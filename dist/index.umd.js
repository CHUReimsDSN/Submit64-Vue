(function(O,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(O=typeof globalThis<"u"?globalThis:O||self,e(O["submit64-vue"]={},O.Vue,O.Quasar))})(this,function(O,e,u){"use strict";var Qt=Object.defineProperty;var Mt=(O,e,u)=>e in O?Qt(O,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):O[e]=u;var _=(O,e,u)=>Mt(O,typeof e!="symbol"?e+"":e,u);const fe={class:"flex column"},ue={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},me=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(r){const t=r;function n(){const a=t.formApi.form.formStyle;return{outline:a.fieldOutlined,rounded:a.fieldRounded,square:a.fieldSquare,dense:a.fieldDense,color:a.fieldColor,noCaps:!0}}return(a,o)=>(e.openBlock(),e.createElementBlock("div",fe,[e.createElementVNode("div",ue,[e.createVNode(e.unref(u.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.formApi.submit}),null,16,["loading","onClick"]),t.formApi.reset?(e.openBlock(),e.createBlock(e.unref(u.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.formApi.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.formApi.clear?(e.openBlock(),e.createBlock(e.unref(u.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Vider",onClick:t.formApi.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),pe={class:"flex row items-center"},ge={class:"text-body1 text-weight-medium"},he={class:"flex column q-gutter-md"},ye=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",pe,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(u.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",ge,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",he,[e.renderSlot(n.$slots,"default")])]))}}),Ce=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(r){const t=r;return(n,a)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:a[0]||(a[0]=s=>t.reset())})}}}),be=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createBlock(e.unref(u.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),ke={class:"flex column"},Se=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createElementBlock("div",ke,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,s)=>(e.openBlock(),e.createElementBlock("div",{key:s,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(s)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),j=class j{constructor(){_(this,"_formSettings");_(this,"_formStyle");_(this,"_actionComponent");_(this,"_orphanErrorsComponent");_(this,"_sectionComponent");_(this,"_wrapperResetComponent");_(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0,associationEmptyMessage:"Empty",requiredFieldsHasAsterisk:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:""},this._actionComponent=me,this._orphanErrorsComponent=Se,this._sectionComponent=ye,this._wrapperResetComponent=Ce,this._associationDisplayComponent=be}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};_(j,"_instance",new j);let z=j;class G{constructor(t){_(this,"formApi");_(this,"events",[]);this.formApi=t}when(t,n){const a=t,o=n,s=new _e(a,o,this.formApi);return this.events.push(s),new Ve(s)}static create(t){return new G(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(a=>{const o=a.getTarget();switch(o.target){case"field":n.fields[o.targetName]||(n.fields[o.targetName]={}),n.fields[o.targetName][o.key]||(n.fields[o.targetName][o.key]=[]),n.fields[o.targetName][o.key].push(a.getActionCallback());break;case"section":n.sections[o.targetName]||(n.sections[o.targetName]={}),n.sections[o.targetName][o.key]||(n.sections[o.targetName][o.key]=[]),n.sections[o.targetName][o.key].push(a.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(a.getActionCallback());break}}),n}}class _e{constructor(t,n,a){_(this,"type");_(this,"data");_(this,"formApi");_(this,"action",()=>{});_(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=a}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is invalid":return{target:"field",targetName:this.data.fieldName,key:"onIsInvalid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onIsValid"};case"Section is invalid":return{target:"section",targetName:this.data.sectionName,key:"onIsInvalid"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Section is updated":return{target:"section",targetName:this.data.sectionName,key:"onUpdate"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is invalid":return{target:"form",key:"onIsInvalid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class Ve{constructor(t){_(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const xe={class:"row items-center justify-end"},Fe=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,s=a.rulesBehaviour==="lazy",l=e.ref(),c=e.ref();function i(){l.value&&l.value.hide()}function d(){return c.value?c.value.validate():!1}function k(){return c.value?!c.value.hasError:!1}function m(){c.value&&c.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,k,m)}),(y,F)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":F[1]||(F[1]=R=>t.modelValueOnUpdate(R)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(u.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{ref_key:"popupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=R=>t.modelValueOnUpdate(R)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",xe,[e.createVNode(e.unref(u.QBtn),{onClick:i,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Be={class:"row items-center justify-end"},De={class:"row items-center justify-end"},Ne=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,s=a.rulesBehaviour==="lazy",l=e.ref(),c=e.ref(),i=e.ref();function d(){l.value&&l.value.hide()}function k(){c.value&&c.value.hide()}function m(){return i.value?i.value.validate():!1}function y(){return i.value?!i.value.hasError:!1}function F(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(m,y,F)}),(R,B)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":B[2]||(B[2]=D=>t.modelValueOnUpdate(D)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(u.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{ref_key:"datePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=D=>t.modelValueOnUpdate(D)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Be,[e.createVNode(e.unref(u.QBtn),{onClick:d,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(u.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{ref_key:"timePopupProxyRef",ref:c,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":B[1]||(B[1]=D=>t.modelValueOnUpdate(D)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",De,[e.createVNode(e.unref(u.QBtn),{onClick:k,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),we={class:"flex column"},Re={key:0,class:"q-field__bottom"},Ae={key:1,class:"q-field--error q-field__bottom text-negative"},Ee=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=e.ref(!0),o=t.formApi.form.formStyle;function s(){return n.value===!0}function l(){return n.value===!0}function c(){n.value=!0}return e.watch(()=>t.modelValue,i=>{for(const d of t.rules)if(n.value=d(i),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(s,l,c)}),(i,d)=>(e.openBlock(),e.createElementBlock("div",we,[e.createVNode(e.unref(u.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":d[0]||(d[0]=k=>t.modelValueOnUpdate(k)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",Re,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",Ae,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Te=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=e.ref([]),a=e.ref([]),o=e.ref(),s=t.formApi.form,l=s.formSettings,c=s.formStyle,i=l.rulesBehaviour==="lazy";function d(B,D){if(B===""){D(()=>{a.value=[...n.value]});return}D(()=>{const E=B.toLowerCase();a.value=n.value.filter(I=>I.label.toLowerCase().includes(E))})}function k(){n.value=Object.freeze(t.field.staticSelectOptions??[]),a.value=t.field.staticSelectOptions??[]}function m(){return o.value?o.value.validate():!1}function y(){return o.value?!o.value.hasError:!1}function F(){o.value&&o.value.resetValidation()}function R(){t.clear(),a.value=[]}return e.onMounted(()=>{k(),t.registerBehaviourCallbacks(m,y,F)}),(B,D)=>(e.openBlock(),e.createBlock(e.unref(u.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":D[0]||(D[0]=E=>t.modelValueOnUpdate(E)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(c).fieldOutlined,filled:e.unref(c).fieldFilled,standout:e.unref(c).fieldStandout,borderless:e.unref(c).fieldBorderless,rounded:e.unref(c).fieldRounded,square:e.unref(c).fieldSquare,dense:e.unref(c).fieldDense,hideBottomSpace:e.unref(c).fieldHideBottomSpace,color:e.unref(c).fieldColor,bgColor:e.unref(c).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:a.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:R,onFilter:d},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItem),{dense:e.unref(c).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),te="__init",ne=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.field.componentOptions.associationDisplayComponent,a=t.formApi.form,o=a.formSettings,s=a.formStyle,l=o.rulesBehaviour==="lazy",c=e.ref([]),i=e.ref(m()),d=e.ref(),k=e.ref(te);function m(){return{limit:30,nextPage:1,lastPage:2,isLoading:!1}}function y(C,w){if(C===k.value){w(()=>{});return}const V=t.formApi.getAssociationDataCallback();i.value=m(),k.value=C;const T=t.formApi.form;i.value.isLoading=!0,V({resourceName:T.resourceName,resourceId:T.resourceId,associationName:t.field.metadata.field_association_name,limit:i.value.limit,offset:(i.value.nextPage-1)*i.value.limit,labelFilter:C,context:T.context}).then(A=>{w(()=>{c.value=A.rows,i.value.nextPage=2,i.value.lastPage=Math.ceil(A.row_count/i.value.limit),i.value.isLoading=!1})}).catch(()=>{c.value=[],i.value=m()})}function F(){const C=t.getValueSerialized();!C||!t.field.associationData||(c.value=[{label:t.field.associationData.label[0]??"???",value:C,data:t.field.associationData.data[0]}])}function R(){return d.value?d.value.validate():!1}function B(){return d.value?!d.value.hasError:!1}function D(){d.value&&d.value.resetValidation()}function E(){t.clear(),i.value=m(),c.value=[],k.value=te}function I(C){const w=c.value.length-1;if(i.value.isLoading!==!0&&i.value.nextPage<i.value.lastPage&&C.to===w&&w!==-1){const V=t.formApi.form,T=t.formApi.getAssociationDataCallback();i.value.isLoading=!0,T({resourceName:V.resourceName,resourceId:V.resourceId,associationName:t.field.metadata.field_association_name,limit:i.value.limit,offset:(i.value.nextPage-1)*i.value.limit,labelFilter:k.value,context:V.context}).then(A=>{c.value=c.value.concat(A.rows),i.value.lastPage=Math.ceil(A.row_count/i.value.limit),A.row_count>=i.value.limit&&i.value.nextPage++,i.value.isLoading=!1,C.ref.refresh()})}}return e.onMounted(()=>{e.nextTick(()=>{F()}),t.registerBehaviourCallbacks(R,B,D,F)}),(C,w)=>(e.openBlock(),e.createBlock(e.unref(u.QSelect),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":w[0]||(w[0]=V=>t.modelValueOnUpdate(V)),label:t.field.label,outlined:e.unref(s).fieldOutlined,filled:e.unref(s).fieldFilled,standout:e.unref(s).fieldStandout,borderless:e.unref(s).fieldBorderless,rounded:e.unref(s).fieldRounded,square:e.unref(s).fieldSquare,dense:e.unref(s).fieldDense,hideBottomSpace:e.unref(s).fieldHideBottomSpace,color:e.unref(s).fieldColor,bgColor:e.unref(s).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:c.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:E,onFilter:y,onVirtualScroll:I},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(u.QItem),{dense:e.unref(s).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(V=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:V.opt,itemProps:V.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),oe="__init",re=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.field.componentOptions.associationDisplayComponent,a=t.formApi.form,o=a.formSettings,s=a.formStyle,l=o.rulesBehaviour==="lazy",c=e.ref([]),i=e.ref(m()),d=e.ref(),k=e.ref(oe);function m(){return{limit:30,nextPage:1,lastPage:100,isLoading:!1}}function y(C,w){if(C===k.value){w(()=>{});return}const V=t.formApi.getAssociationDataCallback();i.value=m(),k.value=C;const T=t.formApi.form;i.value.isLoading=!0,V({resourceName:T.resourceName,resourceId:T.resourceId,associationName:t.field.metadata.field_association_name,limit:i.value.limit,offset:(i.value.nextPage-1)*i.value.limit,labelFilter:C,context:T.context}).then(A=>{w(()=>{c.value=A.rows,i.value.nextPage=2,i.value.lastPage=Math.ceil(A.row_count/i.value.limit),i.value.isLoading=!1})}).catch(()=>{c.value=[],i.value=m()})}function F(){const C=t.getValueSerialized();!C||!t.field.associationData||(c.value=C.map((w,V)=>({label:t.field.associationData.label[V]??"???",value:w,data:t.field.associationData.data[V]})))}function R(){return d.value?d.value.validate():!1}function B(){return d.value?!d.value.hasError:!1}function D(){d.value&&d.value.resetValidation()}function E(){t.clear(),i.value=m(),c.value=[],k.value=oe}function I(C){const w=c.value.length-1;if(i.value.isLoading!==!0&&i.value.nextPage<i.value.lastPage&&C.to===w&&w!==-1){const V=t.formApi.form,T=t.formApi.getAssociationDataCallback();i.value.isLoading=!0,T({resourceName:V.resourceName,resourceId:V.resourceId,associationName:t.field.metadata.field_association_name,limit:i.value.limit,offset:(i.value.nextPage-1)*i.value.limit,labelFilter:k.value,context:V.context}).then(A=>{c.value=c.value.concat(A.rows),i.value.lastPage=Math.ceil(A.row_count/i.value.limit),A.row_count>=i.value.limit&&i.value.nextPage++,i.value.isLoading=!1,C.ref.refresh()})}}return e.onMounted(()=>{e.nextTick(()=>{F()}),t.registerBehaviourCallbacks(R,B,D,F)}),(C,w)=>(e.openBlock(),e.createBlock(e.unref(u.QSelect),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":w[0]||(w[0]=V=>t.modelValueOnUpdate(V)),label:t.field.label,hint:t.field.hint,outlined:e.unref(s).fieldOutlined,filled:e.unref(s).fieldFilled,standout:e.unref(s).fieldStandout,borderless:e.unref(s).fieldBorderless,rounded:e.unref(s).fieldRounded,square:e.unref(s).fieldSquare,dense:e.unref(s).fieldDense,hideBottomSpace:e.unref(s).fieldHideBottomSpace,color:e.unref(s).fieldColor,bgColor:e.unref(s).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:c.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:E,onFilter:y,onVirtualScroll:I},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(u.QItem),{dense:e.unref(s).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(V=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:V.opt,itemProps:V.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),X=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,s=a.rulesBehaviour==="lazy",l=e.ref();function c(){return l.value?l.value.validate():!1}function i(){return l.value?!l.value.hasError:!1}function d(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,i,d)}),(k,m)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":m[0]||(m[0]=y=>t.modelValueOnUpdate(y)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ie=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,s=a.rulesBehaviour==="lazy",l=e.ref();function c(){return l.value?l.value.validate():!1}function i(){return l.value?!l.value.hasError:!1}function d(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,i,d)}),(k,m)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":m[0]||(m[0]=y=>t.modelValueOnUpdate(y)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}}),Oe=e.defineComponent({__name:"ColorField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,s=a.rulesBehaviour==="lazy",l=e.ref();function c(){return l.value?l.value.validate():!1}function i(){return l.value?!l.value.hasError:!1}function d(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,i,d)}),(k,m)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":m[1]||(m[1]=y=>t.modelValueOnUpdate(y)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(u.QIcon),{name:"colorize",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QColor),{"model-value":t.modelValue,"onUpdate:modelValue":m[0]||(m[0]=y=>t.modelValueOnUpdate(y))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),ze=e.defineComponent({__name:"WysiwygField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=u.useQuasar(),o=t.formApi.form.formStyle,s=[[{label:n.lang.editor.align,icon:n.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:n.lang.editor.formatting,icon:n.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:n.lang.editor.fontSize,icon:n.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:n.lang.editor.defaultFont,icon:n.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],l={arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"},c=e.ref();function i(){return!!c.value}function d(){return!!c.value}function k(){}return e.onMounted(()=>{t.registerBehaviourCallbacks(i,d,k)}),console.log(t.modelValue),(m,y)=>(e.openBlock(),e.createBlock(e.unref(u.QEditor),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":y[0]||(y[0]=F=>t.modelValueOnUpdate(F)),toolbar:s,fonts:l,placeholder:t.field.label,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly},null,8,["model-value","placeholder","square","dense","class","readonly"]))}});class L{constructor(t,n,a,o,s,l,c,i,d){_(this,"resourceName");_(this,"resourceId");_(this,"formMetadataAndData");_(this,"context");_(this,"formSettings");_(this,"formStyle");_(this,"actionComponent");_(this,"orphanErrorsComponent");_(this,"sectionComponent");_(this,"wrapperResetComponent");_(this,"associationDisplayComponent");_(this,"dynamicComponentRecord");_(this,"formApi");_(this,"registerEventCallback");this.dynamicComponentRecord=a.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=c,this.resourceName=t,this.formApi=i,this.formSettings={...s,...z.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...l,...z.getGlobalFormStyle()},this.actionComponent=a.actionComponent??z.getGlobalActionComponent(),this.orphanErrorsComponent=a.orphanErrorsComponent??z.getGlobalOrphanErrorComponent(),this.sectionComponent=a.sectionComponent??z.getGlobalSectionComponent(),this.wrapperResetComponent=a.wrapperResetComponent??z.getGlobalWrapperResetComponent(),this.associationDisplayComponent=a.associationDisplayComponent??z.getGlobalAssociationDisplayComponent(),this.registerEventCallback=d??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...z.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:z.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(z.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(z.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(z.getGlobalWrapperResetComponent()),dynamicComponentRecord:{},allowBulk:!1}}static getForm(t,n,a,o,s,l,c,i,d){return new L(t,n,a,o,s,l,c,i,d).generateFormDef()}generateFormDef(){const t=G.create(this.formApi);this.registerEventCallback(t);const n=G.getEventsObjectFromInstance(t),a=[];return this.formMetadataAndData.form.sections.forEach((s,l)=>{const c=[];s.fields.forEach(y=>{const F=this.dynamicComponentRecord[`field-${y.field_name}-before`],R=L.getFieldComponentByFormFieldType(y),B=this.dynamicComponentRecord[`field-${y.field_name}-after`],D={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:L.getRegularFieldTypeByFieldType(y.field_type)};let E=y.label;this.formSettings.requiredFieldsHasAsterisk&&y.rules.find(C=>C.type==="required")&&(E=E.concat("*"));const I={type:y.field_type,extraType:y.field_extra_type,metadata:Object.freeze(y),label:E,hint:y.hint??void 0,prefix:y.prefix??void 0,suffix:y.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??s.readonly??y.readonly??void 0,cssClass:y.css_class??void 0,staticSelectOptions:y.static_select_options,associationData:y.field_association_data,rules:y.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:F?e.markRaw(F):void 0,mainComponent:e.markRaw(R),afterComponent:B?e.markRaw(B):void 0,events:n.fields[y.field_name]??{},componentOptions:D};c.push(I)});const i=this.dynamicComponentRecord[`section-${s.name??l}-before`],d=this.sectionComponent,k=this.dynamicComponentRecord[`section-${s.name??l}-after`],m={label:s.label??void 0,icon:s.icon??void 0,cssClass:s.css_class??void 0,hidden:!1,name:s.name??l.toString(),readonly:this.formMetadataAndData.form.readonly??s.readonly??void 0,events:n.sections[s.name??l.toString()]??{},beforeComponent:i?e.markRaw(i):void 0,mainComponent:e.markRaw(d),afterComponent:k?e.markRaw(k):void 0,fields:c};a.push(m)}),{sections:a,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,allowBulk:this.formMetadataAndData.form.allow_bulk??!1,events:n.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context}}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){switch(t.field_type){case"string":switch(t.field_extra_type){case"color":return Oe;case"wysiwyg":return ze;default:return X}case"text":return X;case"number":return Ie;case"date":return Fe;case"datetime":return Ne;case"selectString":return Te;case"selectBelongsTo":return ne;case"selectHasMany":return re;case"selectHasAndBelongsToMany":return re;case"selectHasOne":return ne;case"checkbox":return Ee;case"object":default:return X}}}function N(r){r==null||r.forEach(t=>{t()})}function $e(r,t,n){const a=n.form,o=(i,d,k)=>i[d]?k?()=>s(i[d]):()=>i[d]:i.compare_to?()=>{var m;return((m=n.getFieldByName(i.compare_to))==null?void 0:m.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",s=i=>String(u.date.formatDate(u.date.extractDate(i,a.formSettings.backendDateFormat),a.formSettings.dateFormat)),l=[],c=[];switch(t){case"date":l.push(ie(a.formSettings.dateFormat));break;case"datetime":l.push(ie(a.formSettings.datetimeFormat));break}return r.forEach(i=>{const d=i;switch(d.type){case"required":l.push(Pe());break;case"absence":l.push(Le());break;case"acceptance":l.push(Qe());break;case"inclusion":l.push(ae(d.including));break;case"exclusion":l.push(Ue(d.excluding));break;case"backend":break;case"allowNull":c.push("allowNull");break;case"allowBlank":c.push("allowBlank");break;case"positiveNumber":l.push(Ge());break;case"lessThanOrEqualNumber":l.push(He(o(d,"less_than")));break;case"lessThanNumber":l.push(ve(o(d,"less_than")));break;case"greaterThanOrEqualNumber":l.push(Ye(o(d,"greater_than")));break;case"greaterThanNumber":l.push(je(o(d,"greater_than")));break;case"equalToNumber":l.push(We(o(d,"equal_to")));break;case"otherThanNumber":l.push(Je(o(d,"other_than")));break;case"numberIntegerOnly":l.push(Ke());break;case"numberNumericOnly":l.push(Xe());break;case"numberEvenOnly":l.push(Ze());break;case"numberOddOnly":l.push(et());break;case"lessThanOrEqualStringLength":l.push(tt(o(d,"less_than")));break;case"lessThanStringLength":l.push(nt(o(d,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(ot(o(d,"greater_than")));break;case"greaterThanStringLength":l.push(rt(o(d,"greater_than")));break;case"equalToStringLength":l.push(lt(o(d,"equal_to")));break;case"equalToString":l.push(it(o(d,"equal_to")));break;case"betweenStringLength":l.push(at(()=>d.min,()=>d.max));break;case"otherThanString":l.push(st(o(d,"other_than")));break;case"lessThanOrEqualDate":l.push(ct(o(d,"less_than",!0),a.formSettings.dateFormat));break;case"lessThanDate":l.push(dt(o(d,"less_than",!0),a.formSettings.dateFormat));break;case"greaterThanOrEqualDate":l.push(ft(o(d,"greater_than",!0),a.formSettings.dateFormat));break;case"greaterThanDate":l.push(ut(o(d,"greater_than",!0),a.formSettings.dateFormat));break;case"equalToDate":l.push(mt(o(d,"equal_to",!0),a.formSettings.dateFormat));break;case"otherThanDate":l.push(pt(o(d,"other_than",!0),a.formSettings.dateFormat));break}}),c.length>0?c.map(i=>{switch(i){case"allowBlank":return qe(l);case"allowNull":return Me(l)}}):l}function Pe(){return r=>!!r||"Ce champ est requis"}function ae(r){return t=>r.includes(String(t))||`Doit être contenu dans ${r.toString()}`}function Ue(r){return t=>!r.includes(String(t)||`Ne doit pas être contenu dans ${ae.toString()}`)}function Le(){return r=>!r||"Ce champ doit être vide"}function Qe(){return r=>!!r||"Doit être accepté"}function Me(r){return t=>(t===null||r.forEach(n=>{const a=n(t);if(a!==!0)return a}),!0)}function qe(r){return t=>(t===""||r.forEach(n=>{const a=n(t);if(a!==!0)return a}),!0)}function Ge(){return r=>Number(r)>0||"Val. positive uniquement"}function He(r){return t=>{const n=r();return Number(t)<=n||`Inf. ou égal à ${n}`}}function ve(r){return t=>{const n=r();return Number(t)<n||`Inf. ${n}`}}function Ye(r){return t=>{const n=r();return Number(t)>=n||`Sup. ou égal à ${n}`}}function je(r){return t=>{const n=r();return Number(t)>n||`Sup. à ${n}`}}function We(r,t){return n=>{const a=r();return Number(n)===a||`Égale à ${a}`}}function Je(r,t){return n=>{const a=r();return Number(n)!==a||`Doit être différent de ${r}`}}function Ke(){return r=>/^-?\d+$/.test(String(r).trim())||"Nombre entier uniquement"}function Xe(){return r=>/^-?\d+(\.\d+)?$/.test(String(r).trim())||"Caractère numérique uniquement"}function Ze(){return r=>Number.isInteger(Number(r))&&Number(r)%2===0||"Nombre pair uniquement"}function et(){return r=>Number.isInteger(Number(r))&&Number(r)%2===1||"Nombre impair uniquement"}function tt(r){return t=>{const n=r();return String(t).length<=n||`Inf. ou égal à ${n}`}}function nt(r){return t=>{const n=r();return String(t).length<n||`Inf. à ${n}`}}function ot(r){return t=>{const n=r();return String(t).length>=n||`Sup. ou égal à ${n}`}}function rt(r){return t=>{const n=r();return String(t).length>n||`Sup. à ${n}`}}function at(r,t){return n=>{const a=r(),o=t();return String(n).length>=a&&String(n).length<=o||`Entre ${a} et ${o}`}}function it(r,t){return n=>{const a=r();return String(n)===a||`Égale à ${a}`}}function lt(r){return t=>{const n=r();return String(t).length===n||`Doit contenir ${n} caractères`}}function st(r){return t=>{const n=r();return String(t)!==n||`Doit être différent de ${n}`}}function ct(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),s=u.date.extractDate(a,t);return o<=s||`Inf. ou égal à ${a}`}}function dt(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),s=u.date.extractDate(a,t);return o<s||`Inf. à ${a}`}}function ft(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),s=u.date.extractDate(a,t);return o>=s||`Sup. ou égal à ${a}`}}function ut(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),s=u.date.extractDate(a,t);return o>s||`Sup. à ${a}`}}function mt(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),s=u.date.extractDate(a,t);return o===s||`Égale à ${o}`}}function pt(r,t){return n=>{const a=r();return u.date.extractDate(String(n),t)!==u.date.extractDate(a,t)||`Doit être différent de ${a}`}}function ie(r){return t=>t==null||t===""?!0:gt(t,r)||`Date invalide. Format : ${r}`}function gt(r,t){if(typeof r!="string"||!r.trim())return!1;const n=u.date.extractDate(r,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:u.date.formatDate(n,t)===r}const ht={computeServerRules:$e},yt={key:2,class:"q-field__bottom text-negative q-pt-none"},Ct=["index"],bt=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(r,{expose:t}){const n=r;let a=()=>!0,o=()=>!0,s=()=>{},l=()=>{};const c=R(),i=e.ref(),d=e.ref([]);function k(p=!0){i.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),i.value=m(i.value),p&&N(n.field.events.onReset),l(),e.nextTick(()=>{W()})}function m(p){const S=n.formApi.form;switch(n.field.type){case"checkbox":return p==null||p===""?!1:p;case"date":return p==null||p===""?null:u.date.formatDate(u.date.extractDate(String(p),S.formSettings.backendDateFormat),S.formSettings.dateFormat);case"datetime":return p==null||p===""?null:u.date.formatDate(u.date.extractDate(String(p),S.formSettings.backendDatetimeFormat),S.formSettings.datetimeFormat)}return p}function y(p){const S=n.formApi.form;switch(n.field.type){case"date":return p==null||p===""?null:u.date.formatDate(u.date.extractDate(String(p),S.formSettings.dateFormat),S.formSettings.backendDateFormat);case"datetime":return p==null||p===""?null:u.date.formatDate(u.date.extractDate(String(p),S.formSettings.datetimeFormat),S.formSettings.backendDatetimeFormat)}return p}function F(){switch(n.field.type){case"string":i.value="";break;case"checkbox":i.value=!1;break;case"date":i.value=null;break;case"datetime":i.value=null;break;case"number":i.value=null;break;case"selectString":i.value=void 0;break;case"text":i.value="";break;case"object":i.value={};break;case"selectBelongsTo":i.value=void 0;break;case"selectHasMany":i.value=void 0;break}N(n.field.events.onClear)}function R(){return ht.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function B(p){i.value=p}function D(){return e.unref(i)}function E(){return y(e.unref(i))}function I(p){d.value=p}function C(){const p=n.privateFormApi.getFieldRef(n.field.metadata.field_name);p&&(p.hidden=!0,N(n.field.events.onHide))}function w(){const p=n.privateFormApi.getFieldRef(n.field.metadata.field_name);p&&(p.hidden=!1,N(n.field.events.onUnhide))}function V(p){const S=n.privateFormApi.getFieldRef(n.field.metadata.field_name);S&&(S.readonly=p)}function T(p){const S=n.privateFormApi.getFieldRef(n.field.metadata.field_name);S&&(S.hint=p)}function A(p){const S=n.privateFormApi.getFieldRef(n.field.metadata.field_name);S&&(S.cssClass=p)}function H(p){const S=n.privateFormApi.getFieldRef(n.field.metadata.field_name);S&&(S.suffix=p)}function M(p){const S=n.privateFormApi.getFieldRef(n.field.metadata.field_name);S&&(S.prefix=p)}function g(p){const S=n.privateFormApi.getFieldRef(n.field.metadata.field_name);S&&(S.label=p)}function b(){const p=a();return N(n.field.events.onValidated),p}function $(){return o()}function Z(){return!$()}function W(){return s()}function ee(p,S,Y,q){a=p,o=S,s=Y,q&&(l=q)}const v={reset:k,clear:F,validate:b,isValid:$,isInvalid:Z,hide:C,unhide:w,resetValidation:W,getValueDeserialized:E,getValueSerialized:D,setupBackendErrors:I,setReadonlyState:V,setHint:T,setCssClass:A,setSuffix:H,setPrefix:M,setLabel:g,setValue:B,field:n.field};return t(v),e.watch(()=>n.field.events.onUpdate?i.value:null,()=>{N(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid||n.field.events.onIsInvalid?i.value:null,p=>{N(p?n.field.events.onIsValid:n.field.events.onIsInvalid)}),e.onMounted(()=>{var S;k(!1);const p=(S=e.getCurrentInstance())==null?void 0:S.exposed;p&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,p)}),(p,S)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:v},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:i.value,field:n.field,formApi:n.formApi,rules:e.unref(c),reset:k,clear:F,getValueDeserialized:E,getValueSerialized:D,validate:b,modelValueOnUpdate:B,registerBehaviourCallbacks:ee},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:v},null,8,["formApi"])):e.createCommentVNode("",!0),d.value.length>0?(e.openBlock(),e.createElementBlock("div",yt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value,(Y,q)=>(e.openBlock(),e.createElementBlock("div",{index:q,class:"flex column"},e.toDisplayString(Y),9,Ct))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),kt={class:"flex column"},St=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(r,{expose:t}){const n=r;let a=null,o=null,s=null;const l={reset:d,clear:k,validate:F,isValid:R,isInvalid:B,hide:m,unhide:y,resetValidation:D,getFields:E,setReadonlyState:I,setCssClass:C,setIcon:w,setLabel:V,section:n.section},c=e.ref(new Map);function i(){n.section.fields.forEach(g=>{const b=g.metadata.field_name,$=n.formApi.getFieldByName(b);$&&c.value.set(b,$)})}function d(){c.value.forEach(g=>{g.reset()}),N(n.section.events.onReset)}function k(){c.value.forEach(g=>{g.clear()}),N(n.section.events.onClear)}function m(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(c.value.forEach(b=>{b.hide()}),g.hidden=!0,N(n.section.events.onHide))}function y(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(c.value.forEach(b=>{b.unhide()}),g.hidden=!1,N(n.section.events.onUnhide))}function F(){let g=!0;return c.value.forEach(b=>{if(!b.validate()){g=!1;return}}),N(n.section.events.onValidated),g}function R(){let g=!0;return c.value.forEach(b=>{if(!b.isValid()){g=!1;return}}),g}function B(){return!R()}function D(){c.value.forEach(g=>{g.resetValidation()})}function E(){return c.value}function I(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.readonly=g)}function C(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.cssClass=g)}function w(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.icon=g)}function V(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.label=g)}function T(){const g={};for(const[b,$]of c.value)g[b]=$.getValueSerialized();return g}t(l);const A=e.computed(()=>R()),H=e.computed(()=>B()),M=e.computed(()=>T());return e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onIsValid},g=>{a==null||a(),a=null,g&&(a=e.watch(A,b=>{b&&N(n.section.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onIsInvalid},g=>{o==null||o(),o=null,g&&(o=e.watch(H,b=>{var $;b&&N(($=n.section)==null?void 0:$.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onUpdate},g=>{s==null||s(),s=null,g&&(s=e.watch(M,()=>{var b;N((b=n.section)==null?void 0:b.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(()=>{var b;const g=(b=e.getCurrentInstance())==null?void 0:b.exposed;g&&n.privateFormApi.registerSectionWrapperRef(n.section.name,g),e.nextTick(()=>{i()})}),(g,b)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",kt,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:l,formApi:n.formApi},{default:e.withCtx(()=>[e.renderSlot(g.$slots,"default")]),_:3},8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}}),_t={class:"flex column"},Vt=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(r,{expose:t}){const n=r;let a=null,o="",s=0,l=0,c=null,i=null,d=null;const k=e.useSlots(),m=e.ref(L.getEmptyFormBeforeInit()),y=e.ref(!1),F=e.ref(!1),R=e.ref(!1),B=e.ref(!1),D=e.ref("create"),E=e.ref({}),I=e.ref(new Map),C=e.ref(new Map);async function w(){a=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),m.value=L.getForm(n.resourceName,n.resourceId,T(),a,n.formSettings,n.formStyle,n.context,Q,n.eventManager),s=m.value.sections.length,l=m.value.sections.map(f=>f.fields).flat().length,n.resourceId&&(D.value="edit")}async function V(){var x,P,J;if(!M())return;N((x=m.value)==null?void 0:x.events.onSubmit),B.value=!0,ee();const f=A(),h=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:f,context:n.context});if(h.success)E.value={},D.value==="create"&&(D.value="edit"),a&&h.resource_data&&(a.resource_data=h.resource_data),o=JSON.stringify(A()),m.value=L.getForm(n.resourceName,n.resourceId,T(),{form:h.form,resource_data:h.resource_data},n.formSettings,n.formStyle,n.context,Q,n.eventManager),N((J=m.value)==null?void 0:J.events.onSubmitSuccess);else{E.value={};const K=[];for(const[U,Lt]of C.value){const de=h.errors[U];de&&(Lt.setupBackendErrors(de),K.push(U))}Object.entries(h.errors).forEach(U=>{K.includes(U[0])||(E.value[U[0]]=U[1])}),N((P=m.value)==null?void 0:P.events.onSubmitUnsuccess)}B.value=!1}function T(){const f={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const h in k){const x=k[h];if(x){const P=e.defineComponent({inheritAttrs:!1,setup(J,{attrs:K,slots:U}){return()=>x({...J,...K,slots:U})}});switch(h){case"sections":f.sectionComponent=P;break;case"actions":f.actionComponent=P;break;case"orphan-errors":f.orphanErrorsComponent=P;break;case"association-display":f.associationDisplayComponent=P;break;default:f.dynamicComponentRecord[h]=P;break}}}return f}function A(){const f={};for(const[h,x]of C.value)f[h]=x.getValueDeserialized();return f}function H(){const f={};for(const[h,x]of C.value)f[h]=x.getValueSerialized();return f}function M(){var h;let f=!0;return C.value.forEach(x=>{if(!x.validate()){f=!1;return}}),N((h=m.value)==null?void 0:h.events.onValidated),f}function g(){let f=!0;return C.value.forEach(h=>{if(!h.isValid()){f=!1;return}}),f}function b(){return!g()}function $(){var f;C.value.forEach(h=>{h.reset()}),N((f=m.value)==null?void 0:f.events.onReset)}function Z(){var f;C.value.forEach(h=>{h.clear()}),N((f=m.value)==null?void 0:f.events.onClear)}function W(){C.value.forEach(f=>{f.resetValidation()})}function ee(){C.value.forEach(f=>{f.setupBackendErrors([])})}function v(f){if(a)return a.resource_data[f]}function p(f){return I.value.get(f)}function S(f){return[...I.value.values()].at(f)}function Y(){return I.value}function q(f){return C.value.get(f)}function xt(){return C.value}function Ft(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function Bt(){["getMetadataAndData","resourceName"].forEach(h=>{(n[h]===null||n[h]===void 0)&&console.warn(`Missing props for <Submit64> -> ${h}`)})}function Dt(){return e.unref(D)}function Nt(){return o!==JSON.stringify(A())}function wt(f){m.value&&(m.value.context=f)}function Rt(f){m.value&&(m.value.cssClass=f)}function At(f){m.value&&(m.value.readonly=f)}function Et(){return R.value}function Tt(){return m}function It(f){var h;return(h=m.value)==null?void 0:h.sections.find(x=>x.name===f)}function Ot(f){var h;return(h=m.value)==null?void 0:h.sections.map(x=>x.fields).flat().find(x=>x.metadata.field_name===f)}function le(f,h){I.value.set(f,h),s===I.value.size&&(y.value=!0)}function se(f,h){C.value.set(f,h),l===C.value.size&&(F.value=!0)}const ce={getFormRef:Tt,getSectionRef:It,getFieldRef:Ot,registerSectionWrapperRef:le,registerFieldWrapperRef:se},zt=new Proxy({},{get(f,h){var x;return(x=m.value)==null?void 0:x[h]}}),Q={getMode:Dt,getSectionByName:p,getSectionByIndex:S,getSections:Y,getFieldByName:q,getFields:xt,validate:M,isValid:g,isInvalid:b,reset:$,clear:Z,resetValidation:W,submit:V,valuesHasChanged:Nt,getInitialValueByFieldName:v,getAssociationDataCallback:Ft,setContext:wt,setCssClass:Rt,setReadonlyState:At,isReady:Et,form:zt};t(Q);const $t=e.computed(()=>g()),Pt=e.computed(()=>b()),Ut=e.computed(()=>H());return e.watch(()=>y.value&&F.value,f=>{var h;f&&!R.value&&(N((h=m.value)==null?void 0:h.events.onReady),R.value=!0)}),e.watch(()=>{var f;return(f=m.value)==null?void 0:f.events.onIsValid},f=>{c==null||c(),c=null,f&&(c=e.watch($t,h=>{var x;h&&N((x=m.value)==null?void 0:x.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var f;return(f=m.value)==null?void 0:f.events.onIsInvalid},f=>{i==null||i(),i=null,f&&(i=e.watch(Pt,h=>{var x;h&&N((x=m.value)==null?void 0:x.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var f;return(f=m.value)==null?void 0:f.events.onUpdate},f=>{d==null||d(),d=null,f&&(d=e.watch(Ut,()=>{var h;N((h=m.value)==null?void 0:h.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(async()=>{Bt(),await w(),e.nextTick(()=>{o=JSON.stringify(A())})}),(f,h)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",_t,[e.createElementVNode("div",{class:e.normalizeClass(m.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value.sections,x=>(e.openBlock(),e.createBlock(St,{key:x.name,section:x,context:n.context,formApi:Q,privateFormApi:ce,registerRef:le},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.fields,P=>(e.openBlock(),e.createBlock(bt,{key:P.metadata.field_name,field:P,context:n.context,formApi:Q,privateFormApi:ce,registerRef:se},null,8,["field","context"]))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(m.value.orphanErrorsComponent),{orphanErrors:E.value,formApi:Q},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(m.value.actionComponent),{isLoadingSubmit:B.value,formApi:Q},null,8,["isLoadingSubmit"]))],512)),[[e.vShow,R.value]])}});O.DynamicLogicBuilder=G,O.Submit64=z,O.Submit64Form=Vt,Object.defineProperty(O,Symbol.toStringTag,{value:"Module"})});
