(function(B,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(B=typeof globalThis<"u"?globalThis:B||self,e(B["submit64-vue"]={},B.Vue,B.Quasar))})(this,function(B,e,c){"use strict";var rt=Object.defineProperty;var lt=(B,e,c)=>e in B?rt(B,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):B[e]=c;var S=(B,e,c)=>lt(B,typeof e!="symbol"?e+"":e,c);const A={class:"flex column"},Y={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},W=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},functionsProvider:{},submit:{type:Function},reset:{type:Function},clear:{type:Function}},setup(o){const t=o;function n(){const l=t.functionsProvider.getFormFactoryInstance().formStyle;return{outline:l.fieldOutlined,rounded:l.fieldRounded,square:l.fieldSquare,dense:l.fieldDense,color:l.fieldColor,noCaps:!0}}return(l,r)=>(e.openBlock(),e.createElementBlock("div",A,[e.createElementVNode("div",Y,[e.createVNode(e.unref(c.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:r[0]||(r[0]=i=>t.submit())}),null,16,["loading"]),t.reset?(e.openBlock(),e.createBlock(e.unref(c.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:r[1]||(r[1]=i=>t.reset())}),null,16,["loading"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(c.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Vider",onClick:r[2]||(r[2]=i=>t.clear())}),null,16,["loading"])):e.createCommentVNode("",!0)])]))}}),M={class:"flex row items-center"},J={class:"text-body1 text-weight-medium"},X={class:"flex column q-gutter-sm"},Z=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{},functionsProvider:{},context:{}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance().formStyle;return(l,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",t.section.cssClass])},[e.createElementVNode("div",M,[t.section.icon?(e.openBlock(),e.createBlock(e.unref(c.QIcon),{key:0,name:t.section.icon,size:"sm",color:e.unref(n).fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",J,e.toDisplayString(t.section.label),1)]),e.createElementVNode("div",X,[e.renderSlot(l.$slots,"default")])],2))}}),K=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(o){const t=o;return(n,l)=>{const r=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(r,{name:"reset",class:"cursor-pointer",onClick:l[0]||(l[0]=i=>t.reset())})}}}),v=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(o){const t=o;return(n,l)=>(e.openBlock(),e.createBlock(e.unref(c.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),ee={class:"flex column"},te=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},functionsProvider:{}},setup(o){const t=o;return(n,l)=>(e.openBlock(),e.createElementBlock("div",ee,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(r,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(i)+" : "+e.toDisplayString(r.join(",")),1))),128))]))}}),w=class w{constructor(){S(this,"_formSettings");S(this,"_formStyle");S(this,"_actionComponent");S(this,"_orphanErrorsComponent");S(this,"_sectionComponent");S(this,"_wrapperResetComponent");S(this,"_associationDisplayComponent");S(this,"_associationDisplayDictonary");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=W,this._orphanErrorsComponent=te,this._sectionComponent=Z,this._wrapperResetComponent=K,this._associationDisplayComponent=v,this._associationDisplayDictonary={}}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static registerGlobalAssociationDisplayRecord(t){this._instance._associationDisplayDictonary=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}static getGlobalAssociationDisplayRecord(){return this._instance._associationDisplayDictonary}};S(w,"_instance",new w);let T=w;const ne={class:"row items-center justify-end"},oe=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),l=n.formSettings,r=n.formStyle,i=l.rulesBehaviour==="lazy",s=e.ref(),a=e.ref();function f(){s.value&&s.value.hide()}function d(){return a.value?a.value.validate():!1}function u(){a.value&&a.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,u)}),(y,F)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:a,"model-value":t.modelValue,"onUpdate:modelValue":F[1]||(F[1]=x=>t.modelValueOnUpdate(x)),label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"popupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=x=>t.modelValueOnUpdate(x)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",ne,[e.createVNode(e.unref(c.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),re={class:"row items-center justify-end"},le={class:"row items-center justify-end"},ae=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),l=n.formSettings,r=n.formStyle,i=l.rulesBehaviour==="lazy",s=e.ref(),a=e.ref(),f=e.ref();function d(){s.value&&s.value.hide()}function u(){a.value&&a.value.hide()}function y(){return f.value?f.value.validate():!1}function F(){f.value&&f.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(y,F)}),(x,C)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":C[2]||(C[2]=p=>t.modelValueOnUpdate(p)),label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"datePopupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":C[0]||(C[0]=p=>t.modelValueOnUpdate(p)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",re,[e.createVNode(e.unref(c.QBtn),{onClick:d,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"timePopupProxyRef",ref:a,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":C[1]||(C[1]=p=>t.modelValueOnUpdate(p)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",le,[e.createVNode(e.unref(c.QBtn),{onClick:u,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),ie={class:"flex column"},se={key:0,class:"q-field__bottom"},ce={key:1,class:"q-field--error q-field__bottom text-negative"},de=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=e.ref(!0),r=t.functionsProvider.getFormFactoryInstance().formStyle;function i(){return n.value===!0}function s(){n.value=!0}return e.watch(()=>t.modelValue,a=>{for(const f of t.rules)if(n.value=f(a),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(i,s)}),(a,f)=>(e.openBlock(),e.createElementBlock("div",ie,[e.createVNode(e.unref(c.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":f[0]||(f[0]=d=>t.modelValueOnUpdate(d)),label:t.field.label,dense:e.unref(r).fieldDense,color:e.unref(r).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",se,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",ce,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),ue=e.defineComponent({__name:"ObjectField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const n=o.functionsProvider.getFormFactoryInstance(),l=n.formSettings;return n.formStyle,l.rulesBehaviour,(r,i)=>" TODO json edit ? "}}),fe=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=e.ref([]),l=e.ref([]),r=e.ref(),i=t.functionsProvider.getFormFactoryInstance(),s=i.formSettings,a=i.formStyle,f=s.rulesBehaviour==="lazy";function d(C,p){if(C===""){p(()=>{l.value=[...n.value]});return}p(()=>{const _=C.toLowerCase();l.value=n.value.filter(h=>h.label.toLowerCase().includes(_))})}function u(){n.value=Object.freeze(t.field.staticSelectOptions??[]),l.value=t.field.staticSelectOptions??[]}function y(){return r.value?r.value.validate():!1}function F(){r.value&&r.value.resetValidation()}function x(){t.clear(),l.value=[]}return e.onMounted(()=>{u(),t.registerBehaviourCallbacks(y,F)}),(C,p)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:r,"model-value":t.modelValue,"onUpdate:modelValue":p[0]||(p[0]=_=>t.modelValueOnUpdate(_)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(a).fieldOutlined,filled:e.unref(a).fieldFilled,standout:e.unref(a).fieldStandout,borderless:e.unref(a).fieldBorderless,rounded:e.unref(a).fieldRounded,square:e.unref(a).fieldSquare,dense:e.unref(a).fieldDense,hideBottomSpace:e.unref(a).fieldHideBottomSpace,color:e.unref(a).fieldColor,bgColor:e.unref(a).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:x,onFilter:d},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}});function R(){return 20}const me=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.field.componentOptions.associationDisplayComponent,l=t.functionsProvider.getFormFactoryInstance(),r=l.formSettings,i=l.formStyle,s=r.rulesBehaviour==="lazy",a=e.ref([]),f=e.ref({limit:R(),offset:0}),d=e.ref();function u(p,_){const h=t.functionsProvider.getAssociationDataCallback();p===""&&(f.value={limit:R(),offset:0}),_(()=>{const D=t.functionsProvider.getForm();h({resourceName:D.resourceName,resourceId:D.resourceId,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:p,context:D.context}).then(E=>{a.value=E.rows}).catch(()=>{a.value=[]})})}function y(){e.nextTick(()=>{const p=t.getValueSerialized();!p||!t.field.associationData||(a.value=[{label:t.field.associationData.label[0]??"???",value:p,data:t.field.associationData.data[0]}])})}function F(){return d.value?d.value.validate():!1}function x(){d.value&&d.value.resetValidation()}function C(){t.clear(),a.value=[]}return e.onMounted(()=>{y(),t.registerBehaviourCallbacks(F,x)}),(p,_)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=h=>t.modelValueOnUpdate(h)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:a.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:C,onFilter:u},{options:e.withCtx(h=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),e.normalizeProps(e.guardReactiveProps({associationName:t.field.metadata.field_association_name,entry:h.opt,itemProps:h.itemProps})),null,16))]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),pe=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.field.componentOptions.associationDisplayComponent,l=t.functionsProvider.getFormFactoryInstance(),r=l.formSettings,i=l.formStyle,s=r.rulesBehaviour==="lazy",a=e.ref([]),f=e.ref({limit:R(),offset:0}),d=e.ref();function u(p,_){const h=t.functionsProvider.getAssociationDataCallback();p===""&&(f.value={limit:R(),offset:0}),_(()=>{const D=t.functionsProvider.getForm();h({resourceName:D.resourceName,resourceId:D.resourceId,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:p,context:D.context}).then(E=>{a.value=E.rows}).catch(()=>{a.value=[]})})}function y(){e.nextTick(()=>{const p=t.getValueSerialized();!p||!t.field.associationData||(a.value=p.map((_,h)=>({label:t.field.associationData.label[h]??"???",value:_,data:t.field.associationData.data[h]})))})}function F(){return d.value?d.value.validate():!1}function x(){d.value&&d.value.resetValidation()}function C(){t.clear(),a.value=[]}return e.onMounted(()=>{y(),t.registerBehaviourCallbacks(F,x)}),(p,_)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=h=>t.modelValueOnUpdate(h)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:a.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:C,onFilter:u},{options:e.withCtx(h=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),e.normalizeProps(e.guardReactiveProps({associationName:t.field.metadata.field_association_name,entry:h.opt,itemProps:h.itemProps})),null,16))]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),q=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),l=n.formSettings,r=n.formStyle,i=l.rulesBehaviour==="lazy",s=e.ref();function a(){return s.value?s.value.validate():!1}function f(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(a,f)}),(d,u)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":u[0]||(u[0]=y=>t.modelValueOnUpdate(y)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),ge=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),l=n.formSettings,r=n.formStyle,i=l.rulesBehaviour==="lazy",s=e.ref();function a(){return s.value?s.value.validate():!1}function f(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(a,f)}),(d,u)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":u[0]||(u[0]=y=>t.modelValueOnUpdate(y)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}});class ${constructor(t,n,l,r){S(this,"resourceName");S(this,"formSettings");S(this,"formStyle");S(this,"actionComponent");S(this,"orphanErrorsComponent");S(this,"sectionComponent");S(this,"wrapperResetComponent");S(this,"associationDisplayComponent");S(this,"associationDisplayRecord");this.resourceName=t,this.formSettings={...l,...T.getGlobalFormSetting()},this.formStyle={...r,...T.getGlobalFormStyle()},this.actionComponent=n.actionComponent??T.getGlobalActionComponent(),this.orphanErrorsComponent=n.orphanErrorsComponent??T.getGlobalOrphanErrorComponent(),this.sectionComponent=n.sectionComponent??T.getGlobalSectionComponent(),this.wrapperResetComponent=n.wrapperResetComponent??T.getGlobalWrapperResetComponent(),this.associationDisplayComponent=n.associationDisplayComponent??T.getGlobalAssociationDisplayComponent(),this.associationDisplayRecord=n.associationDisplayRecord??T.getGlobalAssociationDisplayRecord()}getForm(t,n,l){const r=[];return t.form.sections.forEach(s=>{const a=[];s.fields.forEach(d=>{const u=$.getFieldComponentByFormFieldType(d.field_type),y={associationDisplayComponent:this.associationDisplayRecord[d.field_association_class??""]??this.associationDisplayComponent,regularFieldType:this.getRegularFieldTypeByFieldType(d.field_type)},F={type:d.field_type,metadata:d,label:d.label,hint:d.hint,prefix:d.prefix,suffix:d.suffix,readonly:t.form.readonly??s.readonly??d.readonly,cssClass:d.css_class,staticSelectOptions:d.static_select_options,associationData:d.field_association_data,rules:d.rules,clearable:t.form.clearable,component:u,componentOptions:y};a.push(F)});const f={label:s.label,icon:s.icon,cssClass:s.css_class,readonly:t.form.readonly??s.readonly,fields:a};r.push(f)}),{sections:r,resourceName:t.form.resource_name,resourceId:n,cssClass:t.form.css_class,resetable:t.form.resetable,clearable:t.form.clearable,readonly:t.form.readonly,backendDateFormat:t.form.backend_date_format,backendDatetimeFormat:t.form.backend_datetime_format,context:l}}getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){return{string:q,text:q,number:ge,date:oe,datetime:ae,selectString:fe,selectBelongsTo:me,selectHasMany:pe,checkbox:de,object:ue}[t]}}function he(o,t,n){const l=n.getFormFactoryInstance().formSettings,r=n.getForm(),i=(d,u,y)=>d[u]?y?()=>s(d[u]):()=>d[u]:d.compare_to?()=>n.getFieldDataByFieldName(d.compare_to)??"Submit64 error : missing comparator definition":()=>"",s=d=>String(c.date.formatDate(c.date.extractDate(d,r.backendDateFormat),l.dateFormat)),a=[],f=[];switch(t){case"date":a.push(L(l.dateFormat));break;case"datetime":a.push(L(l.datetimeFormat));break}return o.forEach(d=>{const u=d;switch(u.type){case"required":a.push(ye());break;case"absence":a.push(Ce());break;case"acceptance":a.push(_e());break;case"inclusion":a.push(Q(u.including));break;case"exclusion":a.push(be(u.excluding));break;case"backend":break;case"allowNull":f.push("allowNull");break;case"allowBlank":f.push("allowBlank");break;case"positiveNumber":a.push(ke());break;case"lessThanOrEqualNumber":a.push(xe(i(u,"less_than")));break;case"lessThanNumber":a.push(Be(i(u,"less_than")));break;case"greaterThanOrEqualNumber":a.push(Ve(i(u,"greater_than")));break;case"greaterThanNumber":a.push(De(i(u,"greater_than")));break;case"equalToNumber":a.push(Ne(i(u,"equal_to")));break;case"otherThanNumber":a.push(Te(i(u,"other_than")));break;case"numberIntegerOnly":a.push(Ee());break;case"numberNumericOnly":a.push(Oe());break;case"numberEvenOnly":a.push(Pe());break;case"numberOddOnly":a.push(Re());break;case"lessThanOrEqualStringLength":a.push(we(i(u,"less_than")));break;case"lessThanStringLength":a.push(ze(i(u,"less_than")));break;case"greaterThanOrEqualStringLength":a.push($e(i(u,"greater_than")));break;case"greaterThanStringLength":a.push(Ie(i(u,"greater_than")));break;case"equalToStringLength":a.push(Qe(i(u,"equal_to")));break;case"equalToString":a.push(qe(i(u,"equal_to")));break;case"betweenStringLength":a.push(Ue(()=>u.min,()=>u.max));break;case"otherThanString":a.push(Le(i(u,"other_than")));break;case"lessThanOrEqualDate":a.push(Ge(i(u,"less_than",!0),l.dateFormat));break;case"lessThanDate":a.push(je(i(u,"less_than",!0),l.dateFormat));break;case"greaterThanOrEqualDate":a.push(He(i(u,"greater_than",!0),l.dateFormat));break;case"greaterThanDate":a.push(Ae(i(u,"greater_than",!0),l.dateFormat));break;case"equalToDate":a.push(Ye(i(u,"equal_to",!0),l.dateFormat));break;case"otherThanDate":a.push(We(i(u,"other_than",!0),l.dateFormat));break}}),f.length>0?f.map(d=>{switch(d){case"allowBlank":return Fe(a);case"allowNull":return Se(a)}}):a}function ye(){return o=>!!o||"Ce champ est requis"}function Q(o){return t=>o.includes(String(t))||`Doit être contenu dans ${o.toString()}`}function be(o){return t=>!o.includes(String(t)||`Ne doit pas être contenu dans ${Q.toString()}`)}function Ce(){return o=>!o||"Ce champ doit être vide"}function _e(){return o=>!!o||"Doit être accepté"}function Se(o){return t=>(t===null||o.forEach(n=>{const l=n(t);if(l!==!0)return l}),!0)}function Fe(o){return t=>(t===""||o.forEach(n=>{const l=n(t);if(l!==!0)return l}),!0)}function ke(){return o=>Number(o)>0||"Val. positive uniquement"}function xe(o){return t=>{const n=o();return Number(t)<=n||`Inf. ou égal à ${n}`}}function Be(o){return t=>{const n=o();return Number(t)<n||`Inf. ${n}`}}function Ve(o){return t=>{const n=o();return Number(t)>=n||`Sup. ou égal à ${n}`}}function De(o){return t=>{const n=o();return Number(t)>n||`Sup. à ${n}`}}function Ne(o,t){return n=>{const l=o();return Number(n)===l||`Égale à ${l}`}}function Te(o,t){return n=>{const l=o();return Number(n)!==l||`Doit être différent de ${o}`}}function Ee(){return o=>/^-?\d+$/.test(String(o).trim())||"Nombre entier uniquement"}function Oe(){return o=>/^-?\d+(\.\d+)?$/.test(String(o).trim())||"Caractère numérique uniquement"}function Pe(){return o=>Number.isInteger(Number(o))&&Number(o)%2===0||"Nombre pair uniquement"}function Re(){return o=>Number.isInteger(Number(o))&&Number(o)%2===1||"Nombre impair uniquement"}function we(o){return t=>{const n=o();return String(t).length<=n||`Inf. ou égal à ${n}`}}function ze(o){return t=>{const n=o();return String(t).length<n||`Inf. à ${n}`}}function $e(o){return t=>{const n=o();return String(t).length>=n||`Sup. ou égal à ${n}`}}function Ie(o){return t=>{const n=o();return String(t).length>n||`Sup. à ${n}`}}function Ue(o,t){return n=>{const l=o(),r=t();return String(n).length>=l&&String(n).length<=r||`Entre ${l} et ${r}`}}function qe(o,t){return n=>{const l=o();return String(n)===l||`Égale à ${l}`}}function Qe(o){return t=>{const n=o();return String(t).length===n||`Doit contenir ${n} caractères`}}function Le(o){return t=>{const n=o();return String(t)!==n||`Doit être différent de ${n}`}}function Ge(o,t){return n=>{const l=o(),r=c.date.extractDate(String(n),t),i=c.date.extractDate(l,t);return r<=i||`Inf. ou égal à ${l}`}}function je(o,t){return n=>{const l=o(),r=c.date.extractDate(String(n),t),i=c.date.extractDate(l,t);return r<i||`Inf. à ${l}`}}function He(o,t){return n=>{const l=o(),r=c.date.extractDate(String(n),t),i=c.date.extractDate(l,t);return r>=i||`Sup. ou égal à ${l}`}}function Ae(o,t){return n=>{const l=o(),r=c.date.extractDate(String(n),t),i=c.date.extractDate(l,t);return r>i||`Sup. à ${l}`}}function Ye(o,t){return n=>{const l=o(),r=c.date.extractDate(String(n),t),i=c.date.extractDate(l,t);return r===i||`Égale à ${r}`}}function We(o,t){return n=>{const l=o();return c.date.extractDate(String(n),t)!==c.date.extractDate(l,t)||`Doit être différent de ${l}`}}function L(o){return t=>t==null||t===""?!0:Me(t,o)||`Date invalide. Format : ${o}`}function Me(o,t){if(typeof o!="string"||!o.trim())return!1;const n=c.date.extractDate(o,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:c.date.formatDate(n,t)===o}const Je={computeServerRules:he},Xe={key:0,class:"q-field__bottom text-negative q-pt-none"},Ze=["index"],G=e.defineComponent({__name:"FieldWrapper",props:{field:{},functionsProvider:{},context:{}},setup(o,{expose:t}){const n=o;let l=()=>!0,r=()=>{};const i=F(),s=e.ref(),a=e.ref([]);function f(){s.value=n.functionsProvider.getDataByFieldName(n.field.metadata.field_name),s.value=d(s.value),e.nextTick(()=>{D()})}function d(m){switch(n.field.type){case"checkbox":return m==null||m===""?!1:m;case"date":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),n.functionsProvider.getForm().backendDateFormat),n.functionsProvider.getFormFactoryInstance().formSettings.dateFormat);case"datetime":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),n.functionsProvider.getForm().backendDatetimeFormat),n.functionsProvider.getFormFactoryInstance().formSettings.datetimeFormat)}return m}function u(m){switch(n.field.type){case"date":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),n.functionsProvider.getFormFactoryInstance().formSettings.dateFormat),n.functionsProvider.getForm().backendDateFormat);case"datetime":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),n.functionsProvider.getFormFactoryInstance().formSettings.datetimeFormat),n.functionsProvider.getForm().backendDatetimeFormat)}return m}function y(){switch(n.field.type){case"string":s.value="";break;case"checkbox":s.value=!1;break;case"date":s.value=null;break;case"datetime":s.value=null;break;case"number":s.value=null;break;case"selectString":s.value=void 0;break;case"text":s.value="";break;case"object":s.value={};break;case"selectBelongsTo":s.value=void 0;break;case"selectHasMany":s.value=void 0;break}}function F(){return Je.computeServerRules(n.field.rules??[],n.field.type,n.functionsProvider)}function x(m){s.value=m}function C(){return e.unref(s)}function p(){return u(e.unref(s))}function _(m){a.value=m}function h(){return l()}function D(){return r()}function E(m,O){l=m,r=O}return t({reset:f,clear:y,validate:h,resetValidation:D,getValueDeserialized:p,getValueSerialized:C,setupBackendErrors:_}),e.onMounted(()=>{var O;f();const m=(O=e.getCurrentInstance())==null?void 0:O.exposed;m&&n.functionsProvider&&n.functionsProvider.registerRef(n.field.metadata.field_name,m)}),(m,O)=>(e.openBlock(),e.createElementBlock("div",null,[e.renderSlot(m.$slots,"default",{is:n.field.component,modelValue:s.value,field:n.field,functionsProvider:n.functionsProvider,rules:e.unref(i),reset:f,clear:y,getValueDeserialized:p,getValueSerialized:C,validate:h,modelValueOnUpdate:x,registerBehaviourCallbacks:E},()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.component),{modelValue:s.value,field:n.field,functionsProvider:n.functionsProvider,rules:e.unref(i),reset:f,clear:y,getValueDeserialized:p,getValueSerialized:C,validate:h,modelValueOnUpdate:x,registerBehaviourCallbacks:E},null,8,["modelValue","field","functionsProvider","rules"])),a.value.length>0?(e.openBlock(),e.createElementBlock("div",Xe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value,(I,U)=>(e.openBlock(),e.createElementBlock("div",{index:U,class:"flex column"},e.toDisplayString(I),9,Ze))),256))])):e.createCommentVNode("",!0)])]))}}),Ke={key:0,class:"flex column"},ve=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},onSubmitFail:{},onSubmitSuccess:{},context:{}},setup(o,{expose:t}){const n=o;let l=null;const r=Object.freeze(new $(n.resourceName,C(),n.formSettings,n.formStyle)),i={registerRef:O,getDataByFieldName:I,getFieldDataByFieldName:U,getFormFactoryInstance:j,getForm:H,getAssociationDataCallback:et},s=e.ref(new Map),a=e.ref(),f=e.ref(!1),d=e.ref(!1),u=e.ref("create"),y=e.ref({});async function F(){l=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),a.value=Object.freeze(r.getForm(l,n.resourceId,n.context)),n.resourceId&&(u.value="edit"),f.value=!0}async function x(){var N,P;if(!_())return;d.value=!0,m();const g=p(),b=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:g,context:n.context});if(b.success)y.value={},u.value==="create"&&(u.value="edit"),l&&b.resource_data&&(l.resource_data=b.resource_data),h(),(P=n.onSubmitSuccess)==null||P.call(n);else{y.value={};const k=[];[...s.value].forEach(V=>{const z=b.errors[V[0]];z&&(V[1].setupBackendErrors(z),k.push(V[0]))}),Object.entries(b.errors).forEach(V=>{k.includes(V[0])||(y.value[V[0]]=V[1])}),(N=n.onSubmitFail)==null||N.call(n)}d.value=!1}function C(){const g={},b=e.useSlots(),N=new Map;for(const k in b){const V=b[k];V&&N.set(k,e.defineComponent({setup(z,{attrs:ot}){return()=>V({...z,...ot})}}))}return[["actionComponent","actions","actionComponent"],["orphanErrorsComponent","orphan-errors","orphanErrorsComponent"],["sectionComponent","sections","sectionComponent"],["wrapperResetComponent","wrapper-reset","wrapperResetComponent"],["associationDisplayComponent","association-display","associationDisplayComponent"]].forEach(k=>{const V=n[k[0]];V&&!N.has(k[1])?g[k[2]]=V:N.has(k[1])&&(g[k[2]]=N.get(k[1]))}),g.associationDisplayRecord=n.associationDisplayRecord,console.log(g),g}function p(){const g={};return[...s.value].forEach(b=>{g[b[0]]=b[1].getValueDeserialized()}),g}function _(){let g=!0;return s.value.forEach(b=>{if(!b.validate()){g=!1;return}}),g}function h(){s.value.forEach(g=>{g.reset()})}function D(){s.value.forEach(g=>{g.clear()})}function E(){s.value.forEach(g=>{g.resetValidation()})}function m(){s.value.forEach(g=>{g.setupBackendErrors([])})}function O(g,b){s.value.set(g,b)}function I(g){if(l)return l.resource_data[g]}function U(g){const b=[...s.value].find(N=>N[0]===g);return b?b[1].getValueSerialized():null}function j(){return r}function H(){return e.unref(a.value)}function et(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function tt(){["getMetadataAndData","resourceName"].forEach(b=>{(n[b]===null||n[b]===void 0)&&console.warn(`Missing props for <Submit64> -> ${b}`)})}function nt(){return u.value}return t({getMode:nt,getFormFactoryInstance:j,getForm:H,validateForm:_,resetForm:h,clearForm:D,resetValidation:E,submitForm:x}),e.onMounted(async()=>{tt(),await F()}),(g,b)=>f.value&&a.value?(e.openBlock(),e.createElementBlock("div",Ke,[e.createElementVNode("div",{class:e.normalizeClass(a.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value.sections,(N,P)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r).sectionComponent),{key:P,section:N,context:n.context,"functions-provider":i},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.fields,k=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:k.metadata.field_name},[g.$slots[k.metadata.field_name]?(e.openBlock(),e.createBlock(G,{key:1,field:k,context:n.context,"functions-provider":i},{default:e.withCtx(V=>[e.renderSlot(g.$slots,"default",e.mergeProps({ref_for:!0},V))]),_:3},8,["field","context"])):(e.openBlock(),e.createBlock(G,{key:0,field:k,context:n.context,"functions-provider":i},null,8,["field","context"]))],64))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r).orphanErrorsComponent),{orphanErrors:y.value,"functions-provider":i},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r).actionComponent),{isLoadingSubmit:d.value,submit:x,clear:a.value.clearable?D:void 0,reset:a.value.resetable?h:void 0,"functions-provider":i},null,8,["isLoadingSubmit","clear","reset"]))])):e.createCommentVNode("",!0)}});B.Submit64=T,B.Submit64Form=ve,Object.defineProperty(B,Symbol.toStringTag,{value:"Module"})});
