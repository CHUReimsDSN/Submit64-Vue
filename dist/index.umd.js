(function($,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):($=typeof globalThis<"u"?globalThis:$||self,e($["submit64-vue"]={},$.Vue,$.Quasar))})(this,function($,e,s){"use strict";var Dn=Object.defineProperty;var wn=($,e,s)=>e in $?Dn($,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):$[e]=s;var E=($,e,s)=>wn($,typeof e!="symbol"?e+"":e,s);const he={class:"flex column"},ge={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},ye=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(r){const t=r;function n(){const a=t.formApi.form.formStyle;return{outline:a.fieldOutlined,rounded:a.fieldRounded,square:a.fieldSquare,dense:a.fieldDense,color:a.fieldColor,noCaps:!0}}return(a,o)=>(e.openBlock(),e.createElementBlock("div",he,[e.createElementVNode("div",ge,[e.createVNode(e.unref(s.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.formApi.submit}),null,16,["loading","onClick"]),t.formApi.reset?(e.openBlock(),e.createBlock(e.unref(s.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.formApi.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.formApi.clear?(e.openBlock(),e.createBlock(e.unref(s.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Effacer",onClick:t.formApi.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),Ce={class:"flex row items-center"},be={class:"text-body1 text-weight-medium"},ke={class:"flex column q-gutter-md"},_e=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(t.sectionApi.section.cssClass)},[e.createElementVNode("div",Ce,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(s.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",be,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",ke,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.sectionApi.section.fieldsComponent)))])],2))}}),Ve=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(r){const t=r;return(n,a)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:a[0]||(a[0]=i=>t.reset())})}}}),Se=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createBlock(e.unref(s.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),Fe={class:"flex column"},xe=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createElementBlock("div",Fe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(i)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),oe=class oe{constructor(){E(this,"_formSettings");E(this,"_formStyle");E(this,"_actionComponent");E(this,"_orphanErrorsComponent");E(this,"_sectionComponent");E(this,"_wrapperResetComponent");E(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0,associationEmptyMessage:"Empty",requiredFieldsHasAsterisk:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:""},this._actionComponent=ye,this._orphanErrorsComponent=xe,this._sectionComponent=_e,this._wrapperResetComponent=Ve,this._associationDisplayComponent=Se}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};E(oe,"_instance",new oe);let U=oe;class ee{constructor(t){E(this,"formApi");E(this,"events",[]);this.formApi=t}when(t,n){const a=t,o=n,i=new Be(a,o,this.formApi);return this.events.push(i),new Ne(i)}static create(t){return new ee(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(a=>{const o=a.getTarget();switch(o.target){case"field":n.fields[o.targetName]||(n.fields[o.targetName]={}),n.fields[o.targetName][o.key]||(n.fields[o.targetName][o.key]=[]),n.fields[o.targetName][o.key].push(a.getActionCallback());break;case"section":n.sections[o.targetName]||(n.sections[o.targetName]={}),n.sections[o.targetName][o.key]||(n.sections[o.targetName][o.key]=[]),n.sections[o.targetName][o.key].push(a.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(a.getActionCallback());break}}),n}}class Be{constructor(t,n,a){E(this,"type");E(this,"data");E(this,"formApi");E(this,"action",()=>{});E(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=a}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is invalid":return{target:"field",targetName:this.data.fieldName,key:"onIsInvalid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Field is ready":return{target:"field",targetName:this.data.fieldName,key:"onReady"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onIsValid"};case"Section is invalid":return{target:"section",targetName:this.data.sectionName,key:"onIsInvalid"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Section is updated":return{target:"section",targetName:this.data.sectionName,key:"onUpdate"};case"Section is ready":return{target:"section",targetName:this.data.sectionName,key:"onReady"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is invalid":return{target:"form",key:"onIsInvalid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class Ne{constructor(t){E(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const De={class:"row items-center justify-end"},we=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref(),l=e.ref();function c(){p.value&&p.value.hide()}function u(){return l.value?l.value.validate():!1}function g(){return l.value?!l.value.hasError:!1}function _(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(u,g,_),i||e.nextTick(()=>{var B;(B=l.value)==null||B.resetValidation()})}),(B,m)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":m[1]||(m[1]=T=>t.modelValueOnUpdate(T)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(s.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{ref_key:"popupProxyRef",ref:p,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":m[0]||(m[0]=T=>t.modelValueOnUpdate(T)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",De,[e.createVNode(e.unref(s.QBtn),{onClick:c,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ee={class:"row items-center justify-end"},Re={class:"row items-center justify-end"},Ae=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref(),l=e.ref(),c=e.ref();function u(){p.value&&p.value.hide()}function g(){l.value&&l.value.hide()}function _(){return c.value?c.value.validate():!1}function B(){return c.value?!c.value.hasError:!1}function m(){c.value&&c.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(_,B,m),i||e.nextTick(()=>{var T;(T=c.value)==null||T.resetValidation()})}),(T,R)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":R[2]||(R[2]=V=>t.modelValueOnUpdate(V)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(s.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{ref_key:"datePopupProxyRef",ref:p,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":R[0]||(R[0]=V=>t.modelValueOnUpdate(V)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Ee,[e.createVNode(e.unref(s.QBtn),{onClick:u,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(s.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{ref_key:"timePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":R[1]||(R[1]=V=>t.modelValueOnUpdate(V)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Re,[e.createVNode(e.unref(s.QBtn),{onClick:g,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Te={class:"flex column"},ze={key:0,class:"q-field__bottom"},Ie={key:1,class:"q-field--error q-field__bottom text-negative"},Oe=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=e.ref(!0),o=t.formApi.form.formStyle;function i(){return n.value===!0}function p(){return n.value===!0}function l(){n.value=!0}return e.watch(()=>t.modelValue,c=>{for(const u of t.rules)if(n.value=u(c),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(i,p,l)}),(c,u)=>(e.openBlock(),e.createElementBlock("div",Te,[e.createVNode(e.unref(s.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":u[0]||(u[0]=g=>t.modelValueOnUpdate(g)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",ze,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",Ie,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),$e=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=e.ref([]),a=e.ref([]),o=e.ref(),i=t.formApi.form,p=i.formSettings,l=i.formStyle,c=p.rulesBehaviour==="lazy";function u(R,V){if(R===""){V(()=>{a.value=[...n.value]});return}V(()=>{const z=R.toLowerCase();a.value=n.value.filter(A=>A.label.toLowerCase().includes(z))})}function g(){n.value=Object.freeze(t.field.staticSelectOptions??[]),a.value=t.field.staticSelectOptions??[]}function _(){return o.value?o.value.validate():!1}function B(){return o.value?!o.value.hasError:!1}function m(){o.value&&o.value.resetValidation()}function T(){a.value=[]}return e.onMounted(()=>{g(),t.registerBehaviourCallbacks(_,B,m,void 0,T)}),(R,V)=>(e.openBlock(),e.createBlock(e.unref(s.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":V[0]||(V[0]=z=>t.modelValueOnUpdate(z)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:a.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:u},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(s.QItem),{dense:e.unref(l).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),se="__init",ce=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.field.componentOptions.associationDisplayComponent,a=t.formApi.form,o=a.formSettings,i=a.formStyle,p=o.rulesBehaviour==="lazy",l=e.ref([]),c=e.ref(_()),u=e.ref(),g=e.ref(se);function _(){return{limit:30,nextPage:1,lastPage:2,isLoading:!1}}function B(F,d){if(F===g.value){d(()=>{});return}const f=t.formApi.getAssociationDataCallback();c.value=_(),g.value=F;const k=t.formApi.form;c.value.isLoading=!0,f({resourceName:k.resourceName,resourceId:k.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:F,context:k.context}).then(x=>{d(()=>{l.value=x.rows,c.value.nextPage=2,c.value.lastPage=Math.ceil(x.row_count/c.value.limit),c.value.isLoading=!1})}).catch(()=>{l.value=[],c.value=_()})}function m(){var d,f;const F=t.getValueSerialized();!F||!t.field.associationData||(l.value=[{label:((d=t.field.associationData[0])==null?void 0:d.label)??"???",value:F,data:(f=t.field.associationData[0])==null?void 0:f.data}])}function T(){return u.value?u.value.validate():!1}function R(){return u.value?!u.value.hasError:!1}function V(){u.value&&u.value.resetValidation()}function z(){c.value=_(),l.value=[],g.value=se}function A(F){const d=l.value.length-1;if(c.value.isLoading!==!0&&c.value.nextPage<c.value.lastPage&&F.to===d&&d!==-1){const f=t.formApi.form,k=t.formApi.getAssociationDataCallback();c.value.isLoading=!0,k({resourceName:f.resourceName,resourceId:f.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:g.value,context:f.context}).then(x=>{l.value=l.value.concat(x.rows),c.value.lastPage=Math.ceil(x.row_count/c.value.limit),x.row_count>=c.value.limit&&c.value.nextPage++,c.value.isLoading=!1,F.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(T,R,V,m,z),e.nextTick(()=>{m()})}),(F,d)=>(e.openBlock(),e.createBlock(e.unref(s.QSelect),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":d[0]||(d[0]=f=>t.modelValueOnUpdate(f)),label:t.field.label,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":p,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:B,onVirtualScroll:A},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(s.QItem),{dense:e.unref(i).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(f=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:f.opt,itemProps:f.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),de="__init",fe=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.field.componentOptions.associationDisplayComponent,a=t.formApi.form,o=a.formSettings,i=a.formStyle,p=o.rulesBehaviour==="lazy",l=e.ref([]),c=e.ref(_()),u=e.ref(),g=e.ref(de);function _(){return{limit:30,nextPage:1,lastPage:100,isLoading:!1}}function B(F,d){if(F===g.value){d(()=>{});return}const f=t.formApi.getAssociationDataCallback();c.value=_(),g.value=F;const k=t.formApi.form;c.value.isLoading=!0,f({resourceName:k.resourceName,resourceId:k.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:F,context:k.context}).then(x=>{d(()=>{l.value=x.rows,c.value.nextPage=2,c.value.lastPage=Math.ceil(x.row_count/c.value.limit),c.value.isLoading=!1})}).catch(()=>{l.value=[],c.value=_()})}function m(){const F=t.getValueSerialized();!F||!t.field.associationData||(l.value=F.map((d,f)=>({label:t.field.associationData[f].label??"???",value:d,data:t.field.associationData[f].data})))}function T(){return u.value?u.value.validate():!1}function R(){return u.value?!u.value.hasError:!1}function V(){u.value&&u.value.resetValidation()}function z(){c.value=_(),l.value=[],g.value=de}function A(F){const d=l.value.length-1;if(c.value.isLoading!==!0&&c.value.nextPage<c.value.lastPage&&F.to===d&&d!==-1){const f=t.formApi.form,k=t.formApi.getAssociationDataCallback();c.value.isLoading=!0,k({resourceName:f.resourceName,resourceId:f.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:g.value,context:f.context}).then(x=>{l.value=l.value.concat(x.rows),c.value.lastPage=Math.ceil(x.row_count/c.value.limit),x.row_count>=c.value.limit&&c.value.nextPage++,c.value.isLoading=!1,F.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(T,R,V,m,z),e.nextTick(()=>{m()})}),(F,d)=>(e.openBlock(),e.createBlock(e.unref(s.QSelect),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":d[0]||(d[0]=f=>t.modelValueOnUpdate(f)),label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":p,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.clear,onFilter:B,onVirtualScroll:A},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(s.QItem),{dense:e.unref(i).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(f=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:f.opt,itemProps:f.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),le=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref();function l(){return p.value?p.value.validate():!1}function c(){return p.value?!p.value.hasError:!1}function u(){p.value&&p.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,u)}),(g,_)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:p,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=B=>t.modelValueOnUpdate(B)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ue=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref();function l(){return p.value?p.value.validate():!1}function c(){return p.value?!p.value.hasError:!1}function u(){p.value&&p.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,u)}),(g,_)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:p,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=B=>t.modelValueOnUpdate(B)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}}),Le=e.defineComponent({__name:"ColorField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref();function l(){return p.value?p.value.validate():!1}function c(){return p.value?!p.value.hasError:!1}function u(){p.value&&p.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,u)}),(g,_)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:p,"model-value":t.modelValue,"onUpdate:modelValue":_[1]||(_[1]=B=>t.modelValueOnUpdate(B)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(s.QIcon),{name:"colorize",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QColor),{"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=B=>t.modelValueOnUpdate(B))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Qe=e.defineComponent({__name:"WysiwygField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=s.useQuasar(),o=t.formApi.form.formStyle,i=[[{label:n.lang.editor.align,icon:n.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:n.lang.editor.formatting,icon:n.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:n.lang.editor.fontSize,icon:n.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:n.lang.editor.defaultFont,icon:n.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],p={arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"},l=e.ref();function c(){return!!l.value}function u(){return!!l.value}function g(){}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,u,g)}),(_,B)=>t.modelValue?(e.openBlock(),e.createBlock(e.unref(s.QEditor),{key:0,ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=m=>t.modelValueOnUpdate(m)),toolbar:i,fonts:p,placeholder:t.field.label,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly},null,8,["model-value","placeholder","square","dense","class","readonly"])):e.createCommentVNode("",!0)}}),Pe=e.defineComponent({__name:"JsonField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const n=r.formApi.form,a=n.formSettings;return n.formStyle,a.rulesBehaviour,(o,i)=>" TODO json edit ? "}});function w(r){r==null||r.forEach(t=>{t()})}function G(r){const t=["B","KB","MB","GB","TB","PB"];let n=0;for(;parseInt(r.toString(),10)>=1024&&n<t.length-1;)r/=1024,++n;return`${r.toFixed(1)}${t[n]}`}const Me={class:"flex column"},He={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},qe={class:"col"},Ge={class:"q-uploader__title"},je={key:0,class:"caption"},Ye={key:0,class:"flex column"},We={key:2,class:"flex column"},Je={key:0,class:"q-field--error q-field__bottom text-negative"},Ke=e.defineComponent({__name:"AttachmentHasOneField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,a=t.formApi.form.formStyle,o=e.ref(null);function i(){let d=t.modelValue;d.add=[],d.delete=[],t.modelValueOnUpdate(d),V()}function p(){var f;let d=t.modelValue;d.add=[],d.delete=((f=t.field.attachmentData)==null?void 0:f.map(k=>k.attachment_id))??[],t.modelValueOnUpdate(d),V()}function l(){return V(),c()}function c(){return o.value===null}function u(){o.value=null}async function g(d){return new Promise(f=>{const k=new Blob([d]),x=new FileReader;x.onload=I=>{var P;const L=((P=I.target)==null?void 0:P.result)??"",[M,q]=L.split(",");f(q)},x.readAsDataURL(k)})}async function _(d){return{key:`${d.lastModified}${d.name}`,size:d.size,filename:d.name,contentType:d.type,base64:await g(await d.arrayBuffer())}}async function B(d){if(!d[0])return;const f=await _(d[0]);let k=t.modelValue;k.add=[f],t.modelValueOnUpdate(k),V()}function m(d){if(!d[0])return;let f=t.modelValue;f.add=[],f.delete=[],t.modelValueOnUpdate(f),V()}function T(d){let f=t.modelValue;f.delete=[d.attachment_id],t.modelValueOnUpdate(f),V()}function R(){let d=t.modelValue;d.delete=[],t.modelValueOnUpdate(d),V()}function V(){o.value=null;for(const d of t.rules){const f=d(t.modelValue);if(typeof f=="string"){o.value=f;break}}}const z=e.computed(()=>(t.field.attachmentData??[]).length===0),A=e.computed(()=>t.modelValue?t.modelValue.delete:[]),F=e.computed(()=>{var d,f;return t.modelValue?(((d=t.field.attachmentData)==null?void 0:d.length)??0)===0||(((f=t.field.attachmentData)==null?void 0:f.length)??!0)&&t.modelValue.delete.length===1:!0});return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,u,i,p)}),(d,f)=>(e.openBlock(),e.createElementBlock("div",Me,[e.createVNode(e.unref(s.QUploader),{"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(a).fieldBorderless!==!0,square:e.unref(a).fieldSquare,color:e.unref(a).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:B,onRemoved:m,style:{width:"inherit"}},{header:e.withCtx(k=>[e.createElementVNode("div",He,[e.createElementVNode("div",qe,[e.createElementVNode("div",Ge,e.toDisplayString(t.field.label),1),t.field.hint?(e.openBlock(),e.createElementBlock("div",je,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0)]),k.canAddFiles&&F.value?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,type:"a",icon:"add_box",onClick:k.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QUploaderAddTrigger))]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(k=>[z.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ye,[f[0]||(f[0]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier déjà en ligne",-1)),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],x=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:x.attachment_id},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.filename),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(G)(x.size)),1)]),_:2},1024)]),_:2},1024),t.modelValue?(e.openBlock(),e.createBlock(e.unref(s.QItemSection),{key:0,top:"",side:""},{default:e.withCtx(()=>[A.value.includes(x.attachment_id)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:I=>T(x)},null,8,["disable","onClick"])),A.value.includes(x.attachment_id)&&t.modelValue.add.length===0?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:1,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"refresh",onClick:R},null,8,["disable"])):e.createCommentVNode("",!0)]),_:2},1024)):e.createCommentVNode("",!0)]),_:2},1024))),128))]),_:1})])),!z.value&&k.files.length>0?(e.openBlock(),e.createBlock(e.unref(s.QSeparator),{key:1})):e.createCommentVNode("",!0),k.files.length>0?(e.openBlock(),e.createElementBlock("div",We,[f[1]||(f[1]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier de remplacement",-1)),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.files,x=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:x.__key},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.name),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(e.unref(s.QItemSection),{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QBtn),{class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:I=>k.removeFile(x)},null,8,["disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):e.createCommentVNode("",!0)]),_:1},8,["label","bordered","square","color","class","readonly"]),o.value!==null?(e.openBlock(),e.createElementBlock("div",Je,e.toDisplayString(o.value),1)):e.createCommentVNode("",!0)]))}}),Xe={class:"flex column"},Ze={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},ve={class:"col"},et={class:"q-uploader__title"},tt={key:0,class:"caption"},nt={key:0,class:"flex column"},ot={class:"text-weight-medium text-body2"},at={key:2,class:"flex column"},rt={class:"text-weight-medium text-body2"},lt={key:0,class:"q-field--error q-field__bottom text-negative"},it=e.defineComponent({__name:"AttachmentHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,a=t.formApi.form.formStyle,o=e.ref(null);function i(){let d=t.modelValue;d.add=[],d.delete=[],t.modelValueOnUpdate(d),V()}function p(){var f;let d=t.modelValue;d.add=[],d.delete=((f=t.field.attachmentData)==null?void 0:f.map(k=>k.attachment_id))??[],t.modelValueOnUpdate(d),V()}function l(){return V(),c()}function c(){return o.value===null}function u(){o.value=null}async function g(d){return new Promise(f=>{const k=new Blob([d]),x=new FileReader;x.onload=I=>{var P;const L=((P=I.target)==null?void 0:P.result)??"",[M,q]=L.split(",");f(q)},x.readAsDataURL(k)})}async function _(d){return{key:`${d.lastModified}${d.name}`,size:d.size,filename:d.name,contentType:d.type,base64:await g(await d.arrayBuffer())}}async function B(d){if(!d[0])return;const f=await _(d[0]);let k=t.modelValue;k.add.push(f),t.modelValueOnUpdate(k),V()}async function m(d){if(!d[0])return;const f=await _(d[0]);let k=t.modelValue;k.add=k.add.filter(x=>x.key!==f.key),t.modelValueOnUpdate(k),V()}function T(d){let f=t.modelValue;f.delete.push(d.attachment_id),t.modelValueOnUpdate(f),V()}function R(d){let f=t.modelValue;f.delete=f.delete.filter(k=>k!==d.attachment_id),t.modelValueOnUpdate(f),V()}function V(){o.value=null;for(const d of t.rules){const f=d(t.modelValue);if(typeof f=="string"){o.value=f;break}}}const z=e.computed(()=>(t.field.attachmentData??[]).length===0),A=e.computed(()=>t.modelValue?t.modelValue.delete:[]),F=e.computed(()=>{var d,f;return t.modelValue?(((d=t.field.attachmentData)==null?void 0:d.length)??0)===0||(((f=t.field.attachmentData)==null?void 0:f.length)??!0)&&t.modelValue.delete.length===1:!0});return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,u,i,p)}),(d,f)=>(e.openBlock(),e.createElementBlock("div",Xe,[e.createVNode(e.unref(s.QUploader),{"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(a).fieldBorderless!==!0,square:e.unref(a).fieldSquare,color:e.unref(a).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:B,onRemoved:m,style:{width:"inherit"}},{header:e.withCtx(k=>[e.createElementVNode("div",Ze,[e.createElementVNode("div",ve,[e.createElementVNode("div",et,e.toDisplayString(t.field.label),1),t.field.hint?(e.openBlock(),e.createElementBlock("div",tt,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0)]),k.canAddFiles&&F.value?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,type:"a",icon:"add_box",onClick:k.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QUploaderAddTrigger))]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(k=>{var x;return[z.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",nt,[e.createElementVNode("div",ot,"Fichier"+e.toDisplayString((((x=t.field.attachmentData)==null?void 0:x.length)??0)>0?"s":"")+" déjà en ligne",1),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],I=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:I.attachment_id},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(I.filename),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(G)(I.size)),1)]),_:2},1024)]),_:2},1024),t.modelValue?(e.openBlock(),e.createBlock(e.unref(s.QItemSection),{key:0,top:"",side:""},{default:e.withCtx(()=>[A.value.includes(I.attachment_id)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:L=>T(I)},null,8,["disable","onClick"])),A.value.includes(I.attachment_id)&&t.modelValue.add.length===0?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:1,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"refresh",onClick:L=>R(I)},null,8,["disable","onClick"])):e.createCommentVNode("",!0)]),_:2},1024)):e.createCommentVNode("",!0)]),_:2},1024))),128))]),_:1})])),!z.value&&k.files.length>0?(e.openBlock(),e.createBlock(e.unref(s.QSeparator),{key:1})):e.createCommentVNode("",!0),k.files.length>0?(e.openBlock(),e.createElementBlock("div",at,[e.createElementVNode("div",rt,"Fichier"+e.toDisplayString(k.files.length>0?"s":"")+" à ajouter",1),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.files,I=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:I.__key},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(I.name),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(I.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(e.unref(s.QItemSection),{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QBtn),{class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:L=>k.removeFile(I)},null,8,["disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):e.createCommentVNode("",!0)]}),_:1},8,["label","bordered","square","color","class","readonly"]),o.value!==null?(e.openBlock(),e.createElementBlock("div",lt,e.toDisplayString(o.value),1)):e.createCommentVNode("",!0)]))}});class j{constructor(t,n,a,o,i,p,l,c,u){E(this,"resourceName");E(this,"resourceId");E(this,"formMetadataAndData");E(this,"context");E(this,"formSettings");E(this,"formStyle");E(this,"actionComponent");E(this,"orphanErrorsComponent");E(this,"sectionComponent");E(this,"wrapperResetComponent");E(this,"associationDisplayComponent");E(this,"dynamicComponentRecord");E(this,"formApi");E(this,"registerEventCallback");this.dynamicComponentRecord=a.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=l,this.resourceName=t,this.formApi=c,this.formSettings={...i,...U.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...p,...U.getGlobalFormStyle()},this.actionComponent=a.actionComponent??U.getGlobalActionComponent(),this.orphanErrorsComponent=a.orphanErrorsComponent??U.getGlobalOrphanErrorComponent(),this.sectionComponent=a.sectionComponent??U.getGlobalSectionComponent(),this.wrapperResetComponent=a.wrapperResetComponent??U.getGlobalWrapperResetComponent(),this.associationDisplayComponent=a.associationDisplayComponent??U.getGlobalAssociationDisplayComponent(),this.registerEventCallback=u??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...U.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:U.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(U.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(U.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(U.getGlobalWrapperResetComponent()),dynamicComponentRecord:{},allowBulk:!1}}static getForm(t,n,a,o,i,p,l,c,u){return new j(t,n,a,o,i,p,l,c,u).generateFormDef()}generateFormDef(){const t=ee.create(this.formApi);this.registerEventCallback(t);const n=new Set,a=ee.getEventsObjectFromInstance(t),o=[];this.formMetadataAndData.form.sections.forEach((p,l)=>{const c=[];p.fields.forEach(m=>{const T=this.dynamicComponentRecord[`field-${m.field_name}-before`],R=j.getFieldComponentByFormFieldType(m),V=this.dynamicComponentRecord[`field-${m.field_name}-after`],z={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:j.getRegularFieldTypeByFieldType(m.field_type)};let A=m.label;this.formSettings.requiredFieldsHasAsterisk&&m.rules.find(d=>d.type==="required")&&(A=A.concat("*"));const F={type:m.field_type,extraType:m.field_extra_type,metadata:Object.freeze(m),label:A,hint:m.hint??void 0,prefix:m.prefix??void 0,suffix:m.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??p.readonly??m.readonly??void 0,cssClass:m.css_class??void 0,staticSelectOptions:m.static_select_options,associationData:m.field_association_data,attachmentData:m.field_attachment_data,rules:m.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:T?e.markRaw(T):void 0,mainComponent:e.markRaw(R),afterComponent:V?e.markRaw(V):void 0,events:a.fields[m.field_name]??{},componentOptions:z};c.push(F),n.add(m.field_name)});const u=this.dynamicComponentRecord[`section-${p.name??l}-before`],g=this.sectionComponent,_=this.dynamicComponentRecord[`section-${p.name??l}-after`],B={label:p.label??void 0,icon:p.icon??void 0,cssClass:p.css_class??void 0,hidden:!1,name:p.name??l.toString(),readonly:this.formMetadataAndData.form.readonly??p.readonly??void 0,events:a.sections[p.name??l.toString()]??{},beforeComponent:u?e.markRaw(u):void 0,mainComponent:e.markRaw(g),fieldsComponent:void 0,afterComponent:_?e.markRaw(_):void 0,fields:c};o.push(B)});const i={sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,allowBulk:this.formMetadataAndData.form.allow_bulk??!1,events:a.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context};return n.size<this.formMetadataAndData.form.sections.reduce((p,l)=>p+l.fields.length,0)&&console.warn("Submit64 -> Found fields with the same name"),i}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){switch(t.field_type){case"string":switch(t.field_extra_type){case"color":return Le;case"wysiwyg":return Qe;default:return le}case"text":return le;case"number":return Ue;case"date":return we;case"datetime":return Ae;case"select":return $e;case"selectBelongsTo":return ce;case"selectHasMany":return fe;case"selectHasAndBelongsToMany":return fe;case"selectHasOne":return ce;case"checkbox":return Oe;case"object":return Pe;case"attachmentHasOne":return Ke;case"attachmentHasMany":return it;default:return le}}}const st={class:"flex column"},ct=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(r,{expose:t}){const n=r;let a=null,o=null,i=null;const p=e.useSlots(),l={softReset:g,reset:_,clear:B,validate:R,isValid:V,isInvalid:z,hide:m,unhide:T,resetValidation:A,getFields:F,setReadonlyState:d,setCssClass:f,setIcon:k,setLabel:x,section:n.section},c=e.ref(new Map);function u(){n.section.fields.forEach(y=>{const S=y.metadata.field_name,O=n.formApi.getFieldByName(S);O&&c.value.set(S,O)})}function g(){c.value.forEach(y=>{y.softReset()})}function _(){c.value.forEach(y=>{y.reset()}),w(n.section.events.onReset)}function B(){c.value.forEach(y=>{y.clear()}),w(n.section.events.onClear)}function m(){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(c.value.forEach(S=>{S.hide()}),y.hidden=!0,w(n.section.events.onHide))}function T(){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(c.value.forEach(S=>{S.unhide()}),y.hidden=!1,w(n.section.events.onUnhide))}function R(){let y=!0;return c.value.forEach(S=>{if(!S.validate()){y=!1;return}}),w(n.section.events.onValidated),y}function V(){let y=!0;return c.value.forEach(S=>{if(!S.isValid()){y=!1;return}}),y}function z(){return!V()}function A(){c.value.forEach(y=>{y.resetValidation()})}function F(){return c.value}function d(y){const S=n.privateFormApi.getSectionRef(n.section.name);S&&(S.readonly=y)}function f(y){const S=n.privateFormApi.getSectionRef(n.section.name);S&&(S.cssClass=y)}function k(y){const S=n.privateFormApi.getSectionRef(n.section.name);S&&(S.icon=y)}function x(y){const S=n.privateFormApi.getSectionRef(n.section.name);S&&(S.label=y)}function I(){const y={};for(const[S,O]of c.value)y[S]=O.getValueSerialized();return y}function L(){const y=p.default;if(!y){console.error("Submit64 : did not found fields slot for section "+n.section.name);return}const S=e.defineComponent({inheritAttrs:!1,setup(O,{attrs:Z,slots:te}){return()=>y({...O,...Z},te)}});n.privateFormApi.setSectionFieldComponent(n.section,e.markRaw(S))}t(l);const M=e.computed(()=>V()),q=e.computed(()=>z()),P=e.computed(()=>I());return e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onIsValid},y=>{a==null||a(),a=null,y&&(a=e.watch(M,S=>{S&&w(n.section.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onIsInvalid},y=>{o==null||o(),o=null,y&&(o=e.watch(q,S=>{var O;S&&w((O=n.section)==null?void 0:O.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onUpdate},y=>{i==null||i(),i=null,y&&(i=e.watch(P,()=>{var S;w((S=n.section)==null?void 0:S.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(()=>{var S;L();const y=(S=e.getCurrentInstance())==null?void 0:S.exposed;y&&n.privateFormApi.registerSectionWrapperRef(n.section.name,y),e.nextTick(()=>{var O;u(),w((O=n.section)==null?void 0:O.events.onReady)})}),(y,S)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",st,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:l,formApi:n.formApi},null,8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}});function dt(r,t){const n=r.rules??[],a=r.type,o=t.form,i=(u,g,_)=>u[g]?_?()=>p(u[g]):()=>u[g]:u.compare_to?()=>{var B;return((B=t.getFieldByName(u.compare_to))==null?void 0:B.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",p=u=>String(s.date.formatDate(s.date.extractDate(u,o.formSettings.backendDateFormat),o.formSettings.dateFormat)),l=[],c=[];switch(a){case"date":l.push(ie(o.formSettings.dateFormat));break;case"datetime":l.push(ie(o.formSettings.datetimeFormat));break}return n.forEach(u=>{const g=u;switch(g.type){case"required":l.push(ft());break;case"absence":l.push(mt());break;case"acceptance":l.push(pt());break;case"inclusion":l.push(ue(g.including));break;case"exclusion":l.push(ut(g.excluding));break;case"backend":break;case"allowNull":c.push("allowNull");break;case"allowBlank":c.push("allowBlank");break;case"positiveNumber":l.push(yt());break;case"lessThanOrEqualNumber":l.push(Ct(i(g,"less_than")));break;case"lessThanNumber":l.push(bt(i(g,"less_than")));break;case"greaterThanOrEqualNumber":l.push(kt(i(g,"greater_than")));break;case"greaterThanNumber":l.push(_t(i(g,"greater_than")));break;case"equalToNumber":l.push(Vt(i(g,"equal_to")));break;case"otherThanNumber":l.push(St(i(g,"other_than")));break;case"numberIntegerOnly":l.push(Ft());break;case"numberNumericOnly":l.push(xt());break;case"numberEvenOnly":l.push(Bt());break;case"numberOddOnly":l.push(Nt());break;case"lessThanOrEqualStringLength":l.push(Dt(i(g,"less_than")));break;case"lessThanStringLength":l.push(wt(i(g,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(Et(i(g,"greater_than")));break;case"greaterThanStringLength":l.push(Rt(i(g,"greater_than")));break;case"equalToStringLength":l.push(zt(i(g,"equal_to")));break;case"equalToString":l.push(Tt(i(g,"equal_to")));break;case"betweenStringLength":l.push(At(()=>g.min,()=>g.max));break;case"otherThanString":l.push(It(i(g,"other_than")));break;case"validDate":l.push(ie(o.formSettings.dateFormat));break;case"lessThanOrEqualDate":l.push(Ot(i(g,"less_than",!0),o.formSettings.dateFormat));break;case"lessThanDate":l.push($t(i(g,"less_than",!0),o.formSettings.dateFormat));break;case"greaterThanOrEqualDate":l.push(Ut(i(g,"greater_than",!0),o.formSettings.dateFormat));break;case"greaterThanDate":l.push(Lt(i(g,"greater_than",!0),o.formSettings.dateFormat));break;case"equalToDate":l.push(Qt(i(g,"equal_to",!0),o.formSettings.dateFormat));break;case"otherThanDate":l.push(Pt(i(g,"other_than",!0),o.formSettings.dateFormat));break;case"requiredUploadFile":l.push(Ht());break;case"allowFileContentType":l.push(qt(i(g,"including")));break;case"equalToFileLength":l.push(Gt(i(g,"equal_to")));break;case"lessThanOrEqualFileLength":l.push(Yt(i(g,"less_than")));break;case"greaterThanOrEqualFileLength":l.push(jt(i(g,"greater_than")));break;case"lessThanOrEqualFileCount":l.push(Wt(i(g,"less_than")));break;case"greaterThanOrEqualFileCount":l.push(Jt(i(g,"greater_than")));break;case"lessThanOrEqualTotalFileSize":l.push(Kt(i(g,"less_than")));case"greaterThanOrEqualTotalFileSize":l.push(Xt(i(g,"greater_than")));break;case"equalToTotalFileSize":l.push(Zt(i(g,"equal_to")));break}}),c.length>0?c.map(u=>{switch(u){case"allowBlank":return gt(l);case"allowNull":return ht(l)}}):l}function ft(){return r=>!!r||"Ce champ est requis"}function ue(r){return t=>r.includes(String(t))||`Doit être contenu dans ${r.toString()}`}function ut(r){return t=>!r.includes(String(t)||`Ne doit pas être contenu dans ${ue.toString()}`)}function mt(){return r=>!r||"Ce champ doit être vide"}function pt(){return r=>!!r||"Doit être accepté"}function ht(r){return t=>(t===null||r.forEach(n=>{const a=n(t);if(a!==!0)return a}),!0)}function gt(r){return t=>(t===""||r.forEach(n=>{const a=n(t);if(a!==!0)return a}),!0)}function yt(){return r=>Number(r)>0||"Val. positive uniquement"}function Ct(r){return t=>{const n=r();return Number(t)<=n||`Inf. ou égal à ${n}`}}function bt(r){return t=>{const n=r();return Number(t)<n||`Inf. ${n}`}}function kt(r){return t=>{const n=r();return Number(t)>=n||`Sup. ou égal à ${n}`}}function _t(r){return t=>{const n=r();return Number(t)>n||`Sup. à ${n}`}}function Vt(r,t){return n=>{const a=r();return Number(n)===a||`Égale à ${a}`}}function St(r,t){return n=>{const a=r();return Number(n)!==a||`Doit être différent de ${r}`}}function Ft(){return r=>/^-?\d+$/.test(String(r).trim())||"Nombre entier uniquement"}function xt(){return r=>/^-?\d+(\.\d+)?$/.test(String(r).trim())||"Caractère numérique uniquement"}function Bt(){return r=>Number.isInteger(Number(r))&&Number(r)%2===0||"Nombre pair uniquement"}function Nt(){return r=>Number.isInteger(Number(r))&&Number(r)%2===1||"Nombre impair uniquement"}function Dt(r){return t=>{const n=r();return String(t).length<=n||`Inf. ou égal à ${n}`}}function wt(r){return t=>{const n=r();return String(t).length<n||`Inf. à ${n}`}}function Et(r){return t=>{const n=r();return String(t).length>=n||`Sup. ou égal à ${n}`}}function Rt(r){return t=>{const n=r();return String(t).length>n||`Sup. à ${n}`}}function At(r,t){return n=>{const a=r(),o=t();return String(n).length>=a&&String(n).length<=o||`Entre ${a} et ${o}`}}function Tt(r,t){return n=>{const a=r();return String(n)===a||`Égale à ${a}`}}function zt(r){return t=>{const n=r();return String(t).length===n||`Doit contenir ${n} caractères`}}function It(r){return t=>{const n=r();return String(t)!==n||`Doit être différent de ${n}`}}function Ot(r,t){return n=>{const a=r(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(a,t);return o<=i||`Inf. ou égal à ${a}`}}function $t(r,t){return n=>{const a=r(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(a,t);return o<i||`Inf. à ${a}`}}function Ut(r,t){return n=>{const a=r(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(a,t);return o>=i||`Sup. ou égal à ${a}`}}function Lt(r,t){return n=>{const a=r(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(a,t);return o>i||`Sup. à ${a}`}}function Qt(r,t){return n=>{const a=r(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(a,t);return o===i||`Égale à ${o}`}}function Pt(r,t){return n=>{const a=r();return s.date.extractDate(String(n),t)!==s.date.extractDate(a,t)||`Doit être différent de ${a}`}}function ie(r){return t=>t==null||t===""?!0:Mt(t,r)||`Date invalide. Format : ${r}`}function Mt(r,t){if(typeof r!="string"||!r.trim())return!1;const n=s.date.extractDate(r,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:s.date.formatDate(n,t)===r}function Ht(){return r=>r.add.length>0||"Ce champ est requis"}function qt(r){return t=>{const n=t,a=r();let o=!0;n.add.forEach(p=>{o&&(a.includes(p.contentType)||(o=!1))});const i=r.length>1;return o||`Type${i?"s":""} autorisé${i?"s":""} : ${a.join(",")}`}}function Gt(r){return t=>{const n=t,a=r();let o=!0;return n.add.forEach(i=>{o&&a!==i.size&&(o=!1)}),o||`Taille par fichier ${G(a)}`}}function jt(r){return t=>{const n=t,a=r();let o=!0;return n.add.forEach(i=>{o&&i.size<a&&(o=!1)}),o||`Taille par fichier min. ${G(a)}`}}function Yt(r){return t=>{const n=t,a=r();let o=!0;return n.add.forEach(i=>{o&&i.size>a&&(o=!1)}),o||`Taille par fichier max. ${G(a)}`}}function Wt(r){return t=>{const n=t,a=r();return n.add.length<=a||`${a} fichier${a>1?"s":""} max.`}}function Jt(r){return t=>{const n=t,a=r();return n.add.length>=a||`${a} fichier${a>1?"s":""} min.`}}function Kt(r){return t=>{const n=t,a=r();return n.add.reduce((i,p)=>(i+=p.size,i),0)<=a||`${G(a)} max.`}}function Xt(r){return t=>{const n=t,a=r();return n.add.reduce((i,p)=>(i+=p.size,i),0)>=a||`${G(a)} min.`}}function Zt(r){return t=>{const n=t,a=r();return n.add.reduce((i,p)=>(i+=p.size,i),0)===a||`Taille totale ${G(a)}`}}const vt={computeServerRules:dt},en={key:2,class:"q-field__bottom text-negative q-pt-none"},tn=["index"],nn=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(r,{expose:t}){const n=r;let a=()=>!0,o=()=>!0,i=()=>{},p=()=>{},l=()=>{};const c=V(),u=e.ref(),g=e.ref([]);function _(){u.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),u.value=m(u.value)}function B(){u.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),u.value=m(u.value),w(n.field.events.onReset),p(),e.nextTick(()=>{Z()})}function m(C){const D=n.formApi.form;switch(n.field.type){case"checkbox":return C==null||C===""?!1:C;case"date":return C==null||C===""?null:s.date.formatDate(s.date.extractDate(String(C),D.formSettings.backendDateFormat),D.formSettings.dateFormat);case"datetime":return C==null||C===""?null:s.date.formatDate(s.date.extractDate(String(C),D.formSettings.backendDatetimeFormat),D.formSettings.datetimeFormat);case"attachmentHasOne":case"attachmentHasMany":return{add:[],delete:[]}}return C}function T(C){const D=n.formApi.form;switch(n.field.type){case"date":return C==null||C===""?null:s.date.formatDate(s.date.extractDate(String(C),D.formSettings.dateFormat),D.formSettings.backendDateFormat);case"datetime":return C==null||C===""?null:s.date.formatDate(s.date.extractDate(String(C),D.formSettings.datetimeFormat),D.formSettings.backendDatetimeFormat)}return C}function R(){switch(n.field.type){case"string":u.value="";break;case"checkbox":u.value=!1;break;case"date":u.value=null;break;case"datetime":u.value=null;break;case"number":u.value=null;break;case"select":u.value=void 0;break;case"text":u.value="";break;case"object":u.value={};break;case"selectBelongsTo":u.value=void 0;break;case"selectHasMany":u.value=void 0;break;case"selectHasAndBelongsToMany":u.value=void 0;break;case"selectHasOne":u.value=void 0;break;case"attachmentHasOne":case"attachmentHasMany":u.value={add:[],delete:[]};break}l(),w(n.field.events.onClear)}function V(){return vt.computeServerRules(n.field,n.formApi)}function z(C){u.value=C}function A(){return e.unref(u)}function F(){return T(e.unref(u))}function d(C){g.value=C}function f(){const C=n.privateFormApi.getFieldRef(n.field.metadata.field_name);C&&(C.hidden=!0,w(n.field.events.onHide))}function k(){const C=n.privateFormApi.getFieldRef(n.field.metadata.field_name);C&&(C.hidden=!1,w(n.field.events.onUnhide))}function x(C){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.readonly=C)}function I(C){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.hint=C)}function L(C){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.cssClass=C)}function M(C){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.suffix=C)}function q(C){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.prefix=C)}function P(C){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.label=C)}function y(){const C=a();return w(n.field.events.onValidated),C}function S(){return o()}function O(){return!S()}function Z(){return i()}function te(C,D,Y,v,ae){a=C,o=D,i=Y,v&&(p=v),ae&&(l=ae)}const ne={softReset:_,reset:B,clear:R,validate:y,isValid:S,isInvalid:O,hide:f,unhide:k,resetValidation:Z,getValueDeserialized:F,getValueSerialized:A,setupBackendErrors:d,setReadonlyState:x,setHint:I,setCssClass:L,setSuffix:M,setPrefix:q,setLabel:P,setValue:z,field:n.field};return t(ne),e.watch(()=>n.field.events.onUpdate?u.value:null,()=>{w(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid||n.field.events.onIsInvalid?u.value:null,C=>{w(C?n.field.events.onIsValid:n.field.events.onIsInvalid)}),e.onMounted(()=>{var D,Y;_();const C=(D=e.getCurrentInstance())==null?void 0:D.exposed;C&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,C),w((Y=n.field)==null?void 0:Y.events.onReady)}),(C,D)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:ne},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:u.value,field:n.field,formApi:n.formApi,rules:e.unref(c),reset:B,clear:R,getValueDeserialized:F,getValueSerialized:A,validate:y,modelValueOnUpdate:z,registerBehaviourCallbacks:te},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:ne},null,8,["formApi"])):e.createCommentVNode("",!0),g.value.length>0?(e.openBlock(),e.createElementBlock("div",en,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value,(Y,v)=>(e.openBlock(),e.createElementBlock("div",{index:v,class:"flex column"},e.toDisplayString(Y),9,tn))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),on={class:"flex column"},an=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(r,{expose:t}){const n=r;let a=null,o="",i=0,p=0,l=null,c=null,u=null,g=null,_=null;const B=e.useSlots(),m=e.ref(j.getEmptyFormBeforeInit()),T=e.ref(!1),R=e.ref(!1),V=e.ref(!1),z=e.ref(!1),A=e.ref("create"),F=e.ref({}),d=e.ref(new Map),f=e.ref(new Map);async function k(){a=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),m.value=j.getForm(n.resourceName,n.resourceId,L(),a,n.formSettings,n.formStyle,n.context,W,n.eventManager),i=m.value.sections.length,p=m.value.sections.map(h=>h.fields).flat().length,n.resourceId&&(A.value="edit")}async function x(){var N,Q,K;if(!P())return;w((N=m.value)==null?void 0:N.events.onSubmit),z.value=!0,C();const h=M(),b=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:h,context:n.context});if(g=b.resource_data,b.success)F.value={},A.value==="create"&&(A.value="edit"),a&&b.resource_data&&(a.resource_data=b.resource_data),m.value=j.getForm(n.resourceName,n.resourceId,L(),{form:b.form,resource_data:b.resource_data},n.formSettings,n.formStyle,n.context,W,n.eventManager),O(),o=JSON.stringify(M()),w((K=m.value)==null?void 0:K.events.onSubmitSuccess);else{F.value={};const X=[];for(const[H,J]of f.value){const re=b.errors[H];re&&(J.setupBackendErrors(re),X.push(H))}Object.entries(b.errors).forEach(H=>{X.includes(H[0])||(F.value[H[0]]=H[1])}),w((Q=m.value)==null?void 0:Q.events.onSubmitUnsuccess)}z.value=!1}async function I(h){var Q,K,X;if(!m.value.allowBulk||A.value==="edit"){console.warn("Submit64 : you are not allowed to submitBulk");return}if(!P())return;w((Q=m.value)==null?void 0:Q.events.onSubmit),z.value=!0,C();const b=M(),N=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:b,bulkCount:h,context:n.context});if(_=N.bulk_data,N.success)F.value={},A.value==="create"&&(A.value="edit"),a&&N.resource_data&&(a.resource_data=N.resource_data),m.value=j.getForm(n.resourceName,n.resourceId,L(),{form:N.form,resource_data:N.resource_data},n.formSettings,n.formStyle,n.context,W,n.eventManager),O(),o=JSON.stringify(M()),w((X=m.value)==null?void 0:X.events.onSubmitSuccess);else{F.value={};const H=[];for(const[J,re]of f.value){const pe=N.errors[J];pe&&(re.setupBackendErrors(pe),H.push(J))}Object.entries(N.errors).forEach(J=>{H.includes(J[0])||(F.value[J[0]]=J[1])}),w((K=m.value)==null?void 0:K.events.onSubmitUnsuccess)}z.value=!1}function L(){const h={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const b in B){const N=B[b];if(N){const Q=e.defineComponent({inheritAttrs:!1,setup(K,{attrs:X,slots:H}){return()=>N({...K,...X,innerSlots:H})}});switch(b){case"sections":h.sectionComponent=Q;break;case"actions":h.actionComponent=Q;break;case"orphan-errors":h.orphanErrorsComponent=Q;break;case"association-display":h.associationDisplayComponent=Q;break;default:h.dynamicComponentRecord[b]=Q;break}}}return h}function M(){const h={};for(const[b,N]of f.value)h[b]=N.getValueDeserialized();return h}function q(){const h={};for(const[b,N]of f.value)h[b]=N.getValueSerialized();return h}function P(){var b;let h=!0;return f.value.forEach(N=>{if(!N.validate()){h=!1;return}}),w((b=m.value)==null?void 0:b.events.onValidated),h}function y(){let h=!0;return f.value.forEach(b=>{if(!b.isValid()){h=!1;return}}),h}function S(){return!y()}function O(){d.value.forEach(h=>{h.softReset()})}function Z(){var h;f.value.forEach(b=>{b.reset()}),w((h=m.value)==null?void 0:h.events.onReset)}function te(){var h;f.value.forEach(b=>{b.clear()}),w((h=m.value)==null?void 0:h.events.onClear)}function ne(){f.value.forEach(h=>{h.resetValidation()})}function C(){f.value.forEach(h=>{h.setupBackendErrors([])})}function D(h){if(a)return a.resource_data[h]}function Y(h){return d.value.get(h)}function v(h){return[...d.value.values()].at(h)}function ae(){return d.value}function rn(h){return f.value.get(h)}function ln(){return f.value}function sn(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function cn(){["getMetadataAndData","resourceName"].forEach(b=>{(n[b]===null||n[b]===void 0)&&console.warn(`Missing props for <Submit64> -> ${b}`)})}function dn(){return e.unref(A)}function fn(){return o!==JSON.stringify(M())}function un(h){m.value&&(m.value.context=h)}function mn(h){m.value&&(m.value.cssClass=h)}function pn(h){m.value&&(m.value.readonly=h)}function hn(){return V.value}function gn(){return g}function yn(){return _}function Cn(){return m}function bn(h){var b;return(b=m.value)==null?void 0:b.sections.find(N=>N.name===h)}function kn(h){var b;return(b=m.value)==null?void 0:b.sections.map(N=>N.fields).flat().find(N=>N.metadata.field_name===h)}function _n(h,b){d.value.set(h,b),i===d.value.size&&(T.value=!0)}function Vn(h,b){f.value.set(h,b),p===f.value.size&&(R.value=!0)}function Sn(h,b){h.fieldsComponent=b}const me={getFormRef:Cn,getSectionRef:bn,getFieldRef:kn,registerSectionWrapperRef:_n,registerFieldWrapperRef:Vn,setSectionFieldComponent:Sn},Fn=new Proxy({},{get(h,b){var N;return(N=m.value)==null?void 0:N[b]}}),W={getMode:dn,getSectionByName:Y,getSectionByIndex:v,getSections:ae,getFieldByName:rn,getFields:ln,validate:P,isValid:y,isInvalid:S,softReset:O,reset:Z,clear:te,resetValidation:ne,submit:x,submitBulk:I,valuesHasChanged:fn,getInitialValueByFieldName:D,getAssociationDataCallback:sn,setContext:un,setCssClass:mn,setReadonlyState:pn,isReady:hn,getSubmitData:gn,getBulkSubmitData:yn,form:Fn};t(W);const xn=e.computed(()=>y()),Bn=e.computed(()=>S()),Nn=e.computed(()=>q());return e.watch(()=>T.value&&R.value,h=>{var b;h&&!V.value&&(w((b=m.value)==null?void 0:b.events.onReady),V.value=!0)}),e.watch(()=>{var h;return(h=m.value)==null?void 0:h.events.onIsValid},h=>{l==null||l(),l=null,h&&(l=e.watch(xn,b=>{var N;b&&w((N=m.value)==null?void 0:N.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var h;return(h=m.value)==null?void 0:h.events.onIsInvalid},h=>{c==null||c(),c=null,h&&(c=e.watch(Bn,b=>{var N;b&&w((N=m.value)==null?void 0:N.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var h;return(h=m.value)==null?void 0:h.events.onUpdate},h=>{u==null||u(),u=null,h&&(u=e.watch(Nn,()=>{var b;w((b=m.value)==null?void 0:b.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(async()=>{cn(),await k(),e.nextTick(()=>{o=JSON.stringify(M())})}),(h,b)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",on,[e.createElementVNode("div",{class:e.normalizeClass(m.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(m.value.sections,N=>(e.openBlock(),e.createBlock(ct,{key:N.name,section:N,formApi:W,privateFormApi:me},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.fields,Q=>(e.openBlock(),e.createBlock(nn,{key:Q.metadata.field_name,field:Q,formApi:W,privateFormApi:me},null,8,["field"]))),128))]),_:2},1032,["section"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(m.value.orphanErrorsComponent),{orphanErrors:F.value,formApi:W},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(m.value.actionComponent),{isLoadingSubmit:z.value,formApi:W},null,8,["isLoadingSubmit"]))],512)),[[e.vShow,V.value]])}});$.DynamicLogicBuilder=ee,$.Submit64=U,$.Submit64Form=an,Object.defineProperty($,Symbol.toStringTag,{value:"Module"})});
