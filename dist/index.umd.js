(function(F,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(F=typeof globalThis<"u"?globalThis:F||self,e(F["submit64-vue"]={},F.Vue,F.Quasar))})(this,function(F,e,c){"use strict";var Xe=Object.defineProperty;var Ze=(F,e,c)=>e in F?Xe(F,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):F[e]=c;var _=(F,e,c)=>Ze(F,typeof e!="symbol"?e+"":e,c);const G={class:"flex row items-center no-wrap q-pt-sm"},A=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formDef:{},reset:{type:Function},clear:{type:Function},submit:{type:Function}},setup(o){const t=o;return(r,a)=>(e.openBlock(),e.createElementBlock("div",G,[e.createVNode(e.unref(c.QBtn),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:a[0]||(a[0]=l=>t.submit())},null,8,["loading"]),t.reset?(e.openBlock(),e.createBlock(e.unref(c.QBtn),{key:0,loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:a[1]||(a[1]=l=>t.reset())},null,8,["loading"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(c.QBtn),{key:1,loading:t.isLoadingSubmit,label:"Vider",onClick:a[2]||(a[2]=l=>t.clear())},null,8,["loading"])):e.createCommentVNode("",!0)]))}}),H={class:"flex row items-center"},Y={class:"text-body1 text-weight-medium"},W={class:"flex column q-gutter-sm"},K=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{},context:{}},setup(o){const t=o;return(r,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",t.section.cssClass])},[e.createElementVNode("div",H,[t.section.icon?(e.openBlock(),e.createBlock(e.unref(c.QIcon),{key:0,name:t.section.icon,size:"sm"},null,8,["name"])):e.createCommentVNode("",!0),e.createElementVNode("div",Y,e.toDisplayString(t.section.label),1)]),e.createElementVNode("div",W,[e.renderSlot(r.$slots,"default")])],2))}}),M=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(o){const t=o;return(r,a)=>{const l=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(l,{name:"reset",class:"cursor-pointer",onClick:a[0]||(a[0]=i=>t.reset())})}}}),J=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{index:{},label:{},selected:{type:Boolean},focused:{type:Boolean},opt:{},itemProps:{}},setup(o){const t=o;return(r,a)=>(e.openBlock(),e.createBlock(e.unref(c.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.opt.label),1)]),_:1})]),_:1})]),_:1},16))}}),R=class R{constructor(){_(this,"_formSettings");_(this,"_formStyle");_(this,"_actionComponent");_(this,"_sectionComponent");_(this,"_wrapperResetComponent");_(this,"_associationDisplayComponent");_(this,"_associationDisplayDictonary");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!0,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=A,this._sectionComponent=K,this._wrapperResetComponent=M,this._associationDisplayComponent=J,this._associationDisplayDictonary={}}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static registerGlobalAssociationDisplayRecord(t){this._instance._associationDisplayDictonary=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}static getGlobalAssociationDisplayRecord(){return this._instance._associationDisplayDictonary}};_(R,"_instance",new R);let x=R;const X={class:"row items-center justify-end"},Z=e.defineComponent({__name:"DateField",props:{wrapper:{}},setup(o){const t=o,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,l=r.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref(),n=e.ref();function f(){p.value&&p.value.hide()}function d(){return n.value?n.value.validate():!1}function s(){n.value&&n.value.resetValidation()}return e.onMounted(()=>{t.wrapper.registerBehaviourCallbacks(d,s)}),(C,h)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:n,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[h[2]||(h[2]=S=>t.wrapper.modelValue=S),h[3]||(h[3]=S=>t.wrapper.modelValueOnUpdate(S))],label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,prefix:t.wrapper.field.prefix,suffix:t.wrapper.field.suffix,readonly:t.wrapper.field.readonly,clearable:t.wrapper.field.clearable,rules:t.wrapper.rules,onClear:t.wrapper.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"popupProxyRef",ref:p,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QDate),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[h[0]||(h[0]=S=>t.wrapper.modelValue=S),h[1]||(h[1]=S=>t.wrapper.modelValueOnUpdate(S))],mask:e.unref(r).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",X,[e.createVNode(e.unref(c.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),v={class:"row items-center justify-end"},ee={class:"row items-center justify-end"},te=e.defineComponent({__name:"DateTimeField",props:{wrapper:{}},setup(o){const t=o,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,l=r.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref(),n=e.ref(),f=e.ref();function d(){p.value&&p.value.hide()}function s(){n.value&&n.value.hide()}function C(){return f.value?f.value.validate():!1}function h(){f.value&&f.value.resetValidation()}return e.onMounted(()=>{t.wrapper.registerBehaviourCallbacks(C,h)}),(S,g)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:f,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[g[4]||(g[4]=u=>t.wrapper.modelValue=u),g[5]||(g[5]=u=>t.wrapper.modelValueOnUpdate(u))],label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,prefix:t.wrapper.field.prefix,suffix:t.wrapper.field.suffix,readonly:t.wrapper.field.readonly,clearable:t.wrapper.field.clearable,rules:t.wrapper.rules,onClear:t.wrapper.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"datePopupProxyRef",ref:p,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QDate),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[g[0]||(g[0]=u=>t.wrapper.modelValue=u),g[1]||(g[1]=u=>t.wrapper.modelValueOnUpdate(u))],mask:e.unref(r).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",v,[e.createVNode(e.unref(c.QBtn),{onClick:d,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"timePopupProxyRef",ref:n,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QTime),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[g[2]||(g[2]=u=>t.wrapper.modelValue=u),g[3]||(g[3]=u=>t.wrapper.modelValueOnUpdate(u))],mask:e.unref(r).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",ee,[e.createVNode(e.unref(c.QBtn),{onClick:s,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),re={key:0,class:"q-field__bottom"},ne={key:1,class:"q-field--error q-field__bottom text-negative"},oe=e.defineComponent({__name:"CheckboxField",props:{wrapper:{}},setup(o){const t=o,r=e.ref(!0),l=t.wrapper.injectForm.getFormFactoryInstance().formStyle;function i(){return r.value===!0}function p(){r.value=!0}return e.watch(()=>t.wrapper.modelValue,n=>{for(const f of t.wrapper.rules)if(r.value=f(n),r.value!==!0)break}),e.onMounted(()=>{t.wrapper.registerBehaviourCallbacks(i,p)}),(n,f)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(e.unref(c.QCheckbox),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[f[0]||(f[0]=d=>t.wrapper.modelValue=d),f[1]||(f[1]=d=>t.wrapper.modelValueOnUpdate(d))],label:t.wrapper.field.label,dense:e.unref(l).fieldDense,color:e.unref(l).fieldColor,"aria-readonly":t.wrapper.field.readonly,class:e.normalizeClass([t.wrapper.field.cssClass,"q-pb-md"])},null,8,["modelValue","label","dense","color","aria-readonly","class"]),t.wrapper.field.hint?(e.openBlock(),e.createElementBlock("div",re,e.toDisplayString(t.wrapper.field.hint),1)):e.createCommentVNode("",!0),r.value!==!0?(e.openBlock(),e.createElementBlock("div",ne,e.toDisplayString(r.value),1)):e.createCommentVNode("",!0)],64))}}),ae=e.defineComponent({__name:"ObjectField",props:{wrapper:{}},setup(o){const r=o.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings;return r.formStyle,a.rulesBehaviour,(l,i)=>" TODO json edit ? "}}),le=e.defineComponent({__name:"SelectField",props:{wrapper:{}},setup(o){const t=o,r=e.ref([]),a=e.ref([]),l=e.ref(),i=t.wrapper.injectForm.getFormFactoryInstance(),p=i.formSettings,n=i.formStyle,f=p.rulesBehaviour==="lazy";function d(g,u){if(g===""){u(()=>{a.value=[...r.value]});return}u(()=>{const b=g.toLowerCase();a.value=r.value.filter(w=>w.label.toLowerCase().includes(b))})}function s(g){r.value=Object.freeze(g.field.selectOptions??[]),a.value=g.field.selectOptions??[]}function C(){return l.value?l.value.validate():!1}function h(){l.value&&l.value.resetValidation()}function S(){t.wrapper.clear(),a.value=[]}return e.onMounted(()=>{s(t.wrapper),t.wrapper.registerBehaviourCallbacks(C,h)}),(g,u)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:l,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[u[0]||(u[0]=b=>t.wrapper.modelValue=b),u[1]||(u[1]=b=>t.wrapper.modelValueOnUpdate(b))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(n).fieldOutlined,filled:e.unref(n).fieldFilled,standout:e.unref(n).fieldStandout,borderless:e.unref(n).fieldBorderless,rounded:e.unref(n).fieldRounded,square:e.unref(n).fieldSquare,dense:e.unref(n).fieldDense,hideBottomSpace:e.unref(n).fieldHideBottomSpace,color:e.unref(n).fieldColor,bgColor:e.unref(n).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":f,clearable:t.wrapper.field.clearable,prefix:t.wrapper.field.prefix,suffix:t.wrapper.field.suffix,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:a.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:S,onFilter:d},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}});function ie(o){return Symbol(o)}function N(){return 20}const se=e.defineComponent({__name:"SelectBelongsToField",props:{wrapper:{}},setup(o){const t=o,r=t.wrapper.field.componentOptions.associationDisplayComponent,a=t.wrapper.injectForm.getFormFactoryInstance(),l=a.formSettings,i=a.formStyle,p=l.rulesBehaviour==="lazy",n=e.ref([]),f=e.ref({limit:N(),offset:0}),d=e.ref();function s(u,b){const w=t.wrapper.injectForm.getAssociationDataCallback();u===""&&(f.value={limit:N(),offset:0}),b(()=>{w({resourceName:t.wrapper.injectForm.getForm().resourceName,associationName:t.wrapper.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:u,context:t.wrapper.injectForm.getForm().context}).then(V=>{n.value=V.rows}).catch(()=>{n.value=[]})})}function C(){e.nextTick(()=>{const u=t.wrapper.getValueSerialized();u&&(n.value=[{label:t.wrapper.field.defaultDisplayValue??"???",value:u}])})}function h(){return d.value?d.value.validate():!1}function S(){d.value&&d.value.resetValidation()}function g(){t.wrapper.clear(),n.value=[]}return e.onMounted(()=>{C(),t.wrapper.registerBehaviourCallbacks(h,S)}),(u,b)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:d,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[b[0]||(b[0]=w=>t.wrapper.modelValue=w),b[1]||(b[1]=w=>t.wrapper.modelValueOnUpdate(w))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":p,clearable:t.wrapper.field.clearable,prefix:t.wrapper.field.prefix,suffix:t.wrapper.field.suffix,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:n.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:g,onFilter:s},{options:e.withCtx(w=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),{scope:w},null,8,["scope"]))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),ce=e.defineComponent({__name:"SelectHasManyField",props:{wrapper:{}},setup(o){const t=o,r=t.wrapper.field.componentOptions.associationDisplayComponent,a=t.wrapper.injectForm.getFormFactoryInstance(),l=a.formSettings,i=a.formStyle,p=l.rulesBehaviour==="lazy",n=e.ref([]),f=e.ref({limit:N(),offset:0}),d=e.ref();function s(u,b){const w=t.wrapper.injectForm.getAssociationDataCallback();u===""&&(f.value={limit:N(),offset:0}),b(()=>{w({resourceName:t.wrapper.injectForm.getForm().resourceName,associationName:t.wrapper.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:u,context:t.wrapper.injectForm.getForm().context}).then(V=>{n.value=V.rows}).catch(()=>{n.value=[]})})}function C(){e.nextTick(()=>{const u=t.wrapper.getValueSerialized();u&&(n.value=u.map((b,w)=>({label:t.wrapper.field.defaultDisplayValue[w]??"???",value:b})))})}function h(){return d.value?d.value.validate():!1}function S(){d.value&&d.value.resetValidation()}function g(){t.wrapper.clear(),n.value=[]}return e.onMounted(()=>{C(),t.wrapper.registerBehaviourCallbacks(h,S)}),(u,b)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:d,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[b[0]||(b[0]=w=>t.wrapper.modelValue=w),b[1]||(b[1]=w=>t.wrapper.modelValueOnUpdate(w))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":p,clearable:t.wrapper.field.clearable,prefix:t.wrapper.field.prefix,suffix:t.wrapper.field.suffix,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:n.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:g,onFilter:s},{options:e.withCtx(w=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),{scope:w},null,8,["scope"]))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),q=e.defineComponent({__name:"StringField",props:{wrapper:{}},setup(o){const t=o,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,l=r.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref();function n(){return p.value?p.value.validate():!1}function f(){p.value&&p.value.resetValidation()}return e.onMounted(()=>{t.wrapper.registerBehaviourCallbacks(n,f)}),(d,s)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:p,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[s[0]||(s[0]=C=>t.wrapper.modelValue=C),s[1]||(s[1]=C=>t.wrapper.modelValueOnUpdate(C))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,prefix:t.wrapper.field.prefix,suffix:t.wrapper.field.suffix,readonly:t.wrapper.field.readonly,clearable:t.wrapper.field.clearable,autogrow:!0,rules:t.wrapper.rules,onClear:t.wrapper.clear},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),de=e.defineComponent({__name:"NumberField",props:{wrapper:{}},setup(o){const t=o,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,l=r.formStyle,i=a.rulesBehaviour==="lazy",p=e.ref();function n(){return p.value?p.value.validate():!1}function f(){p.value&&p.value.resetValidation()}return e.onMounted(()=>{t.wrapper.registerBehaviourCallbacks(n,f)}),(d,s)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:p,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[s[0]||(s[0]=C=>t.wrapper.modelValue=C),s[1]||(s[1]=C=>t.wrapper.modelValueOnUpdate(C))],modelModifiers:{number:!0},type:"number",label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,clearable:t.wrapper.field.clearable,prefix:t.wrapper.field.prefix,suffix:t.wrapper.field.suffix,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,onClear:t.wrapper.clear},null,8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}});class j{constructor(t,r,a,l,i,p,n,f){_(this,"resourceName");_(this,"formSettings");_(this,"formStyle");_(this,"actionComponent");_(this,"sectionComponent");_(this,"wrapperResetComponent");_(this,"associationDisplayComponent");_(this,"associationDisplayRecord");this.resourceName=t,this.formSettings={...r,...x.getGlobalFormSetting()},this.formStyle={...a,...x.getGlobalFormStyle()},this.actionComponent=l??x.getGlobalActionComponent(),this.sectionComponent=i??x.getGlobalSectionComponent(),this.wrapperResetComponent=p??x.getGlobalWrapperResetComponent(),this.associationDisplayComponent=n??x.getGlobalAssociationDisplayComponent(),this.associationDisplayRecord=f??x.getGlobalAssociationDisplayRecord()}static getFieldComponentByFormFieldType(t){return{string:q,text:q,number:de,date:Z,datetime:te,selectString:le,selectBelongsTo:se,selectHasMany:ce,checkbox:oe,object:ae}[t]}getForm(t,r,a,l){const i=[];return t.form.sections.forEach(n=>{const f=[];n.fields.forEach(s=>{const C=j.getFieldComponentByFormFieldType(s.field_type),h={associationDisplayComponent:this.associationDisplayRecord[s.field_association_class??""]??this.associationDisplayComponent,regularFieldType:this.getRegularFieldTypeByFieldType(s.field_type)},S={type:s.field_type,metadata:s,label:s.label,hint:s.hint,prefix:s.prefix,suffix:s.suffix,readonly:t.form.readonly??n.readonly??s.readonly,cssClass:s.css_class,selectOptions:s.select_options,rules:s.rules,clearable:t.form.clearable,provideUniqKey:r,defaultDisplayValue:s.default_display_value,component:C,componentOptions:h};f.push(S)});const d={label:n.label,icon:n.icon,cssClass:n.css_class,readonly:t.form.readonly??n.readonly,fields:f};i.push(d)}),{sections:i,resourceName:t.form.resource_name,resourceId:a,cssClass:t.form.css_class,resetable:t.form.resetable,clearable:t.form.clearable,readonly:t.form.readonly,backendDateFormat:t.form.backend_date_format,backendDatetimeFormat:t.form.backend_datetime_format,context:l}}getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}}function pe(o,t,r){const a=r.getFormFactoryInstance().formSettings,l=r.getForm(),i=(d,s,C)=>d[s]?C?()=>p(d[s]):()=>d[s]:d.compare_to?()=>r.getFieldDataByFieldName(d.compare_to)??"Submit64 error : missing comparator definition":()=>"",p=d=>String(c.date.formatDate(c.date.extractDate(d,l.backendDateFormat),a.dateFormat)),n=[],f=[];switch(t){case"date":n.push(L(a.dateFormat));break;case"datetime":n.push(L(a.datetimeFormat));break}return o.forEach(d=>{const s=d;switch(s.type){case"required":n.push(fe());break;case"absence":n.push(me());break;case"acceptance":n.push(ge());break;case"inclusion":n.push(Q(s.including));break;case"exclusion":n.push(ue(s.excluding));break;case"backend":break;case"allowNull":f.push("allowNull");break;case"allowBlank":f.push("allowBlank");break;case"positiveNumber":n.push(he());break;case"lessThanOrEqualNumber":n.push(Ce(i(s,"less_than")));break;case"lessThanNumber":n.push(we(i(s,"less_than")));break;case"greaterThanOrEqualNumber":n.push(Se(i(s,"greater_than")));break;case"greaterThanNumber":n.push(ke(i(s,"greater_than")));break;case"equalToNumber":n.push(_e(i(s,"equal_to")));break;case"otherThanNumber":n.push(Fe(i(s,"other_than")));break;case"numberIntegerOnly":n.push(xe());break;case"numberNumericOnly":n.push(Ve());break;case"numberEvenOnly":n.push(Be());break;case"numberOddOnly":n.push(De());break;case"lessThanOrEqualStringLength":n.push(Te(i(s,"less_than")));break;case"lessThanStringLength":n.push(Ne(i(s,"less_than")));break;case"greaterThanOrEqualStringLength":n.push(Re(i(s,"greater_than")));break;case"greaterThanStringLength":n.push(Oe(i(s,"greater_than")));break;case"equalToStringLength":n.push(Ie(i(s,"equal_to")));break;case"equalToString":n.push($e(i(s,"equal_to")));break;case"betweenStringLength":n.push(Ee(()=>s.min,()=>s.max));break;case"otherThanString":n.push(ze(i(s,"other_than")));break;case"lessThanOrEqualDate":n.push(je(i(s,"less_than",!0),a.dateFormat));break;case"lessThanDate":n.push(Ue(i(s,"less_than",!0),a.dateFormat));break;case"greaterThanOrEqualDate":n.push(qe(i(s,"greater_than",!0),a.dateFormat));break;case"greaterThanDate":n.push(Qe(i(s,"greater_than",!0),a.dateFormat));break;case"equalToDate":n.push(Le(i(s,"equal_to",!0),a.dateFormat));break;case"otherThanDate":n.push(Pe(i(s,"other_than",!0),a.dateFormat));break}}),f.length>0?f.map(d=>{switch(d){case"allowBlank":return ye(n);case"allowNull":return be(n)}}):n}function fe(){return o=>!!o||"Ce champ est requis"}function Q(o){return t=>o.includes(String(t))||`Doit être contenu dans ${o.toString()}`}function ue(o){return t=>!o.includes(String(t)||`Ne doit pas être contenu dans ${Q.toString()}`)}function me(){return o=>!o||"Ce champ doit être vide"}function ge(){return o=>!!o||"Doit être accepté"}function be(o){return t=>(t===null||o.forEach(r=>{const a=r(t);if(a!==!0)return a}),!0)}function ye(o){return t=>(t===""||o.forEach(r=>{const a=r(t);if(a!==!0)return a}),!0)}function he(){return o=>Number(o)>0||"Val. positive uniquement"}function Ce(o){return t=>{const r=o();return Number(t)<=r||`Inf. ou égal à ${r}`}}function we(o){return t=>{const r=o();return Number(t)<r||`Inf. ${r}`}}function Se(o){return t=>{const r=o();return Number(t)>=r||`Sup. ou égal à ${r}`}}function ke(o){return t=>{const r=o();return Number(t)>r||`Sup. à ${r}`}}function _e(o,t){return r=>{const a=o();return Number(r)===a||`Égale à ${a}`}}function Fe(o,t){return r=>{const a=o();return Number(r)!==a||`Doit être différent de ${o}`}}function xe(){return o=>/^-?\d+$/.test(String(o).trim())||"Nombre entier uniquement"}function Ve(){return o=>/^-?\d+(\.\d+)?$/.test(String(o).trim())||"Caractère numérique uniquement"}function Be(){return o=>Number.isInteger(Number(o))&&Number(o)%2===0||"Nombre pair uniquement"}function De(){return o=>Number.isInteger(Number(o))&&Number(o)%2===1||"Nombre impair uniquement"}function Te(o){return t=>{const r=o();return String(t).length<=r||`Inf. ou égal à ${r}`}}function Ne(o){return t=>{const r=o();return String(t).length<r||`Inf. à ${r}`}}function Re(o){return t=>{const r=o();return String(t).length>=r||`Sup. ou égal à ${r}`}}function Oe(o){return t=>{const r=o();return String(t).length>r||`Sup. à ${r}`}}function Ee(o,t){return r=>{const a=o(),l=t();return String(r).length>=a&&String(r).length<=l||`Entre ${a} et ${l}`}}function $e(o,t){return r=>{const a=o();return String(r)===a||`Égale à ${a}`}}function Ie(o){return t=>{const r=o();return String(t).length===r||`Doit contenir ${r} caractères`}}function ze(o){return t=>{const r=o();return String(t)!==r||`Doit être différent de ${r}`}}function je(o,t){return r=>{const a=o(),l=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return l<=i||`Inf. ou égal à ${a}`}}function Ue(o,t){return r=>{const a=o(),l=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return l<i||`Inf. à ${a}`}}function qe(o,t){return r=>{const a=o(),l=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return l>=i||`Sup. ou égal à ${a}`}}function Qe(o,t){return r=>{const a=o(),l=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return l>i||`Sup. à ${a}`}}function Le(o,t){return r=>{const a=o(),l=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return l===i||`Égale à ${l}`}}function Pe(o,t){return r=>{const a=o();return c.date.extractDate(String(r),t)!==c.date.extractDate(a,t)||`Doit être différent de ${a}`}}function L(o){return t=>t==null||t===""?!0:Ge(t,o)||`Date invalide. Format : ${o}`}function Ge(o,t){if(typeof o!="string"||!o.trim())return!1;const r=c.date.extractDate(o,t);return!(r instanceof Date)||isNaN(r.getTime())?!1:c.date.formatDate(r,t)===o}const Ae={computeServerRules:pe},He={key:0,class:"q-field__bottom text-negative q-pt-none"},Ye=["index"],P=e.defineComponent({__name:"FieldWrapper",props:{field:{},context:{}},setup(o,{expose:t}){const r=o;let a=()=>!0,l=()=>{};const i=e.inject(r.field.provideUniqKey),p=S(),n=e.ref(),f=e.ref([]);function d(){i&&(n.value=i.getDataByFieldName(r.field.metadata.field_name),n.value=s(n.value),e.nextTick(()=>{O()}))}function s(m){switch(r.field.type){case"checkbox":return m==null||m===""?!1:m;case"date":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),i.getForm().backendDateFormat),i.getFormFactoryInstance().formSettings.dateFormat);case"datetime":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),i.getForm().backendDatetimeFormat),i.getFormFactoryInstance().formSettings.datetimeFormat)}return m}function C(m){switch(r.field.type){case"date":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),i.getFormFactoryInstance().formSettings.dateFormat),i.getForm().backendDateFormat);case"datetime":return m==null||m===""?null:c.date.formatDate(c.date.extractDate(String(m),i.getFormFactoryInstance().formSettings.datetimeFormat),i.getForm().backendDatetimeFormat)}return m}function h(){switch(r.field.type){case"string":n.value="";break;case"checkbox":n.value=!1;break;case"date":n.value=null;break;case"datetime":n.value=null;break;case"number":n.value=null;break;case"selectString":n.value=void 0;break;case"text":n.value="";break;case"object":n.value={};break;case"selectBelongsTo":n.value=void 0;break;case"selectHasMany":n.value=void 0;break}}function S(){return Ae.computeServerRules(r.field.rules??[],r.field.type,i)}function g(m){n.value=m}function u(){return e.unref(n)}function b(){return C(e.unref(n))}function w(m){f.value=m}function V(){return a()}function O(){return l()}function E(m,B){a=m,l=B}return t({reset:d,clear:h,validate:V,resetValidation:O,getValueDeserialized:b,getValueSerialized:u,setupBackendErrors:w}),e.onMounted(()=>{var B;d();const m=(B=e.getCurrentInstance())==null?void 0:B.exposed;m&&i&&i.registerRef(r.field.metadata.field_name,m)}),(m,B)=>(e.openBlock(),e.createElementBlock("div",null,[e.renderSlot(m.$slots,"default",{propsWrapper:{modelValue:n.value,modelValueOnUpdate:g,field:r.field,injectForm:e.unref(i),rules:e.unref(p),reset:d,clear:h,getValueDeserialized:b,getValueSerialized:u,validate:V,registerBehaviourCallbacks:E}},()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(r.field.component),{wrapper:{modelValue:n.value,modelValueOnUpdate:g,field:r.field,injectForm:e.unref(i),rules:e.unref(p),reset:d,clear:h,getValueDeserialized:b,getValueSerialized:u,validate:V,registerBehaviourCallbacks:E}},null,8,["wrapper"])),f.value.length>0?(e.openBlock(),e.createElementBlock("div",He,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,($,U)=>(e.openBlock(),e.createElementBlock("div",{index:U,class:"flex column"},e.toDisplayString($),9,Ye))),256))])):e.createCommentVNode("",!0)])]))}}),We={key:0,class:"flex column"},Ke=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},sectionComponent:{},actionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},onSubmitFail:{},onSubmitSuccess:{},context:{}},setup(o,{expose:t}){const r=o;let a=null;const l=Object.freeze(new j(r.resourceName,r.formSettings,r.formStyle,r.actionComponent,r.sectionComponent,r.wrapperResetComponent,r.associationDisplayComponent,r.associationDisplayRecord)),i=ie(c.uid()),p=e.ref(new Map),n=e.ref(),f=e.ref(!1),d=e.ref(!1),s=e.ref("create");async function C(){a=await r.getMetadataAndData({resourceName:r.resourceName,resourceId:r.resourceId,context:r.context}),n.value=Object.freeze(l.getForm(a,i,r.resourceId,r.context)),r.resourceId&&(s.value="edit"),f.value=!0}async function h(){var D,I;if(!g())return;d.value=!0,V();const y=S(),k=await r.getSubmitFormData({resourceName:r.resourceName,resourceId:r.resourceId,resourceData:y,context:r.context});k.success?(s.value==="create"&&(s.value="edit"),a&&k.resource_data&&(a.resource_data=k.resource_data),u(),(I=r.onSubmitSuccess)==null||I.call(r)):([...p.value].forEach(T=>{const z=k.errors[T[0]];z&&T[1].setupBackendErrors(z)}),(D=r.onSubmitFail)==null||D.call(r)),d.value=!1}function S(){const y={};return[...p.value].forEach(k=>{y[k[0]]=k[1].getValueDeserialized()}),y}function g(){let y=!0;return p.value.forEach(k=>{if(!k.validate()){y=!1;return}}),y}function u(){p.value.forEach(y=>{y.reset()})}function b(){p.value.forEach(y=>{y.clear()})}function w(){p.value.forEach(y=>{y.resetValidation()})}function V(){p.value.forEach(y=>{y.setupBackendErrors([])})}function O(y,k){p.value.set(y,k)}function E(y){if(a)return a.resource_data[y]}function m(y){const k=[...p.value].find(D=>D[0]===y);return k?k[1].getValue():null}function B(){return l}function $(){return n.value}function U(){return r.getAssociationData??(async()=>({rows:[],row_count:0}))}function Me(){["getMetadataAndData","getMetadataAndData","resourceName"].forEach(k=>{(r[k]===null||r[k]===void 0)&&console.warn(`Missing props for <Submit64> -> ${k}`)})}function Je(){return s.value}return e.provide(i,{registerRef:O,getDataByFieldName:E,getFieldDataByFieldName:m,getFormFactoryInstance:B,getForm:$,getAssociationDataCallback:U}),t({getMode:Je,getFormFactoryInstance:B,getForm:$,validateForm:g,resetForm:u,clearForm:b,resetValidation:w,submitForm:h}),e.onMounted(async()=>{Me(),await C()}),(y,k)=>f.value&&n.value?(e.openBlock(),e.createElementBlock("div",We,[e.createElementVNode("div",{class:e.normalizeClass(n.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.sections,(D,I)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(l).sectionComponent),{key:I,section:D,context:r.context},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.fields,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T.metadata.field_name},[y.$slots[T.metadata.field_name]?(e.openBlock(),e.createBlock(P,{key:1,field:T,context:r.context},{default:e.withCtx(({propsWrapper:z})=>[e.renderSlot(y.$slots,"default",{propsWrapper:z})]),_:3},8,["field","context"])):(e.openBlock(),e.createBlock(P,{key:0,field:T,context:r.context},null,8,["field","context"]))],64))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(l).actionComponent),{isLoadingSubmit:d.value,formDef:n.value,submit:h,clear:n.value.clearable?b:void 0,reset:n.value.resetable?u:void 0},null,8,["isLoadingSubmit","formDef","clear","reset"])),y.$slots.more_actions?e.renderSlot(y.$slots,"more_actions",{key:0,propsForm:{generatedForm:n.value}}):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)}});F.Submit64=x,F.Submit64Form=Ke,Object.defineProperty(F,Symbol.toStringTag,{value:"Module"})});
