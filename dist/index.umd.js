(function(_,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(_=typeof globalThis<"u"?globalThis:_||self,e(_["submit64-vue"]={},_.Vue,_.Quasar))})(this,function(_,e,c){"use strict";var Je=Object.defineProperty;var Xe=(_,e,c)=>e in _?Je(_,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):_[e]=c;var S=(_,e,c)=>Xe(_,typeof e!="symbol"?e+"":e,c);const L={class:"flex row items-center no-wrap q-pt-sm"},q=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},reset:{type:Function},clear:{type:Function},submit:{type:Function}},setup(n){const t=n;return(r,a)=>(e.openBlock(),e.createElementBlock("div",L,[e.createVNode(e.unref(c.QBtn),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:a[0]||(a[0]=o=>t.submit())},null,8,["loading"]),t.reset?(e.openBlock(),e.createBlock(e.unref(c.QBtn),{key:0,loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:a[1]||(a[1]=o=>t.reset())},null,8,["loading"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(c.QBtn),{key:1,loading:t.isLoadingSubmit,label:"Vider",onClick:a[2]||(a[2]=o=>t.clear())},null,8,["loading"])):e.createCommentVNode("",!0)]))}}),G={class:"flex row items-center"},A={class:"text-body1 text-weight-medium"},H={class:"flex column q-gutter-sm"},M=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{}},setup(n){const t=n;return(r,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",t.section.cssClass])},[e.createElementVNode("div",G,[t.section.icon?(e.openBlock(),e.createBlock(e.unref(c.QIcon),{key:0,name:t.section.icon,size:"sm"},null,8,["name"])):e.createCommentVNode("",!0),e.createElementVNode("div",A,e.toDisplayString(t.section.label),1)]),e.createElementVNode("div",H,[e.renderSlot(r.$slots,"default")])],2))}}),Y=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(n){const t=n;return(r,a)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:a[0]||(a[0]=i=>t.reset())})}}}),W=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{index:{},label:{},selected:{type:Boolean},focused:{type:Boolean},opt:{},itemProps:{}},setup(n){const t=n;return(r,a)=>(e.openBlock(),e.createBlock(e.unref(c.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.opt.label),1)]),_:1})]),_:1})]),_:1},16))}}),T=class T{constructor(){S(this,"_formSettings");S(this,"_formStyle");S(this,"_actionComponent");S(this,"_sectionComponent");S(this,"_wrapperResetComponent");S(this,"_associationDisplayComponent");S(this,"_associationDisplayDictonary");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!0,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=q,this._sectionComponent=M,this._wrapperResetComponent=Y,this._associationDisplayComponent=W,this._associationDisplayDictonary=new Map}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static registerGlobalAssociationDisplayMap(t){this._instance._associationDisplayDictonary=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}static getGlobalAssociationDisplayMap(){return this._instance._associationDisplayDictonary}static getGlobalAssociationDisplayByResourceName(t){return this._instance._associationDisplayDictonary.get(t)}};S(T,"_instance",new T);let k=T;const K={class:"row items-center justify-end"},J=e.defineComponent({__name:"DateField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,o=r.formStyleConfig,i=a.rulesBehaviour==="lazy",s=e.ref(),l=e.ref();function f(){s.value&&s.value.hide()}function p(){return l.value?l.value.validate():!1}return e.onMounted(()=>{t.wrapper.registerValidationCallback(p)}),(d,y)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:l,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[y[2]||(y[2]=b=>t.wrapper.modelValue=b),y[3]||(y[3]=b=>t.wrapper.modelValueOnUpdate(b))],label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,readonly:t.wrapper.field.readonly,clearable:t.wrapper.field.clearable,rules:t.wrapper.rules,onClear:t.wrapper.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"popupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QDate),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[y[0]||(y[0]=b=>t.wrapper.modelValue=b),y[1]||(y[1]=b=>t.wrapper.modelValueOnUpdate(b))],mask:e.unref(r).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",K,[e.createVNode(e.unref(c.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","readonly","clearable","rules","onClear"]))}}),X={class:"row items-center justify-end"},Z={class:"row items-center justify-end"},v=e.defineComponent({__name:"DateTimeField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,o=r.formStyleConfig,i=a.rulesBehaviour==="lazy",s=e.ref(),l=e.ref(),f=e.ref();function p(){s.value&&s.value.hide()}function d(){l.value&&l.value.hide()}function y(){return f.value?f.value.validate():!1}return e.onMounted(()=>{t.wrapper.registerValidationCallback(y)}),(b,u)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:f,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[u[4]||(u[4]=m=>t.wrapper.modelValue=m),u[5]||(u[5]=m=>t.wrapper.modelValueOnUpdate(m))],label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,readonly:t.wrapper.field.readonly,clearable:t.wrapper.field.clearable,rules:t.wrapper.rules,onClear:t.wrapper.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"datePopupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QDate),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[u[0]||(u[0]=m=>t.wrapper.modelValue=m),u[1]||(u[1]=m=>t.wrapper.modelValueOnUpdate(m))],mask:e.unref(r).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",X,[e.createVNode(e.unref(c.QBtn),{onClick:p,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"timePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QTime),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[u[2]||(u[2]=m=>t.wrapper.modelValue=m),u[3]||(u[3]=m=>t.wrapper.modelValueOnUpdate(m))],mask:e.unref(r).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Z,[e.createVNode(e.unref(c.QBtn),{onClick:d,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","readonly","clearable","rules","onClear"]))}}),ee={key:0,class:"q-field__bottom"},te={key:1,class:"q-field--error q-field__bottom text-negative"},re=e.defineComponent({__name:"CheckboxField",props:{wrapper:{}},setup(n){const t=n,r=e.ref(!0),o=t.wrapper.injectForm.getFormFactoryInstance().formStyleConfig;function i(){return r.value===!0}return e.watch(()=>t.wrapper.modelValue,s=>{t.wrapper.rules.forEach(l=>{r.value=l(s),r.value})}),e.onMounted(()=>{t.wrapper.registerValidationCallback(i)}),(s,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(e.unref(c.QCheckbox),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[l[0]||(l[0]=f=>t.wrapper.modelValue=f),l[1]||(l[1]=f=>t.wrapper.modelValueOnUpdate(f))],label:t.wrapper.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.wrapper.field.readonly,class:e.normalizeClass(t.wrapper.field.cssClass)},null,8,["modelValue","label","dense","color","aria-readonly","class"]),t.wrapper.field.hint?(e.openBlock(),e.createElementBlock("div",ee,e.toDisplayString(t.wrapper.field.hint),1)):e.createCommentVNode("",!0),r.value!==!0?(e.openBlock(),e.createElementBlock("div",te,e.toDisplayString(r.value),1)):e.createCommentVNode("",!0)],64))}}),ne=e.defineComponent({__name:"ObjectField",props:{wrapper:{}},setup(n){const r=n.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings;return r.formStyleConfig,a.rulesBehaviour,(o,i)=>" TODO json edit ? "}}),oe=e.defineComponent({__name:"SelectField",props:{wrapper:{}},setup(n){const t=n,r=e.ref([]),a=e.ref([]),o=e.ref(),i=t.wrapper.injectForm.getFormFactoryInstance(),s=i.formSettings,l=i.formStyleConfig,f=s.rulesBehaviour==="lazy";function p(b,u){if(b===""){u(()=>{a.value=[...r.value]});return}u(()=>{const m=b.toLowerCase();a.value=r.value.filter(w=>w.label.toLowerCase().includes(m))})}function d(b){r.value=Object.freeze(b.field.selectOptions??[]),a.value=b.field.selectOptions??[]}function y(){return o.value?o.value.validate():!1}return e.onMounted(()=>{d(t.wrapper),t.wrapper.registerValidationCallback(y)}),(b,u)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:o,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[u[0]||(u[0]=m=>t.wrapper.modelValue=m),u[1]||(u[1]=m=>t.wrapper.modelValueOnUpdate(m))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":f,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:a.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.wrapper.clear,onFilter:p},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","options","onClear"]))}});function ae(n){return Symbol(n)}function N(){return 20}const le=e.defineComponent({__name:"SelectBelongsToField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.field.componentOptions.associationDisplayComponent,a=t.wrapper.injectForm.getFormFactoryInstance(),o=a.formSettings,i=a.formStyleConfig,s=o.rulesBehaviour==="lazy",l=e.ref([]),f=e.ref({limit:N(),offset:0}),p=e.ref();function d(u,m){const w=t.wrapper.injectForm.getAssociationDataCallback();u===""&&(f.value={limit:N(),offset:0}),m(()=>{w({resourceName:t.wrapper.injectForm.getForm().resourceName,associationName:t.wrapper.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:u,context:t.wrapper.injectForm.getForm().context}).then(B=>{l.value=B.rows})})}function y(){e.nextTick(()=>{l.value=[{label:t.wrapper.field.defaultDisplayValue??String(t.wrapper.getValueSerialized()),value:t.wrapper.getValueSerialized()}]})}function b(){return p.value?p.value.validate():!1}return e.onMounted(()=>{y(),t.wrapper.registerValidationCallback(b)}),(u,m)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{ref_key:"fieldRef",ref:p,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[m[0]||(m[0]=w=>t.wrapper.modelValue=w),m[1]||(m[1]=w=>t.wrapper.modelValueOnUpdate(w))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":s,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.wrapper.clear,onFilter:d},{options:e.withCtx(w=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),{scope:w},null,8,["scope"]))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","options","onClear"]))}}),ie=e.defineComponent({__name:"SelectHasManyField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.field.componentOptions.associationDisplayComponent,a=t.wrapper.injectForm.getFormFactoryInstance(),o=a.formSettings,i=a.formStyleConfig,s=o.rulesBehaviour==="lazy",l=e.ref([]),f=e.ref({limit:N(),offset:0});function p(y,b){const u=t.wrapper.injectForm.getAssociationDataCallback();y===""&&(f.value={limit:N(),offset:0}),b(()=>{u({resourceName:t.wrapper.injectForm.getForm().resourceName,associationName:t.wrapper.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:y,context:t.wrapper.injectForm.getForm().context}).then(m=>{l.value=m.rows})})}function d(){e.nextTick(()=>{l.value=[{label:t.wrapper.field.defaultDisplayValue??String(t.wrapper.getValueSerialized()),value:t.wrapper.getValueSerialized()}]})}return e.onMounted(()=>{d()}),(y,b)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[b[0]||(b[0]=u=>t.wrapper.modelValue=u),b[1]||(b[1]=u=>t.wrapper.modelValueOnUpdate(u))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":s,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.wrapper.clear,onFilter:p},{options:e.withCtx(u=>[e.unref(r)?(e.openBlock(),e.createBlock(e.unref(c.QItem),e.normalizeProps(e.mergeProps({key:0},u.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),{key:1,scope:u},null,8,["scope"]))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","options","onClear"]))}}),j=e.defineComponent({__name:"StringField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,o=r.formStyleConfig,i=a.rulesBehaviour==="lazy",s=e.ref();function l(){return s.value?s.value.validate():!1}return e.onMounted(()=>{t.wrapper.registerValidationCallback(l)}),(f,p)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:s,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[p[0]||(p[0]=d=>t.wrapper.modelValue=d),p[1]||(p[1]=d=>t.wrapper.modelValueOnUpdate(d))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,autogrow:!0,rules:t.wrapper.rules,onClear:t.wrapper.clear},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","onClear"]))}}),se=e.defineComponent({__name:"NumberField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.injectForm.getFormFactoryInstance(),a=r.formSettings,o=r.formStyleConfig,i=a.rulesBehaviour==="lazy",s=e.ref();function l(){return s.value?s.value.validate():!1}return e.onMounted(()=>{t.wrapper.registerValidationCallback(l)}),(f,p)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{ref_key:"fieldRef",ref:s,modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[p[0]||(p[0]=d=>t.wrapper.modelValue=d),p[1]||(p[1]=d=>t.wrapper.modelValueOnUpdate(d))],modelModifiers:{number:!0},type:"number",label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":i,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,onClear:t.wrapper.clear},null,8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","onClear"]))}});class z{constructor(t,r,a,o,i,s,l){S(this,"resourceName");S(this,"formSettings");S(this,"formStyleConfig");S(this,"actionComponent");S(this,"sectionComponent");S(this,"wrapperResetComponent");S(this,"associationDisplayComponent");this.resourceName=t,this.formSettings={...k.getGlobalFormSetting(),...r},this.formStyleConfig={...k.getGlobalFormStyle(),...a},this.actionComponent=o??k.getGlobalActionComponent(),this.sectionComponent=i??k.getGlobalSectionComponent(),this.wrapperResetComponent=s??k.getGlobalWrapperResetComponent(),this.associationDisplayComponent=l??k.getGlobalAssociationDisplayByResourceName(t)??k.getGlobalAssociationDisplayComponent()}static getFieldComponentByFormFieldType(t){return{string:j,text:j,number:se,date:J,datetime:v,selectString:oe,selectBelongsTo:le,selectHasMany:ie,checkbox:re,object:ne}[t]}getForm(t,r,a){const o=[];return t.form.sections.forEach(s=>{const l=[];s.fields.forEach(p=>{const d=z.getFieldComponentByFormFieldType(p.field_type),y={associationDisplayComponent:this.associationDisplayComponent,regularFieldType:this.getRegularFieldTypeByFieldType(p.field_type)},b={type:p.field_type,metadata:p,label:p.label,hint:p.hint,cssClass:p.css_class,selectOptions:p.select_options,rules:p.rules,clearable:t.form.clearable,provideUniqKey:r,defaultDisplayValue:p.default_display_value,component:d,componentOptions:y};l.push(b)});const f={label:s.label,icon:s.icon,cssClass:s.css_class,fields:l};o.push(f)}),{sections:o,resourceName:t.form.resource_name,cssClass:t.form.css_class,resetable:t.form.resetable,clearable:t.form.clearable,backendDateFormat:t.form.backend_date_format,backendDatetimeFormat:t.form.backend_datetime_format,hasGlobalCustomValidation:t.form.has_global_custom_validation??!1,context:a}}getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}}function ce(n,t,r){const a=r.getFormFactoryInstance().formSettings,o=r.getForm(),i=(p,d,y)=>p[d]?y?()=>s(p[d]):()=>p[d]:p.compare_to?()=>r.getFieldDataByFieldName(p.compare_to)??"Submit64 error : missing comparator definition":()=>"",s=p=>String(c.date.formatDate(c.date.extractDate(p,o.backendDateFormat),a.dateFormat)),l=[],f=[];switch(t){case"date":l.push(P(a.dateFormat));break;case"datetime":l.push(P(a.datetimeFormat));break}return n.forEach(p=>{const d=p;switch(d.type){case"required":l.push(de());break;case"absence":l.push(ue());break;case"acceptance":l.push(fe());break;case"inclusion":l.push(Q(d.including));break;case"exclusion":l.push(pe(d.excluding));break;case"backend":break;case"allowNull":f.push("allowNull");break;case"allowBlank":f.push("allowBlank");break;case"positiveNumber":l.push(be());break;case"lessThanOrEqualNumber":l.push(ye(i(d,"less_than")));break;case"lessThanNumber":l.push(he(i(d,"less_than")));break;case"greaterThanOrEqualNumber":l.push(Ce(i(d,"greater_than")));break;case"greaterThanNumber":l.push(we(i(d,"greater_than")));break;case"equalToNumber":l.push(Se(i(d,"equal_to")));break;case"otherThanNumber":l.push(_e(i(d,"other_than")));break;case"numberIntegerOnly":l.push(ke());break;case"numberNumericOnly":l.push(Fe());break;case"numberEvenOnly":l.push(Ve());break;case"numberOddOnly":l.push(Be());break;case"lessThanOrEqualStringLength":l.push(De(i(d,"less_than")));break;case"lessThanStringLength":l.push(xe(i(d,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(Ne(i(d,"greater_than")));break;case"greaterThanStringLength":l.push(Te(i(d,"greater_than")));break;case"equalToStringLength":l.push(Ee(i(d,"equal_to")));break;case"equalToString":l.push(Re(i(d,"equal_to")));break;case"betweenStringLength":l.push(Oe(()=>d.min,()=>d.max));break;case"otherThanString":l.push($e(i(d,"other_than")));break;case"lessThanOrEqualDate":l.push(Ie(i(d,"less_than",!0),a.dateFormat));break;case"lessThanDate":l.push(ze(i(d,"less_than",!0),a.dateFormat));break;case"greaterThanOrEqualDate":l.push(je(i(d,"greater_than",!0),a.dateFormat));break;case"greaterThanDate":l.push(Qe(i(d,"greater_than",!0),a.dateFormat));break;case"equalToDate":l.push(Pe(i(d,"equal_to",!0),a.dateFormat));break;case"otherThanDate":l.push(Ue(i(d,"other_than",!0),a.dateFormat));break}}),f.length>0?f.map(p=>{switch(p){case"allowBlank":return ge(l);case"allowNull":return me(l)}}):l}function de(){return n=>!!n||"Ce champ est requis"}function Q(n){return t=>n.includes(String(t))||`Doit être contenu dans ${n.toString()}`}function pe(n){return t=>!n.includes(String(t)||`Ne doit pas être contenu dans ${Q.toString()}`)}function ue(){return n=>!n||"Ce champ doit être vide"}function fe(){return n=>!!n||"Doit être accepté"}function me(n){return t=>(t===null||n.forEach(r=>{const a=r(t);if(a!==!0)return a}),!0)}function ge(n){return t=>(t===""||n.forEach(r=>{const a=r(t);if(a!==!0)return a}),!0)}function be(){return n=>Number(n)>0||"Val. positive uniquement"}function ye(n){return t=>{const r=n();return Number(t)<=r||`Inf. ou égal à ${r}`}}function he(n){return t=>{const r=n();return Number(t)<r||`Inf. ${r}`}}function Ce(n){return t=>{const r=n();return Number(t)>=r||`Sup. ou égal à ${r}`}}function we(n){return t=>{const r=n();return Number(t)>r||`Sup. à ${r}`}}function Se(n,t){return r=>{const a=n();return Number(r)===a||`Égale à ${a}`}}function _e(n,t){return r=>{const a=n();return Number(r)!==a||`Doit être différent de ${n}`}}function ke(){return n=>/^-?\d+$/.test(String(n).trim())||"Nombre entier uniquement"}function Fe(){return n=>/^-?\d+(\.\d+)?$/.test(String(n).trim())||"Caractère numérique uniquement"}function Ve(){return n=>Number.isInteger(Number(n))&&Number(n)%2===0||"Nombre pair uniquement"}function Be(){return n=>Number.isInteger(Number(n))&&Number(n)%2===1||"Nombre impair uniquement"}function De(n){return t=>{const r=n();return String(t).length<=r||`Inf. ou égal à ${r}`}}function xe(n){return t=>{const r=n();return String(t).length<r||`Inf. à ${r}`}}function Ne(n){return t=>{const r=n();return String(t).length>=r||`Sup. ou égal à ${r}`}}function Te(n){return t=>{const r=n();return String(t).length>r||`Sup. à ${r}`}}function Oe(n,t){return r=>{const a=n(),o=t();return String(r).length>=a&&String(r).length<=o||`Entre ${a} et ${o}`}}function Re(n,t){return r=>{const a=n();return String(r)===a||`Égale à ${a}`}}function Ee(n){return t=>{const r=n();return String(t).length===r||`Doit contenir ${r} caractères`}}function $e(n){return t=>{const r=n();return String(t)!==r||`Doit être différent de ${r}`}}function Ie(n,t){return r=>{const a=n(),o=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return o<=i||`Inf. ou égal à ${a}`}}function ze(n,t){return r=>{const a=n(),o=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return o<i||`Inf. à ${a}`}}function je(n,t){return r=>{const a=n(),o=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return o>=i||`Sup. ou égal à ${a}`}}function Qe(n,t){return r=>{const a=n(),o=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return o>i||`Sup. à ${a}`}}function Pe(n,t){return r=>{const a=n(),o=c.date.extractDate(String(r),t),i=c.date.extractDate(a,t);return o===i||`Égale à ${o}`}}function Ue(n,t){return r=>{const a=n();return c.date.extractDate(String(r),t)!==c.date.extractDate(a,t)||`Doit être différent de ${a}`}}function P(n){return t=>t==null||t===""?!0:Le(t,n)||`Date invalide. Format : ${n}`}function Le(n,t){if(typeof n!="string"||!n.trim())return!1;const r=c.date.extractDate(n,t);return!(r instanceof Date)||isNaN(r.getTime())?!1:c.date.formatDate(r,t)===n}const qe={computeServerRules:ce},Ge={key:0,class:"q-field__bottom text-negative q-pt-none"},Ae=["index"],U=e.defineComponent({__name:"FieldWrapper",props:{field:{}},setup(n,{expose:t}){const r=n;let a=()=>!0;const o=e.inject(r.field.provideUniqKey),i=b(),s=e.ref(),l=e.ref([]);function f(){o&&(s.value=o.getDataByFieldName(r.field.metadata.field_name),s.value=p(s.value))}function p(g){switch(r.field.type){case"date":return g==null||g===""?"":c.date.formatDate(c.date.extractDate(String(g),o.getForm().backendDateFormat),o.getFormFactoryInstance().formSettings.dateFormat);case"datetime":return g==null||g===""?"":c.date.formatDate(c.date.extractDate(String(g),o.getForm().backendDatetimeFormat),o.getFormFactoryInstance().formSettings.datetimeFormat)}return g}function d(g){switch(r.field.type){case"date":return g==null||g===""?void 0:c.date.formatDate(c.date.extractDate(String(g),o.getFormFactoryInstance().formSettings.dateFormat),o.getForm().backendDateFormat);case"datetime":return g==null||g===""?void 0:c.date.formatDate(c.date.extractDate(String(g),o.getFormFactoryInstance().formSettings.datetimeFormat),o.getForm().backendDatetimeFormat)}return g}function y(){switch(r.field.type){case"string":s.value="";break;case"checkbox":s.value=!1;break;case"date":s.value="";break;case"datetime":s.value="";break;case"number":s.value=null;break;case"selectString":s.value=null;break;case"text":s.value="";break;case"object":s.value={};break;case"selectBelongsTo":s.value=null;break;case"selectHasMany":s.value=null;break}}function b(){return qe.computeServerRules(r.field.rules??[],r.field.type,o)}function u(g){s.value=g}function m(){return s}function w(){return d(e.unref(s))}function B(g){l.value=g}function D(){return a()}function O(g){a=g}return t({reset:f,clear:y,validate:D,getValueDeserialized:w,getValueSerialized:m,setupBackendErrors:B}),e.onMounted(()=>{var x;f();const g=(x=e.getCurrentInstance())==null?void 0:x.exposed;g&&o&&o.registerRef(r.field.metadata.field_name,g)}),(g,x)=>(e.openBlock(),e.createElementBlock("div",null,[e.renderSlot(g.$slots,"default",{propsWrapper:{modelValue:s.value,modelValueOnUpdate:u,field:r.field,injectForm:e.unref(o),rules:e.unref(i),reset:f,clear:y,getValueDeserialized:w,getValueSerialized:m,validate:D,registerValidationCallback:O}},()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(r.field.component),{wrapper:{modelValue:s.value,modelValueOnUpdate:u,field:r.field,injectForm:e.unref(o),rules:e.unref(i),reset:f,clear:y,getValueDeserialized:w,getValueSerialized:m,validate:D,registerValidationCallback:O}},null,8,["wrapper"])),l.value.length>0?(e.openBlock(),e.createElementBlock("div",Ge,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(R,E)=>(e.openBlock(),e.createElementBlock("div",{index:E,class:"flex column"},e.toDisplayString(R),9,Ae))),256))])):e.createCommentVNode("",!0)])]))}}),He={key:0,class:"flex column"},Me=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayDictionary:{},onSubmitFail:{},onSubmitSuccess:{},context:{}},setup(n,{expose:t}){const r=n;let a=null;const o=Object.freeze(new z(r.resourceName,r.formSettings,r.formStyle,r.actionComponent,r.sectionComponent,r.wrapperResetComponent,r.associationDisplayDictionary)),i=ae(c.uid()),s=e.ref(new Map),l=e.ref(),f=e.ref(!1),p=e.ref(!1),d=e.ref("create");async function y(){a=await r.getMetadataAndData({resourceName:r.resourceName,resourceId:r.resourceId,context:r.context}),l.value=Object.freeze(o.getForm(a,i,r.context)),r.resourceId&&(d.value="edit"),f.value=!0}async function b(){var V,$;if(!m())return;p.value=!0,D();const h=u(),C=await r.getSubmitFormData({resourceName:r.resourceName,resourceId:r.resourceId,resourceData:h,context:r.context});C.success?(d.value==="create"&&(d.value="edit"),a&&C.resource_data&&(a.resource_data=C.resource_data),w(),($=r.onSubmitSuccess)==null||$.call(r)):([...s.value].forEach(F=>{const I=C.errors[F[0]];I&&F[1].setupBackendErrors(I)}),(V=r.onSubmitFail)==null||V.call(r)),p.value=!1}function u(){const h={};return[...s.value].forEach(C=>{h[C[0]]=C[1].getValueDeserialized()}),h}function m(){let h=!0;return s.value.forEach(C=>{if(!C.validate()){h=!1;return}}),h}function w(){s.value.forEach(h=>{h.reset()})}function B(){s.value.forEach(h=>{h.clear()})}function D(){s.value.forEach(h=>{h.setupBackendErrors([])})}function O(h,C){s.value.set(h,C)}function g(h){if(a)return a.resource_data[h]}function x(h){const C=[...s.value].find(V=>V[0]===h);return C?C[1].getValue():null}function R(){return o}function E(){return l.value}function Ye(){return r.getAssociationData??(async()=>({rows:[],row_count:0}))}function We(){["getMetadataAndData","getMetadataAndData","resourceName"].forEach(C=>{(r[C]===null||r[C]===void 0)&&console.warn(`Missing props for <Submit64> -> ${C}`)})}function Ke(){return d.value}return e.provide(i,{registerRef:O,getDataByFieldName:g,getFieldDataByFieldName:x,getFormFactoryInstance:R,getForm:E,getAssociationDataCallback:Ye}),t({getMode:Ke,getFormFactoryInstance:R,getForm:E,validateForm:m,resetForm:w,clearForm:B,submitForm:b}),e.onMounted(async()=>{We(),await y()}),(h,C)=>f.value&&l.value?(e.openBlock(),e.createElementBlock("div",He,[e.createElementVNode("div",{class:e.normalizeClass(l.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.sections,(V,$)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(o).sectionComponent),{key:$,section:V},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(V.fields,F=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:F.metadata.field_name},[h.$slots[F.metadata.field_name]?(e.openBlock(),e.createBlock(U,{key:1,field:F},{default:e.withCtx(({propsWrapper:I})=>[e.renderSlot(h.$slots,F.metadata.field_name,{propsWrapper:I})]),_:2},1032,["field"])):(e.openBlock(),e.createBlock(U,{key:0,field:F},null,8,["field"]))],64))),128))]),_:2},1032,["section"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(o).actionComponent),{isLoadingSubmit:p.value,submit:b,clear:l.value.clearable?B:void 0,reset:l.value.resetable?w:void 0},null,8,["isLoadingSubmit","clear","reset"])),h.$slots.more_actions?e.renderSlot(h.$slots,"more_actions",{key:0,propsForm:{generatedForm:l.value}}):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)}});_.Submit64=k,_.Submit64Form=Me,Object.defineProperty(_,Symbol.toStringTag,{value:"Module"})});
