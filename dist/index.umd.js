(function(I,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(I=typeof globalThis<"u"?globalThis:I||self,e(I["submit64-vue"]={},I.Vue,I.Quasar))})(this,function(I,e,s){"use strict";var xn=Object.defineProperty;var Bn=(I,e,s)=>e in I?xn(I,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):I[e]=s;var w=(I,e,s)=>Bn(I,typeof e!="symbol"?e+"":e,s);const me={class:"flex column"},pe={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},he=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(a){const t=a;function n(){const r=t.formApi.form.formStyle;return{outline:r.fieldOutlined,rounded:r.fieldRounded,square:r.fieldSquare,dense:r.fieldDense,color:r.fieldColor,noCaps:!0}}return(r,o)=>(e.openBlock(),e.createElementBlock("div",me,[e.createElementVNode("div",pe,[e.createVNode(e.unref(s.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.formApi.isLoadingSubmit,onClick:t.formApi.submit}),null,16,["loading","onClick"]),t.formApi.form.resetable?(e.openBlock(),e.createBlock(e.unref(s.QBtn),e.mergeProps({key:0},n(),{loading:t.formApi.isLoadingSubmit,label:"Réinitialiser",onClick:t.formApi.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.formApi.form.clearable?(e.openBlock(),e.createBlock(e.unref(s.QBtn),e.mergeProps({key:1},n(),{loading:t.formApi.isLoadingSubmit,label:"Effacer",onClick:t.formApi.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),ge={class:"flex row items-center"},ye={class:"text-body1 text-weight-medium"},Ce={class:"flex column q-gutter-md"},be=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(t.sectionApi.section.cssClass)},[e.createElementVNode("div",ge,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(s.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",ye,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",Ce,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.sectionApi.section.fieldsComponent)))])],2))}}),ke=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,r)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:r[0]||(r[0]=i=>t.reset())})}}}),_e=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createBlock(e.unref(s.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),Ve={class:"flex column"},Se=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",Ve,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.formApi.orphanErrors,(o,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(i)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),ee=class ee{constructor(){w(this,"_formSettings");w(this,"_formStyle");w(this,"_actionComponent");w(this,"_orphanErrorsComponent");w(this,"_sectionComponent");w(this,"_wrapperResetComponent");w(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0,associationEmptyMessage:"Empty",requiredFieldsHasAsterisk:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:""},this._actionComponent=he,this._orphanErrorsComponent=Se,this._sectionComponent=be,this._wrapperResetComponent=ke,this._associationDisplayComponent=_e}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};w(ee,"_instance",new ee);let U=ee;class X{constructor(t){w(this,"formApi");w(this,"events",[]);this.formApi=t}when(t,n){const r=t,o=n,i=new Fe(r,o,this.formApi);return this.events.push(i),new xe(i)}static create(t){return new X(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(r=>{const o=r.getTarget();switch(o.target){case"field":n.fields[o.targetName]||(n.fields[o.targetName]={}),n.fields[o.targetName][o.key]||(n.fields[o.targetName][o.key]=[]),n.fields[o.targetName][o.key].push(r.getActionCallback());break;case"section":n.sections[o.targetName]||(n.sections[o.targetName]={}),n.sections[o.targetName][o.key]||(n.sections[o.targetName][o.key]=[]),n.sections[o.targetName][o.key].push(r.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(r.getActionCallback());break}}),n}}class Fe{constructor(t,n,r){w(this,"type");w(this,"data");w(this,"formApi");w(this,"action",()=>{});w(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=r}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is invalid":return{target:"field",targetName:this.data.fieldName,key:"onIsInvalid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Field is ready":return{target:"field",targetName:this.data.fieldName,key:"onReady"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onIsValid"};case"Section is invalid":return{target:"section",targetName:this.data.sectionName,key:"onIsInvalid"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Section is updated":return{target:"section",targetName:this.data.sectionName,key:"onUpdate"};case"Section is ready":return{target:"section",targetName:this.data.sectionName,key:"onReady"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is invalid":return{target:"form",key:"onIsInvalid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class xe{constructor(t){w(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const Be={class:"row items-center justify-end"},Ne=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,i=r.rulesBehaviour==="lazy",u=e.ref(),l=e.ref();function c(){u.value&&u.value.hide()}function f(){return l.value?l.value.validate():!1}function h(){return l.value?!l.value.hasError:!1}function S(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(f,h,S),i||e.nextTick(()=>{var g;(g=l.value)==null||g.resetValidation()})}),(g,V)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":V[1]||(V[1]=R=>t.modelValueOnUpdate(R)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(s.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{ref_key:"popupProxyRef",ref:u,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":V[0]||(V[0]=R=>t.modelValueOnUpdate(R)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Be,[e.createVNode(e.unref(s.QBtn),{onClick:c,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),De={class:"row items-center justify-end"},we={class:"row items-center justify-end"},Ae=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,i=r.rulesBehaviour==="lazy",u=e.ref(),l=e.ref(),c=e.ref();function f(){u.value&&u.value.hide()}function h(){l.value&&l.value.hide()}function S(){return c.value?c.value.validate():!1}function g(){return c.value?!c.value.hasError:!1}function V(){c.value&&c.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(S,g,V),i||e.nextTick(()=>{var R;(R=c.value)==null||R.resetValidation()})}),(R,A)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":A[2]||(A[2]=x=>t.modelValueOnUpdate(x)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(s.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{ref_key:"datePopupProxyRef",ref:u,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":A[0]||(A[0]=x=>t.modelValueOnUpdate(x)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",De,[e.createVNode(e.unref(s.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(s.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{ref_key:"timePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":A[1]||(A[1]=x=>t.modelValueOnUpdate(x)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",we,[e.createVNode(e.unref(s.QBtn),{onClick:h,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ee={class:"flex column"},Re={key:0,class:"q-field__bottom"},Te={key:1,class:"q-field--error q-field__bottom text-negative"},ze=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),o=t.formApi.form.formStyle;function i(){return n.value===!0}function u(){return n.value===!0}function l(){n.value=!0}return e.watch(()=>t.modelValue,c=>{for(const f of t.rules)if(n.value=f(c),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(i,u,l)}),(c,f)=>(e.openBlock(),e.createElementBlock("div",Ee,[e.createVNode(e.unref(s.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":f[0]||(f[0]=h=>t.modelValueOnUpdate(h)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",Re,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",Te,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Oe=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),r=e.ref([]),o=e.ref(),i=t.formApi.form,u=i.formSettings,l=i.formStyle,c=u.rulesBehaviour==="lazy";function f(A,x){if(A===""){x(()=>{r.value=[...n.value]});return}x(()=>{const T=A.toLowerCase();r.value=n.value.filter(z=>z.label.toLowerCase().includes(T))})}function h(){n.value=Object.freeze(t.field.staticSelectOptions??[]),r.value=t.field.staticSelectOptions??[]}function S(){return o.value?o.value.validate():!1}function g(){return o.value?!o.value.hasError:!1}function V(){o.value&&o.value.resetValidation()}function R(){r.value=[]}return e.onMounted(()=>{h(),t.registerBehaviourCallbacks(S,g,V,void 0,R)}),(A,x)=>(e.openBlock(),e.createBlock(e.unref(s.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":x[0]||(x[0]=T=>t.modelValueOnUpdate(T)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:r.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:f},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(s.QItem),{dense:e.unref(l).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),le="__init",ie=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,i=r.formStyle,u=o.rulesBehaviour==="lazy",l=e.ref([]),c=e.ref(S()),f=e.ref(),h=e.ref(le);function S(){return{limit:30,nextPage:1,lastPage:2,isLoading:!1}}function g(y,d){if(y===h.value){d(()=>{});return}const p=t.formApi.getAssociationDataCallback();c.value=S(),h.value=y;const F=t.formApi.form;c.value.isLoading=!0,p({resourceName:F.resourceName,resourceId:F.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:y,context:F.context}).then(_=>{d(()=>{l.value=_.rows,c.value.nextPage=2,c.value.lastPage=Math.ceil(_.row_count/c.value.limit),c.value.isLoading=!1})}).catch(()=>{l.value=[],c.value=S()})}function V(){var d,p;const y=t.getValueSerialized();!y||!t.field.associationData||(l.value=[{label:((d=t.field.associationData[0])==null?void 0:d.label)??"???",value:y,data:(p=t.field.associationData[0])==null?void 0:p.data}])}function R(){return f.value?f.value.validate():!1}function A(){return f.value?!f.value.hasError:!1}function x(){f.value&&f.value.resetValidation()}function T(){c.value=S(),l.value=[],h.value=le}function z(y){const d=l.value.length-1;if(c.value.isLoading!==!0&&c.value.nextPage<=c.value.lastPage&&y.to===d&&d!==-1){const p=t.formApi.form,F=t.formApi.getAssociationDataCallback();c.value.isLoading=!0,F({resourceName:p.resourceName,resourceId:p.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:h.value,context:p.context}).then(_=>{l.value=l.value.concat(_.rows),c.value.lastPage=Math.ceil(_.row_count/c.value.limit),_.row_count>=c.value.limit&&c.value.nextPage++,c.value.isLoading=!1,y.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(R,A,x,V,T),e.nextTick(()=>{V()})}),(y,d)=>(e.openBlock(),e.createBlock(e.unref(s.QSelect),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":d[0]||(d[0]=p=>t.modelValueOnUpdate(p)),label:t.field.label,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":u,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:g,onVirtualScroll:z},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(s.QItem),{dense:e.unref(i).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(p=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:p.opt,itemProps:p.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),se="__init",ce=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,i=r.formStyle,u=o.rulesBehaviour==="lazy",l=e.ref([]),c=e.ref(S()),f=e.ref(),h=e.ref(se);function S(){return{limit:30,nextPage:1,lastPage:100,isLoading:!1}}function g(y,d){if(y===h.value){d(()=>{});return}const p=t.formApi.getAssociationDataCallback();c.value=S(),h.value=y;const F=t.formApi.form;c.value.isLoading=!0,p({resourceName:F.resourceName,resourceId:F.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:y,context:F.context}).then(_=>{d(()=>{l.value=_.rows,c.value.nextPage=2,c.value.lastPage=Math.ceil(_.row_count/c.value.limit),c.value.isLoading=!1})}).catch(()=>{l.value=[],c.value=S()})}function V(){const y=t.getValueSerialized();!y||!t.field.associationData||(l.value=y.map((d,p)=>({label:t.field.associationData[p].label??"???",value:d,data:t.field.associationData[p].data})))}function R(){return f.value?f.value.validate():!1}function A(){return f.value?!f.value.hasError:!1}function x(){f.value&&f.value.resetValidation()}function T(){c.value=S(),l.value=[],h.value=se}function z(y){const d=l.value.length-1;if(c.value.isLoading!==!0&&c.value.nextPage<=c.value.lastPage&&y.to===d&&d!==-1){const p=t.formApi.form,F=t.formApi.getAssociationDataCallback();c.value.isLoading=!0,F({resourceName:p.resourceName,resourceId:p.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:h.value,context:p.context}).then(_=>{l.value=l.value.concat(_.rows),c.value.lastPage=Math.ceil(_.row_count/c.value.limit),_.row_count>=c.value.limit&&c.value.nextPage++,c.value.isLoading=!1,y.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(R,A,x,V,T),e.nextTick(()=>{V()})}),(y,d)=>(e.openBlock(),e.createBlock(e.unref(s.QSelect),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":d[0]||(d[0]=p=>t.modelValueOnUpdate(p)),label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":u,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.clear,onFilter:g,onVirtualScroll:z},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(s.QItem),{dense:e.unref(i).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(p=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:p.opt,itemProps:p.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),ae=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,i=r.rulesBehaviour==="lazy",u=e.ref();function l(){return u.value?u.value.validate():!1}function c(){return u.value?!u.value.hasError:!1}function f(){u.value&&u.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,f)}),(h,S)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=g=>t.modelValueOnUpdate(g)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ie=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,i=r.rulesBehaviour==="lazy",u=e.ref();function l(){return u.value?u.value.validate():!1}function c(){return u.value?!u.value.hasError:!1}function f(){u.value&&u.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,f)}),(h,S)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=g=>t.modelValueOnUpdate(g)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}}),$e=e.defineComponent({__name:"ColorField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,i=r.rulesBehaviour==="lazy",u=e.ref();function l(){return u.value?u.value.validate():!1}function c(){return u.value?!u.value.hasError:!1}function f(){u.value&&u.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,f)}),(h,S)=>(e.openBlock(),e.createBlock(e.unref(s.QInput),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":S[1]||(S[1]=g=>t.modelValueOnUpdate(g)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(s.QIcon),{name:"colorize",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QPopupProxy),{cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QColor),{"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=g=>t.modelValueOnUpdate(g))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ue=e.defineComponent({__name:"WysiwygField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=s.useQuasar(),o=t.formApi.form.formStyle,i=[[{label:n.lang.editor.align,icon:n.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:n.lang.editor.formatting,icon:n.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:n.lang.editor.fontSize,icon:n.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:n.lang.editor.defaultFont,icon:n.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],u={arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"},l=e.ref();function c(){return!!l.value}function f(){return!!l.value}function h(){}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,f,h)}),(S,g)=>t.modelValue?(e.openBlock(),e.createBlock(e.unref(s.QEditor),{key:0,ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":g[0]||(g[0]=V=>t.modelValueOnUpdate(V)),toolbar:i,fonts:u,placeholder:t.field.label,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly},null,8,["model-value","placeholder","square","dense","class","readonly"])):e.createCommentVNode("",!0)}}),Qe=e.defineComponent({__name:"JsonField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.form,r=n.formSettings;return n.formStyle,r.rulesBehaviour,(o,i)=>" TODO json edit ? "}});function E(a){a==null||a.forEach(t=>{t()})}function H(a){const t=["B","KB","MB","GB","TB","PB"];let n=0;for(;parseInt(a.toString(),10)>=1024&&n<t.length-1;)a/=1024,++n;return`${a.toFixed(1)}${t[n]}`}const Le={class:"flex column"},Pe={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},Me={class:"col"},He={class:"q-uploader__title"},qe={key:0,class:"caption"},Ge={key:0,class:"flex column"},je={key:2,class:"flex column"},Ye={key:0,class:"q-field--error q-field__bottom text-negative"},We=e.defineComponent({__name:"AttachmentHasOneField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,r=t.formApi.form.formStyle,o=e.ref(null);function i(){let d=t.modelValue;d.add=[],d.delete=[],t.modelValueOnUpdate(d),x()}function u(){var p;let d=t.modelValue;d.add=[],d.delete=((p=t.field.attachmentData)==null?void 0:p.map(F=>F.attachment_id))??[],t.modelValueOnUpdate(d),x()}function l(){return x(),c()}function c(){return o.value===null}function f(){o.value=null}async function h(d){return new Promise(p=>{const F=new Blob([d]),_=new FileReader;_.onload=O=>{var M;const q=((M=O.target)==null?void 0:M.result)??"",[P,Q]=q.split(",");p(Q)},_.readAsDataURL(F)})}async function S(d){return{key:`${d.lastModified}${d.name}`,size:d.size,filename:d.name,contentType:d.type,base64:await h(await d.arrayBuffer())}}async function g(d){if(!d[0])return;const p=await S(d[0]);let F=t.modelValue;F.add=[p],t.modelValueOnUpdate(F),x()}function V(d){if(!d[0])return;let p=t.modelValue;p.add=[],p.delete=[],t.modelValueOnUpdate(p),x()}function R(d){let p=t.modelValue;p.delete=[d.attachment_id],t.modelValueOnUpdate(p),x()}function A(){let d=t.modelValue;d.delete=[],t.modelValueOnUpdate(d),x()}function x(){o.value=null;for(const d of t.rules){const p=d(t.modelValue);if(typeof p=="string"){o.value=p;break}}}const T=e.computed(()=>(t.field.attachmentData??[]).length===0),z=e.computed(()=>t.modelValue?t.modelValue.delete:[]),y=e.computed(()=>{var d,p;return t.modelValue?(((d=t.field.attachmentData)==null?void 0:d.length)??0)===0||(((p=t.field.attachmentData)==null?void 0:p.length)??!0)&&t.modelValue.delete.length===1:!0});return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,f,i,u)}),(d,p)=>(e.openBlock(),e.createElementBlock("div",Le,[e.createVNode(e.unref(s.QUploader),{"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(r).fieldBorderless!==!0,square:e.unref(r).fieldSquare,color:e.unref(r).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:g,onRemoved:V,style:{width:"inherit"}},{header:e.withCtx(F=>[e.createElementVNode("div",Pe,[e.createElementVNode("div",Me,[e.createElementVNode("div",He,e.toDisplayString(t.field.label),1),t.field.hint?(e.openBlock(),e.createElementBlock("div",qe,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0)]),F.canAddFiles&&y.value?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,type:"a",icon:"add_box",onClick:F.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QUploaderAddTrigger))]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(F=>[T.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ge,[p[0]||(p[0]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier déjà en ligne",-1)),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],_=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:_.attachment_id},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.filename),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(H)(_.size)),1)]),_:2},1024)]),_:2},1024),t.modelValue?(e.openBlock(),e.createBlock(e.unref(s.QItemSection),{key:0,top:"",side:""},{default:e.withCtx(()=>[z.value.includes(_.attachment_id)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:O=>R(_)},null,8,["disable","onClick"])),z.value.includes(_.attachment_id)&&t.modelValue.add.length===0?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:1,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"refresh",onClick:A},null,8,["disable"])):e.createCommentVNode("",!0)]),_:2},1024)):e.createCommentVNode("",!0)]),_:2},1024))),128))]),_:1})])),!T.value&&F.files.length>0?(e.openBlock(),e.createBlock(e.unref(s.QSeparator),{key:1})):e.createCommentVNode("",!0),F.files.length>0?(e.openBlock(),e.createElementBlock("div",je,[p[1]||(p[1]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier de remplacement",-1)),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(F.files,_=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:_.__key},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.name),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(e.unref(s.QItemSection),{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QBtn),{class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:O=>F.removeFile(_)},null,8,["disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):e.createCommentVNode("",!0)]),_:1},8,["label","bordered","square","color","class","readonly"]),o.value!==null?(e.openBlock(),e.createElementBlock("div",Ye,e.toDisplayString(o.value),1)):e.createCommentVNode("",!0)]))}}),Je={class:"flex column"},Ke={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},Xe={class:"col"},Ze={class:"q-uploader__title"},ve={key:0,class:"caption"},et={key:0,class:"flex column"},tt={class:"text-weight-medium text-body2"},nt={key:2,class:"flex column"},ot={class:"text-weight-medium text-body2"},at={key:0,class:"q-field--error q-field__bottom text-negative"},rt=e.defineComponent({__name:"AttachmentHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,r=t.formApi.form.formStyle,o=e.ref(null);function i(){let y=t.modelValue;y.add=[],y.delete=[],t.modelValueOnUpdate(y),x()}function u(){var d;let y=t.modelValue;y.add=[],y.delete=((d=t.field.attachmentData)==null?void 0:d.map(p=>p.attachment_id))??[],t.modelValueOnUpdate(y),x()}function l(){return x(),c()}function c(){return o.value===null}function f(){o.value=null}async function h(y){return new Promise(d=>{const p=new Blob([y]),F=new FileReader;F.onload=_=>{var Q;const O=((Q=_.target)==null?void 0:Q.result)??"",[q,P]=O.split(",");d(P)},F.readAsDataURL(p)})}async function S(y){return{key:`${y.lastModified}${y.name}`,size:y.size,filename:y.name,contentType:y.type,base64:await h(await y.arrayBuffer())}}async function g(y){for(const d of y){const p=await S(d);let F=t.modelValue;F.add.push(p),t.modelValueOnUpdate(F)}x()}async function V(y){for(const d of y){const p=await S(d);let F=t.modelValue;F.add=F.add.filter(_=>_.key!==p.key),t.modelValueOnUpdate(F)}x()}function R(y){let d=t.modelValue;d.delete.push(y.attachment_id),t.modelValueOnUpdate(d),x()}function A(y){let d=t.modelValue;d.delete=d.delete.filter(p=>p!==y.attachment_id),t.modelValueOnUpdate(d),x()}function x(){o.value=null;for(const y of t.rules){const d=y(t.modelValue);if(typeof d=="string"){o.value=d;break}}}const T=e.computed(()=>(t.field.attachmentData??[]).length===0),z=e.computed(()=>t.modelValue?t.modelValue.delete:[]);return e.onMounted(()=>{t.registerBehaviourCallbacks(l,c,f,i,u)}),(y,d)=>(e.openBlock(),e.createElementBlock("div",Je,[e.createVNode(e.unref(s.QUploader),{"hide-upload-btn":"",multiple:!0,label:t.field.label,bordered:e.unref(r).fieldBorderless!==!0,square:e.unref(r).fieldSquare,color:e.unref(r).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:g,onRemoved:V,style:{width:"inherit"}},{header:e.withCtx(p=>[e.createElementVNode("div",Ke,[e.createElementVNode("div",Xe,[e.createElementVNode("div",Ze,e.toDisplayString(t.field.label),1),t.field.hint?(e.openBlock(),e.createElementBlock("div",ve,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0)]),p.canAddFiles?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,type:"a",icon:"add_box",onClick:p.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QUploaderAddTrigger))]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(p=>{var F;return[T.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",et,[e.createElementVNode("div",tt,"Fichier"+e.toDisplayString((((F=t.field.attachmentData)==null?void 0:F.length)??0)>0?"s":"")+" déjà en ligne",1),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],_=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:_.attachment_id},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.filename),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(H)(_.size)),1)]),_:2},1024)]),_:2},1024),t.modelValue?(e.openBlock(),e.createBlock(e.unref(s.QItemSection),{key:0,top:"",side:""},{default:e.withCtx(()=>[z.value.includes(_.attachment_id)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:0,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:O=>R(_)},null,8,["disable","onClick"])),z.value.includes(_.attachment_id)&&t.modelValue.add.length===0?(e.openBlock(),e.createBlock(e.unref(s.QBtn),{key:1,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"refresh",onClick:O=>A(_)},null,8,["disable","onClick"])):e.createCommentVNode("",!0)]),_:2},1024)):e.createCommentVNode("",!0)]),_:2},1024))),128))]),_:1})])),!T.value&&p.files.length>0?(e.openBlock(),e.createBlock(e.unref(s.QSeparator),{key:1})):e.createCommentVNode("",!0),p.files.length>0?(e.openBlock(),e.createElementBlock("div",nt,[e.createElementVNode("div",ot,"Fichier"+e.toDisplayString(p.files.length>0?"s":"")+" à ajouter",1),e.createVNode(e.unref(s.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.files,_=>(e.openBlock(),e.createBlock(e.unref(s.QItem),{key:_.__key},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(s.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.name),1)]),_:2},1024),e.createVNode(e.unref(s.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(e.unref(s.QItemSection),{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(e.unref(s.QBtn),{class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:O=>p.removeFile(_)},null,8,["disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):e.createCommentVNode("",!0)]}),_:1},8,["label","bordered","square","color","class","readonly"]),o.value!==null?(e.openBlock(),e.createElementBlock("div",at,e.toDisplayString(o.value),1)):e.createCommentVNode("",!0)]))}});class Y{constructor(t,n,r,o,i,u,l,c,f){w(this,"resourceName");w(this,"resourceId");w(this,"formMetadataAndData");w(this,"context");w(this,"formSettings");w(this,"formStyle");w(this,"actionComponent");w(this,"orphanErrorsComponent");w(this,"sectionComponent");w(this,"wrapperResetComponent");w(this,"associationDisplayComponent");w(this,"dynamicComponentRecord");w(this,"formApi");w(this,"registerEventCallback");this.dynamicComponentRecord=r.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=l,this.resourceName=t,this.formApi=c,this.formSettings={...i,...U.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...u,...U.getGlobalFormStyle()},this.actionComponent=r.actionComponent??U.getGlobalActionComponent(),this.orphanErrorsComponent=r.orphanErrorsComponent??U.getGlobalOrphanErrorComponent(),this.sectionComponent=r.sectionComponent??U.getGlobalSectionComponent(),this.wrapperResetComponent=r.wrapperResetComponent??U.getGlobalWrapperResetComponent(),this.associationDisplayComponent=r.associationDisplayComponent??U.getGlobalAssociationDisplayComponent(),this.registerEventCallback=f??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...U.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:U.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(U.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(U.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(U.getGlobalWrapperResetComponent()),dynamicComponentRecord:{}}}static getForm(t,n,r,o,i,u,l,c,f){return new Y(t,n,r,o,i,u,l,c,f).generateFormDef()}generateFormDef(){const t=X.create(this.formApi);this.registerEventCallback(t);const n=new Set,r=X.getEventsObjectFromInstance(t),o=[];this.formMetadataAndData.form.sections.forEach((u,l)=>{const c=[];u.fields.forEach(V=>{const R=this.dynamicComponentRecord[`field-${V.field_name}-before`],A=Y.getFieldComponentByFormFieldType(V),x=this.dynamicComponentRecord[`field-${V.field_name}-after`],T={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:Y.getRegularFieldTypeByFieldType(V.field_type)};let z=V.label;this.formSettings.requiredFieldsHasAsterisk&&V.rules.find(d=>d.type==="required")&&(z=z.concat("*"));const y={type:V.field_type,extraType:V.field_extra_type,metadata:Object.freeze(V),label:z,hint:V.hint??void 0,prefix:V.prefix??void 0,suffix:V.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??u.readonly??V.readonly??void 0,cssClass:V.css_class??void 0,staticSelectOptions:V.static_select_options,associationData:V.field_association_data,attachmentData:V.field_attachment_data,rules:V.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:R?e.markRaw(R):void 0,mainComponent:e.markRaw(A),afterComponent:x?e.markRaw(x):void 0,events:r.fields[V.field_name]??{},componentOptions:T};c.push(y),n.add(V.field_name)});const f=this.dynamicComponentRecord[`section-${u.name??l}-before`],h=this.sectionComponent,S=this.dynamicComponentRecord[`section-${u.name??l}-after`],g={label:u.label??void 0,icon:u.icon??void 0,cssClass:u.css_class??void 0,hidden:!1,name:u.name??l.toString(),readonly:this.formMetadataAndData.form.readonly??u.readonly??void 0,events:r.sections[u.name??l.toString()]??{},beforeComponent:f?e.markRaw(f):void 0,mainComponent:e.markRaw(h),fieldsComponent:void 0,afterComponent:S?e.markRaw(S):void 0,fields:c};o.push(g)});const i={sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,events:r.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context};return n.size<this.formMetadataAndData.form.sections.reduce((u,l)=>u+l.fields.length,0)&&console.warn("Submit64 -> Found fields with the same name"),i}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){switch(t.field_type){case"string":switch(t.field_extra_type){case"color":return $e;case"wysiwyg":return Ue;default:return ae}case"text":return ae;case"number":return Ie;case"date":return Ne;case"datetime":return Ae;case"select":return Oe;case"selectBelongsTo":return ie;case"selectHasMany":return ce;case"selectHasAndBelongsToMany":return ce;case"selectHasOne":return ie;case"checkbox":return ze;case"object":return Qe;case"attachmentHasOne":return We;case"attachmentHasMany":return rt;default:return ae}}}const lt={class:"flex column"},it=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=null,o=null,i=null;const u=e.useSlots(),l={softReset:h,reset:S,clear:g,validate:A,isValid:x,isInvalid:T,hide:V,unhide:R,resetValidation:z,getFields:y,setReadonlyState:d,setCssClass:p,setIcon:F,setLabel:_,section:n.section},c=e.ref(new Map);function f(){n.section.fields.forEach(C=>{const B=C.metadata.field_name,$=n.formApi.getFieldByName(B);$&&c.value.set(B,$)})}function h(){c.value.forEach(C=>{C.softReset()})}function S(){c.value.forEach(C=>{C.reset()}),E(n.section.events.onReset)}function g(){c.value.forEach(C=>{C.clear()}),E(n.section.events.onClear)}function V(){const C=n.privateFormApi.getSectionRef(n.section.name);C&&(c.value.forEach(B=>{B.hide()}),C.hidden=!0,E(n.section.events.onHide))}function R(){const C=n.privateFormApi.getSectionRef(n.section.name);C&&(c.value.forEach(B=>{B.unhide()}),C.hidden=!1,E(n.section.events.onUnhide))}function A(){let C=!0;return c.value.forEach(B=>{if(!B.validate()){C=!1;return}}),E(n.section.events.onValidated),C}function x(){let C=!0;return c.value.forEach(B=>{if(!B.isValid()){C=!1;return}}),C}function T(){return!x()}function z(){c.value.forEach(C=>{C.resetValidation()})}function y(){return c.value}function d(C){const B=n.privateFormApi.getSectionRef(n.section.name);B&&(B.readonly=C)}function p(C){const B=n.privateFormApi.getSectionRef(n.section.name);B&&(B.cssClass=C)}function F(C){const B=n.privateFormApi.getSectionRef(n.section.name);B&&(B.icon=C)}function _(C){const B=n.privateFormApi.getSectionRef(n.section.name);B&&(B.label=C)}function O(){const C={};for(const[B,$]of c.value)C[B]=$.getValueSerialized();return C}function q(){const C=u.default;if(!C){console.error("Submit64 : did not found fields slot for section "+n.section.name);return}const B=e.defineComponent({inheritAttrs:!1,setup($,{attrs:J,slots:Z}){return()=>C({...$,...J},Z)}});n.privateFormApi.setSectionFieldComponent(n.section,e.markRaw(B))}t(l);const P=e.computed(()=>x()),Q=e.computed(()=>T()),M=e.computed(()=>O());return e.watch(()=>{var C;return(C=n.section)==null?void 0:C.events.onIsValid},C=>{r==null||r(),r=null,C&&(r=e.watch(P,B=>{B&&E(n.section.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var C;return(C=n.section)==null?void 0:C.events.onIsInvalid},C=>{o==null||o(),o=null,C&&(o=e.watch(Q,B=>{var $;B&&E(($=n.section)==null?void 0:$.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var C;return(C=n.section)==null?void 0:C.events.onUpdate},C=>{i==null||i(),i=null,C&&(i=e.watch(M,()=>{var B;E((B=n.section)==null?void 0:B.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(()=>{var B;q();const C=(B=e.getCurrentInstance())==null?void 0:B.exposed;C&&n.privateFormApi.registerSectionWrapperRef(n.section.name,C),e.nextTick(()=>{var $;f(),E(($=n.section)==null?void 0:$.events.onReady)})}),(C,B)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",lt,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:l,formApi:n.formApi},null,8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}});function st(a,t){const n=a.rules??[],r=a.type,o=t.form,i=(f,h,S)=>f[h]?S?()=>u(f[h]):()=>f[h]:f.compare_to?()=>{var g;return((g=t.getFieldByName(f.compare_to))==null?void 0:g.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",u=f=>String(s.date.formatDate(s.date.extractDate(f,o.formSettings.backendDateFormat),o.formSettings.dateFormat)),l=[],c=[];switch(r){case"date":l.push(re(o.formSettings.dateFormat));break;case"datetime":l.push(re(o.formSettings.datetimeFormat));break}return n.forEach(f=>{const h=f;switch(h.type){case"required":l.push(ct());break;case"absence":l.push(ft());break;case"acceptance":l.push(ut());break;case"inclusion":l.push(de(h.including));break;case"exclusion":l.push(dt(h.excluding));break;case"backend":break;case"allowNull":c.push("allowNull");break;case"allowBlank":c.push("allowBlank");break;case"positiveNumber":l.push(ht());break;case"lessThanOrEqualNumber":l.push(gt(i(h,"less_than")));break;case"lessThanNumber":l.push(yt(i(h,"less_than")));break;case"greaterThanOrEqualNumber":l.push(Ct(i(h,"greater_than")));break;case"greaterThanNumber":l.push(bt(i(h,"greater_than")));break;case"equalToNumber":l.push(kt(i(h,"equal_to")));break;case"otherThanNumber":l.push(_t(i(h,"other_than")));break;case"numberIntegerOnly":l.push(Vt());break;case"numberNumericOnly":l.push(St());break;case"numberEvenOnly":l.push(Ft());break;case"numberOddOnly":l.push(xt());break;case"lessThanOrEqualStringLength":l.push(Bt(i(h,"less_than")));break;case"lessThanStringLength":l.push(Nt(i(h,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(Dt(i(h,"greater_than")));break;case"greaterThanStringLength":l.push(wt(i(h,"greater_than")));break;case"equalToStringLength":l.push(Rt(i(h,"equal_to")));break;case"equalToString":l.push(Et(i(h,"equal_to")));break;case"betweenStringLength":l.push(At(()=>h.min,()=>h.max));break;case"otherThanString":l.push(Tt(i(h,"other_than")));break;case"validDate":l.push(re(o.formSettings.dateFormat));break;case"lessThanOrEqualDate":l.push(zt(i(h,"less_than",!0),o.formSettings.dateFormat));break;case"lessThanDate":l.push(Ot(i(h,"less_than",!0),o.formSettings.dateFormat));break;case"greaterThanOrEqualDate":l.push(It(i(h,"greater_than",!0),o.formSettings.dateFormat));break;case"greaterThanDate":l.push($t(i(h,"greater_than",!0),o.formSettings.dateFormat));break;case"equalToDate":l.push(Ut(i(h,"equal_to",!0),o.formSettings.dateFormat));break;case"otherThanDate":l.push(Qt(i(h,"other_than",!0),o.formSettings.dateFormat));break;case"requiredUploadFile":l.push(Pt());break;case"allowFileContentType":l.push(Mt(i(h,"including")));break;case"equalToFileLength":l.push(Ht(i(h,"equal_to")));break;case"lessThanOrEqualFileLength":l.push(Gt(i(h,"less_than")));break;case"greaterThanOrEqualFileLength":l.push(qt(i(h,"greater_than")));break;case"lessThanOrEqualFileCount":l.push(jt(i(h,"less_than")));break;case"greaterThanOrEqualFileCount":l.push(Yt(i(h,"greater_than")));break;case"lessThanOrEqualTotalFileSize":l.push(Wt(i(h,"less_than")));case"greaterThanOrEqualTotalFileSize":l.push(Jt(i(h,"greater_than")));break;case"equalToTotalFileSize":l.push(Kt(i(h,"equal_to")));break}}),c.length>0?c.map(f=>{switch(f){case"allowBlank":return pt(l);case"allowNull":return mt(l)}}):l}function ct(){return a=>!!a||"Ce champ est requis"}function de(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function dt(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${de.toString()}`)}function ft(){return a=>!a||"Ce champ doit être vide"}function ut(){return a=>!!a||"Doit être accepté"}function mt(a){return t=>(t===null||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function pt(a){return t=>(t===""||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function ht(){return a=>Number(a)>0||"Val. positive uniquement"}function gt(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function yt(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function Ct(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function bt(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function kt(a,t){return n=>{const r=a();return Number(n)===r||`Égale à ${r}`}}function _t(a,t){return n=>{const r=a();return Number(n)!==r||`Doit être différent de ${a}`}}function Vt(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function St(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function Ft(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function xt(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function Bt(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function Nt(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function Dt(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function wt(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function At(a,t){return n=>{const r=a(),o=t();return String(n).length>=r&&String(n).length<=o||`Entre ${r} et ${o}`}}function Et(a,t){return n=>{const r=a();return String(n)===r||`Égale à ${r}`}}function Rt(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function Tt(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function zt(a,t){return n=>{const r=a(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(r,t);return o<=i||`Inf. ou égal à ${r}`}}function Ot(a,t){return n=>{const r=a(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(r,t);return o<i||`Inf. à ${r}`}}function It(a,t){return n=>{const r=a(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(r,t);return o>=i||`Sup. ou égal à ${r}`}}function $t(a,t){return n=>{const r=a(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(r,t);return o>i||`Sup. à ${r}`}}function Ut(a,t){return n=>{const r=a(),o=s.date.extractDate(String(n),t),i=s.date.extractDate(r,t);return o===i||`Égale à ${o}`}}function Qt(a,t){return n=>{const r=a();return s.date.extractDate(String(n),t)!==s.date.extractDate(r,t)||`Doit être différent de ${r}`}}function re(a){return t=>t==null||t===""?!0:Lt(t,a)||`Date invalide. Format : ${a}`}function Lt(a,t){if(typeof a!="string"||!a.trim())return!1;const n=s.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:s.date.formatDate(n,t)===a}function Pt(){return a=>a.add.length>0||"Ce champ est requis"}function Mt(a){return t=>{const n=t,r=a();let o=!0;n.add.forEach(u=>{o&&(r.includes(u.contentType)||(o=!1))});const i=a.length>1;return o||`Type${i?"s":""} autorisé${i?"s":""} : ${r.join(",")}`}}function Ht(a){return t=>{const n=t,r=a();let o=!0;return n.add.forEach(i=>{o&&r!==i.size&&(o=!1)}),o||`Taille par fichier ${H(r)}`}}function qt(a){return t=>{const n=t,r=a();let o=!0;return n.add.forEach(i=>{o&&i.size<r&&(o=!1)}),o||`Taille par fichier min. ${H(r)}`}}function Gt(a){return t=>{const n=t,r=a();let o=!0;return n.add.forEach(i=>{o&&i.size>r&&(o=!1)}),o||`Taille par fichier max. ${H(r)}`}}function jt(a){return t=>{const n=t,r=a();return n.add.length<=r||`${r} fichier${r>1?"s":""} max.`}}function Yt(a){return t=>{const n=t,r=a();return n.add.length>=r||`${r} fichier${r>1?"s":""} min.`}}function Wt(a){return t=>{const n=t,r=a();return n.add.reduce((i,u)=>(i+=u.size,i),0)<=r||`${H(r)} max.`}}function Jt(a){return t=>{const n=t,r=a();return n.add.reduce((i,u)=>(i+=u.size,i),0)>=r||`${H(r)} min.`}}function Kt(a){return t=>{const n=t,r=a();return n.add.reduce((i,u)=>(i+=u.size,i),0)===r||`Taille totale ${H(r)}`}}const Xt={computeServerRules:st},Zt={key:2,class:"q-field__bottom text-negative q-pt-none"},vt=["index"],en=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=()=>!0,o=()=>!0,i=()=>{},u=()=>{},l=()=>{};const c=x(),f=e.ref(),h=e.ref([]);function S(){f.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),f.value=V(f.value)}function g(){f.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),f.value=V(f.value),E(n.field.events.onReset),u(),e.nextTick(()=>{J()})}function V(b){const N=n.formApi.form;switch(n.field.type){case"checkbox":return b==null||b===""?!1:b;case"date":return b==null||b===""?null:s.date.formatDate(s.date.extractDate(String(b),N.formSettings.backendDateFormat),N.formSettings.dateFormat);case"datetime":return b==null||b===""?null:s.date.formatDate(s.date.extractDate(String(b),N.formSettings.backendDatetimeFormat),N.formSettings.datetimeFormat);case"attachmentHasOne":case"attachmentHasMany":return{add:[],delete:[]}}return b}function R(b){const N=n.formApi.form;switch(n.field.type){case"date":return b==null||b===""?null:s.date.formatDate(s.date.extractDate(String(b),N.formSettings.dateFormat),N.formSettings.backendDateFormat);case"datetime":return b==null||b===""?null:s.date.formatDate(s.date.extractDate(String(b),N.formSettings.datetimeFormat),N.formSettings.backendDatetimeFormat);case"selectBelongsTo":case"selectHasOne":if(b===void 0)return null;case"selectHasMany":case"selectHasAndBelongsToMany":if(b===void 0)return[]}return b}function A(){switch(n.field.type){case"string":f.value="";break;case"checkbox":f.value=!1;break;case"date":f.value=null;break;case"datetime":f.value=null;break;case"number":f.value=null;break;case"select":f.value=void 0;break;case"text":f.value="";break;case"object":f.value={};break;case"selectBelongsTo":case"selectHasMany":case"selectHasAndBelongsToMany":case"selectHasOne":f.value=void 0;break;case"attachmentHasOne":case"attachmentHasMany":f.value={add:[],delete:[]};break}l(),E(n.field.events.onClear)}function x(){return Xt.computeServerRules(n.field,n.formApi)}function T(b){f.value=b}function z(){return e.unref(f)}function y(){return R(e.unref(f))}function d(b){h.value=b}function p(){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.hidden=!0,E(n.field.events.onHide))}function F(){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.hidden=!1,E(n.field.events.onUnhide))}function _(b){const N=n.privateFormApi.getFieldRef(n.field.metadata.field_name);N&&(N.readonly=b)}function O(b){const N=n.privateFormApi.getFieldRef(n.field.metadata.field_name);N&&(N.hint=b)}function q(b){const N=n.privateFormApi.getFieldRef(n.field.metadata.field_name);N&&(N.cssClass=b)}function P(b){const N=n.privateFormApi.getFieldRef(n.field.metadata.field_name);N&&(N.suffix=b)}function Q(b){const N=n.privateFormApi.getFieldRef(n.field.metadata.field_name);N&&(N.prefix=b)}function M(b){const N=n.privateFormApi.getFieldRef(n.field.metadata.field_name);N&&(N.label=b)}function C(){const b=r();return E(n.field.events.onValidated),b}function B(){return o()}function $(){return!B()}function J(){return i()}function Z(b,N,G,K,te){r=b,o=N,i=G,K&&(u=K),te&&(l=te)}const v={softReset:S,reset:g,clear:A,validate:C,isValid:B,isInvalid:$,hide:p,unhide:F,resetValidation:J,getValueDeserialized:y,getValueSerialized:z,setupBackendErrors:d,setReadonlyState:_,setHint:O,setCssClass:q,setSuffix:P,setPrefix:Q,setLabel:M,setValue:T,field:n.field};return t(v),e.watch(()=>n.field.events.onUpdate?f.value:null,()=>{E(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid||n.field.events.onIsInvalid?f.value:null,b=>{E(b?n.field.events.onIsValid:n.field.events.onIsInvalid)}),e.onMounted(()=>{var N,G;S();const b=(N=e.getCurrentInstance())==null?void 0:N.exposed;b&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,b),E((G=n.field)==null?void 0:G.events.onReady)}),(b,N)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:v},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:f.value,field:n.field,formApi:n.formApi,rules:e.unref(c),reset:g,clear:A,getValueDeserialized:y,getValueSerialized:z,validate:C,modelValueOnUpdate:T,registerBehaviourCallbacks:Z},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:v},null,8,["formApi"])):e.createCommentVNode("",!0),h.value.length>0?(e.openBlock(),e.createElementBlock("div",Zt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,(G,K)=>(e.openBlock(),e.createElementBlock("div",{index:K,class:"flex column"},e.toDisplayString(G),9,vt))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),tn={class:"flex column"},nn=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let r=null,o="",i=0,u=0,l=null,c=null,f=null,h=null;const S=e.useSlots(),g=e.ref(Y.getEmptyFormBeforeInit()),V=e.ref(!1),R=e.ref(!1),A=e.ref(!1),x=e.ref(!1),T=e.ref("create"),z=e.ref({}),y=e.ref(new Map),d=e.ref(new Map);async function p(){r=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),g.value=Y.getForm(n.resourceName,n.resourceId,_(),r,n.formSettings,n.formStyle,n.context,W,n.eventManager),i=g.value.sections.length,u=g.value.sections.map(m=>m.fields).flat().length,n.resourceId&&(T.value="edit")}async function F(){var D,L,ne;if(!P())return;E((D=g.value)==null?void 0:D.events.onSubmit),x.value=!0,Z();const m=O(),k=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:m,context:n.context});if(h=k.resource_data,k.success)z.value={},T.value==="create"&&(T.value="edit"),r&&k.resource_data&&(r.resource_data=k.resource_data),g.value=Y.getForm(n.resourceName,n.resourceId,_(),{form:k.form,resource_data:k.resource_data},n.formSettings,n.formStyle,n.context,W,n.eventManager),C(),o=JSON.stringify(O()),E((ne=g.value)==null?void 0:ne.events.onSubmitSuccess);else{z.value={};const oe=[];for(const[j,Fn]of d.value){const ue=k.errors[j];ue&&(Fn.setupBackendErrors(ue),oe.push(j))}Object.entries(k.errors).forEach(j=>{oe.includes(j[0])||(z.value[j[0]]=j[1])}),E((L=g.value)==null?void 0:L.events.onSubmitUnsuccess)}x.value=!1}function _(){const m={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const k in S){const D=S[k];if(D){const L=e.defineComponent({inheritAttrs:!1,setup(ne,{attrs:oe,slots:j}){return()=>D({...ne,...oe,innerSlots:j})}});switch(k){case"sections":m.sectionComponent=L;break;case"actions":m.actionComponent=L;break;case"orphan-errors":m.orphanErrorsComponent=L;break;case"association-display":m.associationDisplayComponent=L;break;default:m.dynamicComponentRecord[k]=L;break}}}return m}function O(){const m={};for(const[k,D]of d.value)m[k]=D.getValueDeserialized();return m}function q(){const m={};for(const[k,D]of d.value)m[k]=D.getValueSerialized();return m}function P(){var k;let m=!0;return d.value.forEach(D=>{if(!D.validate()){m=!1;return}}),E((k=g.value)==null?void 0:k.events.onValidated),m}function Q(){let m=!0;return d.value.forEach(k=>{if(!k.isValid()){m=!1;return}}),m}function M(){return!Q()}function C(){y.value.forEach(m=>{m.softReset()})}function B(){var m;d.value.forEach(k=>{k.reset()}),E((m=g.value)==null?void 0:m.events.onReset)}function $(){var m;d.value.forEach(k=>{k.clear()}),E((m=g.value)==null?void 0:m.events.onClear)}function J(){d.value.forEach(m=>{m.resetValidation()})}function Z(){d.value.forEach(m=>{m.setupBackendErrors([])})}function v(m){if(r)return r.resource_data[m]}function b(m){return y.value.get(m)}function N(m){return[...y.value.values()].at(m)}function G(){return y.value}function K(m){return d.value.get(m)}function te(){return d.value}function on(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function an(){["getMetadataAndData","resourceName"].forEach(k=>{(n[k]===null||n[k]===void 0)&&console.warn(`Missing props for <Submit64> -> ${k}`)})}function rn(){return e.unref(T)}function ln(){return o!==JSON.stringify(O())}function sn(m){g.value&&(g.value.context=m)}function cn(m){g.value&&(g.value.cssClass=m)}function dn(m){g.value&&(g.value.readonly=m)}function fn(){return A.value}function un(){return h}function mn(){return g}function pn(m){var k;return(k=g.value)==null?void 0:k.sections.find(D=>D.name===m)}function hn(m){var k;return(k=g.value)==null?void 0:k.sections.map(D=>D.fields).flat().find(D=>D.metadata.field_name===m)}function gn(m,k){y.value.set(m,k),i===y.value.size&&(V.value=!0)}function yn(m,k){d.value.set(m,k),u===d.value.size&&(R.value=!0)}function Cn(m,k){m.fieldsComponent=k}const fe={getFormRef:mn,getSectionRef:pn,getFieldRef:hn,registerSectionWrapperRef:gn,registerFieldWrapperRef:yn,setSectionFieldComponent:Cn},bn=new Proxy({},{get(m,k){var D;return(D=g.value)==null?void 0:D[k]}}),kn=new Proxy({},{get(m,k){var D;return(D=z.value)==null?void 0:D[k]}}),W={getMode:rn,getSectionByName:b,getSectionByIndex:N,getSections:G,getFieldByName:K,getFields:te,validate:P,isValid:Q,isInvalid:M,softReset:C,reset:B,clear:$,resetValidation:J,submit:F,valuesHasChanged:ln,getInitialValueByFieldName:v,getAssociationDataCallback:on,setContext:sn,setCssClass:cn,setReadonlyState:dn,isReady:fn,getSubmitData:un,form:bn,isLoadingSubmit:x,orphanErrors:kn};t(W);const _n=e.computed(()=>Q()),Vn=e.computed(()=>M()),Sn=e.computed(()=>q());return e.watch(()=>V.value&&R.value,m=>{var k;m&&!A.value&&(E((k=g.value)==null?void 0:k.events.onReady),A.value=!0)}),e.watch(()=>{var m;return(m=g.value)==null?void 0:m.events.onIsValid},m=>{l==null||l(),l=null,m&&(l=e.watch(_n,k=>{var D;k&&E((D=g.value)==null?void 0:D.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var m;return(m=g.value)==null?void 0:m.events.onIsInvalid},m=>{c==null||c(),c=null,m&&(c=e.watch(Vn,k=>{var D;k&&E((D=g.value)==null?void 0:D.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var m;return(m=g.value)==null?void 0:m.events.onUpdate},m=>{f==null||f(),f=null,m&&(f=e.watch(Sn,()=>{var k;E((k=g.value)==null?void 0:k.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(async()=>{an(),await p(),e.nextTick(()=>{o=JSON.stringify(O())})}),(m,k)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",tn,[e.createElementVNode("div",{class:e.normalizeClass(g.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value.sections,D=>(e.openBlock(),e.createBlock(it,{key:D.name,section:D,formApi:W,privateFormApi:fe},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.fields,L=>(e.openBlock(),e.createBlock(en,{key:L.metadata.field_name,field:L,formApi:W,privateFormApi:fe},null,8,["field"]))),128))]),_:2},1032,["section"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(g.value.orphanErrorsComponent),{formApi:W})),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(g.value.actionComponent),{formApi:W}))],512)),[[e.vShow,A.value]])}});I.DynamicLogicBuilder=X,I.Submit64=U,I.Submit64Form=nn,Object.defineProperty(I,Symbol.toStringTag,{value:"Module"})});
