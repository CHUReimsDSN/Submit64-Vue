(function(O,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(O=typeof globalThis<"u"?globalThis:O||self,e(O["submit64-vue"]={},O.Vue,O.Quasar))})(this,function(O,e,m){"use strict";var Wt=Object.defineProperty;var Jt=(O,e,m)=>e in O?Wt(O,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):O[e]=m;var x=(O,e,m)=>Jt(O,typeof e!="symbol"?e+"":e,m);const he={class:"flex column"},ye={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},Ce=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(a){const t=a;function n(){const r=t.formApi.form.formStyle;return{outline:r.fieldOutlined,rounded:r.fieldRounded,square:r.fieldSquare,dense:r.fieldDense,color:r.fieldColor,noCaps:!0}}return(r,o)=>(e.openBlock(),e.createElementBlock("div",he,[e.createElementVNode("div",ye,[e.createVNode(e.unref(m.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.formApi.submit}),null,16,["loading","onClick"]),t.formApi.reset?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.formApi.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.formApi.clear?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Effacer",onClick:t.formApi.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),be={class:"flex row items-center"},Se={class:"text-body1 text-weight-medium"},ke={class:"flex column q-gutter-md"},_e=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",be,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(m.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",Se,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",ke,[e.renderSlot(n.$slots,"default")])]))}}),Ve=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,r)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:r[0]||(r[0]=d=>t.reset())})}}}),Fe=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),xe={class:"flex column"},Be=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",xe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,d)=>(e.openBlock(),e.createElementBlock("div",{key:d,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(d)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),ee=class ee{constructor(){x(this,"_formSettings");x(this,"_formStyle");x(this,"_actionComponent");x(this,"_orphanErrorsComponent");x(this,"_sectionComponent");x(this,"_wrapperResetComponent");x(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0,associationEmptyMessage:"Empty",requiredFieldsHasAsterisk:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:""},this._actionComponent=Ce,this._orphanErrorsComponent=Be,this._sectionComponent=_e,this._wrapperResetComponent=Ve,this._associationDisplayComponent=Fe}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};x(ee,"_instance",new ee);let z=ee;class Y{constructor(t){x(this,"formApi");x(this,"events",[]);this.formApi=t}when(t,n){const r=t,o=n,d=new De(r,o,this.formApi);return this.events.push(d),new Ne(d)}static create(t){return new Y(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(r=>{const o=r.getTarget();switch(o.target){case"field":n.fields[o.targetName]||(n.fields[o.targetName]={}),n.fields[o.targetName][o.key]||(n.fields[o.targetName][o.key]=[]),n.fields[o.targetName][o.key].push(r.getActionCallback());break;case"section":n.sections[o.targetName]||(n.sections[o.targetName]={}),n.sections[o.targetName][o.key]||(n.sections[o.targetName][o.key]=[]),n.sections[o.targetName][o.key].push(r.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(r.getActionCallback());break}}),n}}class De{constructor(t,n,r){x(this,"type");x(this,"data");x(this,"formApi");x(this,"action",()=>{});x(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=r}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is invalid":return{target:"field",targetName:this.data.fieldName,key:"onIsInvalid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onIsValid"};case"Section is invalid":return{target:"section",targetName:this.data.sectionName,key:"onIsInvalid"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Section is updated":return{target:"section",targetName:this.data.sectionName,key:"onUpdate"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is invalid":return{target:"form",key:"onIsInvalid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class Ne{constructor(t){x(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const we={class:"row items-center justify-end"},Re=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,d=r.rulesBehaviour==="lazy",i=e.ref(),c=e.ref();function s(){i.value&&i.value.hide()}function l(){return c.value?c.value.validate():!1}function _(){return c.value?!c.value.hasError:!1}function C(){c.value&&c.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,_,C)}),(D,f)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":f[1]||(f[1]=R=>t.modelValueOnUpdate(R)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":d,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"popupProxyRef",ref:i,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":f[0]||(f[0]=R=>t.modelValueOnUpdate(R)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",we,[e.createVNode(e.unref(m.QBtn),{onClick:s,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ae={class:"row items-center justify-end"},Ee={class:"row items-center justify-end"},Ie=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,d=r.rulesBehaviour==="lazy",i=e.ref(),c=e.ref(),s=e.ref();function l(){i.value&&i.value.hide()}function _(){c.value&&c.value.hide()}function C(){return s.value?s.value.validate():!1}function D(){return s.value?!s.value.hasError:!1}function f(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(C,D,f),d&&e.nextTick(()=>{var R;(R=s.value)==null||R.resetValidation()})}),(R,w)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":w[2]||(w[2]=N=>t.modelValueOnUpdate(N)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":d,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"datePopupProxyRef",ref:i,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":w[0]||(w[0]=N=>t.modelValueOnUpdate(N)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Ae,[e.createVNode(e.unref(m.QBtn),{onClick:l,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"timePopupProxyRef",ref:c,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":w[1]||(w[1]=N=>t.modelValueOnUpdate(N)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Ee,[e.createVNode(e.unref(m.QBtn),{onClick:_,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Te={class:"flex column"},Oe={key:0,class:"q-field__bottom"},ze={key:1,class:"q-field--error q-field__bottom text-negative"},$e=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),o=t.formApi.form.formStyle;function d(){return n.value===!0}function i(){return n.value===!0}function c(){n.value=!0}return e.watch(()=>t.modelValue,s=>{for(const l of t.rules)if(n.value=l(s),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(d,i,c)}),(s,l)=>(e.openBlock(),e.createElementBlock("div",Te,[e.createVNode(e.unref(m.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":l[0]||(l[0]=_=>t.modelValueOnUpdate(_)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",Oe,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",ze,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Pe=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),r=e.ref([]),o=e.ref(),d=t.formApi.form,i=d.formSettings,c=d.formStyle,s=i.rulesBehaviour==="lazy";function l(w,N){if(w===""){N(()=>{r.value=[...n.value]});return}N(()=>{const E=w.toLowerCase();r.value=n.value.filter(A=>A.label.toLowerCase().includes(E))})}function _(){n.value=Object.freeze(t.field.staticSelectOptions??[]),r.value=t.field.staticSelectOptions??[]}function C(){return o.value?o.value.validate():!1}function D(){return o.value?!o.value.hasError:!1}function f(){o.value&&o.value.resetValidation()}function R(){r.value=[]}return e.onMounted(()=>{_(),t.registerBehaviourCallbacks(C,D,f,void 0,R)}),(w,N)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":N[0]||(N[0]=E=>t.modelValueOnUpdate(E)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(c).fieldOutlined,filled:e.unref(c).fieldFilled,standout:e.unref(c).fieldStandout,borderless:e.unref(c).fieldBorderless,rounded:e.unref(c).fieldRounded,square:e.unref(c).fieldSquare,dense:e.unref(c).fieldDense,hideBottomSpace:e.unref(c).fieldHideBottomSpace,color:e.unref(c).fieldColor,bgColor:e.unref(c).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:r.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:l},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(m.QItem),{dense:e.unref(c).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),ie="__init",le=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,d=r.formStyle,i=o.rulesBehaviour==="lazy",c=e.ref([]),s=e.ref(C()),l=e.ref(),_=e.ref(ie);function C(){return{limit:30,nextPage:1,lastPage:2,isLoading:!1}}function D(k,F){if(k===_.value){F(()=>{});return}const y=t.formApi.getAssociationDataCallback();s.value=C(),_.value=k;const T=t.formApi.form;s.value.isLoading=!0,y({resourceName:T.resourceName,resourceId:T.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:k,context:T.context}).then(I=>{F(()=>{c.value=I.rows,s.value.nextPage=2,s.value.lastPage=Math.ceil(I.row_count/s.value.limit),s.value.isLoading=!1})}).catch(()=>{c.value=[],s.value=C()})}function f(){const k=t.getValueSerialized();!k||!t.field.associationData||(c.value=[{label:t.field.associationData.label[0]??"???",value:k,data:t.field.associationData.data[0]}])}function R(){return l.value?l.value.validate():!1}function w(){return l.value?!l.value.hasError:!1}function N(){l.value&&l.value.resetValidation()}function E(){s.value=C(),c.value=[],_.value=ie}function A(k){const F=c.value.length-1;if(s.value.isLoading!==!0&&s.value.nextPage<s.value.lastPage&&k.to===F&&F!==-1){const y=t.formApi.form,T=t.formApi.getAssociationDataCallback();s.value.isLoading=!0,T({resourceName:y.resourceName,resourceId:y.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:_.value,context:y.context}).then(I=>{c.value=c.value.concat(I.rows),s.value.lastPage=Math.ceil(I.row_count/s.value.limit),I.row_count>=s.value.limit&&s.value.nextPage++,s.value.isLoading=!1,k.ref.refresh()})}}return e.onMounted(()=>{e.nextTick(()=>{f()}),t.registerBehaviourCallbacks(R,w,N,f,E)}),(k,F)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=y=>t.modelValueOnUpdate(y)),label:t.field.label,outlined:e.unref(d).fieldOutlined,filled:e.unref(d).fieldFilled,standout:e.unref(d).fieldStandout,borderless:e.unref(d).fieldBorderless,rounded:e.unref(d).fieldRounded,square:e.unref(d).fieldSquare,dense:e.unref(d).fieldDense,hideBottomSpace:e.unref(d).fieldHideBottomSpace,color:e.unref(d).fieldColor,bgColor:e.unref(d).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:c.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:D,onVirtualScroll:A},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(m.QItem),{dense:e.unref(d).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(y=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:y.opt,itemProps:y.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),se="__init",ce=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,d=r.formStyle,i=o.rulesBehaviour==="lazy",c=e.ref([]),s=e.ref(C()),l=e.ref(),_=e.ref(se);function C(){return{limit:30,nextPage:1,lastPage:100,isLoading:!1}}function D(k,F){if(k===_.value){F(()=>{});return}const y=t.formApi.getAssociationDataCallback();s.value=C(),_.value=k;const T=t.formApi.form;s.value.isLoading=!0,y({resourceName:T.resourceName,resourceId:T.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:k,context:T.context}).then(I=>{F(()=>{c.value=I.rows,s.value.nextPage=2,s.value.lastPage=Math.ceil(I.row_count/s.value.limit),s.value.isLoading=!1})}).catch(()=>{c.value=[],s.value=C()})}function f(){const k=t.getValueSerialized();!k||!t.field.associationData||(c.value=k.map((F,y)=>({label:t.field.associationData.label[y]??"???",value:F,data:t.field.associationData.data[y]})))}function R(){return l.value?l.value.validate():!1}function w(){return l.value?!l.value.hasError:!1}function N(){l.value&&l.value.resetValidation()}function E(){s.value=C(),c.value=[],_.value=se}function A(k){const F=c.value.length-1;if(s.value.isLoading!==!0&&s.value.nextPage<s.value.lastPage&&k.to===F&&F!==-1){const y=t.formApi.form,T=t.formApi.getAssociationDataCallback();s.value.isLoading=!0,T({resourceName:y.resourceName,resourceId:y.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:_.value,context:y.context}).then(I=>{c.value=c.value.concat(I.rows),s.value.lastPage=Math.ceil(I.row_count/s.value.limit),I.row_count>=s.value.limit&&s.value.nextPage++,s.value.isLoading=!1,k.ref.refresh()})}}return e.onMounted(()=>{e.nextTick(()=>{f()}),t.registerBehaviourCallbacks(R,w,N,f,E)}),(k,F)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=y=>t.modelValueOnUpdate(y)),label:t.field.label,hint:t.field.hint,outlined:e.unref(d).fieldOutlined,filled:e.unref(d).fieldFilled,standout:e.unref(d).fieldStandout,borderless:e.unref(d).fieldBorderless,rounded:e.unref(d).fieldRounded,square:e.unref(d).fieldSquare,dense:e.unref(d).fieldDense,hideBottomSpace:e.unref(d).fieldHideBottomSpace,color:e.unref(d).fieldColor,bgColor:e.unref(d).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:c.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.clear,onFilter:D,onVirtualScroll:A},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(m.QItem),{dense:e.unref(d).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(y=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:y.opt,itemProps:y.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),re=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,d=r.rulesBehaviour==="lazy",i=e.ref();function c(){return i.value?i.value.validate():!1}function s(){return i.value?!i.value.hasError:!1}function l(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,s,l)}),(_,C)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":C[0]||(C[0]=D=>t.modelValueOnUpdate(D)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":d,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ue=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,d=r.rulesBehaviour==="lazy",i=e.ref();function c(){return i.value?i.value.validate():!1}function s(){return i.value?!i.value.hasError:!1}function l(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,s,l)}),(_,C)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":C[0]||(C[0]=D=>t.modelValueOnUpdate(D)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":d,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}}),Le=e.defineComponent({__name:"ColorField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,d=r.rulesBehaviour==="lazy",i=e.ref();function c(){return i.value?i.value.validate():!1}function s(){return i.value?!i.value.hasError:!1}function l(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,s,l)}),(_,C)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":C[1]||(C[1]=D=>t.modelValueOnUpdate(D)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":d,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{name:"colorize",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QColor),{"model-value":t.modelValue,"onUpdate:modelValue":C[0]||(C[0]=D=>t.modelValueOnUpdate(D))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),ve=e.defineComponent({__name:"WysiwygField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=m.useQuasar(),o=t.formApi.form.formStyle,d=[[{label:n.lang.editor.align,icon:n.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:n.lang.editor.formatting,icon:n.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:n.lang.editor.fontSize,icon:n.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:n.lang.editor.defaultFont,icon:n.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],i={arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"},c=e.ref();function s(){return!!c.value}function l(){return!!c.value}function _(){}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,l,_)}),(C,D)=>t.modelValue?(e.openBlock(),e.createBlock(e.unref(m.QEditor),{key:0,ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":D[0]||(D[0]=f=>t.modelValueOnUpdate(f)),toolbar:d,fonts:i,placeholder:t.field.label,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly},null,8,["model-value","placeholder","square","dense","class","readonly"])):e.createCommentVNode("",!0)}}),Qe=e.defineComponent({__name:"JsonField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.form,r=n.formSettings;return n.formStyle,r.rulesBehaviour,(o,d)=>" TODO json edit ? "}});class v{constructor(t,n,r,o,d,i,c,s,l){x(this,"resourceName");x(this,"resourceId");x(this,"formMetadataAndData");x(this,"context");x(this,"formSettings");x(this,"formStyle");x(this,"actionComponent");x(this,"orphanErrorsComponent");x(this,"sectionComponent");x(this,"wrapperResetComponent");x(this,"associationDisplayComponent");x(this,"dynamicComponentRecord");x(this,"formApi");x(this,"registerEventCallback");this.dynamicComponentRecord=r.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=c,this.resourceName=t,this.formApi=s,this.formSettings={...d,...z.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...i,...z.getGlobalFormStyle()},this.actionComponent=r.actionComponent??z.getGlobalActionComponent(),this.orphanErrorsComponent=r.orphanErrorsComponent??z.getGlobalOrphanErrorComponent(),this.sectionComponent=r.sectionComponent??z.getGlobalSectionComponent(),this.wrapperResetComponent=r.wrapperResetComponent??z.getGlobalWrapperResetComponent(),this.associationDisplayComponent=r.associationDisplayComponent??z.getGlobalAssociationDisplayComponent(),this.registerEventCallback=l??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...z.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:z.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(z.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(z.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(z.getGlobalWrapperResetComponent()),dynamicComponentRecord:{},allowBulk:!1}}static getForm(t,n,r,o,d,i,c,s,l){return new v(t,n,r,o,d,i,c,s,l).generateFormDef()}generateFormDef(){const t=Y.create(this.formApi);this.registerEventCallback(t);const n=new Set,r=Y.getEventsObjectFromInstance(t),o=[];this.formMetadataAndData.form.sections.forEach((i,c)=>{const s=[];i.fields.forEach(f=>{const R=this.dynamicComponentRecord[`field-${f.field_name}-before`],w=v.getFieldComponentByFormFieldType(f),N=this.dynamicComponentRecord[`field-${f.field_name}-after`],E={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:v.getRegularFieldTypeByFieldType(f.field_type)};let A=f.label;this.formSettings.requiredFieldsHasAsterisk&&f.rules.find(F=>F.type==="required")&&(A=A.concat("*"));const k={type:f.field_type,extraType:f.field_extra_type,metadata:Object.freeze(f),label:A,hint:f.hint??void 0,prefix:f.prefix??void 0,suffix:f.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??i.readonly??f.readonly??void 0,cssClass:f.css_class??void 0,staticSelectOptions:f.static_select_options,associationData:f.field_association_data,rules:f.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:R?e.markRaw(R):void 0,mainComponent:e.markRaw(w),afterComponent:N?e.markRaw(N):void 0,events:r.fields[f.field_name]??{},componentOptions:E};s.push(k),n.add(f.field_name)});const l=this.dynamicComponentRecord[`section-${i.name??c}-before`],_=this.sectionComponent,C=this.dynamicComponentRecord[`section-${i.name??c}-after`],D={label:i.label??void 0,icon:i.icon??void 0,cssClass:i.css_class??void 0,hidden:!1,name:i.name??c.toString(),readonly:this.formMetadataAndData.form.readonly??i.readonly??void 0,events:r.sections[i.name??c.toString()]??{},beforeComponent:l?e.markRaw(l):void 0,mainComponent:e.markRaw(_),afterComponent:C?e.markRaw(C):void 0,fields:s};o.push(D)});const d={sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,allowBulk:this.formMetadataAndData.form.allow_bulk??!1,events:r.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context};return n.size<this.formMetadataAndData.form.sections.reduce((i,c)=>i+c.fields.length,0)&&console.warn("Submit64 -> Found fields with the same name"),d}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){switch(t.field_type){case"string":switch(t.field_extra_type){case"color":return Le;case"wysiwyg":return ve;default:return re}case"text":return re;case"number":return Ue;case"date":return Re;case"datetime":return Ie;case"select":return Pe;case"selectBelongsTo":return le;case"selectHasMany":return ce;case"selectHasAndBelongsToMany":return ce;case"selectHasOne":return le;case"checkbox":return $e;case"object":return Qe;default:return re}}}function B(a){a==null||a.forEach(t=>{t()})}function Me(a,t,n){const r=n.form,o=(s,l,_)=>s[l]?_?()=>d(s[l]):()=>s[l]:s.compare_to?()=>{var C;return((C=n.getFieldByName(s.compare_to))==null?void 0:C.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",d=s=>String(m.date.formatDate(m.date.extractDate(s,r.formSettings.backendDateFormat),r.formSettings.dateFormat)),i=[],c=[];switch(t){case"date":i.push(fe(r.formSettings.dateFormat));break;case"datetime":i.push(fe(r.formSettings.datetimeFormat));break}return a.forEach(s=>{const l=s;switch(l.type){case"required":i.push(qe());break;case"absence":i.push(He());break;case"acceptance":i.push(je());break;case"inclusion":i.push(de(l.including));break;case"exclusion":i.push(Ge(l.excluding));break;case"backend":break;case"allowNull":c.push("allowNull");break;case"allowBlank":c.push("allowBlank");break;case"positiveNumber":i.push(Je());break;case"lessThanOrEqualNumber":i.push(Ke(o(l,"less_than")));break;case"lessThanNumber":i.push(Xe(o(l,"less_than")));break;case"greaterThanOrEqualNumber":i.push(Ze(o(l,"greater_than")));break;case"greaterThanNumber":i.push(et(o(l,"greater_than")));break;case"equalToNumber":i.push(tt(o(l,"equal_to")));break;case"otherThanNumber":i.push(nt(o(l,"other_than")));break;case"numberIntegerOnly":i.push(ot());break;case"numberNumericOnly":i.push(rt());break;case"numberEvenOnly":i.push(at());break;case"numberOddOnly":i.push(it());break;case"lessThanOrEqualStringLength":i.push(lt(o(l,"less_than")));break;case"lessThanStringLength":i.push(st(o(l,"less_than")));break;case"greaterThanOrEqualStringLength":i.push(ct(o(l,"greater_than")));break;case"greaterThanStringLength":i.push(dt(o(l,"greater_than")));break;case"equalToStringLength":i.push(mt(o(l,"equal_to")));break;case"equalToString":i.push(ut(o(l,"equal_to")));break;case"betweenStringLength":i.push(ft(()=>l.min,()=>l.max));break;case"otherThanString":i.push(pt(o(l,"other_than")));break;case"lessThanOrEqualDate":i.push(gt(o(l,"less_than",!0),r.formSettings.dateFormat));break;case"lessThanDate":i.push(ht(o(l,"less_than",!0),r.formSettings.dateFormat));break;case"greaterThanOrEqualDate":i.push(yt(o(l,"greater_than",!0),r.formSettings.dateFormat));break;case"greaterThanDate":i.push(Ct(o(l,"greater_than",!0),r.formSettings.dateFormat));break;case"equalToDate":i.push(bt(o(l,"equal_to",!0),r.formSettings.dateFormat));break;case"otherThanDate":i.push(St(o(l,"other_than",!0),r.formSettings.dateFormat));break}}),c.length>0?c.map(s=>{switch(s){case"allowBlank":return We(i);case"allowNull":return Ye(i)}}):i}function qe(){return a=>!!a||"Ce champ est requis"}function de(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function Ge(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${de.toString()}`)}function He(){return a=>!a||"Ce champ doit être vide"}function je(){return a=>!!a||"Doit être accepté"}function Ye(a){return t=>(t===null||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function We(a){return t=>(t===""||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function Je(){return a=>Number(a)>0||"Val. positive uniquement"}function Ke(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function Xe(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function Ze(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function et(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function tt(a,t){return n=>{const r=a();return Number(n)===r||`Égale à ${r}`}}function nt(a,t){return n=>{const r=a();return Number(n)!==r||`Doit être différent de ${a}`}}function ot(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function rt(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function at(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function it(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function lt(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function st(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function ct(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function dt(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function ft(a,t){return n=>{const r=a(),o=t();return String(n).length>=r&&String(n).length<=o||`Entre ${r} et ${o}`}}function ut(a,t){return n=>{const r=a();return String(n)===r||`Égale à ${r}`}}function mt(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function pt(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function gt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),d=m.date.extractDate(r,t);return o<=d||`Inf. ou égal à ${r}`}}function ht(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),d=m.date.extractDate(r,t);return o<d||`Inf. à ${r}`}}function yt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),d=m.date.extractDate(r,t);return o>=d||`Sup. ou égal à ${r}`}}function Ct(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),d=m.date.extractDate(r,t);return o>d||`Sup. à ${r}`}}function bt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),d=m.date.extractDate(r,t);return o===d||`Égale à ${o}`}}function St(a,t){return n=>{const r=a();return m.date.extractDate(String(n),t)!==m.date.extractDate(r,t)||`Doit être différent de ${r}`}}function fe(a){return t=>t==null||t===""?!0:kt(t,a)||`Date invalide. Format : ${a}`}function kt(a,t){if(typeof a!="string"||!a.trim())return!1;const n=m.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:m.date.formatDate(n,t)===a}const _t={computeServerRules:Me},Vt={key:2,class:"q-field__bottom text-negative q-pt-none"},Ft=["index"],xt=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=()=>!0,o=()=>!0,d=()=>{},i=()=>{},c=()=>{};const s=N(),l=e.ref(),_=e.ref([]);function C(){l.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),l.value=f(l.value)}function D(){l.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),l.value=f(l.value),B(n.field.events.onReset),i(),e.nextTick(()=>{te()})}function f(p){const V=n.formApi.form;switch(n.field.type){case"checkbox":return p==null||p===""?!1:p;case"date":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),V.formSettings.backendDateFormat),V.formSettings.dateFormat);case"datetime":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),V.formSettings.backendDatetimeFormat),V.formSettings.datetimeFormat)}return p}function R(p){const V=n.formApi.form;switch(n.field.type){case"date":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),V.formSettings.dateFormat),V.formSettings.backendDateFormat);case"datetime":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),V.formSettings.datetimeFormat),V.formSettings.backendDatetimeFormat)}return p}function w(){switch(n.field.type){case"string":l.value="";break;case"checkbox":l.value=!1;break;case"date":l.value=null;break;case"datetime":l.value=null;break;case"number":l.value=null;break;case"select":l.value=void 0;break;case"text":l.value="";break;case"object":l.value={};break;case"selectBelongsTo":l.value=void 0;break;case"selectHasMany":l.value=void 0;break}c(),B(n.field.events.onClear)}function N(){return _t.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function E(p){l.value=p}function A(){return e.unref(l)}function k(){return R(e.unref(l))}function F(p){_.value=p}function y(){const p=n.privateFormApi.getFieldRef(n.field.metadata.field_name);p&&(p.hidden=!0,B(n.field.events.onHide))}function T(){const p=n.privateFormApi.getFieldRef(n.field.metadata.field_name);p&&(p.hidden=!1,B(n.field.events.onUnhide))}function I(p){const V=n.privateFormApi.getFieldRef(n.field.metadata.field_name);V&&(V.readonly=p)}function W(p){const V=n.privateFormApi.getFieldRef(n.field.metadata.field_name);V&&(V.hint=p)}function q(p){const V=n.privateFormApi.getFieldRef(n.field.metadata.field_name);V&&(V.cssClass=p)}function L(p){const V=n.privateFormApi.getFieldRef(n.field.metadata.field_name);V&&(V.suffix=p)}function g(p){const V=n.privateFormApi.getFieldRef(n.field.metadata.field_name);V&&(V.prefix=p)}function b(p){const V=n.privateFormApi.getFieldRef(n.field.metadata.field_name);V&&(V.label=p)}function $(){const p=r();return B(n.field.events.onValidated),p}function J(){return o()}function K(){return!J()}function te(){return d()}function ae(p,V,Z,j,ne){r=p,o=V,d=Z,j&&(i=j),ne&&(c=ne)}const X={softReset:C,reset:D,clear:w,validate:$,isValid:J,isInvalid:K,hide:y,unhide:T,resetValidation:te,getValueDeserialized:k,getValueSerialized:A,setupBackendErrors:F,setReadonlyState:I,setHint:W,setCssClass:q,setSuffix:L,setPrefix:g,setLabel:b,setValue:E,field:n.field};return t(X),e.watch(()=>n.field.events.onUpdate?l.value:null,()=>{B(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid||n.field.events.onIsInvalid?l.value:null,p=>{B(p?n.field.events.onIsValid:n.field.events.onIsInvalid)}),e.onMounted(()=>{var V;C();const p=(V=e.getCurrentInstance())==null?void 0:V.exposed;p&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,p)}),(p,V)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:X},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:l.value,field:n.field,formApi:n.formApi,rules:e.unref(s),reset:D,clear:w,getValueDeserialized:k,getValueSerialized:A,validate:$,modelValueOnUpdate:E,registerBehaviourCallbacks:ae},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:X},null,8,["formApi"])):e.createCommentVNode("",!0),_.value.length>0?(e.openBlock(),e.createElementBlock("div",Vt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(_.value,(Z,j)=>(e.openBlock(),e.createElementBlock("div",{index:j,class:"flex column"},e.toDisplayString(Z),9,Ft))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),Bt={class:"flex column"},Dt=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=null,o=null,d=null;const i={softReset:l,reset:_,clear:C,validate:R,isValid:w,isInvalid:N,hide:D,unhide:f,resetValidation:E,getFields:A,setReadonlyState:k,setCssClass:F,setIcon:y,setLabel:T,section:n.section},c=e.ref(new Map);function s(){n.section.fields.forEach(g=>{const b=g.metadata.field_name,$=n.formApi.getFieldByName(b);$&&c.value.set(b,$)})}function l(){c.value.forEach(g=>{g.softReset()})}function _(){c.value.forEach(g=>{g.reset()}),B(n.section.events.onReset)}function C(){c.value.forEach(g=>{g.clear()}),B(n.section.events.onClear)}function D(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(c.value.forEach(b=>{b.hide()}),g.hidden=!0,B(n.section.events.onHide))}function f(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(c.value.forEach(b=>{b.unhide()}),g.hidden=!1,B(n.section.events.onUnhide))}function R(){let g=!0;return c.value.forEach(b=>{if(!b.validate()){g=!1;return}}),B(n.section.events.onValidated),g}function w(){let g=!0;return c.value.forEach(b=>{if(!b.isValid()){g=!1;return}}),g}function N(){return!w()}function E(){c.value.forEach(g=>{g.resetValidation()})}function A(){return c.value}function k(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.readonly=g)}function F(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.cssClass=g)}function y(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.icon=g)}function T(g){const b=n.privateFormApi.getSectionRef(n.section.name);b&&(b.label=g)}function I(){const g={};for(const[b,$]of c.value)g[b]=$.getValueSerialized();return g}t(i);const W=e.computed(()=>w()),q=e.computed(()=>N()),L=e.computed(()=>I());return e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onIsValid},g=>{r==null||r(),r=null,g&&(r=e.watch(W,b=>{b&&B(n.section.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onIsInvalid},g=>{o==null||o(),o=null,g&&(o=e.watch(q,b=>{var $;b&&B(($=n.section)==null?void 0:$.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onUpdate},g=>{d==null||d(),d=null,g&&(d=e.watch(L,()=>{var b;B((b=n.section)==null?void 0:b.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(()=>{var b;const g=(b=e.getCurrentInstance())==null?void 0:b.exposed;g&&n.privateFormApi.registerSectionWrapperRef(n.section.name,g),e.nextTick(()=>{s()})}),(g,b)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",Bt,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:i},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:i,formApi:n.formApi},{default:e.withCtx(()=>[e.renderSlot(g.$slots,"default")]),_:3},8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:i},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}}),Nt={class:"flex column"},wt=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let r=null,o="",d=0,i=0,c=null,s=null,l=null,_=null,C=null;const D=e.useSlots(),f=e.ref(v.getEmptyFormBeforeInit()),R=e.ref(!1),w=e.ref(!1),N=e.ref(!1),E=e.ref(!1),A=e.ref("create"),k=e.ref({}),F=e.ref(new Map),y=e.ref(new Map);async function T(){r=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),f.value=v.getForm(n.resourceName,n.resourceId,q(),r,n.formSettings,n.formStyle,n.context,Q,n.eventManager),d=f.value.sections.length,i=f.value.sections.map(u=>u.fields).flat().length,n.resourceId&&(A.value="edit")}async function I(){var S,P,G;if(!b())return;B((S=f.value)==null?void 0:S.events.onSubmit),E.value=!0,p();const u=L(),h=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:u,context:n.context});if(_=h.resource_data,h.success)k.value={},A.value==="create"&&(A.value="edit"),r&&h.resource_data&&(r.resource_data=h.resource_data),f.value=v.getForm(n.resourceName,n.resourceId,q(),{form:h.form,resource_data:h.resource_data},n.formSettings,n.formStyle,n.context,Q,n.eventManager),K(),o=JSON.stringify(L()),B((G=f.value)==null?void 0:G.events.onSubmitSuccess);else{k.value={};const H=[];for(const[U,M]of y.value){const oe=h.errors[U];oe&&(M.setupBackendErrors(oe),H.push(U))}Object.entries(h.errors).forEach(U=>{H.includes(U[0])||(k.value[U[0]]=U[1])}),B((P=f.value)==null?void 0:P.events.onSubmitUnsuccess)}E.value=!1}async function W(u){var P,G,H;if(!f.value.allowBulk||A.value==="edit"){console.warn("Submit64 : you are not allowed to submitBulk");return}if(!b())return;B((P=f.value)==null?void 0:P.events.onSubmit),E.value=!0,p();const h=L(),S=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:h,bulkCount:u,context:n.context});if(C=S.bulk_data,S.success)k.value={},A.value==="create"&&(A.value="edit"),r&&S.resource_data&&(r.resource_data=S.resource_data),f.value=v.getForm(n.resourceName,n.resourceId,q(),{form:S.form,resource_data:S.resource_data},n.formSettings,n.formStyle,n.context,Q,n.eventManager),K(),o=JSON.stringify(L()),B((H=f.value)==null?void 0:H.events.onSubmitSuccess);else{k.value={};const U=[];for(const[M,oe]of y.value){const ge=S.errors[M];ge&&(oe.setupBackendErrors(ge),U.push(M))}Object.entries(S.errors).forEach(M=>{U.includes(M[0])||(k.value[M[0]]=M[1])}),B((G=f.value)==null?void 0:G.events.onSubmitUnsuccess)}E.value=!1}function q(){const u={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const h in D){const S=D[h];if(S){const P=e.defineComponent({inheritAttrs:!1,setup(G,{attrs:H,slots:U}){return()=>S({...G,...H,slots:U})}});switch(h){case"sections":u.sectionComponent=P;break;case"actions":u.actionComponent=P;break;case"orphan-errors":u.orphanErrorsComponent=P;break;case"association-display":u.associationDisplayComponent=P;break;default:u.dynamicComponentRecord[h]=P;break}}}return u}function L(){const u={};for(const[h,S]of y.value)u[h]=S.getValueDeserialized();return u}function g(){const u={};for(const[h,S]of y.value)u[h]=S.getValueSerialized();return u}function b(){var h;let u=!0;return y.value.forEach(S=>{if(!S.validate()){u=!1;return}}),B((h=f.value)==null?void 0:h.events.onValidated),u}function $(){let u=!0;return y.value.forEach(h=>{if(!h.isValid()){u=!1;return}}),u}function J(){return!$()}function K(){F.value.forEach(u=>{u.softReset()})}function te(){var u;y.value.forEach(h=>{h.reset()}),B((u=f.value)==null?void 0:u.events.onReset)}function ae(){var u;y.value.forEach(h=>{h.clear()}),B((u=f.value)==null?void 0:u.events.onClear)}function X(){y.value.forEach(u=>{u.resetValidation()})}function p(){y.value.forEach(u=>{u.setupBackendErrors([])})}function V(u){if(r)return r.resource_data[u]}function Z(u){return F.value.get(u)}function j(u){return[...F.value.values()].at(u)}function ne(){return F.value}function Rt(u){return y.value.get(u)}function At(){return y.value}function Et(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function It(){["getMetadataAndData","resourceName"].forEach(h=>{(n[h]===null||n[h]===void 0)&&console.warn(`Missing props for <Submit64> -> ${h}`)})}function Tt(){return e.unref(A)}function Ot(){return o!==JSON.stringify(L())}function zt(u){f.value&&(f.value.context=u)}function $t(u){f.value&&(f.value.cssClass=u)}function Pt(u){f.value&&(f.value.readonly=u)}function Ut(){return N.value}function Lt(){return _}function vt(){return C}function Qt(){return f}function Mt(u){var h;return(h=f.value)==null?void 0:h.sections.find(S=>S.name===u)}function qt(u){var h;return(h=f.value)==null?void 0:h.sections.map(S=>S.fields).flat().find(S=>S.metadata.field_name===u)}function ue(u,h){F.value.set(u,h),d===F.value.size&&(R.value=!0)}function me(u,h){y.value.set(u,h),i===y.value.size&&(w.value=!0)}const pe={getFormRef:Qt,getSectionRef:Mt,getFieldRef:qt,registerSectionWrapperRef:ue,registerFieldWrapperRef:me},Gt=new Proxy({},{get(u,h){var S;return(S=f.value)==null?void 0:S[h]}}),Q={getMode:Tt,getSectionByName:Z,getSectionByIndex:j,getSections:ne,getFieldByName:Rt,getFields:At,validate:b,isValid:$,isInvalid:J,softReset:K,reset:te,clear:ae,resetValidation:X,submit:I,submitBulk:W,valuesHasChanged:Ot,getInitialValueByFieldName:V,getAssociationDataCallback:Et,setContext:zt,setCssClass:$t,setReadonlyState:Pt,isReady:Ut,getSubmitData:Lt,getBulkSubmitData:vt,form:Gt};t(Q);const Ht=e.computed(()=>$()),jt=e.computed(()=>J()),Yt=e.computed(()=>g());return e.watch(()=>R.value&&w.value,u=>{var h;u&&!N.value&&(B((h=f.value)==null?void 0:h.events.onReady),N.value=!0)}),e.watch(()=>{var u;return(u=f.value)==null?void 0:u.events.onIsValid},u=>{c==null||c(),c=null,u&&(c=e.watch(Ht,h=>{var S;h&&B((S=f.value)==null?void 0:S.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var u;return(u=f.value)==null?void 0:u.events.onIsInvalid},u=>{s==null||s(),s=null,u&&(s=e.watch(jt,h=>{var S;h&&B((S=f.value)==null?void 0:S.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var u;return(u=f.value)==null?void 0:u.events.onUpdate},u=>{l==null||l(),l=null,u&&(l=e.watch(Yt,()=>{var h;B((h=f.value)==null?void 0:h.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(async()=>{It(),await T(),e.nextTick(()=>{o=JSON.stringify(L())})}),(u,h)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",Nt,[e.createElementVNode("div",{class:e.normalizeClass(f.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value.sections,S=>(e.openBlock(),e.createBlock(Dt,{key:S.name,section:S,context:n.context,formApi:Q,privateFormApi:pe,registerRef:ue},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(S.fields,P=>(e.openBlock(),e.createBlock(xt,{key:P.metadata.field_name,field:P,context:n.context,formApi:Q,privateFormApi:pe,registerRef:me},null,8,["field","context"]))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(f.value.orphanErrorsComponent),{orphanErrors:k.value,formApi:Q},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(f.value.actionComponent),{isLoadingSubmit:E.value,formApi:Q},null,8,["isLoadingSubmit"]))],512)),[[e.vShow,N.value]])}});O.DynamicLogicBuilder=Y,O.Submit64=z,O.Submit64Form=wt,Object.defineProperty(O,Symbol.toStringTag,{value:"Module"})});
