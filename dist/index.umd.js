(function(h,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(h=typeof globalThis<"u"?globalThis:h||self,e(h["submit64-vue"]={},h.Vue,h.Quasar))})(this,function(h,e,m){"use strict";var Le=Object.defineProperty;var Qe=(h,e,m)=>e in h?Le(h,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):h[e]=m;var _=(h,e,m)=>Qe(h,typeof e!="symbol"?e+"":e,m);const R={class:"flex row items-center no-wrap q-pt-sm"},E=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},reset:{type:Function},clear:{type:Function},submit:{type:Function}},setup(l){const n=l;return(o,t)=>(e.openBlock(),e.createElementBlock("div",R,[e.createVNode(e.unref(m.QBtn),{label:"Enregistrer",loading:n.isLoadingSubmit,onClick:n.submit},null,8,["loading","onClick"]),n.reset?(e.openBlock(),e.createBlock(e.unref(m.QBtn),{key:0,loading:n.isLoadingSubmit,label:"Réinitialiser",onClick:n.reset},null,8,["loading","onClick"])):e.createCommentVNode("",!0),n.clear?(e.openBlock(),e.createBlock(e.unref(m.QBtn),{key:1,loading:n.isLoadingSubmit,label:"Vider",onClick:n.clear},null,8,["loading","onClick"])):e.createCommentVNode("",!0)]))}}),$={class:"flex row items-center"},I={class:"text-body1 text-weight-medium"},j={class:"flex column q-gutter-sm"},P=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{}},setup(l){const n=l;return(o,t)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",n.section.cssClass])},[e.createElementVNode("div",$,[n.section.icon?(e.openBlock(),e.createBlock(e.unref(m.QIcon),{key:0,name:n.section.icon,size:"sm"},null,8,["name"])):e.createCommentVNode("",!0),e.createElementVNode("div",I,e.toDisplayString(n.section.label),1)]),e.createElementVNode("div",j,[e.renderSlot(o.$slots,"default")])],2))}}),z=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(l){const n=l;return(o,t)=>{const r=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(r,{name:"reset",class:"cursor-pointer",onClick:t[0]||(t[0]=c=>n.reset())})}}}),D=class D{constructor(){_(this,"_formSettings");_(this,"_formStyleConfig");_(this,"_actionComponent");_(this,"_sectionComponent");_(this,"_wrapperResetComponent");_(this,"_associationDisplayDictonary");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY:HHmm",renderBackendHint:!0},this._formStyleConfig={fieldOutlined:!0,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=E,this._sectionComponent=P,this._wrapperResetComponent=z,this._associationDisplayDictonary={}}static registerGlobalFormSetting(n){this._instance._formSettings={...this._instance._formSettings,...n}}static registerGlobalFormStyleSetting(n){this._instance._formStyleConfig={...this._instance._formStyleConfig,...n}}static registerGlobalActionComponent(n){this._instance._actionComponent=n}static registerGlobalSectionComponent(n){this._instance._sectionComponent=n}static registerGlobalWrapperResetComponent(n){this._instance._wrapperResetComponent=n}static registerGlobalAssociationDisplayDictonary(n){this._instance._associationDisplayDictonary=n}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyleConfig(){return this._instance._formStyleConfig}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayDictonary(){return this._instance._associationDisplayDictonary}};_(D,"_instance",new D);let F=D;function q(l,n,o){const t=o.getFormFactoryInstance().formSettings,r=o.getForm(),c=(u,i,f)=>u[i]?f?()=>d(u[i]):()=>u[i]:u.compare_to?()=>o.getFieldDataByFieldName(u.compare_to):()=>"",d=u=>String(m.date.formatDate(m.date.extractDate(u,r.backendDateFormat),t.dateFormat)),a=[],s=[];switch(n){case"date":a.push(_e(t.dateFormat))}return l.forEach(u=>{const i=u;switch(i.type){case"required":a.push(L());break;case"absence":a.push(U());break;case"acceptance":a.push(G());break;case"inclusion":a.push(w(i.including));break;case"exclusion":a.push(Q(i.excluding));break;case"backend":break;case"allowNull":s.push("allowNull");break;case"allowBlank":s.push("allowBlank");break;case"positiveNumber":a.push(Y());break;case"lessThanOrEqualNumber":a.push(M(c(i,"less_than")));break;case"lessThanNumber":a.push(K(c(i,"less_than")));break;case"greaterThanOrEqualNumber":a.push(J(c(i,"greater_than")));break;case"greaterThanNumber":a.push(X(c(i,"greater_than")));break;case"equalToNumber":a.push(Z(c(i,"equal_to")));break;case"otherThanNumber":a.push(W(c(i,"other_than")));break;case"numberIntegerOnly":a.push(v());break;case"numberNumericOnly":a.push(ee());break;case"numberEvenOnly":a.push(te());break;case"numberOddOnly":a.push(ne());break;case"lessThanOrEqualStringLength":a.push(oe(c(i,"less_than")));break;case"lessThanStringLength":a.push(le(c(i,"less_than")));break;case"greaterThanOrEqualStringLength":a.push(ae(c(i,"greater_than")));break;case"greaterThanStringLength":a.push(re(c(i,"greater_than")));break;case"equalToStringLength":a.push(ce(c(i,"equal_to")));break;case"equalToString":a.push(se(c(i,"equal_to")));break;case"betweenStringLength":a.push(ie(()=>i.min,()=>i.max));break;case"otherThanString":a.push(de(c(i,"other_than")));break;case"lessThanOrEqualDate":a.push(ue(c(i,"less_than",!0),t.dateFormat));break;case"lessThanDate":a.push(fe(c(i,"less_than",!0),t.dateFormat));break;case"greaterThanOrEqualDate":a.push(me(c(i,"greater_than",!0),t.dateFormat));break;case"greaterThanDate":a.push(ge(c(i,"greater_than",!0),t.dateFormat));break;case"equalToDate":a.push(he(c(i,"equal_to",!0),t.dateFormat));break;case"otherThanDate":a.push(be(c(i,"other_than",!0),t.dateFormat));break}}),s.length>0?s.map(u=>{switch(u){case"allowBlank":return A(a);case"allowNull":return H(a)}}):a}function L(){return l=>!!l||"Ce champ est requis"}function w(l){return n=>l.includes(String(n))||`Doit être contenu dans ${l.toString()}`}function Q(l){return n=>!l.includes(String(n)||`Ne doit pas être contenu dans ${w.toString()}`)}function U(){return l=>!l||"Ce champ doit être vide"}function G(){return l=>!!l||"Doit être accepté"}function H(l){return n=>(n===null||l.forEach(o=>{const t=o(n);if(t!==!0)return t}),!0)}function A(l){return n=>(n===""||l.forEach(o=>{const t=o(n);if(t!==!0)return t}),!0)}function Y(){return l=>Number(l)>0||"Val. positive uniquement"}function M(l){return n=>{const o=l();return Number(n)<=o||`Inf. ou égal à ${o}`}}function K(l){return n=>{const o=l();return Number(n)<o||`Inf. ${o}`}}function J(l){return n=>{const o=l();return Number(n)>=o||`Sup. ou égal à ${o}`}}function X(l){return n=>{const o=l();return Number(n)>o||`Sup. à ${o}`}}function Z(l,n){return o=>{const t=l();return Number(o)===t||`Égale à ${t}`}}function W(l,n){return o=>{const t=l();return Number(o)!==t||`Doit être différent de ${l}`}}function v(){return l=>/^-?\d+$/.test(String(l).trim())||"Nombre entier uniquement"}function ee(){return l=>/^-?\d+(\.\d+)?$/.test(String(l).trim())||"Caractère numérique uniquement"}function te(){return l=>Number.isInteger(Number(l))&&Number(l)%2===0||"Nombre pair uniquement"}function ne(){return l=>Number.isInteger(Number(l))&&Number(l)%2===1||"Nombre impair uniquement"}function oe(l){return n=>{const o=l();return String(n).length<=o||`Inf. ou égal à ${o}`}}function le(l){return n=>{const o=l();return String(n).length<o||`Inf. à ${o}`}}function ae(l){return n=>{const o=l();return String(n).length>=o||`Sup. ou égal à ${o}`}}function re(l){return n=>{const o=l();return String(n).length>o||`Sup. à ${o}`}}function ie(l,n){return o=>{const t=l(),r=n();return String(o).length>=t&&String(o).length<=r||`Entre ${t} et ${r}`}}function se(l,n){return o=>{const t=l();return String(o)===t||`Égale à ${t}`}}function ce(l){return n=>{const o=l();return String(n).length===o||`Doit contenir ${o} caractères`}}function de(l){return n=>{const o=l();return String(n)!==o||`Doit être différent de ${o}`}}function ue(l,n){return o=>{const t=l(),r=m.date.extractDate(String(o),n),c=m.date.extractDate(t,n);return!Number.isNaN(r.getTime())&&r<=c||`Inf. ou égal à ${t}`}}function fe(l,n){return o=>{const t=l(),r=m.date.extractDate(String(o),n),c=m.date.extractDate(t,n);return!Number.isNaN(r.getTime())&&r<c||`Inf. à ${t}`}}function me(l,n){return o=>{const t=l(),r=m.date.extractDate(String(o),n),c=m.date.extractDate(t,n);return!Number.isNaN(r.getTime())&&r>=c||`Sup. ou égal à ${t}`}}function ge(l,n){return o=>{const t=l(),r=m.date.extractDate(String(o),n),c=m.date.extractDate(t,n);return!Number.isNaN(r.getTime())&&r>c||`Sup. à ${t}`}}function he(l,n){return o=>{const t=l(),r=m.date.extractDate(String(o),n),c=m.date.extractDate(t,n);return r===c||`Égale à ${r}`}}function be(l,n){return o=>{const t=l();return m.date.extractDate(String(o),n)!==m.date.extractDate(t,n)||`Doit être différent de ${t}`}}function _e(l){return n=>!Number.isNaN(m.date.extractDate(String(n),l).getTime())||"Date invalide"}const Ce={computeServerRules:q},k=e.defineComponent({__name:"FieldWrapper",props:{field:{}},setup(l,{expose:n}){const o=l,t=e.inject(o.field.provideUniqKey),r=e.ref(),c=e.ref([]);function d(){return r.value}function a(){t&&(r.value=t.getDefaultDataByFieldName(o.field.metadata.field_name),r.value=s(r.value))}function s(b){switch(o.field.type){case"date":return m.date.formatDate(m.date.extractDate(String(b),t.getForm().backendDateFormat),t.getFormFactoryInstance().formSettings.dateFormat)}return b}function u(){switch(o.field.type){case"string":r.value="";break;case"checkbox":r.value=!1;break;case"date":r.value=m.date.formatDate(new Date,t.getFormFactoryInstance().formSettings.dateFormat);break;case"number":r.value=0;break;case"selectString":r.value=null;break;case"text":r.value="";break;case"object":r.value={};break;case"selectBelongsTo":r.value=null;break;case"selectHasMany":r.value=null;break}}function i(){return Ce.computeServerRules(o.field.rules??[],o.field.type,t)}function f(b){r.value=b}function C(){return e.unref(r)}function N(b){c.value=b}return n({reset:a,clear:u,getValue:d,setupBackendErrors:N}),e.onMounted(()=>{var p;a();const b=(p=e.getCurrentInstance())==null?void 0:p.exposed;b&&t&&t.registerRef(o.field.metadata.field_name,b)}),(b,p)=>(e.openBlock(),e.createElementBlock("div",null,[o.field.resetable?e.renderSlot(b.$slots,"reset",{key:0,actionProps:{reset:a}},()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(t).getFormFactoryInstance().wrapperResetComponent),{reset:a}))]):e.createCommentVNode("",!0),e.renderSlot(b.$slots,"default",{propsWrapper:{modelValue:r.value,backendErrors:c.value,modelValueOnUpdate:f,field:b.field,injectForm:e.unref(t),reset:a,clear:u,getComputedRules:i,getModelValueValue:C}})]))}}),Se=e.defineComponent({__name:"StringField",props:{field:{}},setup(l){const n=l;function o(t){const r=t.injectForm.getFormFactoryInstance(),c=r.formSettings,d=r.formStyleConfig;return{"onUpdate:modelValue":a=>t.modelValueOnUpdate(a),modelValue:t.modelValue,lazyRules:c.rulesBehaviour==="lazy",clearable:t.field.clearable,rules:t.getComputedRules(),onClear:t.clear,label:t.field.label,hint:t.field.hint,outlined:d.fieldOutlined,filled:d.fieldFilled,standout:d.fieldStandout,borderless:d.fieldBorderless,rounded:d.fieldRounded,square:d.fieldSquare,dense:d.fieldDense,hideBottomSpace:d.fieldHideBottomSpace,color:d.fieldColor,bgColor:d.fieldBgColor,class:t.field.cssClass}}return(t,r)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QInput),e.normalizeProps(e.guardReactiveProps(o(c))),null,16)]),_:1},8,["field"]))}}),ye=e.defineComponent({__name:"TextField",props:{field:{}},setup(l){const n=l;function o(t){const r=t.injectForm.getFormFactoryInstance(),c=r.formSettings,d=r.formStyleConfig;return{"onUpdate:modelValue":a=>t.modelValueOnUpdate(a),modelValue:t.modelValue,lazyRules:c.rulesBehaviour==="lazy",clearable:t.field.clearable,rules:t.getComputedRules(),onClear:t.clear,label:t.field.label,hint:t.field.hint,outlined:d.fieldOutlined,filled:d.fieldFilled,standout:d.fieldStandout,borderless:d.fieldBorderless,rounded:d.fieldRounded,square:d.fieldSquare,dense:d.fieldDense,hideBottomSpace:d.fieldHideBottomSpace,color:d.fieldColor,bgColor:d.fieldBgColor,class:t.field.cssClass}}return(t,r)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QInput),e.mergeProps(o(c),{type:"textarea"}),{error:e.withCtx(d=>[e.createTextVNode(e.toDisplayString(d),1)]),_:2},1040)]),_:1},8,["field"]))}}),Fe={class:"row items-center justify-end"},ke=e.defineComponent({__name:"DateField",props:{field:{}},setup(l){const n=l,o=e.ref();function t(a){const s=a.injectForm.getFormFactoryInstance(),u=s.formSettings,i=s.formStyleConfig;return{"onUpdate:modelValue":f=>a.modelValueOnUpdate(f),modelValue:a.modelValue,lazyRules:u.rulesBehaviour==="lazy",clearable:a.field.clearable,rules:a.getComputedRules(),readonly:a.field.readonly,onClear:a.clear,label:a.field.label,hint:a.field.hint,outlined:i.fieldOutlined,filled:i.fieldFilled,standout:i.fieldStandout,borderless:i.fieldBorderless,rounded:i.fieldRounded,square:i.fieldSquare,dense:i.fieldDense,hideBottomSpace:i.fieldHideBottomSpace,color:i.fieldColor,bgColor:i.fieldBgColor,class:a.field.cssClass}}function r(a){return{size:"sm",color:"primary",name:"event",class:"cursor-pointer"}}function c(a){return{"onUpdate:modelValue":s=>a.modelValueOnUpdate(s),modelValue:a.modelValue,mask:a.injectForm.getFormFactoryInstance().formSettings.dateFormat}}function d(){o.value&&o.value.hide()}return(a,s)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:u})=>[e.createVNode(e.unref(m.QInput),e.normalizeProps(e.guardReactiveProps(t(u))),{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),e.normalizeProps(e.guardReactiveProps(r())),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"popupProxyRef",ref:o,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),e.normalizeProps(e.guardReactiveProps(c(u))),{default:e.withCtx(()=>[e.createElementVNode("div",Fe,[e.createVNode(e.unref(m.QBtn),{onClick:d,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:2},1040)]),_:2},1536)]),_:2},1040)]),_:2},1040)]),_:1},8,["field"]))}}),Be=e.defineComponent({__name:"CheckboxField",props:{field:{}},setup(l){const n=l;function o(t){const r=t.injectForm.getFormFactoryInstance().formStyleConfig;return{"onUpdate:modelValue":c=>t.modelValueOnUpdate(c),modelValue:t.modelValue,label:t.field.label,dense:r.fieldDense,color:r.fieldColor,class:t.field.cssClass}}return(t,r)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QCheckbox),e.normalizeProps(e.guardReactiveProps(o(c))),null,16)]),_:1},8,["field"]))}}),pe=e.defineComponent({__name:"NumberField",props:{field:{}},setup(l){const n=l;function o(t){const r=t.injectForm.getFormFactoryInstance(),c=r.formSettings,d=r.formStyleConfig;return{"onUpdate:modelValue":a=>t.modelValueOnUpdate(a),modelValue:t.modelValue,lazyRules:c.rulesBehaviour==="lazy",clearable:t.field.clearable,rules:t.getComputedRules(),onClear:t.clear,label:t.field.label,hint:t.field.hint,outlined:d.fieldOutlined,filled:d.fieldFilled,standout:d.fieldStandout,borderless:d.fieldBorderless,rounded:d.fieldRounded,square:d.fieldSquare,dense:d.fieldDense,hideBottomSpace:d.fieldHideBottomSpace,color:d.fieldColor,bgColor:d.fieldBgColor,class:t.field.cssClass}}return(t,r)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QInput),e.mergeProps(o(c),{type:"number"}),null,16)]),_:1},8,["field"]))}});function Ve(l){return Symbol(l)}function V(){return 20}const De=e.defineComponent({__name:"SelectHasManyField",props:{field:{}},setup(l){const n=l,o=n.field.componentOptions.associationDisplayComponent,t=e.ref([]),r=e.ref({limit:V(),offset:0});function c(s){const u=s.injectForm.getFormFactoryInstance(),i=u.formSettings,f=u.formStyleConfig;return{"onUpdate:modelValue":C=>s.modelValueOnUpdate(C),modelValue:s.modelValue,lazyRules:i.rulesBehaviour==="lazy",clearable:s.field.clearable,rules:s.getComputedRules(),multiple:!0,useChips:!0,mapOptions:!0,emitValue:!0,useInput:!0,onClear:s.clear,onFilter:d(s),label:s.field.label,hint:s.field.hint,outlined:f.fieldOutlined,filled:f.fieldFilled,standout:f.fieldStandout,borderless:f.fieldBorderless,rounded:f.fieldRounded,square:f.fieldSquare,dense:f.fieldDense,hideBottomSpace:f.fieldHideBottomSpace,color:f.fieldColor,bgColor:f.fieldBgColor,class:s.field.cssClass}}function d(s){return(u,i)=>{const f=s.injectForm.getAssociationDataCallback();u===""&&(r.value={limit:V(),offset:0}),i(()=>{f({resourceName:s.injectForm.getForm().resourceName,associationName:s.field.metadata.field_association_name,limit:r.value.limit,offset:r.value.offset,labelFilter:u,context:s.injectForm.getForm().context}).then(C=>{t.value=C.rows})})}}function a(s){setTimeout(()=>{t.value=[{label:s.field.defaultDisplayValue??String(s.getModelValueValue()),value:s.getModelValueValue()}]},0)}return(s,u)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:i})=>[e.createVNode(e.unref(m.QSelect),e.mergeProps(c(i),{onVnodeMounted:f=>a(i),options:t.value}),{options:e.withCtx(f=>[e.unref(o)?(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.mergeProps({key:0},f.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(f.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(o)),{key:1,scope:f},null,8,["scope"]))]),_:2},1040,["onVnodeMounted","options"])]),_:1},8,["field"]))}}),Ne=(l,n)=>{const o=l.__vccOpts||l;for(const[t,r]of n)o[t]=r;return o},xe={};function Te(l,n){return" TODO json edit ? "}const Oe=Ne(xe,[["render",Te]]),we=e.defineComponent({__name:"SelectField",props:{field:{}},setup(l){const n=l,o=e.ref([]),t=e.ref([]);function r(a){const s=a.injectForm.getFormFactoryInstance(),u=s.formSettings,i=s.formStyleConfig;return{"onUpdate:modelValue":f=>a.modelValueOnUpdate(f),modelValue:a.modelValue,lazyRules:u.rulesBehaviour==="lazy",clearable:a.field.clearable,rules:a.getComputedRules(),mapOptions:!0,emitValue:!0,useInput:!0,onClear:a.clear,onFilter:c,label:a.field.label,hint:a.field.hint,outlined:i.fieldOutlined,filled:i.fieldFilled,standout:i.fieldStandout,borderless:i.fieldBorderless,rounded:i.fieldRounded,square:i.fieldSquare,dense:i.fieldDense,hideBottomSpace:i.fieldHideBottomSpace,color:i.fieldColor,bgColor:i.fieldBgColor,class:a.field.cssClass}}function c(a,s){if(a===""){s(()=>{t.value=[...o.value]});return}s(()=>{const u=a.toLowerCase();t.value=o.value.filter(i=>i.label.toLowerCase().includes(u))})}function d(a){o.value=Object.freeze(a.field.selectOptions??[]),t.value=a.field.selectOptions??[]}return(a,s)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:u})=>[e.createVNode(e.unref(m.QSelect),e.mergeProps(r(u),{onVnodeMounted:d,options:t.value}),null,16,["options"])]),_:1},8,["field"]))}}),Re=e.defineComponent({__name:"SelectBelongsToField",props:{field:{}},setup(l){const n=l,o=n.field.componentOptions.associationDisplayComponent,t=e.ref([]),r=e.ref({limit:V(),offset:0});function c(s){const u=s.injectForm.getFormFactoryInstance(),i=u.formSettings,f=u.formStyleConfig;return{"onUpdate:modelValue":C=>s.modelValueOnUpdate(C),modelValue:s.modelValue,lazyRules:i.rulesBehaviour==="lazy",clearable:s.field.clearable,rules:s.getComputedRules(),mapOptions:!0,emitValue:!0,useInput:!0,onClear:s.clear,onFilter:d(s),label:s.field.label,hint:s.field.hint,outlined:f.fieldOutlined,filled:f.fieldFilled,standout:f.fieldStandout,borderless:f.fieldBorderless,rounded:f.fieldRounded,square:f.fieldSquare,dense:f.fieldDense,hideBottomSpace:f.fieldHideBottomSpace,color:f.fieldColor,bgColor:f.fieldBgColor,class:s.field.cssClass}}function d(s){return(u,i)=>{const f=s.injectForm.getAssociationDataCallback();u===""&&(r.value={limit:V(),offset:0}),i(()=>{f({resourceName:s.injectForm.getForm().resourceName,associationName:s.field.metadata.field_association_name,limit:r.value.limit,offset:r.value.offset,labelFilter:u,context:s.injectForm.getForm().context}).then(C=>{t.value=C.rows})})}}function a(s){setTimeout(()=>{t.value=[{label:s.field.defaultDisplayValue??String(s.getModelValueValue()),value:s.getModelValueValue()}]},0)}return(s,u)=>(e.openBlock(),e.createBlock(k,{field:n.field},{default:e.withCtx(({propsWrapper:i})=>[e.createVNode(e.unref(m.QSelect),e.mergeProps(c(i),{onVnodeMounted:f=>a(i),options:t.value}),{options:e.withCtx(f=>[e.unref(o)?(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.mergeProps({key:0},f.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(f.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(o)),{key:1,scope:f},null,8,["scope"]))]),_:2},1040,["onVnodeMounted","options"])]),_:1},8,["field"]))}});class O{constructor(n,o,t,r,c,d,a){_(this,"resourceName");_(this,"formSettings");_(this,"formStyleConfig");_(this,"actionComponent");_(this,"sectionComponent");_(this,"wrapperResetComponent");_(this,"associationDisplayDictionary");this.resourceName=n,this.formSettings={...F.getGlobalFormSetting(),...o},this.formStyleConfig={...F.getGlobalFormStyleConfig(),...t},this.actionComponent=r??F.getGlobalActionComponent(),this.sectionComponent=c??F.getGlobalSectionComponent(),this.wrapperResetComponent=d??F.getGlobalWrapperResetComponent(),this.associationDisplayDictionary=a??F.getGlobalAssociationDisplayDictonary()}static getFieldComponentByFormFieldType(n){return{string:Se,text:ye,number:pe,date:ke,selectString:we,selectBelongsTo:Re,selectHasMany:De,checkbox:Be,object:Oe}[n]}getForm(n,o,t){const r=[];return n.form.sections.forEach(d=>{const a=[];d.fields.forEach(u=>{const i=O.getFieldComponentByFormFieldType(u.field_type),f={associationDisplayComponent:this.getAssociationDisplayComponentByResourceName(n.form.resource_name)},C={type:u.field_type,metadata:u,label:u.label,hint:u.hint,cssClass:u.css_class,selectOptions:u.select_options,rules:u.rules,clearable:u.clearable,resetable:u.resetable,provideUniqKey:o,defaultDisplayValue:u.default_display_value,component:i,componentOptions:f};a.push(C)});const s={label:d.label,icon:d.icon,cssClass:d.css_class,fields:a};r.push(s)}),{sections:r,resourceName:n.form.resource_name,cssClass:n.form.css_class,resetable:n.form.resetable,clearable:n.form.clearable,backendDateFormat:n.form.backend_date_format,backendDatetimeFormat:n.form.backend_datetime_format,hasGlobalCustomValidation:n.form.has_global_custom_validation??!1,context:t}}getAssociationDisplayComponentByResourceName(n){return this.associationDisplayDictionary[n]}}const Ee={key:0,class:"flex column"},$e=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},submitForm:{},resourceId:{},getAssociationData:{},formSettings:{},onSubmitFail:{},onSubmitSuccess:{},context:{}},setup(l,{expose:n}){const o=l;let t=null;const r=Object.freeze(new O(o.resourceName,o.formSettings)),c=Ve(m.uid()),d=e.ref({}),a=e.ref(),s=e.ref(!1),u=e.ref(!1),i=e.ref("create");async function f(){t=await o.getMetadataAndData({resourceName:o.resourceName,resourceId:o.resourceId,context:o.context}),a.value=Object.freeze(r.getForm(t,c,o.context)),o.resourceId&&(s.value=!0)}async function C(){var B,x;u.value=!0;const g={};Object.entries(d.value).forEach(S=>{g[S[0]]=S[1].getValue()});const y=await o.submitForm({resourceName:o.resourceName,resourceId:o.resourceId,resourceData:g,context:o.context});y.success?(i.value==="create"&&(i.value="edit"),t&&y.resource_data&&(t.resource_data=y.resource_data),N(),(x=o.onSubmitSuccess)==null||x.call(o)):(Object.entries(d.value).forEach(S=>{const T=y.errors[S[0]];T&&S[1].setupBackendErrors(T)}),(B=o.onSubmitFail)==null||B.call(o)),u.value=!1}function N(){Object.values(d.value).forEach(g=>{g.reset()})}function b(){Object.values(d.value).forEach(g=>{g.clear()})}function p(g,y){d.value[g]=y}function Ie(g){if(t)return t.resource_data[g]}function je(g){const y=Object.entries(d.value).find(B=>B[0]===g);return y?y[1].getValue():null}function Pe(){return r}function ze(){return a.value}function qe(){return o.getAssociationData??(async()=>({rows:[],row_count:0}))}return e.provide(c,{registerRef:p,getDefaultDataByFieldName:Ie,getFieldDataByFieldName:je,getFormFactoryInstance:Pe,getForm:ze,getAssociationDataCallback:qe}),n({}),e.onMounted(async()=>{await f()}),(g,y)=>s.value&&a.value?(e.openBlock(),e.createElementBlock("div",Ee,[e.createElementVNode("div",{class:e.normalizeClass(a.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value.sections,(B,x)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r).sectionComponent),{key:x,section:B},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.fields,S=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:S.metadata.field_name},[g.$slots[S.metadata.field_name]?(e.openBlock(),e.createBlock(k,{key:1,field:S},{default:e.withCtx(({propsWrapper:T})=>[e.renderSlot(g.$slots,"default",{propsWrapper:T})]),_:2},1032,["field"])):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(S.component),{key:0,field:S},null,8,["field"]))],64))),128))]),_:2},1032,["section"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r).actionComponent),{isLoadingSubmit:u.value,submit:C,clear:a.value.clearable?b:void 0,reset:a.value.resetable?N:void 0},null,8,["isLoadingSubmit","clear","reset"])),g.$slots.more_actions?e.renderSlot(g.$slots,"more_actions",{key:0,propsForm:{generatedForm:a.value}}):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)}});h.Submit64=F,h.Submit64Form=$e,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
