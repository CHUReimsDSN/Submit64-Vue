(function(_,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(_=typeof globalThis<"u"?globalThis:_||self,e(_["submit64-vue"]={},_.Vue,_.Quasar))})(this,function(_,e,d){"use strict";var Xe=Object.defineProperty;var Ze=(_,e,d)=>e in _?Xe(_,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):_[e]=d;var V=(_,e,d)=>Ze(_,typeof e!="symbol"?e+"":e,d);const G={class:"flex row items-center no-wrap q-pt-sm"},H=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formDef:{},functionsProvider:{},submit:{type:Function},reset:{type:Function},clear:{type:Function}},setup(o){const t=o;return(n,r)=>(e.openBlock(),e.createElementBlock("div",G,[e.createVNode(e.unref(d.QBtn),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:r[0]||(r[0]=a=>t.submit())},null,8,["loading"]),t.reset?(e.openBlock(),e.createBlock(e.unref(d.QBtn),{key:0,loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:r[1]||(r[1]=a=>t.reset())},null,8,["loading"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(d.QBtn),{key:1,loading:t.isLoadingSubmit,label:"Vider",onClick:r[2]||(r[2]=a=>t.clear())},null,8,["loading"])):e.createCommentVNode("",!0)]))}}),A={class:"flex row items-center"},j={class:"text-body1 text-weight-medium"},Y={class:"flex column q-gutter-sm"},W=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{},functionsProvider:{},context:{}},setup(o){const t=o;return(n,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",t.section.cssClass])},[e.createElementVNode("div",A,[t.section.icon?(e.openBlock(),e.createBlock(e.unref(d.QIcon),{key:0,name:t.section.icon,size:"sm"},null,8,["name"])):e.createCommentVNode("",!0),e.createElementVNode("div",j,e.toDisplayString(t.section.label),1)]),e.createElementVNode("div",Y,[e.renderSlot(n.$slots,"default")])],2))}}),J=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(o){const t=o;return(n,r)=>{const a=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(a,{name:"reset",class:"cursor-pointer",onClick:r[0]||(r[0]=i=>t.reset())})}}}),K=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(o){const t=o;return(n,r)=>(e.openBlock(),e.createBlock(e.unref(d.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),R=class R{constructor(){V(this,"_formSettings");V(this,"_formStyle");V(this,"_actionComponent");V(this,"_sectionComponent");V(this,"_wrapperResetComponent");V(this,"_associationDisplayComponent");V(this,"_associationDisplayDictonary");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!0,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=H,this._sectionComponent=W,this._wrapperResetComponent=J,this._associationDisplayComponent=K,this._associationDisplayDictonary={}}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static registerGlobalAssociationDisplayRecord(t){this._instance._associationDisplayDictonary=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}static getGlobalAssociationDisplayRecord(){return this._instance._associationDisplayDictonary}};V(R,"_instance",new R);let x=R;const X={class:"row items-center justify-end"},Z=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),r=n.formSettings,a=n.formStyle,i=r.rulesBehaviour==="lazy",s=e.ref(),l=e.ref();function f(){s.value&&s.value.hide()}function u(){return l.value?l.value.validate():!1}function c(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(u,c)}),(h,F)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:l,modelValue:t.modelValue,"onUpdate:modelValue":[F[2]||(F[2]=S=>t.modelValue=S),F[3]||(F[3]=S=>t.modelValueOnUpdate(S))],label:t.field.label,hint:t.field.hint,outlined:e.unref(a).fieldOutlined,filled:e.unref(a).fieldFilled,standout:e.unref(a).fieldStandout,borderless:e.unref(a).fieldBorderless,rounded:e.unref(a).fieldRounded,square:e.unref(a).fieldSquare,dense:e.unref(a).fieldDense,hideBottomSpace:e.unref(a).fieldHideBottomSpace,color:e.unref(a).fieldColor,bgColor:e.unref(a).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"popupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QDate),{modelValue:t.modelValue,"onUpdate:modelValue":[F[0]||(F[0]=S=>t.modelValue=S),F[1]||(F[1]=S=>t.modelValueOnUpdate(S))],mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",X,[e.createVNode(e.unref(d.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),M={class:"row items-center justify-end"},v={class:"row items-center justify-end"},ee=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),r=n.formSettings,a=n.formStyle,i=r.rulesBehaviour==="lazy",s=e.ref(),l=e.ref(),f=e.ref();function u(){s.value&&s.value.hide()}function c(){l.value&&l.value.hide()}function h(){return f.value?f.value.validate():!1}function F(){f.value&&f.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(h,F)}),(S,y)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:f,modelValue:t.modelValue,"onUpdate:modelValue":[y[4]||(y[4]=m=>t.modelValue=m),y[5]||(y[5]=m=>t.modelValueOnUpdate(m))],label:t.field.label,hint:t.field.hint,outlined:e.unref(a).fieldOutlined,filled:e.unref(a).fieldFilled,standout:e.unref(a).fieldStandout,borderless:e.unref(a).fieldBorderless,rounded:e.unref(a).fieldRounded,square:e.unref(a).fieldSquare,dense:e.unref(a).fieldDense,hideBottomSpace:e.unref(a).fieldHideBottomSpace,color:e.unref(a).fieldColor,bgColor:e.unref(a).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"datePopupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QDate),{modelValue:t.modelValue,"onUpdate:modelValue":[y[0]||(y[0]=m=>t.modelValue=m),y[1]||(y[1]=m=>t.modelValueOnUpdate(m))],mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",M,[e.createVNode(e.unref(d.QBtn),{onClick:u,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"timePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QTime),{modelValue:t.modelValue,"onUpdate:modelValue":[y[2]||(y[2]=m=>t.modelValue=m),y[3]||(y[3]=m=>t.modelValueOnUpdate(m))],mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",v,[e.createVNode(e.unref(d.QBtn),{onClick:c,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),te={key:0,class:"q-field__bottom"},ne={key:1,class:"q-field--error q-field__bottom text-negative"},oe=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=e.ref(!0),a=t.functionsProvider.getFormFactoryInstance().formStyle;function i(){return n.value===!0}function s(){n.value=!0}return e.watch(()=>t.modelValue,l=>{for(const f of t.rules)if(n.value=f(l),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(i,s)}),(l,f)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(e.unref(d.QCheckbox),{modelValue:t.modelValue,"onUpdate:modelValue":[f[0]||(f[0]=u=>t.modelValue=u),f[1]||(f[1]=u=>t.modelValueOnUpdate(u))],label:t.field.label,dense:e.unref(a).fieldDense,color:e.unref(a).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["modelValue","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",te,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",ne,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)],64))}}),re=e.defineComponent({__name:"ObjectField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const n=o.functionsProvider.getFormFactoryInstance(),r=n.formSettings;return n.formStyle,r.rulesBehaviour,(a,i)=>" TODO json edit ? "}}),le=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=e.ref([]),r=e.ref([]),a=e.ref(),i=t.functionsProvider.getFormFactoryInstance(),s=i.formSettings,l=i.formStyle,f=s.rulesBehaviour==="lazy";function u(y,m){if(y===""){m(()=>{r.value=[...n.value]});return}m(()=>{const C=y.toLowerCase();r.value=n.value.filter(g=>g.label.toLowerCase().includes(C))})}function c(){n.value=Object.freeze(t.field.staticSelectOptions??[]),r.value=t.field.staticSelectOptions??[]}function h(){return a.value?a.value.validate():!1}function F(){a.value&&a.value.resetValidation()}function S(){t.clear(),r.value=[]}return e.onMounted(()=>{c(),t.registerBehaviourCallbacks(h,F)}),(y,m)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:a,modelValue:t.modelValue,"onUpdate:modelValue":[m[0]||(m[0]=C=>t.modelValue=C),m[1]||(m[1]=C=>t.modelValueOnUpdate(C))],type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:r.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:S,onFilter:u},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}});function P(){return 20}const ae=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.field.componentOptions.associationDisplayComponent,r=t.functionsProvider.getFormFactoryInstance(),a=r.formSettings,i=r.formStyle,s=a.rulesBehaviour==="lazy",l=e.ref([]),f=e.ref({limit:P(),offset:0}),u=e.ref();function c(m,C){const g=t.functionsProvider.getAssociationDataCallback();m===""&&(f.value={limit:P(),offset:0}),C(()=>{g({resourceName:t.functionsProvider.getForm().resourceName,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:m,context:t.functionsProvider.getForm().context}).then(B=>{l.value=B.rows}).catch(()=>{l.value=[]})})}function h(){e.nextTick(()=>{const m=t.getValueSerialized();!m||!t.field.associationData||(l.value=[{label:t.field.associationData.label??"???",value:m,data:t.field.associationData.data}])})}function F(){return u.value?u.value.validate():!1}function S(){u.value&&u.value.resetValidation()}function y(){t.clear(),l.value=[]}return e.onMounted(()=>{h(),t.registerBehaviourCallbacks(F,S)}),(m,C)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:u,modelValue:t.modelValue,"onUpdate:modelValue":[C[0]||(C[0]=g=>t.modelValue=g),C[1]||(C[1]=g=>t.modelValueOnUpdate(g))],type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:y,onFilter:c},{options:e.withCtx(g=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),e.normalizeProps(e.guardReactiveProps({associationName:t.field.metadata.field_association_name,entry:g.opt,itemProps:g.itemProps})),null,16))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),ie=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.field.componentOptions.associationDisplayComponent,r=t.functionsProvider.getFormFactoryInstance(),a=r.formSettings,i=r.formStyle,s=a.rulesBehaviour==="lazy",l=e.ref([]),f=e.ref({limit:P(),offset:0}),u=e.ref();function c(m,C){const g=t.functionsProvider.getAssociationDataCallback();m===""&&(f.value={limit:P(),offset:0}),C(()=>{g({resourceName:t.functionsProvider.getForm().resourceName,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:m,context:t.functionsProvider.getForm().context}).then(B=>{l.value=B.rows}).catch(()=>{l.value=[]})})}function h(){e.nextTick(()=>{const m=t.getValueSerialized();!m||!t.field.associationData||(l.value=m.map((C,g)=>({label:t.field.associationData.label[g][g]??"???",value:C,data:t.field.associationData.data[g]})))})}function F(){return u.value?u.value.validate():!1}function S(){u.value&&u.value.resetValidation()}function y(){t.clear(),l.value=[]}return e.onMounted(()=>{h(),t.registerBehaviourCallbacks(F,S)}),(m,C)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:u,modelValue:t.modelValue,"onUpdate:modelValue":[C[0]||(C[0]=g=>t.modelValue=g),C[1]||(C[1]=g=>t.modelValueOnUpdate(g))],type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:y,onFilter:c},{options:e.withCtx(g=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),e.normalizeProps(e.guardReactiveProps({associationName:t.field.metadata.field_association_name,entry:g.opt,itemProps:g.itemProps})),null,16))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),U=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),r=n.formSettings,a=n.formStyle,i=r.rulesBehaviour==="lazy",s=e.ref();function l(){return s.value?s.value.validate():!1}function f(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,f)}),(u,c)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:s,modelValue:t.modelValue,"onUpdate:modelValue":[c[0]||(c[0]=h=>t.modelValue=h),c[1]||(c[1]=h=>t.modelValueOnUpdate(h))],type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(a).fieldOutlined,filled:e.unref(a).fieldFilled,standout:e.unref(a).fieldStandout,borderless:e.unref(a).fieldBorderless,rounded:e.unref(a).fieldRounded,square:e.unref(a).fieldSquare,dense:e.unref(a).fieldDense,hideBottomSpace:e.unref(a).fieldHideBottomSpace,color:e.unref(a).fieldColor,bgColor:e.unref(a).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),se=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},functionsProvider:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(o){const t=o,n=t.functionsProvider.getFormFactoryInstance(),r=n.formSettings,a=n.formStyle,i=r.rulesBehaviour==="lazy",s=e.ref();function l(){return s.value?s.value.validate():!1}function f(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(l,f)}),(u,c)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:s,modelValue:t.modelValue,"onUpdate:modelValue":[c[0]||(c[0]=h=>t.modelValue=h),c[1]||(c[1]=h=>t.modelValueOnUpdate(h))],modelModifiers:{number:!0},type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(a).fieldOutlined,filled:e.unref(a).fieldFilled,standout:e.unref(a).fieldStandout,borderless:e.unref(a).fieldBorderless,rounded:e.unref(a).fieldRounded,square:e.unref(a).fieldSquare,dense:e.unref(a).fieldDense,hideBottomSpace:e.unref(a).fieldHideBottomSpace,color:e.unref(a).fieldColor,bgColor:e.unref(a).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}});class I{constructor(t,n,r,a,i,s,l,f){V(this,"resourceName");V(this,"formSettings");V(this,"formStyle");V(this,"actionComponent");V(this,"sectionComponent");V(this,"wrapperResetComponent");V(this,"associationDisplayComponent");V(this,"associationDisplayRecord");this.resourceName=t,this.formSettings={...n,...x.getGlobalFormSetting()},this.formStyle={...r,...x.getGlobalFormStyle()},this.actionComponent=a??x.getGlobalActionComponent(),this.sectionComponent=i??x.getGlobalSectionComponent(),this.wrapperResetComponent=s??x.getGlobalWrapperResetComponent(),this.associationDisplayComponent=l??x.getGlobalAssociationDisplayComponent(),this.associationDisplayRecord=f??x.getGlobalAssociationDisplayRecord()}static getFieldComponentByFormFieldType(t){return{string:U,text:U,number:se,date:Z,datetime:ee,selectString:le,selectBelongsTo:ae,selectHasMany:ie,checkbox:oe,object:re}[t]}getForm(t,n,r){const a=[];return t.form.sections.forEach(s=>{const l=[];s.fields.forEach(u=>{const c=I.getFieldComponentByFormFieldType(u.field_type),h={associationDisplayComponent:this.associationDisplayRecord[u.field_association_class??""]??this.associationDisplayComponent,regularFieldType:this.getRegularFieldTypeByFieldType(u.field_type)},F={type:u.field_type,metadata:u,label:u.label,hint:u.hint,prefix:u.prefix,suffix:u.suffix,readonly:t.form.readonly??s.readonly??u.readonly,cssClass:u.css_class,staticSelectOptions:u.static_select_options,associationData:u.field_association_data,rules:u.rules,clearable:t.form.clearable,component:c,componentOptions:h};l.push(F)});const f={label:s.label,icon:s.icon,cssClass:s.css_class,readonly:t.form.readonly??s.readonly,fields:l};a.push(f)}),{sections:a,resourceName:t.form.resource_name,resourceId:n,cssClass:t.form.css_class,resetable:t.form.resetable,clearable:t.form.clearable,readonly:t.form.readonly,backendDateFormat:t.form.backend_date_format,backendDatetimeFormat:t.form.backend_datetime_format,context:r}}getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}}function ce(o,t,n){const r=n.getFormFactoryInstance().formSettings,a=n.getForm(),i=(u,c,h)=>u[c]?h?()=>s(u[c]):()=>u[c]:u.compare_to?()=>n.getFieldDataByFieldName(u.compare_to)??"Submit64 error : missing comparator definition":()=>"",s=u=>String(d.date.formatDate(d.date.extractDate(u,a.backendDateFormat),r.dateFormat)),l=[],f=[];switch(t){case"date":l.push(q(r.dateFormat));break;case"datetime":l.push(q(r.datetimeFormat));break}return o.forEach(u=>{const c=u;switch(c.type){case"required":l.push(de());break;case"absence":l.push(fe());break;case"acceptance":l.push(me());break;case"inclusion":l.push(Q(c.including));break;case"exclusion":l.push(ue(c.excluding));break;case"backend":break;case"allowNull":f.push("allowNull");break;case"allowBlank":f.push("allowBlank");break;case"positiveNumber":l.push(ye());break;case"lessThanOrEqualNumber":l.push(be(i(c,"less_than")));break;case"lessThanNumber":l.push(he(i(c,"less_than")));break;case"greaterThanOrEqualNumber":l.push(Ce(i(c,"greater_than")));break;case"greaterThanNumber":l.push(Fe(i(c,"greater_than")));break;case"equalToNumber":l.push(Se(i(c,"equal_to")));break;case"otherThanNumber":l.push(ke(i(c,"other_than")));break;case"numberIntegerOnly":l.push(Ve());break;case"numberNumericOnly":l.push(_e());break;case"numberEvenOnly":l.push(xe());break;case"numberOddOnly":l.push(Be());break;case"lessThanOrEqualStringLength":l.push(De(i(c,"less_than")));break;case"lessThanStringLength":l.push(Ne(i(c,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(Te(i(c,"greater_than")));break;case"greaterThanStringLength":l.push(Pe(i(c,"greater_than")));break;case"equalToStringLength":l.push(we(i(c,"equal_to")));break;case"equalToString":l.push(Oe(i(c,"equal_to")));break;case"betweenStringLength":l.push(Re(()=>c.min,()=>c.max));break;case"otherThanString":l.push(ze(i(c,"other_than")));break;case"lessThanOrEqualDate":l.push(Ee(i(c,"less_than",!0),r.dateFormat));break;case"lessThanDate":l.push($e(i(c,"less_than",!0),r.dateFormat));break;case"greaterThanOrEqualDate":l.push(Ie(i(c,"greater_than",!0),r.dateFormat));break;case"greaterThanDate":l.push(Ue(i(c,"greater_than",!0),r.dateFormat));break;case"equalToDate":l.push(Qe(i(c,"equal_to",!0),r.dateFormat));break;case"otherThanDate":l.push(qe(i(c,"other_than",!0),r.dateFormat));break}}),f.length>0?f.map(u=>{switch(u){case"allowBlank":return ge(l);case"allowNull":return pe(l)}}):l}function de(){return o=>!!o||"Ce champ est requis"}function Q(o){return t=>o.includes(String(t))||`Doit être contenu dans ${o.toString()}`}function ue(o){return t=>!o.includes(String(t)||`Ne doit pas être contenu dans ${Q.toString()}`)}function fe(){return o=>!o||"Ce champ doit être vide"}function me(){return o=>!!o||"Doit être accepté"}function pe(o){return t=>(t===null||o.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function ge(o){return t=>(t===""||o.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function ye(){return o=>Number(o)>0||"Val. positive uniquement"}function be(o){return t=>{const n=o();return Number(t)<=n||`Inf. ou égal à ${n}`}}function he(o){return t=>{const n=o();return Number(t)<n||`Inf. ${n}`}}function Ce(o){return t=>{const n=o();return Number(t)>=n||`Sup. ou égal à ${n}`}}function Fe(o){return t=>{const n=o();return Number(t)>n||`Sup. à ${n}`}}function Se(o,t){return n=>{const r=o();return Number(n)===r||`Égale à ${r}`}}function ke(o,t){return n=>{const r=o();return Number(n)!==r||`Doit être différent de ${o}`}}function Ve(){return o=>/^-?\d+$/.test(String(o).trim())||"Nombre entier uniquement"}function _e(){return o=>/^-?\d+(\.\d+)?$/.test(String(o).trim())||"Caractère numérique uniquement"}function xe(){return o=>Number.isInteger(Number(o))&&Number(o)%2===0||"Nombre pair uniquement"}function Be(){return o=>Number.isInteger(Number(o))&&Number(o)%2===1||"Nombre impair uniquement"}function De(o){return t=>{const n=o();return String(t).length<=n||`Inf. ou égal à ${n}`}}function Ne(o){return t=>{const n=o();return String(t).length<n||`Inf. à ${n}`}}function Te(o){return t=>{const n=o();return String(t).length>=n||`Sup. ou égal à ${n}`}}function Pe(o){return t=>{const n=o();return String(t).length>n||`Sup. à ${n}`}}function Re(o,t){return n=>{const r=o(),a=t();return String(n).length>=r&&String(n).length<=a||`Entre ${r} et ${a}`}}function Oe(o,t){return n=>{const r=o();return String(n)===r||`Égale à ${r}`}}function we(o){return t=>{const n=o();return String(t).length===n||`Doit contenir ${n} caractères`}}function ze(o){return t=>{const n=o();return String(t)!==n||`Doit être différent de ${n}`}}function Ee(o,t){return n=>{const r=o(),a=d.date.extractDate(String(n),t),i=d.date.extractDate(r,t);return a<=i||`Inf. ou égal à ${r}`}}function $e(o,t){return n=>{const r=o(),a=d.date.extractDate(String(n),t),i=d.date.extractDate(r,t);return a<i||`Inf. à ${r}`}}function Ie(o,t){return n=>{const r=o(),a=d.date.extractDate(String(n),t),i=d.date.extractDate(r,t);return a>=i||`Sup. ou égal à ${r}`}}function Ue(o,t){return n=>{const r=o(),a=d.date.extractDate(String(n),t),i=d.date.extractDate(r,t);return a>i||`Sup. à ${r}`}}function Qe(o,t){return n=>{const r=o(),a=d.date.extractDate(String(n),t),i=d.date.extractDate(r,t);return a===i||`Égale à ${a}`}}function qe(o,t){return n=>{const r=o();return d.date.extractDate(String(n),t)!==d.date.extractDate(r,t)||`Doit être différent de ${r}`}}function q(o){return t=>t==null||t===""?!0:Le(t,o)||`Date invalide. Format : ${o}`}function Le(o,t){if(typeof o!="string"||!o.trim())return!1;const n=d.date.extractDate(o,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:d.date.formatDate(n,t)===o}const Ge={computeServerRules:ce},He={key:0,class:"q-field__bottom text-negative q-pt-none"},Ae=["index"],L=e.defineComponent({__name:"FieldWrapper",props:{field:{},functionsProvider:{},context:{}},setup(o,{expose:t}){const n=o;let r=()=>!0,a=()=>{};const i=F(),s=e.ref(),l=e.ref([]);function f(){s.value=n.functionsProvider.getDataByFieldName(n.field.metadata.field_name),s.value=u(s.value),e.nextTick(()=>{B()})}function u(p){switch(n.field.type){case"checkbox":return p==null||p===""?!1:p;case"date":return p==null||p===""?null:d.date.formatDate(d.date.extractDate(String(p),n.functionsProvider.getForm().backendDateFormat),n.functionsProvider.getFormFactoryInstance().formSettings.dateFormat);case"datetime":return p==null||p===""?null:d.date.formatDate(d.date.extractDate(String(p),n.functionsProvider.getForm().backendDatetimeFormat),n.functionsProvider.getFormFactoryInstance().formSettings.datetimeFormat)}return p}function c(p){switch(n.field.type){case"date":return p==null||p===""?null:d.date.formatDate(d.date.extractDate(String(p),n.functionsProvider.getFormFactoryInstance().formSettings.dateFormat),n.functionsProvider.getForm().backendDateFormat);case"datetime":return p==null||p===""?null:d.date.formatDate(d.date.extractDate(String(p),n.functionsProvider.getFormFactoryInstance().formSettings.datetimeFormat),n.functionsProvider.getForm().backendDatetimeFormat)}return p}function h(){switch(n.field.type){case"string":s.value="";break;case"checkbox":s.value=!1;break;case"date":s.value=null;break;case"datetime":s.value=null;break;case"number":s.value=null;break;case"selectString":s.value=void 0;break;case"text":s.value="";break;case"object":s.value={};break;case"selectBelongsTo":s.value=void 0;break;case"selectHasMany":s.value=void 0;break}}function F(){return Ge.computeServerRules(n.field.rules??[],n.field.type,n.functionsProvider)}function S(p){s.value=p}function y(){return e.unref(s)}function m(){return c(e.unref(s))}function C(p){l.value=p}function g(){return r()}function B(){return a()}function O(p,D){r=p,a=D}return t({reset:f,clear:h,validate:g,resetValidation:B,getValueDeserialized:m,getValueSerialized:y,setupBackendErrors:C}),e.onMounted(()=>{var D;f();const p=(D=e.getCurrentInstance())==null?void 0:D.exposed;p&&n.functionsProvider&&n.functionsProvider.registerRef(n.field.metadata.field_name,p)}),(p,D)=>(e.openBlock(),e.createElementBlock("div",null,[e.renderSlot(p.$slots,"default",{is:n.field.component,modelValue:s.value,field:n.field,functionsProvider:n.functionsProvider,rules:e.unref(i),reset:f,clear:h,getValueDeserialized:m,getValueSerialized:y,validate:g,modelValueOnUpdate:S,registerBehaviourCallbacks:O},()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.component),{modelValue:s.value,field:n.field,functionsProvider:n.functionsProvider,rules:e.unref(i),reset:f,clear:h,getValueDeserialized:m,getValueSerialized:y,validate:g,modelValueOnUpdate:S,registerBehaviourCallbacks:O},null,8,["modelValue","field","functionsProvider","rules"])),l.value.length>0?(e.openBlock(),e.createElementBlock("div",He,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(w,z)=>(e.openBlock(),e.createElementBlock("div",{index:z,class:"flex column"},e.toDisplayString(w),9,Ae))),256))])):e.createCommentVNode("",!0)])]))}}),je={key:0,class:"flex column"},Ye=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},sectionComponent:{},actionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},onSubmitFail:{},onSubmitSuccess:{},context:{}},setup(o,{expose:t}){const n=o;let r=null;const a=Object.freeze(new I(n.resourceName,n.formSettings,n.formStyle,n.actionComponent,n.sectionComponent,n.wrapperResetComponent,n.associationDisplayComponent,n.associationDisplayRecord)),i={registerRef:O,getDataByFieldName:p,getFieldDataByFieldName:D,getFormFactoryInstance:w,getForm:z,getAssociationDataCallback:We},s=e.ref(new Map),l=e.ref(),f=e.ref(!1),u=e.ref(!1),c=e.ref("create");async function h(){r=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),l.value=Object.freeze(a.getForm(r,n.resourceId,n.context)),n.resourceId&&(c.value="edit"),f.value=!0}async function F(){var N,E;if(!y())return;u.value=!0,B();const b=S(),k=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:b,context:n.context});k.success?(c.value==="create"&&(c.value="edit"),r&&k.resource_data&&(r.resource_data=k.resource_data),m(),(E=n.onSubmitSuccess)==null||E.call(n)):([...s.value].forEach(T=>{const $=k.errors[T[0]];$&&T[1].setupBackendErrors($)}),(N=n.onSubmitFail)==null||N.call(n)),u.value=!1}function S(){const b={};return[...s.value].forEach(k=>{b[k[0]]=k[1].getValueDeserialized()}),b}function y(){let b=!0;return s.value.forEach(k=>{if(!k.validate()){b=!1;return}}),b}function m(){s.value.forEach(b=>{b.reset()})}function C(){s.value.forEach(b=>{b.clear()})}function g(){s.value.forEach(b=>{b.resetValidation()})}function B(){s.value.forEach(b=>{b.setupBackendErrors([])})}function O(b,k){s.value.set(b,k)}function p(b){if(r)return r.resource_data[b]}function D(b){const k=[...s.value].find(N=>N[0]===b);return k?k[1].getValueSerialized():null}function w(){return a}function z(){return e.unref(l.value)}function We(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function Je(){["getMetadataAndData","resourceName"].forEach(k=>{(n[k]===null||n[k]===void 0)&&console.warn(`Missing props for <Submit64> -> ${k}`)})}function Ke(){return c.value}return t({getMode:Ke,getFormFactoryInstance:w,getForm:z,validateForm:y,resetForm:m,clearForm:C,resetValidation:g,submitForm:F}),e.onMounted(async()=>{Je(),await h()}),(b,k)=>f.value&&l.value?(e.openBlock(),e.createElementBlock("div",je,[e.createElementVNode("div",{class:e.normalizeClass(l.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.sections,(N,E)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(a).sectionComponent),{key:E,section:N,context:n.context,"functions-provider":i},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.fields,T=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:T.metadata.field_name},[b.$slots[T.metadata.field_name]?(e.openBlock(),e.createBlock(L,{key:1,field:T,context:n.context,"functions-provider":i},{default:e.withCtx($=>[e.renderSlot(b.$slots,"default",e.mergeProps({ref_for:!0},$))]),_:3},8,["field","context"])):(e.openBlock(),e.createBlock(L,{key:0,field:T,context:n.context,"functions-provider":i},null,8,["field","context"]))],64))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(a).actionComponent),{isLoadingSubmit:u.value,submit:F,clear:l.value.clearable?C:void 0,reset:l.value.resetable?m:void 0,"functions-provider":i},null,8,["isLoadingSubmit","clear","reset"])),b.$slots.more_actions?e.renderSlot(b.$slots,"more_actions",{key:0,propsForm:{generatedForm:l.value}}):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)}});_.Submit64=x,_.Submit64Form=Ye,Object.defineProperty(_,Symbol.toStringTag,{value:"Module"})});
