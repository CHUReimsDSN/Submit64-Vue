(function(C,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(C=typeof globalThis<"u"?globalThis:C||self,e(C["submit64-vue"]={},C.Vue,C.Quasar))})(this,function(C,e,c){"use strict";var Pe=Object.defineProperty;var Ae=(C,e,c)=>e in C?Pe(C,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):C[e]=c;var S=(C,e,c)=>Ae(C,typeof e!="symbol"?e+"":e,c);const q={class:"flex row items-center no-wrap q-pt-sm"},z=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},reset:{type:Function},clear:{type:Function},submit:{type:Function}},setup(n){const t=n;return(r,o)=>(e.openBlock(),e.createElementBlock("div",q,[e.createVNode(e.unref(c.QBtn),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:o[0]||(o[0]=s=>t.submit())},null,8,["loading"]),t.reset?(e.openBlock(),e.createBlock(e.unref(c.QBtn),{key:0,loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:o[1]||(o[1]=s=>t.reset())},null,8,["loading"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(c.QBtn),{key:1,loading:t.isLoadingSubmit,label:"Vider",onClick:o[2]||(o[2]=s=>t.clear())},null,8,["loading"])):e.createCommentVNode("",!0)]))}}),L={class:"flex row items-center"},Q={class:"text-body1 text-weight-medium"},G={class:"flex column q-gutter-sm"},U=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{}},setup(n){const t=n;return(r,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",t.section.cssClass])},[e.createElementVNode("div",L,[t.section.icon?(e.openBlock(),e.createBlock(e.unref(c.QIcon),{key:0,name:t.section.icon,size:"sm"},null,8,["name"])):e.createCommentVNode("",!0),e.createElementVNode("div",Q,e.toDisplayString(t.section.label),1)]),e.createElementVNode("div",G,[e.renderSlot(r.$slots,"default")])],2))}}),P=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(n){const t=n;return(r,o)=>{const s=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(s,{name:"reset",class:"cursor-pointer",onClick:o[0]||(o[0]=a=>t.reset())})}}}),T=class T{constructor(){S(this,"_formSettings");S(this,"_formStyleConfig");S(this,"_actionComponent");S(this,"_sectionComponent");S(this,"_wrapperResetComponent");S(this,"_associationDisplayDictonary");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY:HHmm",renderBackendHint:!0},this._formStyleConfig={fieldOutlined:!0,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=z,this._sectionComponent=U,this._wrapperResetComponent=P,this._associationDisplayDictonary={}}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyleSetting(t){this._instance._formStyleConfig={...this._instance._formStyleConfig,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayDictonary(t){this._instance._associationDisplayDictonary=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyleConfig(){return this._instance._formStyleConfig}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayDictonary(){return this._instance._associationDisplayDictonary}};S(T,"_instance",new T);let _=T;const E=e.defineComponent({__name:"RegularField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.injectForm.getFormFactoryInstance(),o=r.formSettings,s=r.formStyleConfig,a=o.rulesBehaviour==="lazy";return(u,l)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[l[0]||(l[0]=d=>t.wrapper.modelValue=d),l[1]||(l[1]=d=>t.wrapper.modelValueOnUpdate(d))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(s).fieldOutlined,filled:e.unref(s).fieldFilled,standout:e.unref(s).fieldStandout,borderless:e.unref(s).fieldBorderless,rounded:e.unref(s).fieldRounded,square:e.unref(s).fieldSquare,dense:e.unref(s).fieldDense,hideBottomSpace:e.unref(s).fieldHideBottomSpace,color:e.unref(s).fieldColor,bgColor:e.unref(s).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":a,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,autogrow:!0,rules:t.wrapper.rules,onClear:t.wrapper.clear},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","onClear"]))}}),A={class:"row items-center justify-end"},H=e.defineComponent({__name:"DateField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.injectForm.getFormFactoryInstance(),o=r.formSettings,s=r.formStyleConfig,a=o.rulesBehaviour==="lazy",u=e.ref();function l(){u.value&&u.value.hide()}return(d,p)=>(e.openBlock(),e.createBlock(e.unref(c.QInput),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[p[2]||(p[2]=i=>t.wrapper.modelValue=i),p[3]||(p[3]=i=>t.wrapper.modelValueOnUpdate(i))],label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(s).fieldOutlined,filled:e.unref(s).fieldFilled,standout:e.unref(s).fieldStandout,borderless:e.unref(s).fieldBorderless,rounded:e.unref(s).fieldRounded,square:e.unref(s).fieldSquare,dense:e.unref(s).fieldDense,hideBottomSpace:e.unref(s).fieldHideBottomSpace,color:e.unref(s).fieldColor,bgColor:e.unref(s).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":a,readonly:t.wrapper.field.readonly,clearable:t.wrapper.field.clearable,rules:t.wrapper.rules,onClear:t.wrapper.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(c.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QPopupProxy),{ref_key:"popupProxyRef",ref:u,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(c.QDate),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[p[0]||(p[0]=i=>t.wrapper.modelValue=i),p[1]||(p[1]=i=>t.wrapper.modelValueOnUpdate(i))],mask:e.unref(r).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",A,[e.createVNode(e.unref(c.QBtn),{onClick:l,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["modelValue","mask"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","readonly","clearable","rules","onClear"]))}}),Y={key:0,class:"q-field__bottom"},W={key:1,class:"q-field--error q-field__bottom text-negative"},K=e.defineComponent({__name:"CheckboxField",props:{wrapper:{}},setup(n){const t=n,r=e.ref(!0),s=t.wrapper.injectForm.getFormFactoryInstance().formStyleConfig;function a(u){t.wrapper.modelValueOnUpdate(u)}return e.watch(()=>t.wrapper.modelValue,()=>{r.value=t.wrapper.validate()}),(u,l)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createVNode(e.unref(c.QCheckbox),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[l[0]||(l[0]=d=>t.wrapper.modelValue=d),l[1]||(l[1]=d=>a(d))],label:t.wrapper.field.label,dense:e.unref(s).fieldDense,color:e.unref(s).fieldColor,"aria-readonly":t.wrapper.field.readonly,class:e.normalizeClass(t.wrapper.field.cssClass)},null,8,["modelValue","label","dense","color","aria-readonly","class"]),t.wrapper.field.hint?(e.openBlock(),e.createElementBlock("div",Y,e.toDisplayString(t.wrapper.field.hint),1)):e.createCommentVNode("",!0),r.value!==!0?(e.openBlock(),e.createElementBlock("div",W,e.toDisplayString(r.value),1)):e.createCommentVNode("",!0)],64))}}),M=e.defineComponent({__name:"ObjectField",props:{wrapper:{}},setup(n){const r=n.wrapper.injectForm.getFormFactoryInstance(),o=r.formSettings;return r.formStyleConfig,o.rulesBehaviour,(s,a)=>" TODO json edit ? "}}),J=e.defineComponent({__name:"SelectField",props:{wrapper:{}},setup(n){const t=n,r=e.ref([]),o=e.ref([]),s=t.wrapper.injectForm.getFormFactoryInstance(),a=s.formSettings,u=s.formStyleConfig,l=a.rulesBehaviour==="lazy";function d(i,b){if(i===""){b(()=>{o.value=[...r.value]});return}b(()=>{const f=i.toLowerCase();o.value=r.value.filter(m=>m.label.toLowerCase().includes(f))})}function p(i){r.value=Object.freeze(i.field.selectOptions??[]),o.value=i.field.selectOptions??[]}return e.onMounted(()=>{p(t.wrapper)}),(i,b)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[b[0]||(b[0]=f=>t.wrapper.modelValue=f),b[1]||(b[1]=f=>t.wrapper.modelValueOnUpdate(f))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(u).fieldOutlined,filled:e.unref(u).fieldFilled,standout:e.unref(u).fieldStandout,borderless:e.unref(u).fieldBorderless,rounded:e.unref(u).fieldRounded,square:e.unref(u).fieldSquare,dense:e.unref(u).fieldDense,hideBottomSpace:e.unref(u).fieldHideBottomSpace,color:e.unref(u).fieldColor,bgColor:e.unref(u).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":l,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:o.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.wrapper.clear,onFilter:d},null,8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","options","onClear"]))}});function X(n){return Symbol(n)}function N(){return 20}const Z=e.defineComponent({__name:"SelectBelongsToField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.field.componentOptions.associationDisplayComponent,o=t.wrapper.injectForm.getFormFactoryInstance(),s=o.formSettings,a=o.formStyleConfig,u=s.rulesBehaviour==="lazy",l=e.ref([]),d=e.ref({limit:N(),offset:0});function p(b,f){const m=t.wrapper.injectForm.getAssociationDataCallback();b===""&&(d.value={limit:N(),offset:0}),f(()=>{m({resourceName:t.wrapper.injectForm.getForm().resourceName,associationName:t.wrapper.field.metadata.field_association_name,limit:d.value.limit,offset:d.value.offset,labelFilter:b,context:t.wrapper.injectForm.getForm().context}).then(w=>{l.value=w.rows})})}function i(){setTimeout(()=>{l.value=[{label:t.wrapper.field.defaultDisplayValue??String(t.wrapper.getValue()),value:t.wrapper.getValue()}]},0)}return e.onMounted(()=>{i()}),(b,f)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[f[0]||(f[0]=m=>t.wrapper.modelValue=m),f[1]||(f[1]=m=>t.wrapper.modelValueOnUpdate(m))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(a).fieldOutlined,filled:e.unref(a).fieldFilled,standout:e.unref(a).fieldStandout,borderless:e.unref(a).fieldBorderless,rounded:e.unref(a).fieldRounded,square:e.unref(a).fieldSquare,dense:e.unref(a).fieldDense,hideBottomSpace:e.unref(a).fieldHideBottomSpace,color:e.unref(a).fieldColor,bgColor:e.unref(a).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":u,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.wrapper.clear,onFilter:p},{options:e.withCtx(m=>[e.unref(r)?(e.openBlock(),e.createBlock(e.unref(c.QItem),e.normalizeProps(e.mergeProps({key:0},m.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),{key:1,scope:m},null,8,["scope"]))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","options","onClear"]))}}),v=e.defineComponent({__name:"SelectHasManyField",props:{wrapper:{}},setup(n){const t=n,r=t.wrapper.field.componentOptions.associationDisplayComponent,o=t.wrapper.injectForm.getFormFactoryInstance(),s=o.formSettings,a=o.formStyleConfig,u=s.rulesBehaviour==="lazy",l=e.ref([]),d=e.ref({limit:N(),offset:0});function p(b,f){const m=t.wrapper.injectForm.getAssociationDataCallback();b===""&&(d.value={limit:N(),offset:0}),f(()=>{m({resourceName:t.wrapper.injectForm.getForm().resourceName,associationName:t.wrapper.field.metadata.field_association_name,limit:d.value.limit,offset:d.value.offset,labelFilter:b,context:t.wrapper.injectForm.getForm().context}).then(w=>{l.value=w.rows})})}function i(){setTimeout(()=>{l.value=[{label:t.wrapper.field.defaultDisplayValue??String(t.wrapper.getValue()),value:t.wrapper.getValue()}]},0)}return e.onMounted(()=>{i()}),(b,f)=>(e.openBlock(),e.createBlock(e.unref(c.QSelect),{modelValue:t.wrapper.modelValue,"onUpdate:modelValue":[f[0]||(f[0]=m=>t.wrapper.modelValue=m),f[1]||(f[1]=m=>t.wrapper.modelValueOnUpdate(m))],type:t.wrapper.field.componentOptions.regularFieldType,label:t.wrapper.field.label,hint:t.wrapper.field.hint,outlined:e.unref(a).fieldOutlined,filled:e.unref(a).fieldFilled,standout:e.unref(a).fieldStandout,borderless:e.unref(a).fieldBorderless,rounded:e.unref(a).fieldRounded,square:e.unref(a).fieldSquare,dense:e.unref(a).fieldDense,hideBottomSpace:e.unref(a).fieldHideBottomSpace,color:e.unref(a).fieldColor,bgColor:e.unref(a).fieldBgColor,class:e.normalizeClass(t.wrapper.field.cssClass),"lazy-rules":u,clearable:t.wrapper.field.clearable,readonly:t.wrapper.field.readonly,rules:t.wrapper.rules,options:l.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.wrapper.clear,onFilter:p},{options:e.withCtx(m=>[e.unref(r)?(e.openBlock(),e.createBlock(e.unref(c.QItem),e.normalizeProps(e.mergeProps({key:0},m.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(c.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r)),{key:1,scope:m},null,8,["scope"]))]),_:1},8,["modelValue","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","readonly","rules","options","onClear"]))}});class ${constructor(t,r,o,s,a,u,l){S(this,"resourceName");S(this,"formSettings");S(this,"formStyleConfig");S(this,"actionComponent");S(this,"sectionComponent");S(this,"wrapperResetComponent");S(this,"associationDisplayDictionary");this.resourceName=t,this.formSettings={..._.getGlobalFormSetting(),...r},this.formStyleConfig={..._.getGlobalFormStyleConfig(),...o},this.actionComponent=s??_.getGlobalActionComponent(),this.sectionComponent=a??_.getGlobalSectionComponent(),this.wrapperResetComponent=u??_.getGlobalWrapperResetComponent(),this.associationDisplayDictionary=l??_.getGlobalAssociationDisplayDictonary()}static getFieldComponentByFormFieldType(t){return{string:E,text:E,number:E,date:H,selectString:J,selectBelongsTo:Z,selectHasMany:v,checkbox:K,object:M}[t]}getForm(t,r,o){const s=[];return t.form.sections.forEach(u=>{const l=[];u.fields.forEach(p=>{const i=$.getFieldComponentByFormFieldType(p.field_type),b={associationDisplayComponent:this.getAssociationDisplayComponentByResourceName(t.form.resource_name),regularFieldType:this.getRegularFieldTypeByFieldType(p.field_type)},f={type:p.field_type,metadata:p,label:p.label,hint:p.hint,cssClass:p.css_class,selectOptions:p.select_options,rules:p.rules,clearable:t.form.clearable,provideUniqKey:r,defaultDisplayValue:p.default_display_value,component:i,componentOptions:b};l.push(f)});const d={label:u.label,icon:u.icon,cssClass:u.css_class,fields:l};s.push(d)}),{sections:s,resourceName:t.form.resource_name,cssClass:t.form.css_class,resetable:t.form.resetable,clearable:t.form.clearable,backendDateFormat:t.form.backend_date_format,backendDatetimeFormat:t.form.backend_datetime_format,hasGlobalCustomValidation:t.form.has_global_custom_validation??!1,context:o}}getAssociationDisplayComponentByResourceName(t){return this.associationDisplayDictionary[t]}getRegularFieldTypeByFieldType(t){return{number:"number",text:"textarea"}[t]||void 0}}function ee(n,t,r){const o=r.getFormFactoryInstance().formSettings,s=r.getForm(),a=(p,i,b)=>p[i]?b?()=>u(p[i]):()=>p[i]:p.compare_to?()=>r.getFieldDataByFieldName(p.compare_to)??"Submit64 error : missing comparator definition":()=>"",u=p=>String(c.date.formatDate(c.date.extractDate(p,s.backendDateFormat),o.dateFormat)),l=[],d=[];switch(t){case"date":l.push(Ee(o.dateFormat))}return n.forEach(p=>{const i=p;switch(i.type){case"required":l.push(te());break;case"absence":l.push(ne());break;case"acceptance":l.push(oe());break;case"inclusion":l.push(I(i.including));break;case"exclusion":l.push(re(i.excluding));break;case"backend":break;case"allowNull":d.push("allowNull");break;case"allowBlank":d.push("allowBlank");break;case"positiveNumber":l.push(se());break;case"lessThanOrEqualNumber":l.push(ie(a(i,"less_than")));break;case"lessThanNumber":l.push(ce(a(i,"less_than")));break;case"greaterThanOrEqualNumber":l.push(ue(a(i,"greater_than")));break;case"greaterThanNumber":l.push(pe(a(i,"greater_than")));break;case"equalToNumber":l.push(de(a(i,"equal_to")));break;case"otherThanNumber":l.push(me(a(i,"other_than")));break;case"numberIntegerOnly":l.push(fe());break;case"numberNumericOnly":l.push(ge());break;case"numberEvenOnly":l.push(be());break;case"numberOddOnly":l.push(he());break;case"lessThanOrEqualStringLength":l.push(ye(a(i,"less_than")));break;case"lessThanStringLength":l.push(Ce(a(i,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(Se(a(i,"greater_than")));break;case"greaterThanStringLength":l.push(_e(a(i,"greater_than")));break;case"equalToStringLength":l.push(Fe(a(i,"equal_to")));break;case"equalToString":l.push(we(a(i,"equal_to")));break;case"betweenStringLength":l.push(ke(()=>i.min,()=>i.max));break;case"otherThanString":l.push(Be(a(i,"other_than")));break;case"lessThanOrEqualDate":l.push(De(a(i,"less_than",!0),o.dateFormat));break;case"lessThanDate":l.push(Ve(a(i,"less_than",!0),o.dateFormat));break;case"greaterThanOrEqualDate":l.push(Ne(a(i,"greater_than",!0),o.dateFormat));break;case"greaterThanDate":l.push(Te(a(i,"greater_than",!0),o.dateFormat));break;case"equalToDate":l.push(xe(a(i,"equal_to",!0),o.dateFormat));break;case"otherThanDate":l.push(Oe(a(i,"other_than",!0),o.dateFormat));break}}),d.length>0?d.map(p=>{switch(p){case"allowBlank":return le(l);case"allowNull":return ae(l)}}):l}function te(){return n=>!!n||"Ce champ est requis"}function I(n){return t=>n.includes(String(t))||`Doit être contenu dans ${n.toString()}`}function re(n){return t=>!n.includes(String(t)||`Ne doit pas être contenu dans ${I.toString()}`)}function ne(){return n=>!n||"Ce champ doit être vide"}function oe(){return n=>!!n||"Doit être accepté"}function ae(n){return t=>(t===null||n.forEach(r=>{const o=r(t);if(o!==!0)return o}),!0)}function le(n){return t=>(t===""||n.forEach(r=>{const o=r(t);if(o!==!0)return o}),!0)}function se(){return n=>Number(n)>0||"Val. positive uniquement"}function ie(n){return t=>{const r=n();return Number(t)<=r||`Inf. ou égal à ${r}`}}function ce(n){return t=>{const r=n();return Number(t)<r||`Inf. ${r}`}}function ue(n){return t=>{const r=n();return Number(t)>=r||`Sup. ou égal à ${r}`}}function pe(n){return t=>{const r=n();return Number(t)>r||`Sup. à ${r}`}}function de(n,t){return r=>{const o=n();return Number(r)===o||`Égale à ${o}`}}function me(n,t){return r=>{const o=n();return Number(r)!==o||`Doit être différent de ${n}`}}function fe(){return n=>/^-?\d+$/.test(String(n).trim())||"Nombre entier uniquement"}function ge(){return n=>/^-?\d+(\.\d+)?$/.test(String(n).trim())||"Caractère numérique uniquement"}function be(){return n=>Number.isInteger(Number(n))&&Number(n)%2===0||"Nombre pair uniquement"}function he(){return n=>Number.isInteger(Number(n))&&Number(n)%2===1||"Nombre impair uniquement"}function ye(n){return t=>{const r=n();return String(t).length<=r||`Inf. ou égal à ${r}`}}function Ce(n){return t=>{const r=n();return String(t).length<r||`Inf. à ${r}`}}function Se(n){return t=>{const r=n();return String(t).length>=r||`Sup. ou égal à ${r}`}}function _e(n){return t=>{const r=n();return String(t).length>r||`Sup. à ${r}`}}function ke(n,t){return r=>{const o=n(),s=t();return String(r).length>=o&&String(r).length<=s||`Entre ${o} et ${s}`}}function we(n,t){return r=>{const o=n();return String(r)===o||`Égale à ${o}`}}function Fe(n){return t=>{const r=n();return String(t).length===r||`Doit contenir ${r} caractères`}}function Be(n){return t=>{const r=n();return String(t)!==r||`Doit être différent de ${r}`}}function De(n,t){return r=>{const o=n(),s=c.date.extractDate(String(r),t),a=c.date.extractDate(o,t);return!Number.isNaN(s.getTime())&&s<=a||`Inf. ou égal à ${o}`}}function Ve(n,t){return r=>{const o=n(),s=c.date.extractDate(String(r),t),a=c.date.extractDate(o,t);return!Number.isNaN(s.getTime())&&s<a||`Inf. à ${o}`}}function Ne(n,t){return r=>{const o=n(),s=c.date.extractDate(String(r),t),a=c.date.extractDate(o,t);return!Number.isNaN(s.getTime())&&s>=a||`Sup. ou égal à ${o}`}}function Te(n,t){return r=>{const o=n(),s=c.date.extractDate(String(r),t),a=c.date.extractDate(o,t);return!Number.isNaN(s.getTime())&&s>a||`Sup. à ${o}`}}function xe(n,t){return r=>{const o=n(),s=c.date.extractDate(String(r),t),a=c.date.extractDate(o,t);return s===a||`Égale à ${s}`}}function Oe(n,t){return r=>{const o=n();return c.date.extractDate(String(r),t)!==c.date.extractDate(o,t)||`Doit être différent de ${o}`}}function Ee(n){return t=>!Number.isNaN(c.date.extractDate(String(t),n).getTime())||"Date invalide"}const $e={computeServerRules:ee},Re={key:0,class:"q-field__bottom text-negative q-pt-none"},Ie=["index"],j=e.defineComponent({__name:"FieldWrapper",props:{field:{}},setup(n,{expose:t}){const r=n,o=e.inject(r.field.provideUniqKey),s=b(),a=e.ref(),u=e.ref([]);function l(){o&&(a.value=o.getDefaultDataByFieldName(r.field.metadata.field_name),a.value=d(a.value))}function d(h){switch(r.field.type){case"date":return c.date.formatDate(c.date.extractDate(String(h),o.getForm().backendDateFormat),o.getFormFactoryInstance().formSettings.dateFormat)}return h}function p(h){switch(r.field.type){case"date":return c.date.formatDate(c.date.extractDate(String(h),o.getFormFactoryInstance().formSettings.dateFormat),o.getForm().backendDateFormat)}return h}function i(){switch(r.field.type){case"string":a.value="";break;case"checkbox":a.value=!1;break;case"date":a.value="";break;case"number":a.value=0;break;case"selectString":a.value=null;break;case"text":a.value="";break;case"object":a.value={};break;case"selectBelongsTo":a.value=null;break;case"selectHasMany":a.value=null;break}}function b(){return $e.computeServerRules(r.field.rules??[],r.field.type,o)}function f(h){a.value=h}function m(){return p(e.unref(a))}function w(h){u.value=h}function D(){let h=!0;return s.forEach(F=>{const V=F(m());if(V!==!0){h=V;return}}),h}return t({reset:l,clear:i,validate:D,getValue:m,setupBackendErrors:w}),e.onMounted(()=>{var F;l();const h=(F=e.getCurrentInstance())==null?void 0:F.exposed;h&&o&&o.registerRef(r.field.metadata.field_name,h)}),(h,F)=>(e.openBlock(),e.createElementBlock("div",null,[e.renderSlot(h.$slots,"default",{propsWrapper:{modelValue:a.value,modelValueOnUpdate:f,field:h.field,injectForm:e.unref(o),rules:e.unref(s),reset:l,clear:i,getValue:m,validate:D}},()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(r.field.component),{wrapper:{modelValue:a.value,modelValueOnUpdate:f,field:h.field,injectForm:e.unref(o),rules:e.unref(s),reset:l,clear:i,getValue:m,validate:D}},null,8,["wrapper"])),u.value.length>0?(e.openBlock(),e.createElementBlock("div",Re,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(u.value,(V,R)=>(e.openBlock(),e.createElementBlock("div",{index:R,class:"flex column"},e.toDisplayString(V),9,Ie))),256))])):e.createCommentVNode("",!0)])]))}}),je={key:0,class:"flex column"},qe=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},onSubmitFail:{},onSubmitSuccess:{},context:{}},setup(n,{expose:t}){const r=n;let o=null;const s=Object.freeze(new $(r.resourceName,r.formSettings)),a=X(c.uid()),u=e.ref({}),l=e.ref(),d=e.ref(!1),p=e.ref(!1),i=e.ref("create");async function b(){o=await r.getMetadataAndData({resourceName:r.resourceName,resourceId:r.resourceId,context:r.context}),l.value=Object.freeze(s.getForm(o,a,r.context)),r.resourceId&&(i.value="edit"),d.value=!0}async function f(){var B,x;if(!w())return;p.value=!0,F();const g=m(),y=await r.getSubmitFormData({resourceName:r.resourceName,resourceId:r.resourceId,resourceData:g,context:r.context});y.success?(i.value==="create"&&(i.value="edit"),o&&y.resource_data&&(o.resource_data=y.resource_data),D(),(x=r.onSubmitSuccess)==null||x.call(r)):(Object.entries(u.value).forEach(k=>{const O=y.errors[k[0]];O&&k[1].setupBackendErrors(O)}),(B=r.onSubmitFail)==null||B.call(r)),p.value=!1}function m(){const g={};return Object.entries(u.value).forEach(y=>{g[y[0]]=y[1].getValue()}),g}function w(){let g=!0;return Object.values(u.value).forEach(y=>{if(y.validate()!==!0){g=!1;return}}),g}function D(){Object.values(u.value).forEach(g=>{g.reset()})}function h(){Object.values(u.value).forEach(g=>{g.clear()})}function F(){Object.values(u.value).forEach(g=>{g.setupBackendErrors([])})}function V(g,y){u.value[g]=y}function R(g){if(o)return o.resource_data[g]}function ze(g){const y=Object.entries(u.value).find(B=>B[0]===g);return y?y[1].getValue():null}function Le(){return s}function Qe(){return l.value}function Ge(){return r.getAssociationData??(async()=>({rows:[],row_count:0}))}function Ue(){["getMetadataAndData","getMetadataAndData","resourceName"].forEach(y=>{(r[y]===null||r[y]===void 0)&&console.warn(`Missing props for <Submit64> -> ${y}`)})}return e.provide(a,{registerRef:V,getDefaultDataByFieldName:R,getFieldDataByFieldName:ze,getFormFactoryInstance:Le,getForm:Qe,getAssociationDataCallback:Ge}),t({}),e.onMounted(async()=>{Ue(),await b()}),(g,y)=>d.value&&l.value?(e.openBlock(),e.createElementBlock("div",je,[e.createElementVNode("div",{class:e.normalizeClass(l.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.sections,(B,x)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(s).sectionComponent),{key:x,section:B},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.fields,k=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:k.metadata.field_name},[g.$slots[k.metadata.field_name]?(e.openBlock(),e.createBlock(j,{key:1,field:k},{default:e.withCtx(({propsWrapper:O})=>[e.renderSlot(g.$slots,k.metadata.field_name,{propsWrapper:O})]),_:2},1032,["field"])):(e.openBlock(),e.createBlock(j,{key:0,field:k},null,8,["field"]))],64))),128))]),_:2},1032,["section"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(s).actionComponent),{isLoadingSubmit:p.value,submit:f,clear:l.value.clearable?h:void 0,reset:l.value.resetable?D:void 0},null,8,["isLoadingSubmit","clear","reset"])),g.$slots.more_actions?e.renderSlot(g.$slots,"more_actions",{key:0,propsForm:{generatedForm:l.value}}):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)}});C.Submit64=_,C.Submit64Form=qe,Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})});
