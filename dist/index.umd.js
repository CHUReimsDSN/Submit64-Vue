(function(A,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(A=typeof globalThis<"u"?globalThis:A||self,e(A["submit64-vue"]={},A.Vue,A.Quasar))})(this,function(A,e,d){"use strict";var bt=Object.defineProperty;var Ft=(A,e,d)=>e in A?bt(A,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):A[e]=d;var b=(A,e,d)=>Ft(A,typeof e!="symbol"?e+"":e,d);const Z={class:"flex column"},v={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},ee=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{},submit:{type:Function},reset:{type:Function},clear:{type:Function}},setup(a){const t=a;function n(){const o=t.formApi.getForm().formStyle;return{outline:o.fieldOutlined,rounded:o.fieldRounded,square:o.fieldSquare,dense:o.fieldDense,color:o.fieldColor,noCaps:!0}}return(o,r)=>(e.openBlock(),e.createElementBlock("div",Z,[e.createElementVNode("div",v,[e.createVNode(e.unref(d.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.submit}),null,16,["loading","onClick"]),t.reset?(e.openBlock(),e.createBlock(e.unref(d.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(d.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Vider",onClick:t.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),te={class:"flex row items-center"},ne={class:"text-body1 text-weight-medium"},oe={class:"flex column q-gutter-md"},re=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{},formApi:{},sectionApi:{}},setup(a){const t=a,n=t.formApi.getForm().formStyle;return(o,r)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",te,[t.section.icon?(e.openBlock(),e.createBlock(e.unref(d.QIcon),{key:0,name:t.section.icon,size:"sm",color:e.unref(n).fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",ne,e.toDisplayString(t.section.label),1)]),e.createElementVNode("div",oe,[e.renderSlot(o.$slots,"default")])]))}}),ae=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,o)=>{const r=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(r,{name:"reset",class:"cursor-pointer",onClick:o[0]||(o[0]=i=>t.reset())})}}}),ie=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,o)=>(e.openBlock(),e.createBlock(e.unref(d.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),le={class:"flex column"},se=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{},privateFormApi:{}},setup(a){const t=a;return(n,o)=>(e.openBlock(),e.createElementBlock("div",le,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(r,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(i)+" : "+e.toDisplayString(r.join(",")),1))),128))]))}}),Q=class Q{constructor(){b(this,"_formSettings");b(this,"_formStyle");b(this,"_actionComponent");b(this,"_orphanErrorsComponent");b(this,"_sectionComponent");b(this,"_wrapperResetComponent");b(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=ee,this._orphanErrorsComponent=se,this._sectionComponent=re,this._wrapperResetComponent=ae,this._associationDisplayComponent=ie}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};b(Q,"_instance",new Q);let E=Q;const ce={class:"row items-center justify-end"},de=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.getForm(),o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",l=e.ref(),s=e.ref();function f(){l.value&&l.value.hide()}function c(){return s.value?s.value.validate():!1}function g(){return s.value?s.value.hasError:!1}function S(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,g,S)}),(C,_)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":_[1]||(_[1]=V=>t.modelValueOnUpdate(V)),label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"popupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=V=>t.modelValueOnUpdate(V)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",ce,[e.createVNode(e.unref(d.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),fe={class:"row items-center justify-end"},ue={class:"row items-center justify-end"},me=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.getForm(),o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",l=e.ref(),s=e.ref(),f=e.ref();function c(){l.value&&l.value.hide()}function g(){s.value&&s.value.hide()}function S(){return f.value?f.value.validate():!1}function C(){return f.value?f.value.hasError:!1}function _(){f.value&&f.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(S,C,_)}),(V,p)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":p[2]||(p[2]=m=>t.modelValueOnUpdate(m)),label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"datePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":p[0]||(p[0]=m=>t.modelValueOnUpdate(m)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",fe,[e.createVNode(e.unref(d.QBtn),{onClick:c,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"timePopupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":p[1]||(p[1]=m=>t.modelValueOnUpdate(m)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",ue,[e.createVNode(e.unref(d.QBtn),{onClick:g,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),pe={class:"flex column"},he={key:0,class:"q-field__bottom"},ge={key:1,class:"q-field--error q-field__bottom text-negative"},ye=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),r=t.formApi.getForm().formStyle;function i(){return n.value===!0}function l(){return n.value===!0}function s(){n.value=!0}return e.watch(()=>t.modelValue,f=>{for(const c of t.rules)if(n.value=c(f),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(i,l,s)}),(f,c)=>(e.openBlock(),e.createElementBlock("div",pe,[e.createVNode(e.unref(d.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":c[0]||(c[0]=g=>t.modelValueOnUpdate(g)),label:t.field.label,dense:e.unref(r).fieldDense,color:e.unref(r).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",he,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",ge,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Ce=e.defineComponent({__name:"ObjectField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.getFormFactoryInstance(),o=n.formSettings;return n.formStyle,o.rulesBehaviour,(r,i)=>" TODO json edit ? "}}),be=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),o=e.ref([]),r=e.ref(),i=t.formApi.getForm(),l=i.formSettings,s=i.formStyle,f=l.rulesBehaviour==="lazy";function c(p,m){if(p===""){m(()=>{o.value=[...n.value]});return}m(()=>{const F=p.toLowerCase();o.value=n.value.filter(k=>k.label.toLowerCase().includes(F))})}function g(){n.value=Object.freeze(t.field.staticSelectOptions??[]),o.value=t.field.staticSelectOptions??[]}function S(){return r.value?r.value.validate():!1}function C(){return r.value?r.value.hasError:!1}function _(){r.value&&r.value.resetValidation()}function V(){t.clear(),o.value=[]}return e.onMounted(()=>{g(),t.registerBehaviourCallbacks(S,C,_)}),(p,m)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:r,"model-value":t.modelValue,"onUpdate:modelValue":m[0]||(m[0]=F=>t.modelValueOnUpdate(F)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(s).fieldOutlined,filled:e.unref(s).fieldFilled,standout:e.unref(s).fieldStandout,borderless:e.unref(s).fieldBorderless,rounded:e.unref(s).fieldRounded,square:e.unref(s).fieldSquare,dense:e.unref(s).fieldDense,hideBottomSpace:e.unref(s).fieldHideBottomSpace,color:e.unref(s).fieldColor,bgColor:e.unref(s).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:o.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:V,onFilter:c},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}});function P(){return 20}function Y(a){return Object.keys(a).forEach(t=>{const n=a[t];n&&typeof n=="object"&&Y(n)}),Object.freeze(a)}function B(a){a==null||a.forEach(t=>{t()})}const Fe=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,o=t.formApi.getForm(),r=o.formSettings,i=o.formStyle,l=r.rulesBehaviour==="lazy",s=e.ref([]),f=e.ref({limit:P(),offset:0}),c=e.ref();function g(m,F){const k=t.privateFormApi.getAssociationDataCallback();m===""&&(f.value={limit:P(),offset:0}),F(()=>{const N=t.formApi.getForm();k({resourceName:N.resourceName,resourceId:N.resourceId,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:m,context:N.context}).then(T=>{s.value=T.rows}).catch(()=>{s.value=[]})})}function S(){e.nextTick(()=>{const m=t.getValueSerialized();!m||!t.field.associationData||(s.value=[{label:t.field.associationData.label[0]??"???",value:m,data:t.field.associationData.data[0]}])})}function C(){return c.value?c.value.validate():!1}function _(){return c.value?c.value.hasError:!1}function V(){c.value&&c.value.resetValidation()}function p(){t.clear(),s.value=[]}return e.onMounted(()=>{S(),t.registerBehaviourCallbacks(C,_,V)}),(m,F)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=k=>t.modelValueOnUpdate(k)),type:t.field.componentOptions.regularFieldType,label:t.field.label,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:s.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:p,onFilter:g},{option:e.withCtx(k=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:k.opt,itemProps:k.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","type","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),Se=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,o=t.formApi.getForm(),r=o.formSettings,i=o.formStyle,l=r.rulesBehaviour==="lazy",s=e.ref([]),f=e.ref({limit:P(),offset:0}),c=e.ref();function g(m,F){const k=t.privateFormApi.getAssociationDataCallback();m===""&&(f.value={limit:P(),offset:0}),F(()=>{const N=t.formApi.getForm();k({resourceName:N.resourceName,resourceId:N.resourceId,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:m,context:N.context}).then(T=>{s.value=T.rows}).catch(()=>{s.value=[]})})}function S(){e.nextTick(()=>{const m=t.getValueSerialized();!m||!t.field.associationData||(s.value=m.map((F,k)=>({label:t.field.associationData.label[k]??"???",value:F,data:t.field.associationData.data[k]})))})}function C(){return c.value?c.value.validate():!1}function _(){return c.value?c.value.hasError:!1}function V(){c.value&&c.value.resetValidation()}function p(){t.clear(),s.value=[]}return e.onMounted(()=>{S(),t.registerBehaviourCallbacks(C,_,V)}),(m,F)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=k=>t.modelValueOnUpdate(k)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:s.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:p,onFilter:g},{option:e.withCtx(k=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:k.opt,itemProps:k.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),J=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.getForm(),o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",l=e.ref();function s(){return l.value?l.value.validate():!1}function f(){return l.value?l.value.hasError:!1}function c(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,f,c)}),(g,S)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=C=>t.modelValueOnUpdate(C)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),ke=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},privateFormApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.getForm(),o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",l=e.ref();function s(){return l.value?l.value.validate():!1}function f(){return l.value?l.value.hasError:!1}function c(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,f,c)}),(g,S)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=C=>t.modelValueOnUpdate(C)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}});class L{constructor(t){b(this,"fullFormApi");b(this,"events",[]);this.fullFormApi=t}when(t,n){const o=new _e(this,this.fullFormApi),r=t,i=n,l=new Ve(r,i);return this.events.push(l),o}static create(t){return new L(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(o=>{const r=o.getTarget();switch(r.target){case"field":n.fields[r.target]||(n.fields[r.target]={}),n.fields[r.target][r.key]||(n.fields[r.target][r.key]=[]),n.fields[r.target][r.key].push(o.getActionCallback());break;case"section":n.sections[r.target]||(n.sections[r.target]={}),n.sections[r.target][r.key]||(n.sections[r.target][r.key]=[]),n.sections[r.target][r.key].push(o.getActionCallback());break;case"form":n.form[r.key]||(n.form[r.key]=[]),n.form[r.key].push(o.getActionCallback());break}}),n}}class _e{constructor(t,n){b(this,"logicBuilder");b(this,"fullFormApi");this.logicBuilder=t,this.fullFormApi=n}then(t,n){if(typeof t=="function")new q(this.fullFormApi,"Hide field",{fieldName:""},t);else{const o=t,r=n;new q(this.fullFormApi,o,r)}return new G(this.fullFormApi)}}class G{constructor(t){b(this,"fullFormApi");this.fullFormApi=t}then(t,n){if(typeof t=="function")new q(this.fullFormApi,"Hide field",{fieldName:""},t);else{const o=t,r=n;new q(this.fullFormApi,o,r)}return new G(this.fullFormApi)}}class Ve{constructor(t,n){b(this,"type");b(this,"data");b(this,"actions",[]);this.type=t,this.data=n}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field confirm statement":return{target:"field",targetName:this.data.fieldName,key:"onConfirmStatement"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){const t=this.actions.map(n=>n.generateEvent());return()=>{t.forEach(n=>{n()})}}}class q{constructor(t,n,o,r){b(this,"fullFormApi");b(this,"type");b(this,"data");b(this,"customCallback");b(this,"cyclicActionCalls",new Set);this.fullFormApi=t,this.type=n,this.data=o,this.customCallback=r}generateEvent(){const t=this.getEventCallback();return()=>{this.cyclicActionCalls.has(this.type)||(this.cyclicActionCalls.add(this.type),t(),this.cyclicActionCalls.clear())}}getEventCallback(){if(this.customCallback)return()=>{var t;(t=this.customCallback)==null||t.call(this,this.fullFormApi)};switch(this.type){case"Set field label":return this.setFieldLabel;case"Set field prefix":return this.setFieldPrefix;case"Set field suffix":return this.setFieldSuffix;case"Set field css class":return this.setFieldCssClass;case"Set field hint":return this.setFieldHint;case"Set field readonly state":return this.setFieldReadonlyState;case"Hide field":return this.hideField;case"Unhide field":return this.unhideField;case"Clear field":return this.clearField;case"Reset field":return this.resetField;case"Validate field":return this.validateField;case"Set section label":return this.setSectionLabel;case"Set section icon":return this.setSectionIcon;case"Set section css class":return this.setSectionCssClass;case"Set section readonly state":return this.setSectionReadonlyState;case"Hide section":return this.hideSection;case"Unhide section":return this.unHideSection;case"Clear section":return this.clearSection;case"Reset section":return this.resetSection;case"Validate section":return this.validateSection;case"Set form readonly state":return this.setFormReadonlyState;case"Set form css class":return this.setFormCssClass;case"Set form context":return this.setFormContext;case"Submit form":return this.submitForm;case"Clear form":return this.clearForm;case"Reset form":return this.resetForm;case"Validate form":return this.validateForm;default:return console.warn(`Submit64 -> unhandled builder action callback generation : ${this.type}`),()=>{}}}setFieldLabel(){var o;const t=this.data,n=(o=this.fullFormApi.getField(t.fieldName))==null?void 0:o.getDataRef();n&&(n.label=t.newLabel)}setFieldPrefix(){var o;const t=this.data,n=(o=this.fullFormApi.getField(t.fieldName))==null?void 0:o.getDataRef();n&&(n.prefix=t.newPrefix)}setFieldSuffix(){var o;const t=this.data,n=(o=this.fullFormApi.getField(t.fieldName))==null?void 0:o.getDataRef();n&&(n.suffix=t.newSuffix)}setFieldCssClass(){var o;const t=this.data,n=(o=this.fullFormApi.getField(t.fieldName))==null?void 0:o.getDataRef();n&&(n.cssClass=t.newCssClass)}setFieldHint(){var o;const t=this.data,n=(o=this.fullFormApi.getField(t.fieldName))==null?void 0:o.getDataRef();n&&(n.hint=t.newHint)}setFieldReadonlyState(){var o;const t=this.data,n=(o=this.fullFormApi.getField(t.fieldName))==null?void 0:o.getDataRef();n&&(n.readonly=t.newState)}hideField(){const t=this.data,n=this.fullFormApi.getField(t.fieldName);n&&n.hide()}unhideField(){const t=this.data,n=this.fullFormApi.getField(t.fieldName);n&&n.unhide()}clearField(){const t=this.data,n=this.fullFormApi.getField(t.fieldName);n&&n.clear()}resetField(){const t=this.data,n=this.fullFormApi.getField(t.fieldName);n&&n.reset()}validateField(){const t=this.data,n=this.fullFormApi.getField(t.fieldName);n&&n.validate()}setSectionLabel(){var o;const t=this.data,n=(o=this.fullFormApi.getSection(t.sectionName))==null?void 0:o.getDataRef();n&&(n.label=t.newLabel)}setSectionIcon(){var o;const t=this.data,n=(o=this.fullFormApi.getSection(t.sectionName))==null?void 0:o.getDataRef();n&&(n.icon=t.newIcon)}setSectionCssClass(){var o;const t=this.data,n=(o=this.fullFormApi.getSection(t.sectionName))==null?void 0:o.getDataRef();n&&(n.cssClass=t.newCssClass)}setSectionReadonlyState(){var o;const t=this.data,n=(o=this.fullFormApi.getSection(t.sectionName))==null?void 0:o.getDataRef();n&&(n.readonly=t.newState)}hideSection(){const t=this.data,n=this.fullFormApi.getSection(t.sectionName);n&&n.hide()}unHideSection(){const t=this.data,n=this.fullFormApi.getSection(t.sectionName);n&&n.unhide()}clearSection(){const t=this.data,n=this.fullFormApi.getSection(t.sectionName);n&&n.clear()}resetSection(){const t=this.data,n=this.fullFormApi.getSection(t.sectionName);n&&n.reset()}validateSection(){const t=this.data,n=this.fullFormApi.getSection(t.sectionName);n&&n.validate()}setFormReadonlyState(){const t=this.data,n=this.fullFormApi.getFormRef().value;n&&(n.readonly=t.newState)}setFormCssClass(){const t=this.data,n=this.fullFormApi.getFormRef().value;n&&(n.cssClass=t.newCssClass)}setFormContext(){const t=this.data,n=this.fullFormApi.getFormRef().value;n&&(n.context=t.newContext)}submitForm(){this.fullFormApi.submitForm()}clearForm(){this.fullFormApi.clearForm()}resetForm(){this.fullFormApi.resetForm()}validateForm(){this.fullFormApi.validateForm()}}class I{constructor(t,n,o,r,i,l,s,f,c){b(this,"resourceName");b(this,"resourceId");b(this,"formMetadataAndData");b(this,"context");b(this,"formSettings");b(this,"formStyle");b(this,"actionComponent");b(this,"orphanErrorsComponent");b(this,"sectionComponent");b(this,"wrapperResetComponent");b(this,"associationDisplayComponent");b(this,"dynamicComponentRecord");b(this,"fullFormApi");b(this,"registerEventCallback");this.dynamicComponentRecord=o.dynamicComponentRecord??{},this.formMetadataAndData=r,this.resourceId=n,this.context=s,this.resourceName=t,this.fullFormApi=f,this.formSettings={...i,...E.getGlobalFormSetting(),backendDateFormat:r.form.backend_date_format,backendDatetimeFormat:r.form.backend_datetime_format},this.formStyle={...l,...E.getGlobalFormStyle()},this.actionComponent=o.actionComponent??E.getGlobalActionComponent(),this.orphanErrorsComponent=o.orphanErrorsComponent??E.getGlobalOrphanErrorComponent(),this.sectionComponent=o.sectionComponent??E.getGlobalSectionComponent(),this.wrapperResetComponent=o.wrapperResetComponent??E.getGlobalWrapperResetComponent(),this.associationDisplayComponent=o.associationDisplayComponent??E.getGlobalAssociationDisplayComponent(),this.registerEventCallback=c??(()=>{})}static getForm(t,n,o,r,i,l,s,f,c){return new I(t,n,o,r,i,l,s,f,c).generateFormDef()}generateFormDef(){const t=L.create(this.fullFormApi);this.registerEventCallback(t);const n=L.getEventsObjectFromInstance(t),o=[];return this.formMetadataAndData.form.sections.forEach((i,l)=>{const s=[];i.fields.forEach(C=>{const _=this.dynamicComponentRecord[`field-${C.field_name}-before`],V=I.getFieldComponentByFormFieldType(C.field_type),p=this.dynamicComponentRecord[`field-${C.field_name}-after`],m={associationDisplayComponent:this.associationDisplayComponent,regularFieldType:I.getRegularFieldTypeByFieldType(C.field_type)},F={type:C.field_type,metadata:Object.freeze(C),label:C.label,hint:C.hint??void 0,prefix:C.prefix??void 0,suffix:C.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??i.readonly??C.readonly??void 0,cssClass:C.css_class??void 0,staticSelectOptions:C.static_select_options,associationData:C.field_association_data,rules:C.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:_,mainComponent:V,afterComponent:p,events:n.fields[C.field_name],componentOptions:m};s.push(F)});const f=this.dynamicComponentRecord[`section-${i.name??l}-before`],c=this.sectionComponent,g=this.dynamicComponentRecord[`section-${i.name??l}-after`],S={label:i.label??void 0,icon:i.icon??void 0,cssClass:i.css_class??void 0,hidden:!1,name:i.name??void 0,readonly:this.formMetadataAndData.form.readonly??i.readonly??void 0,events:n.sections[i.name??l.toString()],beforeComponent:f,mainComponent:c,afterComponent:g,fields:s};o.push(S)}),{sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,events:n.form,actionComponent:this.actionComponent,orphanErrorsComponent:this.orphanErrorsComponent,wrapperResetComponent:this.wrapperResetComponent,dynamicComponentRecord:this.dynamicComponentRecord,context:this.context}}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){return{string:J,text:J,number:ke,date:de,datetime:me,selectString:be,selectBelongsTo:Fe,selectHasMany:Se,checkbox:ye,object:Ce}[t]}}function xe(a,t,n){const o=n.getForm(),r=(f,c,g)=>f[c]?g?()=>i(f[c]):()=>f[c]:f.compare_to?()=>{var S;return((S=n.getField(f.compare_to))==null?void 0:S.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",i=f=>String(d.date.formatDate(d.date.extractDate(f,o.formSettings.backendDateFormat),o.formSettings.dateFormat)),l=[],s=[];switch(t){case"date":l.push(X(o.formSettings.dateFormat));break;case"datetime":l.push(X(o.formSettings.datetimeFormat));break}return a.forEach(f=>{const c=f;switch(c.type){case"required":l.push(Be());break;case"absence":l.push(Ae());break;case"acceptance":l.push(Ne());break;case"inclusion":l.push(K(c.including));break;case"exclusion":l.push(De(c.excluding));break;case"backend":break;case"allowNull":s.push("allowNull");break;case"allowBlank":s.push("allowBlank");break;case"positiveNumber":l.push(we());break;case"lessThanOrEqualNumber":l.push(Te(r(c,"less_than")));break;case"lessThanNumber":l.push(Oe(r(c,"less_than")));break;case"greaterThanOrEqualNumber":l.push(ze(r(c,"greater_than")));break;case"greaterThanNumber":l.push(Ie(r(c,"greater_than")));break;case"equalToNumber":l.push($e(r(c,"equal_to")));break;case"otherThanNumber":l.push(Ue(r(c,"other_than")));break;case"numberIntegerOnly":l.push(Pe());break;case"numberNumericOnly":l.push(Le());break;case"numberEvenOnly":l.push(qe());break;case"numberOddOnly":l.push(Qe());break;case"lessThanOrEqualStringLength":l.push(He(r(c,"less_than")));break;case"lessThanStringLength":l.push(Ge(r(c,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(je(r(c,"greater_than")));break;case"greaterThanStringLength":l.push(Me(r(c,"greater_than")));break;case"equalToStringLength":l.push(Je(r(c,"equal_to")));break;case"equalToString":l.push(Ye(r(c,"equal_to")));break;case"betweenStringLength":l.push(We(()=>c.min,()=>c.max));break;case"otherThanString":l.push(Ke(r(c,"other_than")));break;case"lessThanOrEqualDate":l.push(Xe(r(c,"less_than",!0),o.formSettings.dateFormat));break;case"lessThanDate":l.push(Ze(r(c,"less_than",!0),o.formSettings.dateFormat));break;case"greaterThanOrEqualDate":l.push(ve(r(c,"greater_than",!0),o.formSettings.dateFormat));break;case"greaterThanDate":l.push(et(r(c,"greater_than",!0),o.formSettings.dateFormat));break;case"equalToDate":l.push(tt(r(c,"equal_to",!0),o.formSettings.dateFormat));break;case"otherThanDate":l.push(nt(r(c,"other_than",!0),o.formSettings.dateFormat));break}}),s.length>0?s.map(f=>{switch(f){case"allowBlank":return Ee(l);case"allowNull":return Re(l)}}):l}function Be(){return a=>!!a||"Ce champ est requis"}function K(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function De(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${K.toString()}`)}function Ae(){return a=>!a||"Ce champ doit être vide"}function Ne(){return a=>!!a||"Doit être accepté"}function Re(a){return t=>(t===null||a.forEach(n=>{const o=n(t);if(o!==!0)return o}),!0)}function Ee(a){return t=>(t===""||a.forEach(n=>{const o=n(t);if(o!==!0)return o}),!0)}function we(){return a=>Number(a)>0||"Val. positive uniquement"}function Te(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function Oe(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function ze(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function Ie(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function $e(a,t){return n=>{const o=a();return Number(n)===o||`Égale à ${o}`}}function Ue(a,t){return n=>{const o=a();return Number(n)!==o||`Doit être différent de ${a}`}}function Pe(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function Le(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function qe(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function Qe(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function He(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function Ge(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function je(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function Me(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function We(a,t){return n=>{const o=a(),r=t();return String(n).length>=o&&String(n).length<=r||`Entre ${o} et ${r}`}}function Ye(a,t){return n=>{const o=a();return String(n)===o||`Égale à ${o}`}}function Je(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function Ke(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function Xe(a,t){return n=>{const o=a(),r=d.date.extractDate(String(n),t),i=d.date.extractDate(o,t);return r<=i||`Inf. ou égal à ${o}`}}function Ze(a,t){return n=>{const o=a(),r=d.date.extractDate(String(n),t),i=d.date.extractDate(o,t);return r<i||`Inf. à ${o}`}}function ve(a,t){return n=>{const o=a(),r=d.date.extractDate(String(n),t),i=d.date.extractDate(o,t);return r>=i||`Sup. ou égal à ${o}`}}function et(a,t){return n=>{const o=a(),r=d.date.extractDate(String(n),t),i=d.date.extractDate(o,t);return r>i||`Sup. à ${o}`}}function tt(a,t){return n=>{const o=a(),r=d.date.extractDate(String(n),t),i=d.date.extractDate(o,t);return r===i||`Égale à ${r}`}}function nt(a,t){return n=>{const o=a();return d.date.extractDate(String(n),t)!==d.date.extractDate(o,t)||`Doit être différent de ${o}`}}function X(a){return t=>t==null||t===""?!0:ot(t,a)||`Date invalide. Format : ${a}`}function ot(a,t){if(typeof a!="string"||!a.trim())return!1;const n=d.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:d.date.formatDate(n,t)===a}const rt={computeServerRules:xe},at={key:2,class:"q-field__bottom text-negative q-pt-none"},it=["index"],lt=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{},registerRef:{type:Function},context:{}},setup(a,{expose:t}){const n=a;let o=()=>!0,r=()=>!0,i=()=>{};const l=_(),s=e.ref(),f=e.ref([]);function c(){s.value=n.privateFormApi.getInitialValueByFieldName(n.field.metadata.field_name),s.value=g(s.value),B(n.field.events.onReset),e.nextTick(()=>{$()})}function g(h){const x=n.formApi.getForm();switch(n.field.type){case"checkbox":return h==null||h===""?!1:h;case"date":return h==null||h===""?null:d.date.formatDate(d.date.extractDate(String(h),x.formSettings.backendDateFormat),x.formSettings.dateFormat);case"datetime":return h==null||h===""?null:d.date.formatDate(d.date.extractDate(String(h),x.formSettings.backendDatetimeFormat),x.formSettings.datetimeFormat)}return h}function S(h){const x=n.formApi.getForm();switch(n.field.type){case"date":return h==null||h===""?null:d.date.formatDate(d.date.extractDate(String(h),x.formSettings.dateFormat),x.formSettings.backendDateFormat);case"datetime":return h==null||h===""?null:d.date.formatDate(d.date.extractDate(String(h),x.formSettings.datetimeFormat),x.formSettings.backendDatetimeFormat)}return h}function C(){switch(n.field.type){case"string":s.value="";break;case"checkbox":s.value=!1;break;case"date":s.value=null;break;case"datetime":s.value=null;break;case"number":s.value=null;break;case"selectString":s.value=void 0;break;case"text":s.value="";break;case"object":s.value={};break;case"selectBelongsTo":s.value=void 0;break;case"selectHasMany":s.value=void 0;break}B(n.field.events.onClear)}function _(){return rt.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function V(h){s.value=h}function p(){return e.unref(s)}function m(){return S(e.unref(s))}function F(h){f.value=h}function k(){}function N(){}function T(){const h=o();return B(n.field.events.onValidated),h}function z(){return r()}function $(){return i()}function j(){var h;return(h=n.privateFormApi.getFormRef().value)==null?void 0:h.sections.map(x=>x.fields).flat().find(x=>x.metadata.field_name===n.field.metadata.field_name)}function M(h,x,U){o=h,r=x,i=U}return t({reset:c,clear:C,validate:T,isValid:z,hide:k,unhide:N,resetValidation:$,getValueDeserialized:m,getValueSerialized:p,setupBackendErrors:F,getDataRef:j}),e.watch(()=>n.field.events.onUpdate?s.value:null,()=>{B(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid?z():null,h=>{h&&B(n.field.events.onIsValid)}),e.onMounted(()=>{var x;c();const h=(x=e.getCurrentInstance())==null?void 0:x.exposed;h&&n.formApi&&n.registerRef(n.field.metadata.field_name,h)}),(h,x)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(n.field.hidden?"submit64-field-hidden":"")},[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,field:n.field,formApi:n.formApi},null,8,["field","formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:s.value,field:n.field,formApi:n.formApi,rules:e.unref(l),reset:c,clear:C,getValueDeserialized:m,getValueSerialized:p,validate:T,modelValueOnUpdate:V,registerBehaviourCallbacks:M},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,field:n.field,formApi:n.formApi},null,8,["field","formApi"])):e.createCommentVNode("",!0),f.value.length>0?(e.openBlock(),e.createElementBlock("div",at,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,(U,W)=>(e.openBlock(),e.createElementBlock("div",{index:W,class:"flex column"},e.toDisplayString(U),9,it))),256))])):e.createCommentVNode("",!0)],2))}}),st=e.defineComponent({__name:"SectionWrapper",props:{section:{},sectionIndex:{},formApi:{},privateFormApi:{},registerRef:{type:Function},context:{}},setup(a,{expose:t}){const n=a,o=new Map,r={reset:l,clear:s,validate:g,isValid:S,hide:f,unhide:c,resetValidation:C,getDataRef:_,getFields:V};function i(){n.section.fields.forEach(p=>{const m=p.metadata.field_name,F=n.formApi.getField(m);F&&o.set(m,F)})}function l(){o.forEach(p=>{p.reset()}),B(n.section.events.onReset)}function s(){o.forEach(p=>{p.clear()}),B(n.section.events.onClear)}function f(){var m;const p=(m=n.privateFormApi.getFormRef().value)==null?void 0:m.sections.find(F=>F.name===n.section.name||F.name===n.sectionIndex.toString());p&&(o.forEach(F=>{F.hide()}),p.hidden=!0,B(n.section.events.onHide))}function c(){var m;const p=(m=n.privateFormApi.getFormRef().value)==null?void 0:m.sections.find(F=>F.name===n.section.name||F.name===n.sectionIndex.toString());p&&(o.forEach(F=>{F.unhide()}),p.hidden=!1,B(n.section.events.onUnhide))}function g(){let p=!0;return o.forEach(m=>{if(!m.validate()){p=!1;return}}),B(n.section.events.onValidated),p}function S(){let p=!0;return o.forEach(m=>{if(!m.isValid()){p=!1;return}}),p}function C(){o.forEach(p=>{p.resetValidation()})}function _(){var p;return(p=n.privateFormApi.getFormRef().value)==null?void 0:p.sections.find(m=>m.name===n.section.name||m.name===n.sectionIndex.toString())}function V(){return o}return t(r),e.watch(()=>n.section.events.onIsValid?S():null,p=>{p&&B(n.section.events.onIsValid)}),e.onMounted(()=>{var m;const p=(m=e.getCurrentInstance())==null?void 0:m.exposed;p&&n.registerRef(n.section.name??n.sectionIndex.toString(),p),i()}),(p,m)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",n.section.hidden?"submit64-section-hidden":""])},[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,section:n.section,formApi:n.formApi,sectionApi:r},null,8,["section","formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{section:n.section,sectionApi:r,formApi:n.formApi},null,8,["section","formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,field:n.section,formApi:n.formApi,sectionApi:r},null,8,["field","formApi"])):e.createCommentVNode("",!0)],2))}}),ct={key:0,class:"flex column"},dt=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let o=null,r="";const i=new Map,l=new Map,s={getMode:gt,getForm:W,getSection:ut,getField:mt,validateForm:N,isFormValid:T,resetForm:z,clearForm:$,resetValidation:j,submitForm:m,valuesHasChanged:yt},f={getInitialValueByFieldName:U,getAssociationDataCallback:pt,getFormRef:ft},c={...s,...f},g=e.ref(),S=e.ref(!1),C=e.ref(!1),_=e.ref("create"),V=e.ref({});async function p(){var u,y;o=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),g.value=I.getForm(n.resourceName,n.resourceId,F(),o,n.formSettings,n.formStyle,n.context,c,n.eventManager),n.resourceId&&(_.value="edit"),S.value=!0,B((y=(u=g.value)==null?void 0:u.events)==null?void 0:y.onReady)}async function m(){var D,w;if(!N())return;C.value=!0,M();const u=k(),y=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:u,context:n.context});if(y.success)V.value={},_.value==="create"&&(_.value="edit"),o&&y.resource_data&&(o.resource_data=y.resource_data),r=JSON.stringify(k()),z();else{V.value={};const R=[];[...i].forEach(O=>{const H=y.errors[O[0]];H&&(O[1].setupBackendErrors(H),R.push(O[0]))}),Object.entries(y.errors).forEach(O=>{R.includes(O[0])||(V.value[O[0]]=O[1])})}B((w=(D=g.value)==null?void 0:D.events)==null?void 0:w.onSubmit),C.value=!1}function F(){const u={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}},y=e.useSlots();for(const D in y){const w=y[D];if(w){const R=e.defineComponent({inheritAttrs:!1,setup(O,{attrs:H,slots:Ct}){return()=>w({...O,...H,slots:Ct})}});switch(D){case"sections":u.sectionComponent=R;break;case"actions":u.actionComponent=R;break;case"orphan-errors":u.orphanErrorsComponent=R;break;case"association-display":u.associationDisplayComponent=R;break;default:u.dynamicComponentRecord[D]=R;break}}}return u}function k(){const u={};return[...i].forEach(y=>{u[y[0]]=y[1].getValueDeserialized()}),u}function N(){var y,D;let u=!0;return i.forEach(w=>{if(!w.validate()){u=!1;return}}),B((D=(y=g.value)==null?void 0:y.events)==null?void 0:D.onValidated),u}function T(){let u=!0;return i.forEach(y=>{if(!y.isValid()){u=!1;return}}),u}function z(){var u,y;i.forEach(D=>{D.reset()}),B((y=(u=g.value)==null?void 0:u.events)==null?void 0:y.onReset)}function $(){var u,y;i.forEach(D=>{D.clear()}),B((y=(u=g.value)==null?void 0:u.events)==null?void 0:y.onClear)}function j(){i.forEach(u=>{u.resetValidation()})}function M(){i.forEach(u=>{u.setupBackendErrors([])})}function h(u,y){l.set(u,y)}function x(u,y){i.set(u,y)}function U(u){if(o)return o.resource_data[u]}function W(){return Y(e.unref(g.value))}function ft(){return g}function ut(u){return l.get(u)}function mt(u){return i.get(u)}function pt(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function ht(){["getMetadataAndData","resourceName"].forEach(y=>{(n[y]===null||n[y]===void 0)&&console.warn(`Missing props for <Submit64> -> ${y}`)})}function gt(){return e.unref(_)}function yt(){return r!==JSON.stringify(k())}return t(s),e.watch(()=>{var u;return(u=g.value)!=null&&u.events.onIsValid?T():null},()=>{var u,y;B((y=(u=g.value)==null?void 0:u.events)==null?void 0:y.onIsValid)}),e.watch(()=>{var u;return(u=g.value)!=null&&u.events.onUpdate?k():null},()=>{var u,y;B((y=(u=g.value)==null?void 0:u.events)==null?void 0:y.onUpdate)}),e.onMounted(async()=>{console.time("mount and ready"),ht(),await p(),e.nextTick(()=>{r=JSON.stringify(k())}),console.timeEnd("mount and ready")}),(u,y)=>S.value&&g.value?(e.openBlock(),e.createElementBlock("div",ct,[e.createElementVNode("div",{class:e.normalizeClass(g.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(g.value.sections,(D,w)=>(e.openBlock(),e.createBlock(st,{key:D.name??w,section:D,sectionIndex:w,context:n.context,formApi:s,privateFormApi:f,registerRef:h},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(D.fields,R=>(e.openBlock(),e.createBlock(lt,{key:R.metadata.field_name,field:R,context:n.context,formApi:s,privateFormApi:f,registerRef:x},null,8,["field","context"]))),128))]),_:2},1032,["section","sectionIndex","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(g.value.orphanErrorsComponent),{orphanErrors:V.value,formApi:s},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(g.value.actionComponent),{isLoadingSubmit:C.value,submit:m,clear:g.value.clearable?$:void 0,reset:g.value.resetable?z:void 0,formApi:s,privateFormApi:f},null,8,["isLoadingSubmit","clear","reset"]))])):e.createCommentVNode("",!0)}});A.Submit64=E,A.Submit64Form=dt,Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});
