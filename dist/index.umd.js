(function(h,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(h=typeof globalThis<"u"?globalThis:h||self,e(h["submit64-vue"]={},h.Vue,h.Quasar))})(this,function(h,e,m){"use strict";var qe=Object.defineProperty;var Le=(h,e,m)=>e in h?qe(h,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):h[e]=m;var b=(h,e,m)=>Le(h,typeof e!="symbol"?e+"":e,m);const N={class:"flex row items-center no-wrap q-pt-sm"},x=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},reset:{type:Function},clear:{type:Function},submit:{type:Function}},setup(l){const t=l;return(o,n)=>(e.openBlock(),e.createElementBlock("div",N,[e.createVNode(e.unref(m.QBtn),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.submit},null,8,["loading","onClick"]),t.reset?(e.openBlock(),e.createBlock(e.unref(m.QBtn),{key:0,loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.reset},null,8,["loading","onClick"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(m.QBtn),{key:1,loading:t.isLoadingSubmit,label:"Vider",onClick:t.clear},null,8,["loading","onClick"])):e.createCommentVNode("",!0)]))}}),T={class:"flex row items-center"},w={class:"text-body1 text-weight-medium"},O={class:"flex column q-gutter-sm"},R=e.defineComponent({__name:"DefaultSectionComponent",props:{section:{}},setup(l){const t=l;return(o,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",t.section.cssClass])},[e.createElementVNode("div",T,[t.section.icon?(e.openBlock(),e.createBlock(e.unref(m.QIcon),{key:0,name:t.section.icon,size:"sm"},null,8,["name"])):e.createCommentVNode("",!0),e.createElementVNode("div",w,e.toDisplayString(t.section.label),1)]),e.createElementVNode("div",O,[e.renderSlot(o.$slots,"default")])],2))}}),$=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(l){const t=l;return(o,n)=>{const r=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(r,{name:"reset",class:"cursor-pointer",onClick:n[0]||(n[0]=c=>t.reset())})}}}),B=class B{constructor(){b(this,"_formSettings");b(this,"_formStyleConfig");b(this,"_actionComponent");b(this,"_sectionComponent");b(this,"_wrapperResetComponent");b(this,"_associationDisplayDictonary");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY:HHmm",renderBackendHint:!0},this._formStyleConfig={fieldOutlined:!0,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=x,this._sectionComponent=R,this._wrapperResetComponent=$,this._associationDisplayDictonary={}}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyleSetting(t){this._instance._formStyleConfig={...this._instance._formStyleConfig,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayDictonary(t){this._instance._associationDisplayDictonary=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyleConfig(){return this._instance._formStyleConfig}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayDictonary(){return this._instance._associationDisplayDictonary}};b(B,"_instance",new B);let _=B;function I(l,t,o){const n=o.getFormFactoryInstance().formSettings,r=o.getForm(),c=(d,s,f)=>d[s]?f?()=>i(d[s]):()=>d[s]:d.compare_to?()=>o.getFieldDataByFieldName(d.compare_to):()=>"",i=d=>String(m.date.formatDate(m.date.extractDate(d,r.backendDateFormat),n.dateFormat)),a=[],u=[];switch(t){case"date":a.push(me(n.dateFormat))}return l.forEach(d=>{const s=d;switch(s.type){case"required":a.push(E());break;case"absence":a.push(P());break;case"acceptance":a.push(z());break;case"inclusion":a.push(V(s.including));break;case"exclusion":a.push(j(s.excluding));break;case"backend":break;case"allowNull":u.push("allowNull");break;case"allowBlank":u.push("allowBlank");break;case"positiveNumber":a.push(Q());break;case"lessThanOrEqualNumber":a.push(U(c(s,"less_than")));break;case"lessThanNumber":a.push(G(c(s,"less_than")));break;case"greaterThanOrEqualNumber":a.push(H(c(s,"greater_than")));break;case"greaterThanNumber":a.push(A(c(s,"greater_than")));break;case"equalToNumber":a.push(Y(c(s,"equal_to")));break;case"otherThanNumber":a.push(K(c(s,"other_than")));break;case"numberIntegerOnly":a.push(J());break;case"numberNumericOnly":a.push(X());break;case"numberEvenOnly":a.push(Z());break;case"numberOddOnly":a.push(M());break;case"lessThanOrEqualStringLength":a.push(W(c(s,"less_than")));break;case"lessThanStringLength":a.push(v(c(s,"less_than")));break;case"greaterThanOrEqualStringLength":a.push(ee(c(s,"greater_than")));break;case"greaterThanStringLength":a.push(te(c(s,"greater_than")));break;case"equalToStringLength":a.push(le(c(s,"equal_to")));break;case"equalToString":a.push(oe(c(s,"equal_to")));break;case"betweenStringLength":a.push(ne(()=>s.min,()=>s.max));break;case"otherThanString":a.push(ae(c(s,"other_than")));break;case"lessThanOrEqualDate":a.push(re(c(s,"less_than",!0),n.dateFormat));break;case"lessThanDate":a.push(ie(c(s,"less_than",!0),n.dateFormat));break;case"greaterThanOrEqualDate":a.push(se(c(s,"greater_than",!0),n.dateFormat));break;case"greaterThanDate":a.push(ce(c(s,"greater_than",!0),n.dateFormat));break;case"equalToDate":a.push(de(c(s,"equal_to",!0),n.dateFormat));break;case"otherThanDate":a.push(ue(c(s,"other_than",!0),n.dateFormat));break}}),u.length>0?u.map(d=>{switch(d){case"allowBlank":return L(a);case"allowNull":return q(a)}}):a}function E(){return l=>!!l||"Ce champ est requis"}function V(l){return t=>l.includes(String(t))||`Doit être contenu dans ${l.toString()}`}function j(l){return t=>!l.includes(String(t)||`Ne doit pas être contenu dans ${V.toString()}`)}function P(){return l=>!l||"Ce champ doit être vide"}function z(){return l=>!!l||"Doit être accepté"}function q(l){return t=>(t===null||l.forEach(o=>{const n=o(t);if(n!==!0)return n}),!0)}function L(l){return t=>(t===""||l.forEach(o=>{const n=o(t);if(n!==!0)return n}),!0)}function Q(){return l=>Number(l)>0||"Val. positive uniquement"}function U(l){return t=>{const o=l();return Number(t)<=o||`Inf. ou égal à ${o}`}}function G(l){return t=>{const o=l();return Number(t)<o||`Inf. ${o}`}}function H(l){return t=>{const o=l();return Number(t)>=o||`Sup. ou égal à ${o}`}}function A(l){return t=>{const o=l();return Number(t)>o||`Sup. à ${o}`}}function Y(l,t){return o=>{const n=l();return Number(o)===n||`Égale à ${n}`}}function K(l,t){return o=>{const n=l();return Number(o)!==n||`Doit être différent de ${l}`}}function J(){return l=>/^-?\d+$/.test(String(l).trim())||"Nombre entier uniquement"}function X(){return l=>/^-?\d+(\.\d+)?$/.test(String(l).trim())||"Caractère numérique uniquement"}function Z(){return l=>Number.isInteger(Number(l))&&Number(l)%2===0||"Nombre pair uniquement"}function M(){return l=>Number.isInteger(Number(l))&&Number(l)%2===1||"Nombre impair uniquement"}function W(l){return t=>{const o=l();return String(t).length<=o||`Inf. ou égal à ${o}`}}function v(l){return t=>{const o=l();return String(t).length<o||`Inf. à ${o}`}}function ee(l){return t=>{const o=l();return String(t).length>=o||`Sup. ou égal à ${o}`}}function te(l){return t=>{const o=l();return String(t).length>o||`Sup. à ${o}`}}function ne(l,t){return o=>{const n=l(),r=t();return String(o).length>=n&&String(o).length<=r||`Entre ${n} et ${r}`}}function oe(l,t){return o=>{const n=l();return String(o)===n||`Égale à ${n}`}}function le(l){return t=>{const o=l();return String(t).length===o||`Doit contenir ${o} caractères`}}function ae(l){return t=>{const o=l();return String(t)!==o||`Doit être différent de ${o}`}}function re(l,t){return o=>{const n=l(),r=m.date.extractDate(String(o),t),c=m.date.extractDate(n,t);return!Number.isNaN(r.getTime())&&r<=c||`Inf. ou égal à ${n}`}}function ie(l,t){return o=>{const n=l(),r=m.date.extractDate(String(o),t),c=m.date.extractDate(n,t);return!Number.isNaN(r.getTime())&&r<c||`Inf. à ${n}`}}function se(l,t){return o=>{const n=l(),r=m.date.extractDate(String(o),t),c=m.date.extractDate(n,t);return!Number.isNaN(r.getTime())&&r>=c||`Sup. ou égal à ${n}`}}function ce(l,t){return o=>{const n=l(),r=m.date.extractDate(String(o),t),c=m.date.extractDate(n,t);return!Number.isNaN(r.getTime())&&r>c||`Sup. à ${n}`}}function de(l,t){return o=>{const n=l(),r=m.date.extractDate(String(o),t),c=m.date.extractDate(n,t);return r===c||`Égale à ${r}`}}function ue(l,t){return o=>{const n=l();return m.date.extractDate(String(o),t)!==m.date.extractDate(n,t)||`Doit être différent de ${n}`}}function me(l){return t=>!Number.isNaN(m.date.extractDate(String(t),l).getTime())||"Date invalide"}const fe={computeServerRules:I},y=e.defineComponent({__name:"FieldWrapper",props:{field:{}},setup(l,{expose:t}){const o=l,n=e.inject(o.field.provideUniqKey),r=e.ref();function c(){return r.value}function i(){n&&(r.value=n.getDefaultDataByFieldName(o.field.metadata.field_name),r.value=a(r.value))}function a(f){switch(o.field.type){case"date":return m.date.formatDate(m.date.extractDate(String(f),n.getForm().backendDateFormat),n.getFormFactoryInstance().formSettings.dateFormat)}return f}function u(){switch(o.field.type){case"string":r.value="";break;case"checkbox":r.value=!1;break;case"date":r.value=m.date.formatDate(new Date,n.getFormFactoryInstance().formSettings.dateFormat);break;case"number":r.value=0;break;case"selectString":r.value=null;break;case"text":r.value="";break;case"object":r.value={};break;case"selectBelongsTo":r.value=null;break;case"selectHasMany":r.value=null;break}}function d(){return fe.computeServerRules(o.field.rules??[],o.field.type,n)}function s(f){r.value=f}return t({reset:i,clear:u,getValue:c}),e.onMounted(()=>{var C;i();const f=(C=e.getCurrentInstance())==null?void 0:C.exposed;f&&n&&n.registerRef(o.field.metadata.field_name,f)}),(f,C)=>(e.openBlock(),e.createElementBlock("div",null,[o.field.resetable?e.renderSlot(f.$slots,"reset",{key:0,actionProps:{reset:i}},()=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n).getFormFactoryInstance().wrapperResetComponent),{reset:i}))]):e.createCommentVNode("",!0),e.renderSlot(f.$slots,"default",{propsWrapper:{modelValue:r.value,modelValueOnUpdate:s,field:f.field,injectForm:e.unref(n),reset:i,clear:u,getComputedRules:d}})]))}}),ge=e.defineComponent({__name:"StringField",props:{field:{}},setup(l){const t=l;function o(n){const r=n.injectForm.getFormFactoryInstance(),c=r.formSettings,i=r.formStyleConfig;return{"onUpdate:modelValue":a=>n.modelValueOnUpdate(a),modelValue:n.modelValue,lazyRules:c.rulesBehaviour==="lazy",clearable:n.field.clearable,rules:n.getComputedRules(),onClear:n.clear,label:n.field.label,hint:n.field.hint,outlined:i.fieldOutlined,filled:i.fieldFilled,standout:i.fieldStandout,borderless:i.fieldBorderless,rounded:i.fieldRounded,square:i.fieldSquare,dense:i.fieldDense,hideBottomSpace:i.fieldHideBottomSpace,color:i.fieldColor,bgColor:i.fieldBgColor,class:n.field.cssClass}}return(n,r)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QInput),e.normalizeProps(e.guardReactiveProps(o(c))),null,16)]),_:1},8,["field"]))}}),he=e.defineComponent({__name:"TextField",props:{field:{}},setup(l){const t=l;function o(n){const r=n.injectForm.getFormFactoryInstance(),c=r.formSettings,i=r.formStyleConfig;return{"onUpdate:modelValue":a=>n.modelValueOnUpdate(a),modelValue:n.modelValue,lazyRules:c.rulesBehaviour==="lazy",clearable:n.field.clearable,rules:n.getComputedRules(),onClear:n.clear,label:n.field.label,hint:n.field.hint,outlined:i.fieldOutlined,filled:i.fieldFilled,standout:i.fieldStandout,borderless:i.fieldBorderless,rounded:i.fieldRounded,square:i.fieldSquare,dense:i.fieldDense,hideBottomSpace:i.fieldHideBottomSpace,color:i.fieldColor,bgColor:i.fieldBgColor,class:n.field.cssClass}}return(n,r)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QInput),e.mergeProps(o(c),{type:"textarea"}),null,16)]),_:1},8,["field"]))}}),be={class:"row items-center justify-end"},Ce=e.defineComponent({__name:"DateField",props:{field:{}},setup(l){const t=l,o=e.ref();function n(a){const u=a.injectForm.getFormFactoryInstance(),d=u.formSettings,s=u.formStyleConfig;return{"onUpdate:modelValue":f=>a.modelValueOnUpdate(f),modelValue:a.modelValue,lazyRules:d.rulesBehaviour==="lazy",clearable:a.field.clearable,rules:a.getComputedRules(),onClear:a.clear,label:a.field.label,hint:a.field.hint,outlined:s.fieldOutlined,filled:s.fieldFilled,standout:s.fieldStandout,borderless:s.fieldBorderless,rounded:s.fieldRounded,square:s.fieldSquare,dense:s.fieldDense,hideBottomSpace:s.fieldHideBottomSpace,color:s.fieldColor,bgColor:s.fieldBgColor,class:a.field.cssClass}}function r(a){return{size:"sm",color:"primary",name:"event",class:"cursor-pointer"}}function c(a){return{"onUpdate:modelValue":u=>a.modelValueOnUpdate(u),modelValue:a.modelValue,mask:a.injectForm.getFormFactoryInstance().formSettings.dateFormat}}function i(){o.value&&o.value.hide()}return(a,u)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:d})=>[e.createVNode(e.unref(m.QInput),e.normalizeProps(e.guardReactiveProps(n(d))),{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),e.normalizeProps(e.guardReactiveProps(r())),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"popupProxyRef",ref:o,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),e.normalizeProps(e.guardReactiveProps(c(d))),{default:e.withCtx(()=>[e.createElementVNode("div",be,[e.createVNode(e.unref(m.QBtn),{onClick:i,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:2},1040)]),_:2},1536)]),_:2},1040)]),_:2},1040)]),_:1},8,["field"]))}}),_e=e.defineComponent({__name:"CheckboxField",props:{field:{}},setup(l){const t=l;function o(n){const r=n.injectForm.getFormFactoryInstance().formStyleConfig;return{"onUpdate:modelValue":c=>n.modelValueOnUpdate(c),modelValue:n.modelValue,label:n.field.label,dense:r.fieldDense,color:r.fieldColor,class:n.field.cssClass}}return(n,r)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QCheckbox),e.normalizeProps(e.guardReactiveProps(o(c))),null,16)]),_:1},8,["field"]))}}),ye=e.defineComponent({__name:"NumberField",props:{field:{}},setup(l){const t=l;function o(n){const r=n.injectForm.getFormFactoryInstance(),c=r.formSettings,i=r.formStyleConfig;return{"onUpdate:modelValue":a=>n.modelValueOnUpdate(a),modelValue:n.modelValue,lazyRules:c.rulesBehaviour==="lazy",clearable:n.field.clearable,rules:n.getComputedRules(),onClear:n.clear,label:n.field.label,hint:n.field.hint,outlined:i.fieldOutlined,filled:i.fieldFilled,standout:i.fieldStandout,borderless:i.fieldBorderless,rounded:i.fieldRounded,square:i.fieldSquare,dense:i.fieldDense,hideBottomSpace:i.fieldHideBottomSpace,color:i.fieldColor,bgColor:i.fieldBgColor,class:n.field.cssClass}}return(n,r)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:c})=>[e.createVNode(e.unref(m.QInput),e.mergeProps(o(c),{type:"number"}),null,16)]),_:1},8,["field"]))}});function Se(l){return Symbol(l)}function p(){return 20}const Fe=e.defineComponent({__name:"SelectHasManyField",props:{field:{}},setup(l){const t=l,o=t.field.componentOptions.associationDisplayComponent,n=e.ref([]),r=e.ref({limit:p(),offset:0});function c(a){const u=a.injectForm.getFormFactoryInstance(),d=u.formSettings,s=u.formStyleConfig;return{"onUpdate:modelValue":f=>a.modelValueOnUpdate(f),modelValue:a.modelValue,lazyRules:d.rulesBehaviour==="lazy",clearable:a.field.clearable,rules:a.getComputedRules(),multiple:!0,useChips:!0,mapOptions:!0,emitValue:!0,useInput:!0,options:n.value,onClear:a.clear,onFilter:i(a),label:a.field.label,hint:a.field.hint,outlined:s.fieldOutlined,filled:s.fieldFilled,standout:s.fieldStandout,borderless:s.fieldBorderless,rounded:s.fieldRounded,square:s.fieldSquare,dense:s.fieldDense,hideBottomSpace:s.fieldHideBottomSpace,color:s.fieldColor,bgColor:s.fieldBgColor,class:a.field.cssClass}}function i(a){return(u,d)=>{const s=a.injectForm.getAssociationDataCallback();u===""&&(r.value={limit:p(),offset:0}),d(()=>{s({resourceName:a.injectForm.getForm().resourceName,associationName:a.field.metadata.field_association_name,limit:r.value.limit,offset:r.value.offset,labelFilter:u,context:a.injectForm.getForm().context}).then(f=>{n.value=f.rows})})}}return(a,u)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:d})=>[e.createVNode(e.unref(m.QSelect),e.normalizeProps(e.guardReactiveProps(c(d))),{options:e.withCtx(s=>[e.unref(o)?(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.mergeProps({key:0},s.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(o)),{key:1,scope:s},null,8,["scope"]))]),_:2},1040)]),_:1},8,["field"]))}}),ke=(l,t)=>{const o=l.__vccOpts||l;for(const[n,r]of t)o[n]=r;return o},pe={};function Be(l,t){return" TODO json edit ? "}const De=ke(pe,[["render",Be]]),Ve=e.defineComponent({__name:"SelectField",props:{field:{}},setup(l){const t=l,o=e.ref([]),n=e.ref([]);function r(i){const a=i.injectForm.getFormFactoryInstance(),u=a.formSettings,d=a.formStyleConfig;return o.value=Object.freeze(i.field.selectOptions??[]),n.value=i.field.selectOptions??[],{"onUpdate:modelValue":s=>i.modelValueOnUpdate(s),modelValue:i.modelValue,lazyRules:u.rulesBehaviour==="lazy",clearable:i.field.clearable,rules:i.getComputedRules(),mapOptions:!0,emitValue:!0,useInput:!0,options:i.field.selectOptions||[],onClear:i.clear,onFilter:c,label:i.field.label,hint:i.field.hint,outlined:d.fieldOutlined,filled:d.fieldFilled,standout:d.fieldStandout,borderless:d.fieldBorderless,rounded:d.fieldRounded,square:d.fieldSquare,dense:d.fieldDense,hideBottomSpace:d.fieldHideBottomSpace,color:d.fieldColor,bgColor:d.fieldBgColor,class:i.field.cssClass}}function c(i,a){if(i===""){a(()=>{n.value=[...o.value]});return}a(()=>{const u=i.toLowerCase();n.value=o.value.filter(d=>d.label.toLowerCase().includes(u))})}return(i,a)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:u})=>[e.createVNode(e.unref(m.QSelect),e.normalizeProps(e.guardReactiveProps(r(u))),null,16)]),_:1},8,["field"]))}}),Ne=e.defineComponent({__name:"SelectBelongsToField",props:{field:{}},setup(l){const t=l,o=t.field.componentOptions.associationDisplayComponent,n=e.ref([]),r=e.ref({limit:p(),offset:0});function c(u){const d=u.injectForm.getFormFactoryInstance(),s=d.formSettings,f=d.formStyleConfig;return{"onUpdate:modelValue":C=>u.modelValueOnUpdate(C),modelValue:u.modelValue,lazyRules:s.rulesBehaviour==="lazy",clearable:u.field.clearable,rules:u.getComputedRules(),mapOptions:!0,emitValue:!0,useInput:!0,options:n.value,onClear:u.clear,onFilter:i(u),label:u.field.label,hint:u.field.hint,outlined:f.fieldOutlined,filled:f.fieldFilled,standout:f.fieldStandout,borderless:f.fieldBorderless,rounded:f.fieldRounded,square:f.fieldSquare,dense:f.fieldDense,hideBottomSpace:f.fieldHideBottomSpace,color:f.fieldColor,bgColor:f.fieldBgColor,class:u.field.cssClass}}function i(u){return(d,s)=>{const f=u.injectForm.getAssociationDataCallback();d===""&&(r.value={limit:p(),offset:0}),s(()=>{f({resourceName:u.injectForm.getForm().resourceName,associationName:u.field.metadata.field_association_name,limit:r.value.limit,offset:r.value.offset,labelFilter:d,context:u.injectForm.getForm().context}).then(C=>{n.value=C.rows})})}}function a(u){console.log("hellow world"),n.value=[{label:u.field.defaultDisplayValue??"",value:u.modelValue}]}return(u,d)=>(e.openBlock(),e.createBlock(y,{field:t.field},{default:e.withCtx(({propsWrapper:s})=>[e.createVNode(e.unref(m.QSelect),e.mergeProps(c(s),{onVnodeMounted:f=>a(s)}),{options:e.withCtx(f=>[e.unref(o)?(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.mergeProps({key:0},f.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(f.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(o)),{key:1,scope:f},null,8,["scope"]))]),_:2},1040,["onVnodeMounted"])]),_:1},8,["field"]))}});class D{constructor(t,o,n,r,c,i,a){b(this,"resourceName");b(this,"formSettings");b(this,"formStyleConfig");b(this,"actionComponent");b(this,"sectionComponent");b(this,"wrapperResetComponent");b(this,"associationDisplayDictionary");this.resourceName=t,this.formSettings={..._.getGlobalFormSetting(),...o},this.formStyleConfig={..._.getGlobalFormStyleConfig(),...n},this.actionComponent=r??_.getGlobalActionComponent(),this.sectionComponent=c??_.getGlobalSectionComponent(),this.wrapperResetComponent=i??_.getGlobalWrapperResetComponent(),this.associationDisplayDictionary=a??_.getGlobalAssociationDisplayDictonary()}static getFieldComponentByFormFieldType(t){return{string:ge,text:he,number:ye,date:Ce,selectString:Ve,selectBelongsTo:Ne,selectHasMany:Fe,checkbox:_e,object:De}[t]}getForm(t,o,n){const r=[];return t.form.sections.forEach(i=>{const a=[];i.fields.forEach(d=>{const s=D.getFieldComponentByFormFieldType(d.field_type),f={associationDisplayComponent:this.getAssociationDisplayComponentByResourceName(t.form.resource_name)},C={type:d.field_type,metadata:d,label:d.label,hint:d.hint,cssClass:d.css_class,selectOptions:d.select_options,rules:d.rules,clearable:d.clearable,resetable:d.resetable,provideUniqKey:o,defaultDisplayValue:d.default_display_value,component:s,componentOptions:f};a.push(C)});const u={label:i.label,icon:i.icon,cssClass:i.css_class,fields:a};r.push(u)}),{sections:r,resourceName:t.form.resource_name,cssClass:t.form.css_class,resetable:t.form.resetable,clearable:t.form.clearable,backendDateFormat:t.form.backend_date_format,backendDatetimeFormat:t.form.backend_datetime_format,hasGlobalCustomValidation:t.form.has_global_custom_validation??!1,context:n}}getAssociationDisplayComponentByResourceName(t){return this.associationDisplayDictionary[t]}}const xe={key:0,class:"flex column"},Te=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},resourceId:{},getMetadataAndData:{},submitForm:{},getAssociationData:{},globalFormSettings:{},context:{}},setup(l,{expose:t}){const o=l;let n=null;const r=Object.freeze(new D(o.resourceName,o.globalFormSettings)),c=Se(m.uid()),i=e.ref({}),a=e.ref(),u=e.ref(!1),d=e.ref(!1);async function s(){n=await o.getMetadataAndData({resourceName:o.resourceName,resourceId:o.resourceId,context:o.context}),a.value=Object.freeze(r.getForm(n,c,o.context)),u.value=!0}async function f(){d.value=!0;const g={};Object.entries(i.value).forEach(F=>{g[F[0]]=F[1].getValue()});const S=await o.submitForm({formData:g});n&&(n.resource_data=S),C(),d.value=!1}function C(){Object.values(i.value).forEach(g=>{g.reset()})}function we(){Object.values(i.value).forEach(g=>{g.clear()})}function Oe(g,S){i.value[g]=S}function Re(g){if(n)return n.resource_data[g]}function $e(g){const S=Object.entries(i.value).find(F=>F[0]===g);return S?S[1].getValue():null}function Ie(){return r}function Ee(){return a.value}function je(){return o.getAssociationData??(async()=>({rows:[],row_count:0}))}return e.provide(c,{registerRef:Oe,getDefaultDataByFieldName:Re,getFieldDataByFieldName:$e,getFormFactoryInstance:Ie,getForm:Ee,getAssociationDataCallback:je}),t({}),e.onMounted(async()=>{await s()}),(g,S)=>u.value&&a.value?(e.openBlock(),e.createElementBlock("div",xe,[e.createElementVNode("div",{class:e.normalizeClass(a.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.value.sections,(F,Pe)=>(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r).sectionComponent),{key:Pe,section:F},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(F.fields,k=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:k.metadata.field_name},[g.$slots[k.metadata.field_name]?(e.openBlock(),e.createBlock(y,{key:1,field:k},{default:e.withCtx(({propsWrapper:ze})=>[e.renderSlot(g.$slots,"default",{propsWrapper:ze})]),_:2},1032,["field"])):(e.openBlock(),e.createBlock(e.resolveDynamicComponent(k.component),{key:0,field:k},null,8,["field"]))],64))),128))]),_:2},1032,["section"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(r).actionComponent),{isLoadingSubmit:d.value,submit:f,clear:a.value.clearable?we:void 0,reset:a.value.resetable?C:void 0},null,8,["isLoadingSubmit","clear","reset"])),g.$slots.more_actions?e.renderSlot(g.$slots,"more_actions",{key:0,propsForm:{generatedForm:a.value}}):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)}});h.Submit64=_,h.Submit64Form=Te,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
