(function(N,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(N=typeof globalThis<"u"?globalThis:N||self,e(N["submit64-vue"]={},N.Vue,N.Quasar))})(this,function(N,e,m){"use strict";var kt=Object.defineProperty;var St=(N,e,m)=>e in N?kt(N,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):N[e]=m;var k=(N,e,m)=>St(N,typeof e!="symbol"?e+"":e,m);const ie={class:"flex column"},le={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},se=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{},submit:{type:Function},reset:{type:Function},clear:{type:Function}},setup(a){const t=a;function n(){const o=t.formApi.formStyle;return{outline:o.fieldOutlined,rounded:o.fieldRounded,square:o.fieldSquare,dense:o.fieldDense,color:o.fieldColor,noCaps:!0}}return(o,r)=>(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("div",le,[e.createVNode(e.unref(m.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.submit}),null,16,["loading","onClick"]),t.reset?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Vider",onClick:t.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),ce={class:"flex row items-center"},de={class:"text-body1 text-weight-medium"},fe={class:"flex column q-gutter-md"},ue=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{},context:{}},setup(a){const t=a;return(n,o)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",ce,[t.sectionApi.icon?(e.openBlock(),e.createBlock(e.unref(m.QIcon),{key:0,name:t.sectionApi.icon,size:"sm",color:t.formApi.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",de,e.toDisplayString(t.sectionApi.label),1)]),e.createElementVNode("div",fe,[e.renderSlot(n.$slots,"default")])]))}}),me=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,o)=>{const r=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(r,{name:"reset",class:"cursor-pointer",onClick:o[0]||(o[0]=i=>t.reset())})}}}),pe=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,o)=>(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),he={class:"flex column"},ge=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(a){const t=a;return(n,o)=>(e.openBlock(),e.createElementBlock("div",he,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(r,i)=>(e.openBlock(),e.createElementBlock("div",{key:i,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(i)+" : "+e.toDisplayString(r.join(",")),1))),128))]))}}),P=class P{constructor(){k(this,"_formSettings");k(this,"_formStyle");k(this,"_actionComponent");k(this,"_orphanErrorsComponent");k(this,"_sectionComponent");k(this,"_wrapperResetComponent");k(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=se,this._orphanErrorsComponent=ge,this._sectionComponent=ue,this._wrapperResetComponent=me,this._associationDisplayComponent=pe}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};k(P,"_instance",new P);let w=P;const ye={class:"row items-center justify-end"},Ce=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi,o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",d=e.ref(),s=e.ref();function l(){d.value&&d.value.hide()}function p(){return s.value?s.value.validate():!1}function S(){return s.value?s.value.hasError:!1}function _(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(p,S,_)}),(y,B)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":B[1]||(B[1]=D=>t.modelValueOnUpdate(D)),label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"popupProxyRef",ref:d,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=D=>t.modelValueOnUpdate(D)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",ye,[e.createVNode(e.unref(m.QBtn),{onClick:l,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),be={class:"row items-center justify-end"},ke={class:"row items-center justify-end"},Se=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi,o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",d=e.ref(),s=e.ref(),l=e.ref();function p(){d.value&&d.value.hide()}function S(){s.value&&s.value.hide()}function _(){return l.value?l.value.validate():!1}function y(){return l.value?l.value.hasError:!1}function B(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(_,y,B)}),(D,F)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":F[2]||(F[2]=C=>t.modelValueOnUpdate(C)),label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"datePopupProxyRef",ref:d,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=C=>t.modelValueOnUpdate(C)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",be,[e.createVNode(e.unref(m.QBtn),{onClick:p,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"timePopupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":F[1]||(F[1]=C=>t.modelValueOnUpdate(C)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",ke,[e.createVNode(e.unref(m.QBtn),{onClick:S,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),_e={class:"flex column"},Fe={key:0,class:"q-field__bottom"},Ve={key:1,class:"q-field--error q-field__bottom text-negative"},xe=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),r=t.formApi.formStyle;function i(){return n.value===!0}function d(){return n.value===!0}function s(){n.value=!0}return e.watch(()=>t.modelValue,l=>{for(const p of t.rules)if(n.value=p(l),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(i,d,s)}),(l,p)=>(e.openBlock(),e.createElementBlock("div",_e,[e.createVNode(e.unref(m.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":p[0]||(p[0]=S=>t.modelValueOnUpdate(S)),label:t.field.label,dense:e.unref(r).fieldDense,color:e.unref(r).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",Fe,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",Ve,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Be=e.defineComponent({__name:"ObjectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.getFormFactoryInstance(),o=n.formSettings;return n.formStyle,o.rulesBehaviour,(r,i)=>" TODO json edit ? "}}),De=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),o=e.ref([]),r=e.ref(),i=t.formApi,d=i.formSettings,s=i.formStyle,l=d.rulesBehaviour==="lazy";function p(F,C){if(F===""){C(()=>{o.value=[...n.value]});return}C(()=>{const V=F.toLowerCase();o.value=n.value.filter(u=>u.label.toLowerCase().includes(V))})}function S(){n.value=Object.freeze(t.field.staticSelectOptions??[]),o.value=t.field.staticSelectOptions??[]}function _(){return r.value?r.value.validate():!1}function y(){return r.value?r.value.hasError:!1}function B(){r.value&&r.value.resetValidation()}function D(){t.clear(),o.value=[]}return e.onMounted(()=>{S(),t.registerBehaviourCallbacks(_,y,B)}),(F,C)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:r,"model-value":t.modelValue,"onUpdate:modelValue":C[0]||(C[0]=V=>t.modelValueOnUpdate(V)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(s).fieldOutlined,filled:e.unref(s).fieldFilled,standout:e.unref(s).fieldStandout,borderless:e.unref(s).fieldBorderless,rounded:e.unref(s).fieldRounded,square:e.unref(s).fieldSquare,dense:e.unref(s).fieldDense,hideBottomSpace:e.unref(s).fieldHideBottomSpace,color:e.unref(s).fieldColor,bgColor:e.unref(s).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:o.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:D,onFilter:p},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}});function I(){return 20}function j(a){return Object.keys(a).forEach(t=>{const n=a[t];n&&typeof n=="object"&&j(n)}),Object.freeze(a)}function R(a){a==null||a.forEach(t=>{t()})}const Re=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,o=t.formApi,r=o.formSettings,i=o.formStyle,d=r.rulesBehaviour==="lazy",s=e.ref([]),l=e.ref({limit:I(),offset:0}),p=e.ref();function S(C,V){const u=t.formApi.getAssociationDataCallback();C===""&&(l.value={limit:I(),offset:0}),V(()=>{const g=t.formApi;u({resourceName:g.resourceName,resourceId:g.resourceId,associationName:t.field.metadata.field_association_name,limit:l.value.limit,offset:l.value.offset,labelFilter:C,context:g.context}).then(A=>{s.value=A.rows}).catch(()=>{s.value=[]})})}function _(){e.nextTick(()=>{const C=t.getValueSerialized();!C||!t.field.associationData||(s.value=[{label:t.field.associationData.label[0]??"???",value:C,data:t.field.associationData.data[0]}])})}function y(){return p.value?p.value.validate():!1}function B(){return p.value?p.value.hasError:!1}function D(){p.value&&p.value.resetValidation()}function F(){t.clear(),s.value=[]}return e.onMounted(()=>{_(),t.registerBehaviourCallbacks(y,B,D)}),(C,V)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:p,"model-value":t.modelValue,"onUpdate:modelValue":V[0]||(V[0]=u=>t.modelValueOnUpdate(u)),type:t.field.componentOptions.regularFieldType,label:t.field.label,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":d,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:s.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:F,onFilter:S},{option:e.withCtx(u=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:u.opt,itemProps:u.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","type","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),Ne=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,o=t.formApi,r=o.formSettings,i=o.formStyle,d=r.rulesBehaviour==="lazy",s=e.ref([]),l=e.ref({limit:I(),offset:0}),p=e.ref();function S(C,V){const u=t.formApi.getAssociationDataCallback();C===""&&(l.value={limit:I(),offset:0}),V(()=>{const g=t.formApi;u({resourceName:g.resourceName,resourceId:g.resourceId,associationName:t.field.metadata.field_association_name,limit:l.value.limit,offset:l.value.offset,labelFilter:C,context:g.context}).then(A=>{s.value=A.rows}).catch(()=>{s.value=[]})})}function _(){e.nextTick(()=>{const C=t.getValueSerialized();!C||!t.field.associationData||(s.value=C.map((V,u)=>({label:t.field.associationData.label[u]??"???",value:V,data:t.field.associationData.data[u]})))})}function y(){return p.value?p.value.validate():!1}function B(){return p.value?p.value.hasError:!1}function D(){p.value&&p.value.resetValidation()}function F(){t.clear(),s.value=[]}return e.onMounted(()=>{_(),t.registerBehaviourCallbacks(y,B,D)}),(C,V)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:p,"model-value":t.modelValue,"onUpdate:modelValue":V[0]||(V[0]=u=>t.modelValueOnUpdate(u)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":d,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:s.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:F,onFilter:S},{option:e.withCtx(u=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:u.opt,itemProps:u.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),v=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi,o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",d=e.ref();function s(){return d.value?d.value.validate():!1}function l(){return d.value?d.value.hasError:!1}function p(){d.value&&d.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,l,p)}),(S,_)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=y=>t.modelValueOnUpdate(y)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ee=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi,o=n.formSettings,r=n.formStyle,i=o.rulesBehaviour==="lazy",d=e.ref();function s(){return d.value?d.value.validate():!1}function l(){return d.value?d.value.hasError:!1}function p(){d.value&&d.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,l,p)}),(S,_)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=y=>t.modelValueOnUpdate(y)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(r).fieldOutlined,filled:e.unref(r).fieldFilled,standout:e.unref(r).fieldStandout,borderless:e.unref(r).fieldBorderless,rounded:e.unref(r).fieldRounded,square:e.unref(r).fieldSquare,dense:e.unref(r).fieldDense,hideBottomSpace:e.unref(r).fieldHideBottomSpace,color:e.unref(r).fieldColor,bgColor:e.unref(r).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}});class U{constructor(t){k(this,"formApi");k(this,"events",[]);this.formApi=t}when(t,n){const o=t,r=n,i=new we(o,r,this.formApi);return this.events.push(i),new Ae(i)}static create(t){return new U(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(o=>{const r=o.getTarget();switch(r.target){case"field":n.fields[r.target]||(n.fields[r.target]={}),n.fields[r.target][r.key]||(n.fields[r.target][r.key]=[]),n.fields[r.target][r.key].push(o.getActionCallback());break;case"section":n.sections[r.target]||(n.sections[r.target]={}),n.sections[r.target][r.key]||(n.sections[r.target][r.key]=[]),n.sections[r.target][r.key].push(o.getActionCallback());break;case"form":n.form[r.key]||(n.form[r.key]=[]),n.form[r.key].push(o.getActionCallback());break}}),n}}class Ae{constructor(t){k(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.actions.push(t),this}}class we{constructor(t,n,o){k(this,"type");k(this,"data");k(this,"actions",[]);k(this,"formApi");this.type=t,this.data=n,this.formApi=o}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field confirm value statement":return{target:"field",targetName:this.data.fieldName,key:"onConfirmStatement"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.actions.forEach(t=>{t(this.formApi)})}}}class z{constructor(t,n,o,r,i,d,s,l,p){k(this,"resourceName");k(this,"resourceId");k(this,"formMetadataAndData");k(this,"context");k(this,"formSettings");k(this,"formStyle");k(this,"actionComponent");k(this,"orphanErrorsComponent");k(this,"sectionComponent");k(this,"wrapperResetComponent");k(this,"associationDisplayComponent");k(this,"dynamicComponentRecord");k(this,"formApi");k(this,"registerEventCallback");this.dynamicComponentRecord=o.dynamicComponentRecord??{},this.formMetadataAndData=r,this.resourceId=n,this.context=s,this.resourceName=t,this.formApi=l,this.formSettings={...i,...w.getGlobalFormSetting(),backendDateFormat:r.form.backend_date_format,backendDatetimeFormat:r.form.backend_datetime_format},this.formStyle={...d,...w.getGlobalFormStyle()},this.actionComponent=o.actionComponent??w.getGlobalActionComponent(),this.orphanErrorsComponent=o.orphanErrorsComponent??w.getGlobalOrphanErrorComponent(),this.sectionComponent=o.sectionComponent??w.getGlobalSectionComponent(),this.wrapperResetComponent=o.wrapperResetComponent??w.getGlobalWrapperResetComponent(),this.associationDisplayComponent=o.associationDisplayComponent??w.getGlobalAssociationDisplayComponent(),this.registerEventCallback=p??(()=>{})}static getForm(t,n,o,r,i,d,s,l,p){return new z(t,n,o,r,i,d,s,l,p).generateFormDef()}generateFormDef(){const t=U.create(this.formApi);this.registerEventCallback(t);const n=U.getEventsObjectFromInstance(t),o=[];return this.formMetadataAndData.form.sections.forEach((i,d)=>{const s=[];i.fields.forEach(y=>{const B=this.dynamicComponentRecord[`field-${y.field_name}-before`],D=z.getFieldComponentByFormFieldType(y.field_type),F=this.dynamicComponentRecord[`field-${y.field_name}-after`],C={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:z.getRegularFieldTypeByFieldType(y.field_type)},V={type:y.field_type,metadata:Object.freeze(y),label:y.label,hint:y.hint??void 0,prefix:y.prefix??void 0,suffix:y.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??i.readonly??y.readonly??void 0,cssClass:y.css_class??void 0,staticSelectOptions:y.static_select_options,associationData:y.field_association_data,rules:y.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:B?e.markRaw(B):void 0,mainComponent:e.markRaw(D),afterComponent:F?e.markRaw(F):void 0,events:n.fields[y.field_name]??{},componentOptions:C};s.push(V)});const l=this.dynamicComponentRecord[`section-${i.name??d}-before`],p=this.sectionComponent,S=this.dynamicComponentRecord[`section-${i.name??d}-after`],_={label:i.label??void 0,icon:i.icon??void 0,cssClass:i.css_class??void 0,hidden:!1,name:i.name??d.toString(),readonly:this.formMetadataAndData.form.readonly??i.readonly??void 0,events:n.sections[i.name??d.toString()]??{},beforeComponent:l?e.markRaw(l):void 0,mainComponent:e.markRaw(p),afterComponent:S?e.markRaw(S):void 0,fields:s};o.push(_)}),{sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,events:n.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context}}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){return{string:v,text:v,number:Ee,date:Ce,datetime:Se,selectString:De,selectBelongsTo:Re,selectHasMany:Ne,checkbox:xe,object:Be}[t]}}function Te(a,t,n){const o=(s,l,p)=>s[l]?p?()=>r(s[l]):()=>s[l]:s.compare_to?()=>{var S;return((S=n.getField(s.compare_to))==null?void 0:S.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",r=s=>String(m.date.formatDate(m.date.extractDate(s,n.formSettings.backendDateFormat),n.formSettings.dateFormat)),i=[],d=[];switch(t){case"date":i.push(te(n.formSettings.dateFormat));break;case"datetime":i.push(te(n.formSettings.datetimeFormat));break}return a.forEach(s=>{const l=s;switch(l.type){case"required":i.push(Oe());break;case"absence":i.push($e());break;case"acceptance":i.push(Ie());break;case"inclusion":i.push(ee(l.including));break;case"exclusion":i.push(ze(l.excluding));break;case"backend":break;case"allowNull":d.push("allowNull");break;case"allowBlank":d.push("allowBlank");break;case"positiveNumber":i.push(qe());break;case"lessThanOrEqualNumber":i.push(Le(o(l,"less_than")));break;case"lessThanNumber":i.push(Qe(o(l,"less_than")));break;case"greaterThanOrEqualNumber":i.push(Ge(o(l,"greater_than")));break;case"greaterThanNumber":i.push(He(o(l,"greater_than")));break;case"equalToNumber":i.push(je(o(l,"equal_to")));break;case"otherThanNumber":i.push(Me(o(l,"other_than")));break;case"numberIntegerOnly":i.push(We());break;case"numberNumericOnly":i.push(Ye());break;case"numberEvenOnly":i.push(Je());break;case"numberOddOnly":i.push(Ke());break;case"lessThanOrEqualStringLength":i.push(Xe(o(l,"less_than")));break;case"lessThanStringLength":i.push(Ze(o(l,"less_than")));break;case"greaterThanOrEqualStringLength":i.push(ve(o(l,"greater_than")));break;case"greaterThanStringLength":i.push(et(o(l,"greater_than")));break;case"equalToStringLength":i.push(ot(o(l,"equal_to")));break;case"equalToString":i.push(nt(o(l,"equal_to")));break;case"betweenStringLength":i.push(tt(()=>l.min,()=>l.max));break;case"otherThanString":i.push(rt(o(l,"other_than")));break;case"lessThanOrEqualDate":i.push(at(o(l,"less_than",!0),n.formSettings.dateFormat));break;case"lessThanDate":i.push(it(o(l,"less_than",!0),n.formSettings.dateFormat));break;case"greaterThanOrEqualDate":i.push(lt(o(l,"greater_than",!0),n.formSettings.dateFormat));break;case"greaterThanDate":i.push(st(o(l,"greater_than",!0),n.formSettings.dateFormat));break;case"equalToDate":i.push(ct(o(l,"equal_to",!0),n.formSettings.dateFormat));break;case"otherThanDate":i.push(dt(o(l,"other_than",!0),n.formSettings.dateFormat));break}}),d.length>0?d.map(s=>{switch(s){case"allowBlank":return Pe(i);case"allowNull":return Ue(i)}}):i}function Oe(){return a=>!!a||"Ce champ est requis"}function ee(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function ze(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${ee.toString()}`)}function $e(){return a=>!a||"Ce champ doit être vide"}function Ie(){return a=>!!a||"Doit être accepté"}function Ue(a){return t=>(t===null||a.forEach(n=>{const o=n(t);if(o!==!0)return o}),!0)}function Pe(a){return t=>(t===""||a.forEach(n=>{const o=n(t);if(o!==!0)return o}),!0)}function qe(){return a=>Number(a)>0||"Val. positive uniquement"}function Le(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function Qe(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function Ge(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function He(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function je(a,t){return n=>{const o=a();return Number(n)===o||`Égale à ${o}`}}function Me(a,t){return n=>{const o=a();return Number(n)!==o||`Doit être différent de ${a}`}}function We(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function Ye(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function Je(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function Ke(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function Xe(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function Ze(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function ve(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function et(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function tt(a,t){return n=>{const o=a(),r=t();return String(n).length>=o&&String(n).length<=r||`Entre ${o} et ${r}`}}function nt(a,t){return n=>{const o=a();return String(n)===o||`Égale à ${o}`}}function ot(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function rt(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function at(a,t){return n=>{const o=a(),r=m.date.extractDate(String(n),t),i=m.date.extractDate(o,t);return r<=i||`Inf. ou égal à ${o}`}}function it(a,t){return n=>{const o=a(),r=m.date.extractDate(String(n),t),i=m.date.extractDate(o,t);return r<i||`Inf. à ${o}`}}function lt(a,t){return n=>{const o=a(),r=m.date.extractDate(String(n),t),i=m.date.extractDate(o,t);return r>=i||`Sup. ou égal à ${o}`}}function st(a,t){return n=>{const o=a(),r=m.date.extractDate(String(n),t),i=m.date.extractDate(o,t);return r>i||`Sup. à ${o}`}}function ct(a,t){return n=>{const o=a(),r=m.date.extractDate(String(n),t),i=m.date.extractDate(o,t);return r===i||`Égale à ${r}`}}function dt(a,t){return n=>{const o=a();return m.date.extractDate(String(n),t)!==m.date.extractDate(o,t)||`Doit être différent de ${o}`}}function te(a){return t=>t==null||t===""?!0:ft(t,a)||`Date invalide. Format : ${a}`}function ft(a,t){if(typeof a!="string"||!a.trim())return!1;const n=m.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:m.date.formatDate(n,t)===a}const ut={computeServerRules:Te},mt={key:2,class:"q-field__bottom text-negative q-pt-none"},pt=["index"],ht=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{},context:{}},setup(a,{expose:t}){const n=a;let o=()=>!0,r=()=>!0,i=()=>{};const d=B(),s=e.ref(),l=e.ref([]);function p(){s.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),s.value=S(s.value),R(n.field.events.onReset),e.nextTick(()=>{Q()})}function S(f){const b=n.formApi;switch(n.field.type){case"checkbox":return f==null||f===""?!1:f;case"date":return f==null||f===""?null:m.date.formatDate(m.date.extractDate(String(f),b.formSettings.backendDateFormat),b.formSettings.dateFormat);case"datetime":return f==null||f===""?null:m.date.formatDate(m.date.extractDate(String(f),b.formSettings.backendDatetimeFormat),b.formSettings.datetimeFormat)}return f}function _(f){const b=n.formApi;switch(n.field.type){case"date":return f==null||f===""?null:m.date.formatDate(m.date.extractDate(String(f),b.formSettings.dateFormat),b.formSettings.backendDateFormat);case"datetime":return f==null||f===""?null:m.date.formatDate(m.date.extractDate(String(f),b.formSettings.datetimeFormat),b.formSettings.backendDatetimeFormat)}return f}function y(){switch(n.field.type){case"string":s.value="";break;case"checkbox":s.value=!1;break;case"date":s.value=null;break;case"datetime":s.value=null;break;case"number":s.value=null;break;case"selectString":s.value=void 0;break;case"text":s.value="";break;case"object":s.value={};break;case"selectBelongsTo":s.value=void 0;break;case"selectHasMany":s.value=void 0;break}R(n.field.events.onClear)}function B(){return ut.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function D(f){s.value=f}function F(){return e.unref(s)}function C(){return _(e.unref(s))}function V(f){l.value=f}function u(){const f=n.privateFormApi.getFieldRef(n.field.metadata.field_name);f&&(f.hidden=!0)}function g(){const f=n.privateFormApi.getFieldRef(n.field.metadata.field_name);f&&(f.hidden=!1)}function A(f){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.readonly=f)}function M(f){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.hint=f)}function W(f){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.cssClass=f)}function Y(f){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.suffix=f)}function J(f){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.prefix=f)}function K(f){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.label=f)}function q(){const f=o();return R(n.field.events.onValidated),f}function L(){return r()}function Q(){return i()}function X(f,b,$){o=f,r=b,i=$}return t({reset:p,clear:y,validate:q,isValid:L,hide:u,unhide:g,resetValidation:Q,getValueDeserialized:C,getValueSerialized:F,setupBackendErrors:V,setReadonlyState:A,setHint:M,setCssClass:W,setSuffix:Y,setPrefix:J,setLabel:K}),e.watch(()=>n.field.events.onUpdate?s.value:null,()=>{R(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid?L():null,f=>{f&&R(n.field.events.onIsValid)}),e.onMounted(()=>{var b;p();const f=(b=e.getCurrentInstance())==null?void 0:b.exposed;f&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,f)}),(f,b)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(n.field.hidden?"submit64-field-hidden":"")},[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,field:n.field,formApi:n.formApi},null,8,["field","formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:s.value,field:n.field,formApi:n.formApi,rules:e.unref(d),reset:p,clear:y,getValueDeserialized:C,getValueSerialized:F,validate:q,modelValueOnUpdate:D,registerBehaviourCallbacks:X},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,field:n.field,formApi:n.formApi},null,8,["field","formApi"])):e.createCommentVNode("",!0),l.value.length>0?(e.openBlock(),e.createElementBlock("div",mt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,($,Z)=>(e.openBlock(),e.createElementBlock("div",{index:Z,class:"flex column"},e.toDisplayString($),9,pt))),256))])):e.createCommentVNode("",!0)],2))}}),gt=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{},context:{}},setup(a,{expose:t}){const n=a,o=new Map,r={reset:d,clear:s,validate:S,isValid:_,hide:l,unhide:p,resetValidation:y,getFields:B,setReadonlyState:D,setCssClass:F,setIcon:C,setLabel:V,...j({...n.section})};function i(){n.section.fields.forEach(u=>{const g=u.metadata.field_name,A=n.formApi.getField(g);A&&o.set(g,A)})}function d(){o.forEach(u=>{u.reset()}),R(n.section.events.onReset)}function s(){o.forEach(u=>{u.clear()}),R(n.section.events.onClear)}function l(){const u=n.privateFormApi.getSectionRef(n.section.name);u&&(o.forEach(g=>{g.hide()}),u.hidden=!0,R(n.section.events.onHide))}function p(){const u=n.privateFormApi.getSectionRef(n.section.name);u&&(o.forEach(g=>{g.unhide()}),u.hidden=!1,R(n.section.events.onUnhide))}function S(){let u=!0;return o.forEach(g=>{if(!g.validate()){u=!1;return}}),R(n.section.events.onValidated),u}function _(){let u=!0;return o.forEach(g=>{if(!g.isValid()){u=!1;return}}),u}function y(){o.forEach(u=>{u.resetValidation()})}function B(){return o}function D(u){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(g.readonly=u)}function F(u){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(g.cssClass=u)}function C(u){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(g.icon=u)}function V(u){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(g.label=u)}return t(r),e.watch(()=>n.section.events.onIsValid?_():null,u=>{u&&R(n.section.events.onIsValid)}),e.onMounted(()=>{var g;const u=(g=e.getCurrentInstance())==null?void 0:g.exposed;u&&n.privateFormApi.registerSectionWrapperRef(n.section.name,u),i()}),(u,g)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["flex column",n.section.hidden?"submit64-section-hidden":""])},[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:r},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:r,formApi:n.formApi,context:n.context},null,8,["formApi","context"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:r},null,8,["formApi"])):e.createCommentVNode("",!0)],2))}}),yt={key:0,class:"flex column"},Ct=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let o=null,r="";const i=e.useSlots(),d=new Map,s=new Map,l=e.ref(),p=e.ref(!1),S=e.ref(!1),_=e.ref("create"),y=e.ref({});async function B(){var c,h;console.timeEnd("mount and ready"),o=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),console.time("mount and ready 2"),l.value=z.getForm(n.resourceName,n.resourceId,F(),o,n.formSettings,n.formStyle,n.context,O,n.eventManager),n.resourceId&&(_.value="edit"),p.value=!0,R((h=(c=l.value)==null?void 0:c.events)==null?void 0:h.onReady)}async function D(){var x,E;if(!V())return;S.value=!0,W();const c=C(),h=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:c,context:n.context});if(h.success)y.value={},_.value==="create"&&(_.value="edit"),o&&h.resource_data&&(o.resource_data=h.resource_data),r=JSON.stringify(C()),g();else{y.value={};const G=[];[...d].forEach(T=>{const H=h.errors[T[0]];H&&(T[1].setupBackendErrors(H),G.push(T[0]))}),Object.entries(h.errors).forEach(T=>{G.includes(T[0])||(y.value[T[0]]=T[1])})}R((E=(x=l.value)==null?void 0:x.events)==null?void 0:E.onSubmit),S.value=!1}function F(){const c={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const h in i){const x=i[h];if(x){const E=e.defineComponent({inheritAttrs:!1,setup(G,{attrs:T,slots:H}){return()=>x({...G,...T,slots:H})}});switch(h){case"sections":c.sectionComponent=E;break;case"actions":c.actionComponent=E;break;case"orphan-errors":c.orphanErrorsComponent=E;break;case"association-display":c.associationDisplayComponent=E;break;default:c.dynamicComponentRecord[h]=E;break}}}return c}function C(){const c={};return[...d].forEach(h=>{c[h[0]]=h[1].getValueDeserialized()}),c}function V(){var h,x;let c=!0;return d.forEach(E=>{if(!E.validate()){c=!1;return}}),R((x=(h=l.value)==null?void 0:h.events)==null?void 0:x.onValidated),c}function u(){let c=!0;return d.forEach(h=>{if(!h.isValid()){c=!1;return}}),c}function g(){var c,h;d.forEach(x=>{x.reset()}),R((h=(c=l.value)==null?void 0:c.events)==null?void 0:h.onReset)}function A(){var c,h;d.forEach(x=>{x.clear()}),R((h=(c=l.value)==null?void 0:c.events)==null?void 0:h.onClear)}function M(){d.forEach(c=>{c.resetValidation()})}function W(){d.forEach(c=>{c.setupBackendErrors([])})}function Y(c){if(o)return o.resource_data[c]}function J(c){return s.get(c)}function K(c){return d.get(c)}function q(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function L(){["getMetadataAndData","resourceName"].forEach(h=>{(n[h]===null||n[h]===void 0)&&console.warn(`Missing props for <Submit64> -> ${h}`)})}function Q(){return e.unref(_)}function X(){return r!==JSON.stringify(C())}function ne(c){l.value&&(l.value.context=c)}function f(c){l.value&&(l.value.cssClass=c)}function b(c){l.value&&(l.value.readonly=c)}function $(){return l}function Z(c){var h;return(h=l.value)==null?void 0:h.sections.find(x=>x.name===c)}function bt(c){var h;return(h=l.value)==null?void 0:h.sections.map(x=>x.fields).flat().find(x=>x.metadata.field_name===c)}function oe(c,h){s.set(c,h)}function re(c,h){d.set(c,h)}const ae={getFormRef:$,getSectionRef:Z,getFieldRef:bt,registerSectionWrapperRef:oe,registerFieldWrapperRef:re},O={getMode:Q,getSection:J,getField:K,validateForm:V,isFormValid:u,resetForm:g,clearForm:A,resetValidation:M,submitForm:D,valuesHasChanged:X,getInitialValueByFieldName:Y,getAssociationDataCallback:q,setContext:ne,setCssClass:f,setReadonlyState:b,...j({...l.value})};return t(O),e.watch(()=>{var c;return(c=l.value)!=null&&c.events.onIsValid?u():null},()=>{var c,h;R((h=(c=l.value)==null?void 0:c.events)==null?void 0:h.onIsValid)}),e.watch(()=>{var c;return(c=l.value)!=null&&c.events.onUpdate?C():null},()=>{var c,h;R((h=(c=l.value)==null?void 0:c.events)==null?void 0:h.onUpdate)}),e.onMounted(async()=>{console.time("mount and ready"),L(),await B(),console.time("mount and ready 2"),e.nextTick(()=>{r=JSON.stringify(C())})}),(c,h)=>p.value&&l.value?(e.openBlock(),e.createElementBlock("div",yt,[e.createElementVNode("div",{class:e.normalizeClass(l.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value.sections,x=>(e.openBlock(),e.createBlock(gt,{key:x.name,section:x,context:n.context,formApi:O,privateFormApi:ae,registerRef:oe},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.fields,E=>(e.openBlock(),e.createBlock(ht,{key:E.metadata.field_name,field:E,context:n.context,formApi:O,privateFormApi:ae,registerRef:re},null,8,["field","context"]))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(l.value.orphanErrorsComponent),{orphanErrors:y.value,formApi:O},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(l.value.actionComponent),{isLoadingSubmit:S.value,submit:D,clear:l.value.clearable?A:void 0,reset:l.value.resetable?g:void 0,formApi:O},null,8,["isLoadingSubmit","clear","reset"]))])):e.createCommentVNode("",!0)}});N.Submit64=w,N.Submit64Form=Ct,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
