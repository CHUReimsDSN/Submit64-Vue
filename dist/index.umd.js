(function($,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):($=typeof globalThis<"u"?globalThis:$||self,e($["submit64-vue"]={},$.Vue,$.Quasar))})(this,function($,e,m){"use strict";var an=Object.defineProperty;var ln=($,e,m)=>e in $?an($,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):$[e]=m;var E=($,e,m)=>ln($,typeof e!="symbol"?e+"":e,m);const ye={class:"flex column"},Ce={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},_e=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(a){const t=a;function n(){const r=t.formApi.form.formStyle;return{outline:r.fieldOutlined,rounded:r.fieldRounded,square:r.fieldSquare,dense:r.fieldDense,color:r.fieldColor,noCaps:!0}}return(r,o)=>(e.openBlock(),e.createElementBlock("div",ye,[e.createElementVNode("div",Ce,[e.createVNode(e.unref(m.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.formApi.submit}),null,16,["loading","onClick"]),t.formApi.reset?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.formApi.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.formApi.clear?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Effacer",onClick:t.formApi.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),be={class:"flex row items-center"},ke={class:"text-body1 text-weight-medium"},Se={class:"flex column q-gutter-md"},Ve=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",be,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(m.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",ke,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",Se,[e.renderSlot(n.$slots,"default")])]))}}),xe=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,r)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:r[0]||(r[0]=f=>t.reset())})}}}),Fe=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),Be={class:"flex column"},Ne=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",Be,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,f)=>(e.openBlock(),e.createElementBlock("div",{key:f,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(f)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),ee=class ee{constructor(){E(this,"_formSettings");E(this,"_formStyle");E(this,"_actionComponent");E(this,"_orphanErrorsComponent");E(this,"_sectionComponent");E(this,"_wrapperResetComponent");E(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0,associationEmptyMessage:"Empty",requiredFieldsHasAsterisk:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:""},this._actionComponent=_e,this._orphanErrorsComponent=Ne,this._sectionComponent=Ve,this._wrapperResetComponent=xe,this._associationDisplayComponent=Fe}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};E(ee,"_instance",new ee);let U=ee;class K{constructor(t){E(this,"formApi");E(this,"events",[]);this.formApi=t}when(t,n){const r=t,o=n,f=new De(r,o,this.formApi);return this.events.push(f),new we(f)}static create(t){return new K(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(r=>{const o=r.getTarget();switch(o.target){case"field":n.fields[o.targetName]||(n.fields[o.targetName]={}),n.fields[o.targetName][o.key]||(n.fields[o.targetName][o.key]=[]),n.fields[o.targetName][o.key].push(r.getActionCallback());break;case"section":n.sections[o.targetName]||(n.sections[o.targetName]={}),n.sections[o.targetName][o.key]||(n.sections[o.targetName][o.key]=[]),n.sections[o.targetName][o.key].push(r.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(r.getActionCallback());break}}),n}}class De{constructor(t,n,r){E(this,"type");E(this,"data");E(this,"formApi");E(this,"action",()=>{});E(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=r}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is invalid":return{target:"field",targetName:this.data.fieldName,key:"onIsInvalid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Field is ready":return{target:"field",targetName:this.data.fieldName,key:"onReady"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onIsValid"};case"Section is invalid":return{target:"section",targetName:this.data.sectionName,key:"onIsInvalid"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Section is updated":return{target:"section",targetName:this.data.sectionName,key:"onUpdate"};case"Section is ready":return{target:"section",targetName:this.data.sectionName,key:"onReady"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is invalid":return{target:"form",key:"onIsInvalid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class we{constructor(t){E(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const Re={class:"row items-center justify-end"},Ae=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,f=r.rulesBehaviour==="lazy",l=e.ref(),d=e.ref();function c(){l.value&&l.value.hide()}function s(){return d.value?d.value.validate():!1}function x(){return d.value?!d.value.hasError:!1}function k(){d.value&&d.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,x,k),f||e.nextTick(()=>{var N;(N=d.value)==null||N.resetValidation()})}),(N,i)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":i[1]||(i[1]=y=>t.modelValueOnUpdate(y)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"popupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":i[0]||(i[0]=y=>t.modelValueOnUpdate(y)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Re,[e.createVNode(e.unref(m.QBtn),{onClick:c,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ee={class:"row items-center justify-end"},Te={class:"row items-center justify-end"},Oe=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,f=r.rulesBehaviour==="lazy",l=e.ref(),d=e.ref(),c=e.ref();function s(){l.value&&l.value.hide()}function x(){d.value&&d.value.hide()}function k(){return c.value?c.value.validate():!1}function N(){return c.value?!c.value.hasError:!1}function i(){c.value&&c.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(k,N,i),f||e.nextTick(()=>{var y;(y=c.value)==null||y.resetValidation()})}),(y,_)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":_[2]||(_[2]=B=>t.modelValueOnUpdate(B)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"datePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=B=>t.modelValueOnUpdate(B)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Ee,[e.createVNode(e.unref(m.QBtn),{onClick:s,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"timePopupProxyRef",ref:d,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":_[1]||(_[1]=B=>t.modelValueOnUpdate(B)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Te,[e.createVNode(e.unref(m.QBtn),{onClick:x,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),ze={class:"flex column"},Ie={key:0,class:"q-field__bottom"},$e={key:1,class:"q-field--error q-field__bottom text-negative"},Ue=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),o=t.formApi.form.formStyle;function f(){return n.value===!0}function l(){return n.value===!0}function d(){n.value=!0}return e.watch(()=>t.modelValue,c=>{for(const s of t.rules)if(n.value=s(c),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(f,l,d)}),(c,s)=>(e.openBlock(),e.createElementBlock("div",ze,[e.createVNode(e.unref(m.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":s[0]||(s[0]=x=>t.modelValueOnUpdate(x)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",Ie,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",$e,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),qe=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),r=e.ref([]),o=e.ref(),f=t.formApi.form,l=f.formSettings,d=f.formStyle,c=l.rulesBehaviour==="lazy";function s(_,B){if(_===""){B(()=>{r.value=[...n.value]});return}B(()=>{const T=_.toLowerCase();r.value=n.value.filter(R=>R.label.toLowerCase().includes(T))})}function x(){n.value=Object.freeze(t.field.staticSelectOptions??[]),r.value=t.field.staticSelectOptions??[]}function k(){return o.value?o.value.validate():!1}function N(){return o.value?!o.value.hasError:!1}function i(){o.value&&o.value.resetValidation()}function y(){r.value=[]}return e.onMounted(()=>{x(),t.registerBehaviourCallbacks(k,N,i,void 0,y)}),(_,B)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=T=>t.modelValueOnUpdate(T)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(d).fieldOutlined,filled:e.unref(d).fieldFilled,standout:e.unref(d).fieldStandout,borderless:e.unref(d).fieldBorderless,rounded:e.unref(d).fieldRounded,square:e.unref(d).fieldSquare,dense:e.unref(d).fieldDense,hideBottomSpace:e.unref(d).fieldHideBottomSpace,color:e.unref(d).fieldColor,bgColor:e.unref(d).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:r.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:s},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(m.QItem),{dense:e.unref(d).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),le="__init",ie=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,f=r.formStyle,l=o.rulesBehaviour==="lazy",d=e.ref([]),c=e.ref(k()),s=e.ref(),x=e.ref(le);function k(){return{limit:30,nextPage:1,lastPage:2,isLoading:!1}}function N(b,S){if(b===x.value){S(()=>{});return}const C=t.formApi.getAssociationDataCallback();c.value=k(),x.value=b;const z=t.formApi.form;c.value.isLoading=!0,C({resourceName:z.resourceName,resourceId:z.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:b,context:z.context}).then(w=>{S(()=>{d.value=w.rows,c.value.nextPage=2,c.value.lastPage=Math.ceil(w.row_count/c.value.limit),c.value.isLoading=!1})}).catch(()=>{d.value=[],c.value=k()})}function i(){var S,C;const b=t.getValueSerialized();!b||!t.field.associationData||(d.value=[{label:((S=t.field.associationData[0])==null?void 0:S.label)??"???",value:b,data:(C=t.field.associationData[0])==null?void 0:C.data}])}function y(){return s.value?s.value.validate():!1}function _(){return s.value?!s.value.hasError:!1}function B(){s.value&&s.value.resetValidation()}function T(){c.value=k(),d.value=[],x.value=le}function R(b){const S=d.value.length-1;if(c.value.isLoading!==!0&&c.value.nextPage<c.value.lastPage&&b.to===S&&S!==-1){const C=t.formApi.form,z=t.formApi.getAssociationDataCallback();c.value.isLoading=!0,z({resourceName:C.resourceName,resourceId:C.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:x.value,context:C.context}).then(w=>{d.value=d.value.concat(w.rows),c.value.lastPage=Math.ceil(w.row_count/c.value.limit),w.row_count>=c.value.limit&&c.value.nextPage++,c.value.isLoading=!1,b.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(y,_,B,i,T),e.nextTick(()=>{i()})}),(b,S)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=C=>t.modelValueOnUpdate(C)),label:t.field.label,outlined:e.unref(f).fieldOutlined,filled:e.unref(f).fieldFilled,standout:e.unref(f).fieldStandout,borderless:e.unref(f).fieldBorderless,rounded:e.unref(f).fieldRounded,square:e.unref(f).fieldSquare,dense:e.unref(f).fieldDense,hideBottomSpace:e.unref(f).fieldHideBottomSpace,color:e.unref(f).fieldColor,bgColor:e.unref(f).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:d.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:N,onVirtualScroll:R},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(m.QItem),{dense:e.unref(f).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(C=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:C.opt,itemProps:C.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),se="__init",ce=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,f=r.formStyle,l=o.rulesBehaviour==="lazy",d=e.ref([]),c=e.ref(k()),s=e.ref(),x=e.ref(se);function k(){return{limit:30,nextPage:1,lastPage:100,isLoading:!1}}function N(b,S){if(b===x.value){S(()=>{});return}const C=t.formApi.getAssociationDataCallback();c.value=k(),x.value=b;const z=t.formApi.form;c.value.isLoading=!0,C({resourceName:z.resourceName,resourceId:z.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:b,context:z.context}).then(w=>{S(()=>{d.value=w.rows,c.value.nextPage=2,c.value.lastPage=Math.ceil(w.row_count/c.value.limit),c.value.isLoading=!1})}).catch(()=>{d.value=[],c.value=k()})}function i(){const b=t.getValueSerialized();!b||!t.field.associationData||(d.value=b.map((S,C)=>({label:t.field.associationData[C].label??"???",value:S,data:t.field.associationData[C].data})))}function y(){return s.value?s.value.validate():!1}function _(){return s.value?!s.value.hasError:!1}function B(){s.value&&s.value.resetValidation()}function T(){c.value=k(),d.value=[],x.value=se}function R(b){const S=d.value.length-1;if(c.value.isLoading!==!0&&c.value.nextPage<c.value.lastPage&&b.to===S&&S!==-1){const C=t.formApi.form,z=t.formApi.getAssociationDataCallback();c.value.isLoading=!0,z({resourceName:C.resourceName,resourceId:C.resourceId,associationName:t.field.metadata.field_association_name,limit:c.value.limit,offset:(c.value.nextPage-1)*c.value.limit,labelFilter:x.value,context:C.context}).then(w=>{d.value=d.value.concat(w.rows),c.value.lastPage=Math.ceil(w.row_count/c.value.limit),w.row_count>=c.value.limit&&c.value.nextPage++,c.value.isLoading=!1,b.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(y,_,B,i,T),e.nextTick(()=>{i()})}),(b,S)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=C=>t.modelValueOnUpdate(C)),label:t.field.label,hint:t.field.hint,outlined:e.unref(f).fieldOutlined,filled:e.unref(f).fieldFilled,standout:e.unref(f).fieldStandout,borderless:e.unref(f).fieldBorderless,rounded:e.unref(f).fieldRounded,square:e.unref(f).fieldSquare,dense:e.unref(f).fieldDense,hideBottomSpace:e.unref(f).fieldHideBottomSpace,color:e.unref(f).fieldColor,bgColor:e.unref(f).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:d.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.clear,onFilter:N,onVirtualScroll:R},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(m.QItem),{dense:e.unref(f).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(C=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:C.opt,itemProps:C.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),re=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,f=r.rulesBehaviour==="lazy",l=e.ref();function d(){return l.value?l.value.validate():!1}function c(){return l.value?!l.value.hasError:!1}function s(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,c,s)}),(x,k)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":k[0]||(k[0]=N=>t.modelValueOnUpdate(N)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Pe=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,f=r.rulesBehaviour==="lazy",l=e.ref();function d(){return l.value?l.value.validate():!1}function c(){return l.value?!l.value.hasError:!1}function s(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,c,s)}),(x,k)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":k[0]||(k[0]=N=>t.modelValueOnUpdate(N)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}}),Le=e.defineComponent({__name:"ColorField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,f=r.rulesBehaviour==="lazy",l=e.ref();function d(){return l.value?l.value.validate():!1}function c(){return l.value?!l.value.hasError:!1}function s(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,c,s)}),(x,k)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":k[1]||(k[1]=N=>t.modelValueOnUpdate(N)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{name:"colorize",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QColor),{"model-value":t.modelValue,"onUpdate:modelValue":k[0]||(k[0]=N=>t.modelValueOnUpdate(N))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Qe=e.defineComponent({__name:"WysiwygField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=m.useQuasar(),o=t.formApi.form.formStyle,f=[[{label:n.lang.editor.align,icon:n.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:n.lang.editor.formatting,icon:n.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:n.lang.editor.fontSize,icon:n.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:n.lang.editor.defaultFont,icon:n.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],l={arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"},d=e.ref();function c(){return!!d.value}function s(){return!!d.value}function x(){}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,s,x)}),(k,N)=>t.modelValue?(e.openBlock(),e.createBlock(e.unref(m.QEditor),{key:0,ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":N[0]||(N[0]=i=>t.modelValueOnUpdate(i)),toolbar:f,fonts:l,placeholder:t.field.label,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly},null,8,["model-value","placeholder","square","dense","class","readonly"])):e.createCommentVNode("",!0)}}),Me=e.defineComponent({__name:"JsonField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.form,r=n.formSettings;return n.formStyle,r.rulesBehaviour,(o,f)=>" TODO json edit ? "}});function A(a){a==null||a.forEach(t=>{t()})}function de(a){const t=["B","KB","MB","GB","TB","PB"];let n=0;for(;parseInt(a.toString(),10)>=1024&&n<t.length-1;)a/=1024,++n;return`${a.toFixed(1)}${t[n]}`}const He={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},Ge={class:"col"},je={class:"q-uploader__title"},Ye=e.defineComponent({__name:"AttachmentHasOneField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,r=t.formApi.form.formStyle,o=e.ref();function f(){let i=t.modelValue;i.add=[],i.delete=[],t.modelValueOnUpdate(i)}function l(){var y;let i=t.modelValue;i.add=[],i.delete=((y=t.field.attachmentData)==null?void 0:y.map(_=>_.id))??[],t.modelValueOnUpdate(i)}function d(){return!!o.value}function c(){return!!o.value}function s(){o.value}function x(i){const y=i[0];if(!y)return;let _=t.modelValue;_.add.push(y),t.modelValueOnUpdate(_)}function k(i){const y=i[0];if(!y)return;let _=t.modelValue;_.add=_.add.filter(B=>B.key!==y.key),t.modelValueOnUpdate(_)}function N(i){let y=t.modelValue;y.delete.push(i.id),t.modelValueOnUpdate(y)}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,c,s,f,l)}),(i,y)=>{const _=e.resolveComponent("q-spinner"),B=e.resolveComponent("q-uploader-add-trigger"),T=e.resolveComponent("q-btn"),R=e.resolveComponent("q-item-label"),b=e.resolveComponent("q-item-section"),S=e.resolveComponent("q-item"),C=e.resolveComponent("q-list"),z=e.resolveComponent("q-separator");return e.openBlock(),e.createBlock(e.unref(m.QUploader),{ref_key:"fieldRef",ref:o,"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(r).fieldBorderless!==!0,square:e.unref(r).fieldSquare,color:e.unref(r).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:x,onRemoved:k},{header:e.withCtx(w=>[e.createElementVNode("div",He,[w.isUploading?(e.openBlock(),e.createBlock(_,{key:0,class:"q-uploader__spinner"})):e.createCommentVNode("",!0),e.createElementVNode("div",Ge,[e.createElementVNode("div",je,e.toDisplayString(t.field.label),1)]),w.canAddFiles?(e.openBlock(),e.createBlock(T,{key:1,type:"a",icon:"add_box",onClick:w.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(B)]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(w=>[y[0]||(y[0]=e.createElementVNode("div",null,"Déjà upload",-1)),e.createVNode(C,{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],O=>(e.openBlock(),e.createBlock(S,{key:O.id},{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(R,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.filename),1)]),_:2},1024),e.createVNode(R,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(de)(O.size)),1)]),_:2},1024)]),_:2},1024),e.createVNode(b,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>N(O)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}),e.createVNode(z),y[1]||(y[1]=e.createElementVNode("div",null,"Pending",-1)),e.createVNode(C,{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.files,O=>(e.openBlock(),e.createBlock(S,{key:O.__key},{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(R,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.name),1)]),_:2},1024),e.createVNode(R,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(b,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>w.removeFile(O)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["label","bordered","square","color","class","readonly"])}}}),We={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},Je={class:"col"},Ke={class:"q-uploader__title"},Xe={class:"q-uploader__subtitle"},Ze=e.defineComponent({__name:"AttachmentHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,r=t.formApi.form.formStyle,o=e.ref();function f(){let i=t.modelValue;i.add=[],i.delete=[],t.modelValueOnUpdate(i)}function l(){var y;let i=t.modelValue;i.add=[],i.delete=((y=t.field.attachmentData)==null?void 0:y.map(_=>_.id))??[],t.modelValueOnUpdate(i)}function d(){return!!o.value}function c(){return!!o.value}function s(){o.value}function x(i){const y=i;if(!y)return;let _=t.modelValue;y.forEach(B=>{_.add.push(B)}),t.modelValueOnUpdate(_)}function k(i){const y=i;let _=t.modelValue;_.add=_.add.filter(B=>!y.map(T=>T.key).includes(B.key)),t.modelValueOnUpdate(_)}function N(i){let y=t.modelValue;y.delete.push(i.id),t.modelValueOnUpdate(y)}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,c,s,f,l)}),(i,y)=>{const _=e.resolveComponent("q-spinner"),B=e.resolveComponent("q-uploader-add-trigger"),T=e.resolveComponent("q-btn"),R=e.resolveComponent("q-item-label"),b=e.resolveComponent("q-item-section"),S=e.resolveComponent("q-item"),C=e.resolveComponent("q-separator"),z=e.resolveComponent("q-list");return e.openBlock(),e.createBlock(e.unref(m.QUploader),{ref_key:"fieldRef",ref:o,"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(r).fieldBorderless!==!0,square:e.unref(r).fieldSquare,color:e.unref(r).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:x,onRemoved:k},{header:e.withCtx(w=>[e.createElementVNode("div",We,[w.isUploading?(e.openBlock(),e.createBlock(_,{key:0,class:"q-uploader__spinner"})):e.createCommentVNode("",!0),e.createElementVNode("div",Je,[e.createElementVNode("div",Ke,e.toDisplayString(t.field.label),1),e.createElementVNode("div",Xe,"Total : "+e.toDisplayString(w.uploadSizeLabel),1)]),w.canAddFiles?(e.openBlock(),e.createBlock(T,{key:1,type:"a",icon:"add_box",onClick:w.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(B)]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(w=>[e.createVNode(z,{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],O=>(e.openBlock(),e.createBlock(S,{key:O.id},{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(R,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.filename),1)]),_:2},1024),e.createVNode(R,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(de)(O.size)),1)]),_:2},1024)]),_:2},1024),e.createVNode(b,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>N(O)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e.createVNode(C),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(w.files,O=>(e.openBlock(),e.createBlock(S,{key:O.__key},{default:e.withCtx(()=>[e.createVNode(b,null,{default:e.withCtx(()=>[e.createVNode(R,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.name),1)]),_:2},1024),e.createVNode(R,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(b,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>w.removeFile(O)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["label","bordered","square","color","class","readonly"])}}});class M{constructor(t,n,r,o,f,l,d,c,s){E(this,"resourceName");E(this,"resourceId");E(this,"formMetadataAndData");E(this,"context");E(this,"formSettings");E(this,"formStyle");E(this,"actionComponent");E(this,"orphanErrorsComponent");E(this,"sectionComponent");E(this,"wrapperResetComponent");E(this,"associationDisplayComponent");E(this,"dynamicComponentRecord");E(this,"formApi");E(this,"registerEventCallback");this.dynamicComponentRecord=r.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=d,this.resourceName=t,this.formApi=c,this.formSettings={...f,...U.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...l,...U.getGlobalFormStyle()},this.actionComponent=r.actionComponent??U.getGlobalActionComponent(),this.orphanErrorsComponent=r.orphanErrorsComponent??U.getGlobalOrphanErrorComponent(),this.sectionComponent=r.sectionComponent??U.getGlobalSectionComponent(),this.wrapperResetComponent=r.wrapperResetComponent??U.getGlobalWrapperResetComponent(),this.associationDisplayComponent=r.associationDisplayComponent??U.getGlobalAssociationDisplayComponent(),this.registerEventCallback=s??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...U.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:U.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(U.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(U.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(U.getGlobalWrapperResetComponent()),dynamicComponentRecord:{},allowBulk:!1}}static getForm(t,n,r,o,f,l,d,c,s){return new M(t,n,r,o,f,l,d,c,s).generateFormDef()}generateFormDef(){const t=K.create(this.formApi);this.registerEventCallback(t);const n=new Set,r=K.getEventsObjectFromInstance(t),o=[];this.formMetadataAndData.form.sections.forEach((l,d)=>{const c=[];l.fields.forEach(i=>{const y=this.dynamicComponentRecord[`field-${i.field_name}-before`],_=M.getFieldComponentByFormFieldType(i),B=this.dynamicComponentRecord[`field-${i.field_name}-after`],T={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:M.getRegularFieldTypeByFieldType(i.field_type)};let R=i.label;this.formSettings.requiredFieldsHasAsterisk&&i.rules.find(S=>S.type==="required")&&(R=R.concat("*"));const b={type:i.field_type,extraType:i.field_extra_type,metadata:Object.freeze(i),label:R,hint:i.hint??void 0,prefix:i.prefix??void 0,suffix:i.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??l.readonly??i.readonly??void 0,cssClass:i.css_class??void 0,staticSelectOptions:i.static_select_options,associationData:i.field_association_data,attachmentData:i.field_attachment_data,rules:i.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:y?e.markRaw(y):void 0,mainComponent:e.markRaw(_),afterComponent:B?e.markRaw(B):void 0,events:r.fields[i.field_name]??{},componentOptions:T};c.push(b),n.add(i.field_name)});const s=this.dynamicComponentRecord[`section-${l.name??d}-before`],x=this.sectionComponent,k=this.dynamicComponentRecord[`section-${l.name??d}-after`],N={label:l.label??void 0,icon:l.icon??void 0,cssClass:l.css_class??void 0,hidden:!1,name:l.name??d.toString(),readonly:this.formMetadataAndData.form.readonly??l.readonly??void 0,events:r.sections[l.name??d.toString()]??{},beforeComponent:s?e.markRaw(s):void 0,mainComponent:e.markRaw(x),afterComponent:k?e.markRaw(k):void 0,fields:c};o.push(N)});const f={sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,allowBulk:this.formMetadataAndData.form.allow_bulk??!1,events:r.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context};return n.size<this.formMetadataAndData.form.sections.reduce((l,d)=>l+d.fields.length,0)&&console.warn("Submit64 -> Found fields with the same name"),f}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){switch(t.field_type){case"string":switch(t.field_extra_type){case"color":return Le;case"wysiwyg":return Qe;default:return re}case"text":return re;case"number":return Pe;case"date":return Ae;case"datetime":return Oe;case"select":return qe;case"selectBelongsTo":return ie;case"selectHasMany":return ce;case"selectHasAndBelongsToMany":return ce;case"selectHasOne":return ie;case"checkbox":return Ue;case"object":return Me;case"attachmentHasOne":return Ye;case"attachmentHasMany":return Ze;default:return re}}}function ve(a,t,n){const r=n.form,o=(c,s,x)=>c[s]?x?()=>f(c[s]):()=>c[s]:c.compare_to?()=>{var k;return((k=n.getFieldByName(c.compare_to))==null?void 0:k.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",f=c=>String(m.date.formatDate(m.date.extractDate(c,r.formSettings.backendDateFormat),r.formSettings.dateFormat)),l=[],d=[];switch(t){case"date":l.push(ue(r.formSettings.dateFormat));break;case"datetime":l.push(ue(r.formSettings.datetimeFormat));break}return a.forEach(c=>{const s=c;switch(s.type){case"required":l.push(et());break;case"absence":l.push(nt());break;case"acceptance":l.push(ot());break;case"inclusion":l.push(fe(s.including));break;case"exclusion":l.push(tt(s.excluding));break;case"backend":break;case"allowNull":d.push("allowNull");break;case"allowBlank":d.push("allowBlank");break;case"positiveNumber":l.push(lt());break;case"lessThanOrEqualNumber":l.push(it(o(s,"less_than")));break;case"lessThanNumber":l.push(st(o(s,"less_than")));break;case"greaterThanOrEqualNumber":l.push(ct(o(s,"greater_than")));break;case"greaterThanNumber":l.push(dt(o(s,"greater_than")));break;case"equalToNumber":l.push(ft(o(s,"equal_to")));break;case"otherThanNumber":l.push(ut(o(s,"other_than")));break;case"numberIntegerOnly":l.push(mt());break;case"numberNumericOnly":l.push(pt());break;case"numberEvenOnly":l.push(gt());break;case"numberOddOnly":l.push(ht());break;case"lessThanOrEqualStringLength":l.push(yt(o(s,"less_than")));break;case"lessThanStringLength":l.push(Ct(o(s,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(_t(o(s,"greater_than")));break;case"greaterThanStringLength":l.push(bt(o(s,"greater_than")));break;case"equalToStringLength":l.push(Vt(o(s,"equal_to")));break;case"equalToString":l.push(St(o(s,"equal_to")));break;case"betweenStringLength":l.push(kt(()=>s.min,()=>s.max));break;case"otherThanString":l.push(xt(o(s,"other_than")));break;case"lessThanOrEqualDate":l.push(Ft(o(s,"less_than",!0),r.formSettings.dateFormat));break;case"lessThanDate":l.push(Bt(o(s,"less_than",!0),r.formSettings.dateFormat));break;case"greaterThanOrEqualDate":l.push(Nt(o(s,"greater_than",!0),r.formSettings.dateFormat));break;case"greaterThanDate":l.push(Dt(o(s,"greater_than",!0),r.formSettings.dateFormat));break;case"equalToDate":l.push(wt(o(s,"equal_to",!0),r.formSettings.dateFormat));break;case"otherThanDate":l.push(Rt(o(s,"other_than",!0),r.formSettings.dateFormat));break}}),d.length>0?d.map(c=>{switch(c){case"allowBlank":return at(l);case"allowNull":return rt(l)}}):l}function et(){return a=>!!a||"Ce champ est requis"}function fe(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function tt(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${fe.toString()}`)}function nt(){return a=>!a||"Ce champ doit être vide"}function ot(){return a=>!!a||"Doit être accepté"}function rt(a){return t=>(t===null||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function at(a){return t=>(t===""||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function lt(){return a=>Number(a)>0||"Val. positive uniquement"}function it(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function st(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function ct(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function dt(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function ft(a,t){return n=>{const r=a();return Number(n)===r||`Égale à ${r}`}}function ut(a,t){return n=>{const r=a();return Number(n)!==r||`Doit être différent de ${a}`}}function mt(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function pt(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function gt(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function ht(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function yt(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function Ct(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function _t(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function bt(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function kt(a,t){return n=>{const r=a(),o=t();return String(n).length>=r&&String(n).length<=o||`Entre ${r} et ${o}`}}function St(a,t){return n=>{const r=a();return String(n)===r||`Égale à ${r}`}}function Vt(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function xt(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function Ft(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),f=m.date.extractDate(r,t);return o<=f||`Inf. ou égal à ${r}`}}function Bt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),f=m.date.extractDate(r,t);return o<f||`Inf. à ${r}`}}function Nt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),f=m.date.extractDate(r,t);return o>=f||`Sup. ou égal à ${r}`}}function Dt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),f=m.date.extractDate(r,t);return o>f||`Sup. à ${r}`}}function wt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),f=m.date.extractDate(r,t);return o===f||`Égale à ${o}`}}function Rt(a,t){return n=>{const r=a();return m.date.extractDate(String(n),t)!==m.date.extractDate(r,t)||`Doit être différent de ${r}`}}function ue(a){return t=>t==null||t===""?!0:At(t,a)||`Date invalide. Format : ${a}`}function At(a,t){if(typeof a!="string"||!a.trim())return!1;const n=m.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:m.date.formatDate(n,t)===a}const Et={computeServerRules:ve},Tt={key:2,class:"q-field__bottom text-negative q-pt-none"},Ot=["index"],zt=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=()=>!0,o=()=>!0,f=()=>{},l=()=>{},d=()=>{};const c=B(),s=e.ref(),x=e.ref([]);function k(){s.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),s.value=i(s.value)}function N(){s.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),s.value=i(s.value),A(n.field.events.onReset),l(),e.nextTick(()=>{te()})}function i(p){const D=n.formApi.form;switch(n.field.type){case"checkbox":return p==null||p===""?!1:p;case"date":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),D.formSettings.backendDateFormat),D.formSettings.dateFormat);case"datetime":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),D.formSettings.backendDatetimeFormat),D.formSettings.datetimeFormat);case"attachmentHasOne":case"attachmentHasMany":return{add:[],delete:[]}}return p}function y(p){const D=n.formApi.form;switch(n.field.type){case"date":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),D.formSettings.dateFormat),D.formSettings.backendDateFormat);case"datetime":return p==null||p===""?null:m.date.formatDate(m.date.extractDate(String(p),D.formSettings.datetimeFormat),D.formSettings.backendDatetimeFormat)}return p}function _(){switch(n.field.type){case"string":s.value="";break;case"checkbox":s.value=!1;break;case"date":s.value=null;break;case"datetime":s.value=null;break;case"number":s.value=null;break;case"select":s.value=void 0;break;case"text":s.value="";break;case"object":s.value={};break;case"selectBelongsTo":s.value=void 0;break;case"selectHasMany":s.value=void 0;break;case"selectHasAndBelongsToMany":s.value=void 0;break;case"selectHasOne":s.value=void 0;break;case"attachmentHasOne":case"attachmentHasMany":s.value={add:[],delete:[]};break}d(),A(n.field.events.onClear)}function B(){return Et.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function T(p){s.value=p}function R(){return e.unref(s)}function b(){return y(e.unref(s))}function S(p){x.value=p}function C(){const p=n.privateFormApi.getFieldRef(n.field.metadata.field_name);p&&(p.hidden=!0,A(n.field.events.onHide))}function z(){const p=n.privateFormApi.getFieldRef(n.field.metadata.field_name);p&&(p.hidden=!1,A(n.field.events.onUnhide))}function w(p){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.readonly=p)}function O(p){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.hint=p)}function P(p){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.cssClass=p)}function Q(p){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.suffix=p)}function g(p){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.prefix=p)}function V(p){const D=n.privateFormApi.getFieldRef(n.field.metadata.field_name);D&&(D.label=p)}function I(){const p=r();return A(n.field.events.onValidated),p}function X(){return o()}function Z(){return!X()}function te(){return f()}function ae(p,D,H,J,ne){r=p,o=D,f=H,J&&(l=J),ne&&(d=ne)}const v={softReset:k,reset:N,clear:_,validate:I,isValid:X,isInvalid:Z,hide:C,unhide:z,resetValidation:te,getValueDeserialized:b,getValueSerialized:R,setupBackendErrors:S,setReadonlyState:w,setHint:O,setCssClass:P,setSuffix:Q,setPrefix:g,setLabel:V,setValue:T,field:n.field};return t(v),e.watch(()=>n.field.events.onUpdate?s.value:null,()=>{A(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid||n.field.events.onIsInvalid?s.value:null,p=>{A(p?n.field.events.onIsValid:n.field.events.onIsInvalid)}),e.onMounted(()=>{var D,H;k();const p=(D=e.getCurrentInstance())==null?void 0:D.exposed;p&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,p),A((H=n.field)==null?void 0:H.events.onReady)}),(p,D)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:v},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:s.value,field:n.field,formApi:n.formApi,rules:e.unref(c),reset:N,clear:_,getValueDeserialized:b,getValueSerialized:R,validate:I,modelValueOnUpdate:T,registerBehaviourCallbacks:ae},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:v},null,8,["formApi"])):e.createCommentVNode("",!0),x.value.length>0?(e.openBlock(),e.createElementBlock("div",Tt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.value,(H,J)=>(e.openBlock(),e.createElementBlock("div",{index:J,class:"flex column"},e.toDisplayString(H),9,Ot))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),It={class:"flex column"},$t=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=null,o=null,f=null;const l={softReset:s,reset:x,clear:k,validate:y,isValid:_,isInvalid:B,hide:N,unhide:i,resetValidation:T,getFields:R,setReadonlyState:b,setCssClass:S,setIcon:C,setLabel:z,section:n.section},d=e.ref(new Map);function c(){n.section.fields.forEach(g=>{const V=g.metadata.field_name,I=n.formApi.getFieldByName(V);I&&d.value.set(V,I)})}function s(){d.value.forEach(g=>{g.softReset()})}function x(){d.value.forEach(g=>{g.reset()}),A(n.section.events.onReset)}function k(){d.value.forEach(g=>{g.clear()}),A(n.section.events.onClear)}function N(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(d.value.forEach(V=>{V.hide()}),g.hidden=!0,A(n.section.events.onHide))}function i(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(d.value.forEach(V=>{V.unhide()}),g.hidden=!1,A(n.section.events.onUnhide))}function y(){let g=!0;return d.value.forEach(V=>{if(!V.validate()){g=!1;return}}),A(n.section.events.onValidated),g}function _(){let g=!0;return d.value.forEach(V=>{if(!V.isValid()){g=!1;return}}),g}function B(){return!_()}function T(){d.value.forEach(g=>{g.resetValidation()})}function R(){return d.value}function b(g){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.readonly=g)}function S(g){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.cssClass=g)}function C(g){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.icon=g)}function z(g){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.label=g)}function w(){const g={};for(const[V,I]of d.value)g[V]=I.getValueSerialized();return g}t(l);const O=e.computed(()=>_()),P=e.computed(()=>B()),Q=e.computed(()=>w());return e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onIsValid},g=>{r==null||r(),r=null,g&&(r=e.watch(O,V=>{V&&A(n.section.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onIsInvalid},g=>{o==null||o(),o=null,g&&(o=e.watch(P,V=>{var I;V&&A((I=n.section)==null?void 0:I.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var g;return(g=n.section)==null?void 0:g.events.onUpdate},g=>{f==null||f(),f=null,g&&(f=e.watch(Q,()=>{var V;A((V=n.section)==null?void 0:V.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(()=>{var V;const g=(V=e.getCurrentInstance())==null?void 0:V.exposed;g&&n.privateFormApi.registerSectionWrapperRef(n.section.name,g),e.nextTick(()=>{var I;c(),A((I=n.section)==null?void 0:I.events.onReady)})}),(g,V)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",It,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:l,formApi:n.formApi},{default:e.withCtx(()=>[e.renderSlot(g.$slots,"default")]),_:3},8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}}),Ut={class:"flex column"},qt=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let r=null,o="",f=0,l=0,d=null,c=null,s=null,x=null,k=null;const N=e.useSlots(),i=e.ref(M.getEmptyFormBeforeInit()),y=e.ref(!1),_=e.ref(!1),B=e.ref(!1),T=e.ref(!1),R=e.ref("create"),b=e.ref({}),S=e.ref(new Map),C=e.ref(new Map);async function z(){r=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),i.value=M.getForm(n.resourceName,n.resourceId,P(),r,n.formSettings,n.formStyle,n.context,G,n.eventManager),f=i.value.sections.length,l=i.value.sections.map(u=>u.fields).flat().length,n.resourceId&&(R.value="edit")}async function w(){var F,q,Y;if(!V())return;A((F=i.value)==null?void 0:F.events.onSubmit),T.value=!0,p();const u=Q(),h=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:u,context:n.context});if(x=h.resource_data,h.success)b.value={},R.value==="create"&&(R.value="edit"),r&&h.resource_data&&(r.resource_data=h.resource_data),i.value=M.getForm(n.resourceName,n.resourceId,P(),{form:h.form,resource_data:h.resource_data},n.formSettings,n.formStyle,n.context,G,n.eventManager),Z(),o=JSON.stringify(Q()),A((Y=i.value)==null?void 0:Y.events.onSubmitSuccess);else{b.value={};const W=[];for(const[L,j]of C.value){const oe=h.errors[L];oe&&(j.setupBackendErrors(oe),W.push(L))}Object.entries(h.errors).forEach(L=>{W.includes(L[0])||(b.value[L[0]]=L[1])}),A((q=i.value)==null?void 0:q.events.onSubmitUnsuccess)}T.value=!1}async function O(u){var q,Y,W;if(!i.value.allowBulk||R.value==="edit"){console.warn("Submit64 : you are not allowed to submitBulk");return}if(!V())return;A((q=i.value)==null?void 0:q.events.onSubmit),T.value=!0,p();const h=Q(),F=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:h,bulkCount:u,context:n.context});if(k=F.bulk_data,F.success)b.value={},R.value==="create"&&(R.value="edit"),r&&F.resource_data&&(r.resource_data=F.resource_data),i.value=M.getForm(n.resourceName,n.resourceId,P(),{form:F.form,resource_data:F.resource_data},n.formSettings,n.formStyle,n.context,G,n.eventManager),Z(),o=JSON.stringify(Q()),A((W=i.value)==null?void 0:W.events.onSubmitSuccess);else{b.value={};const L=[];for(const[j,oe]of C.value){const he=F.errors[j];he&&(oe.setupBackendErrors(he),L.push(j))}Object.entries(F.errors).forEach(j=>{L.includes(j[0])||(b.value[j[0]]=j[1])}),A((Y=i.value)==null?void 0:Y.events.onSubmitUnsuccess)}T.value=!1}function P(){const u={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const h in N){const F=N[h];if(F){const q=e.defineComponent({inheritAttrs:!1,setup(Y,{attrs:W,slots:L}){return()=>F({...Y,...W,slots:L})}});switch(h){case"sections":u.sectionComponent=q;break;case"actions":u.actionComponent=q;break;case"orphan-errors":u.orphanErrorsComponent=q;break;case"association-display":u.associationDisplayComponent=q;break;default:u.dynamicComponentRecord[h]=q;break}}}return u}function Q(){const u={};for(const[h,F]of C.value)u[h]=F.getValueDeserialized();return u}function g(){const u={};for(const[h,F]of C.value)u[h]=F.getValueSerialized();return u}function V(){var h;let u=!0;return C.value.forEach(F=>{if(!F.validate()){u=!1;return}}),A((h=i.value)==null?void 0:h.events.onValidated),u}function I(){let u=!0;return C.value.forEach(h=>{if(!h.isValid()){u=!1;return}}),u}function X(){return!I()}function Z(){S.value.forEach(u=>{u.softReset()})}function te(){var u;C.value.forEach(h=>{h.reset()}),A((u=i.value)==null?void 0:u.events.onReset)}function ae(){var u;C.value.forEach(h=>{h.clear()}),A((u=i.value)==null?void 0:u.events.onClear)}function v(){C.value.forEach(u=>{u.resetValidation()})}function p(){C.value.forEach(u=>{u.setupBackendErrors([])})}function D(u){if(r)return r.resource_data[u]}function H(u){return S.value.get(u)}function J(u){return[...S.value.values()].at(u)}function ne(){return S.value}function Pt(u){return C.value.get(u)}function Lt(){return C.value}function Qt(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function Mt(){["getMetadataAndData","resourceName"].forEach(h=>{(n[h]===null||n[h]===void 0)&&console.warn(`Missing props for <Submit64> -> ${h}`)})}function Ht(){return e.unref(R)}function Gt(){return o!==JSON.stringify(Q())}function jt(u){i.value&&(i.value.context=u)}function Yt(u){i.value&&(i.value.cssClass=u)}function Wt(u){i.value&&(i.value.readonly=u)}function Jt(){return B.value}function Kt(){return x}function Xt(){return k}function Zt(){return i}function vt(u){var h;return(h=i.value)==null?void 0:h.sections.find(F=>F.name===u)}function en(u){var h;return(h=i.value)==null?void 0:h.sections.map(F=>F.fields).flat().find(F=>F.metadata.field_name===u)}function me(u,h){S.value.set(u,h),f===S.value.size&&(y.value=!0)}function pe(u,h){C.value.set(u,h),l===C.value.size&&(_.value=!0)}const ge={getFormRef:Zt,getSectionRef:vt,getFieldRef:en,registerSectionWrapperRef:me,registerFieldWrapperRef:pe},tn=new Proxy({},{get(u,h){var F;return(F=i.value)==null?void 0:F[h]}}),G={getMode:Ht,getSectionByName:H,getSectionByIndex:J,getSections:ne,getFieldByName:Pt,getFields:Lt,validate:V,isValid:I,isInvalid:X,softReset:Z,reset:te,clear:ae,resetValidation:v,submit:w,submitBulk:O,valuesHasChanged:Gt,getInitialValueByFieldName:D,getAssociationDataCallback:Qt,setContext:jt,setCssClass:Yt,setReadonlyState:Wt,isReady:Jt,getSubmitData:Kt,getBulkSubmitData:Xt,form:tn};t(G);const nn=e.computed(()=>I()),on=e.computed(()=>X()),rn=e.computed(()=>g());return e.watch(()=>y.value&&_.value,u=>{var h;u&&!B.value&&(A((h=i.value)==null?void 0:h.events.onReady),B.value=!0)}),e.watch(()=>{var u;return(u=i.value)==null?void 0:u.events.onIsValid},u=>{d==null||d(),d=null,u&&(d=e.watch(nn,h=>{var F;h&&A((F=i.value)==null?void 0:F.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var u;return(u=i.value)==null?void 0:u.events.onIsInvalid},u=>{c==null||c(),c=null,u&&(c=e.watch(on,h=>{var F;h&&A((F=i.value)==null?void 0:F.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var u;return(u=i.value)==null?void 0:u.events.onUpdate},u=>{s==null||s(),s=null,u&&(s=e.watch(rn,()=>{var h;A((h=i.value)==null?void 0:h.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(async()=>{Mt(),await z(),e.nextTick(()=>{o=JSON.stringify(Q())})}),(u,h)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",Ut,[e.createElementVNode("div",{class:e.normalizeClass(i.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value.sections,F=>(e.openBlock(),e.createBlock($t,{key:F.name,section:F,context:n.context,formApi:G,privateFormApi:ge,registerRef:me},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(F.fields,q=>(e.openBlock(),e.createBlock(zt,{key:q.metadata.field_name,field:q,context:n.context,formApi:G,privateFormApi:ge,registerRef:pe},null,8,["field","context"]))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(i.value.orphanErrorsComponent),{orphanErrors:b.value,formApi:G},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(i.value.actionComponent),{isLoadingSubmit:T.value,formApi:G},null,8,["isLoadingSubmit"]))],512)),[[e.vShow,B.value]])}});$.DynamicLogicBuilder=K,$.Submit64=U,$.Submit64Form=qt,Object.defineProperty($,Symbol.toStringTag,{value:"Module"})});
