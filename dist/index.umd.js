(function($,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):($=typeof globalThis<"u"?globalThis:$||self,e($["submit64-vue"]={},$.Vue,$.Quasar))})(this,function($,e,d){"use strict";var Vn=Object.defineProperty;var Sn=($,e,d)=>e in $?Vn($,e,{enumerable:!0,configurable:!0,writable:!0,value:d}):$[e]=d;var E=($,e,d)=>Sn($,typeof e!="symbol"?e+"":e,d);const he={class:"flex column"},ge={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},ye=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(a){const t=a;function n(){const r=t.formApi.form.formStyle;return{outline:r.fieldOutlined,rounded:r.fieldRounded,square:r.fieldSquare,dense:r.fieldDense,color:r.fieldColor,noCaps:!0}}return(r,o)=>(e.openBlock(),e.createElementBlock("div",he,[e.createElementVNode("div",ge,[e.createVNode(e.unref(d.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.formApi.submit}),null,16,["loading","onClick"]),t.formApi.reset?(e.openBlock(),e.createBlock(e.unref(d.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.formApi.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.formApi.clear?(e.openBlock(),e.createBlock(e.unref(d.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Effacer",onClick:t.formApi.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),Ce={class:"flex row items-center"},be={class:"text-body1 text-weight-medium"},_e={class:"flex column q-gutter-md"},ke=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(t.sectionApi.section.cssClass)},[e.createElementVNode("div",Ce,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(d.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",be,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",_e,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(t.sectionApi.section.fieldsComponent)))])],2))}}),Ve=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,r)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:r[0]||(r[0]=l=>t.reset())})}}}),Se=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createBlock(e.unref(d.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),Fe={class:"flex column"},xe=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",Fe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,l)=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(l)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),oe=class oe{constructor(){E(this,"_formSettings");E(this,"_formStyle");E(this,"_actionComponent");E(this,"_orphanErrorsComponent");E(this,"_sectionComponent");E(this,"_wrapperResetComponent");E(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0,associationEmptyMessage:"Empty",requiredFieldsHasAsterisk:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:""},this._actionComponent=ye,this._orphanErrorsComponent=xe,this._sectionComponent=ke,this._wrapperResetComponent=Ve,this._associationDisplayComponent=Se}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};E(oe,"_instance",new oe);let U=oe;class ee{constructor(t){E(this,"formApi");E(this,"events",[]);this.formApi=t}when(t,n){const r=t,o=n,l=new Be(r,o,this.formApi);return this.events.push(l),new Ne(l)}static create(t){return new ee(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(r=>{const o=r.getTarget();switch(o.target){case"field":n.fields[o.targetName]||(n.fields[o.targetName]={}),n.fields[o.targetName][o.key]||(n.fields[o.targetName][o.key]=[]),n.fields[o.targetName][o.key].push(r.getActionCallback());break;case"section":n.sections[o.targetName]||(n.sections[o.targetName]={}),n.sections[o.targetName][o.key]||(n.sections[o.targetName][o.key]=[]),n.sections[o.targetName][o.key].push(r.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(r.getActionCallback());break}}),n}}class Be{constructor(t,n,r){E(this,"type");E(this,"data");E(this,"formApi");E(this,"action",()=>{});E(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=r}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is invalid":return{target:"field",targetName:this.data.fieldName,key:"onIsInvalid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Field is ready":return{target:"field",targetName:this.data.fieldName,key:"onReady"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onIsValid"};case"Section is invalid":return{target:"section",targetName:this.data.sectionName,key:"onIsInvalid"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Section is updated":return{target:"section",targetName:this.data.sectionName,key:"onUpdate"};case"Section is ready":return{target:"section",targetName:this.data.sectionName,key:"onReady"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is invalid":return{target:"form",key:"onIsInvalid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class Ne{constructor(t){E(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const De={class:"row items-center justify-end"},we=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",u=e.ref(),i=e.ref();function s(){u.value&&u.value.hide()}function f(){return i.value?i.value.validate():!1}function p(){return i.value?!i.value.hasError:!1}function _(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(f,p,_),l||e.nextTick(()=>{var B;(B=i.value)==null||B.resetValidation()})}),(B,c)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":c[1]||(c[1]=D=>t.modelValueOnUpdate(D)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"popupProxyRef",ref:u,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":c[0]||(c[0]=D=>t.modelValueOnUpdate(D)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",De,[e.createVNode(e.unref(d.QBtn),{onClick:s,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Re={class:"row items-center justify-end"},Ae={class:"row items-center justify-end"},Ee=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",u=e.ref(),i=e.ref(),s=e.ref();function f(){u.value&&u.value.hide()}function p(){i.value&&i.value.hide()}function _(){return s.value?s.value.validate():!1}function B(){return s.value?!s.value.hasError:!1}function c(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(_,B,c),l||e.nextTick(()=>{var D;(D=s.value)==null||D.resetValidation()})}),(D,w)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":w[2]||(w[2]=S=>t.modelValueOnUpdate(S)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"datePopupProxyRef",ref:u,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":w[0]||(w[0]=S=>t.modelValueOnUpdate(S)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Re,[e.createVNode(e.unref(d.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(d.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{ref_key:"timePopupProxyRef",ref:i,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":w[1]||(w[1]=S=>t.modelValueOnUpdate(S)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Ae,[e.createVNode(e.unref(d.QBtn),{onClick:p,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Te={class:"flex column"},ze={key:0,class:"q-field__bottom"},Oe={key:1,class:"q-field--error q-field__bottom text-negative"},Ie=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),o=t.formApi.form.formStyle;function l(){return n.value===!0}function u(){return n.value===!0}function i(){n.value=!0}return e.watch(()=>t.modelValue,s=>{for(const f of t.rules)if(n.value=f(s),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(l,u,i)}),(s,f)=>(e.openBlock(),e.createElementBlock("div",Te,[e.createVNode(e.unref(d.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":f[0]||(f[0]=p=>t.modelValueOnUpdate(p)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",ze,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",Oe,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),$e=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),r=e.ref([]),o=e.ref(),l=t.formApi.form,u=l.formSettings,i=l.formStyle,s=u.rulesBehaviour==="lazy";function f(w,S){if(w===""){S(()=>{r.value=[...n.value]});return}S(()=>{const T=w.toLowerCase();r.value=n.value.filter(z=>z.label.toLowerCase().includes(T))})}function p(){n.value=Object.freeze(t.field.staticSelectOptions??[]),r.value=t.field.staticSelectOptions??[]}function _(){return o.value?o.value.validate():!1}function B(){return o.value?!o.value.hasError:!1}function c(){o.value&&o.value.resetValidation()}function D(){r.value=[]}return e.onMounted(()=>{p(),t.registerBehaviourCallbacks(_,B,c,void 0,D)}),(w,S)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=T=>t.modelValueOnUpdate(T)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(i).fieldOutlined,filled:e.unref(i).fieldFilled,standout:e.unref(i).fieldStandout,borderless:e.unref(i).fieldBorderless,rounded:e.unref(i).fieldRounded,square:e.unref(i).fieldSquare,dense:e.unref(i).fieldDense,hideBottomSpace:e.unref(i).fieldHideBottomSpace,color:e.unref(i).fieldColor,bgColor:e.unref(i).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:r.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:f},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(d.QItem),{dense:e.unref(i).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),se="__init",ce=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,l=r.formStyle,u=o.rulesBehaviour==="lazy",i=e.ref([]),s=e.ref(_()),f=e.ref(),p=e.ref(se);function _(){return{limit:30,nextPage:1,lastPage:2,isLoading:!1}}function B(k,g){if(k===p.value){g(()=>{});return}const h=t.formApi.getAssociationDataCallback();s.value=_(),p.value=k;const x=t.formApi.form;s.value.isLoading=!0,h({resourceName:x.resourceName,resourceId:x.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:k,context:x.context}).then(V=>{g(()=>{i.value=V.rows,s.value.nextPage=2,s.value.lastPage=Math.ceil(V.row_count/s.value.limit),s.value.isLoading=!1})}).catch(()=>{i.value=[],s.value=_()})}function c(){var g,h;const k=t.getValueSerialized();!k||!t.field.associationData||(i.value=[{label:((g=t.field.associationData[0])==null?void 0:g.label)??"???",value:k,data:(h=t.field.associationData[0])==null?void 0:h.data}])}function D(){return f.value?f.value.validate():!1}function w(){return f.value?!f.value.hasError:!1}function S(){f.value&&f.value.resetValidation()}function T(){s.value=_(),i.value=[],p.value=se}function z(k){const g=i.value.length-1;if(s.value.isLoading!==!0&&s.value.nextPage<s.value.lastPage&&k.to===g&&g!==-1){const h=t.formApi.form,x=t.formApi.getAssociationDataCallback();s.value.isLoading=!0,x({resourceName:h.resourceName,resourceId:h.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:p.value,context:h.context}).then(V=>{i.value=i.value.concat(V.rows),s.value.lastPage=Math.ceil(V.row_count/s.value.limit),V.row_count>=s.value.limit&&s.value.nextPage++,s.value.isLoading=!1,k.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(D,w,S,c,T),e.nextTick(()=>{c()})}),(k,g)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":g[0]||(g[0]=h=>t.modelValueOnUpdate(h)),label:t.field.label,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":u,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:i.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:B,onVirtualScroll:z},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(d.QItem),{dense:e.unref(l).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(h=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:h.opt,itemProps:h.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),de="__init",fe=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,l=r.formStyle,u=o.rulesBehaviour==="lazy",i=e.ref([]),s=e.ref(_()),f=e.ref(),p=e.ref(de);function _(){return{limit:30,nextPage:1,lastPage:100,isLoading:!1}}function B(k,g){if(k===p.value){g(()=>{});return}const h=t.formApi.getAssociationDataCallback();s.value=_(),p.value=k;const x=t.formApi.form;s.value.isLoading=!0,h({resourceName:x.resourceName,resourceId:x.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:k,context:x.context}).then(V=>{g(()=>{i.value=V.rows,s.value.nextPage=2,s.value.lastPage=Math.ceil(V.row_count/s.value.limit),s.value.isLoading=!1})}).catch(()=>{i.value=[],s.value=_()})}function c(){const k=t.getValueSerialized();!k||!t.field.associationData||(i.value=k.map((g,h)=>({label:t.field.associationData[h].label??"???",value:g,data:t.field.associationData[h].data})))}function D(){return f.value?f.value.validate():!1}function w(){return f.value?!f.value.hasError:!1}function S(){f.value&&f.value.resetValidation()}function T(){s.value=_(),i.value=[],p.value=de}function z(k){const g=i.value.length-1;if(s.value.isLoading!==!0&&s.value.nextPage<s.value.lastPage&&k.to===g&&g!==-1){const h=t.formApi.form,x=t.formApi.getAssociationDataCallback();s.value.isLoading=!0,x({resourceName:h.resourceName,resourceId:h.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:p.value,context:h.context}).then(V=>{i.value=i.value.concat(V.rows),s.value.lastPage=Math.ceil(V.row_count/s.value.limit),V.row_count>=s.value.limit&&s.value.nextPage++,s.value.isLoading=!1,k.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(D,w,S,c,T),e.nextTick(()=>{c()})}),(k,g)=>(e.openBlock(),e.createBlock(e.unref(d.QSelect),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":g[0]||(g[0]=h=>t.modelValueOnUpdate(h)),label:t.field.label,hint:t.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":u,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:i.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.clear,onFilter:B,onVirtualScroll:z},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(d.QItem),{dense:e.unref(l).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(h=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:h.opt,itemProps:h.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),le=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",u=e.ref();function i(){return u.value?u.value.validate():!1}function s(){return u.value?!u.value.hasError:!1}function f(){u.value&&u.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(i,s,f)}),(p,_)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=B=>t.modelValueOnUpdate(B)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ue=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",u=e.ref();function i(){return u.value?u.value.validate():!1}function s(){return u.value?!u.value.hasError:!1}function f(){u.value&&u.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(i,s,f)}),(p,_)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=B=>t.modelValueOnUpdate(B)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}}),Le=e.defineComponent({__name:"ColorField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",u=e.ref();function i(){return u.value?u.value.validate():!1}function s(){return u.value?!u.value.hasError:!1}function f(){u.value&&u.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(i,s,f)}),(p,_)=>(e.openBlock(),e.createBlock(e.unref(d.QInput),{ref_key:"fieldRef",ref:u,"model-value":t.modelValue,"onUpdate:modelValue":_[1]||(_[1]=B=>t.modelValueOnUpdate(B)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(d.QIcon),{name:"colorize",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QPopupProxy),{cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QColor),{"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=B=>t.modelValueOnUpdate(B))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Pe=e.defineComponent({__name:"WysiwygField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=d.useQuasar(),o=t.formApi.form.formStyle,l=[[{label:n.lang.editor.align,icon:n.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:n.lang.editor.formatting,icon:n.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:n.lang.editor.fontSize,icon:n.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:n.lang.editor.defaultFont,icon:n.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],u={arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"},i=e.ref();function s(){return!!i.value}function f(){return!!i.value}function p(){}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,f,p)}),(_,B)=>t.modelValue?(e.openBlock(),e.createBlock(e.unref(d.QEditor),{key:0,ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=c=>t.modelValueOnUpdate(c)),toolbar:l,fonts:u,placeholder:t.field.label,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly},null,8,["model-value","placeholder","square","dense","class","readonly"])):e.createCommentVNode("",!0)}}),Qe=e.defineComponent({__name:"JsonField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.form,r=n.formSettings;return n.formStyle,r.rulesBehaviour,(o,l)=>" TODO json edit ? "}});function A(a){a==null||a.forEach(t=>{t()})}function H(a){const t=["B","KB","MB","GB","TB","PB"];let n=0;for(;parseInt(a.toString(),10)>=1024&&n<t.length-1;)a/=1024,++n;return`${a.toFixed(1)}${t[n]}`}const qe={class:"flex column"},Me={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},He={class:"col"},Ge={class:"q-uploader__title"},je={key:0,class:"caption"},Ye={key:0,class:"flex column"},We={key:2,class:"flex column"},Je={key:0,class:"q-field--error q-field__bottom text-negative"},Ke=e.defineComponent({__name:"AttachmentHasOneField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,r=t.formApi.form.formStyle,o=e.ref(null);function l(){let g=t.modelValue;g.add=[],g.delete=[],t.modelValueOnUpdate(g),S()}function u(){var h;let g=t.modelValue;g.add=[],g.delete=((h=t.field.attachmentData)==null?void 0:h.map(x=>x.id))??[],t.modelValueOnUpdate(g),S()}function i(){return S(),s()}function s(){return o.value===null}function f(){o.value=null}async function p(g){return new Promise(h=>{const x=new Blob([g]),V=new FileReader;V.onload=O=>{var M;const P=((M=O.target)==null?void 0:M.result)??"",[Q,J]=P.split(",");h(J)},V.readAsDataURL(x)})}async function _(g){return{key:`${g.lastModified}${g.name}`,size:g.size,filename:g.name,contentType:g.type,base64:await p(await g.arrayBuffer())}}async function B(g){if(!g[0])return;const h=await _(g[0]);let x=t.modelValue;x.add.push(h),t.modelValueOnUpdate(x),S()}async function c(g){if(!g[0])return;const h=await _(g[0]);let x=t.modelValue;x.add=x.add.filter(V=>V.key!==h.key),t.modelValueOnUpdate(x),S()}function D(g){let h=t.modelValue;h.delete.push(g.id),t.modelValueOnUpdate(h),S()}function w(g){let h=t.modelValue;h.delete=h.delete.filter(x=>x!==g.id),t.modelValueOnUpdate(h),S()}function S(){o.value=null;for(const g of t.rules){const h=g(t.modelValue);if(typeof h=="string"){o.value=h;break}}}const T=e.computed(()=>(t.field.attachmentData??[]).length===0),z=e.computed(()=>t.modelValue?t.modelValue.delete:[]),k=e.computed(()=>{var g,h;return t.modelValue?(((g=t.field.attachmentData)==null?void 0:g.length)??0)===0||(((h=t.field.attachmentData)==null?void 0:h.length)??!0)&&t.modelValue.delete.length===1:!0});return e.onMounted(()=>{t.registerBehaviourCallbacks(i,s,f,l,u)}),(g,h)=>(e.openBlock(),e.createElementBlock("div",qe,[e.createVNode(e.unref(d.QUploader),{"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(r).fieldBorderless!==!0,square:e.unref(r).fieldSquare,color:e.unref(r).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:B,onRemoved:c,style:{width:"inherit"}},{header:e.withCtx(x=>[e.createElementVNode("div",Me,[e.createElementVNode("div",He,[e.createElementVNode("div",Ge,e.toDisplayString(t.field.label),1),t.field.hint?(e.openBlock(),e.createElementBlock("div",je,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0)]),x.canAddFiles&&k.value?(e.openBlock(),e.createBlock(e.unref(d.QBtn),{key:0,type:"a",icon:"add_box",onClick:x.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QUploaderAddTrigger))]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(x=>[T.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Ye,[h[0]||(h[0]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier déjà en ligne",-1)),e.createVNode(e.unref(d.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],V=>(e.openBlock(),e.createBlock(e.unref(d.QItem),{key:V.id},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(V.filename),1)]),_:2},1024),e.createVNode(e.unref(d.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(H)(V.size)),1)]),_:2},1024)]),_:2},1024),t.modelValue?(e.openBlock(),e.createBlock(e.unref(d.QItemSection),{key:0,top:"",side:""},{default:e.withCtx(()=>[z.value.includes(V.id)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(e.unref(d.QBtn),{key:0,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:O=>D(V)},null,8,["disable","onClick"])),z.value.includes(V.id)&&t.modelValue.add.length===0?(e.openBlock(),e.createBlock(e.unref(d.QBtn),{key:1,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"refresh",onClick:O=>w(V)},null,8,["disable","onClick"])):e.createCommentVNode("",!0)]),_:2},1024)):e.createCommentVNode("",!0)]),_:2},1024))),128))]),_:1})])),!T.value&&x.files.length>0?(e.openBlock(),e.createBlock(e.unref(d.QSeparator),{key:1})):e.createCommentVNode("",!0),x.files.length>0?(e.openBlock(),e.createElementBlock("div",We,[h[1]||(h[1]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier à télécharger",-1)),e.createVNode(e.unref(d.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.files,V=>(e.openBlock(),e.createBlock(e.unref(d.QItem),{key:V.__key},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(d.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(V.name),1)]),_:2},1024),e.createVNode(e.unref(d.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(V.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(e.unref(d.QItemSection),{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(e.unref(d.QBtn),{class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:O=>x.removeFile(V)},null,8,["disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):e.createCommentVNode("",!0)]),_:1},8,["label","bordered","square","color","class","readonly"]),o.value!==null?(e.openBlock(),e.createElementBlock("div",Je,e.toDisplayString(o.value),1)):e.createCommentVNode("",!0)]))}}),Xe={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},Ze={class:"col"},ve={class:"q-uploader__title"},et={class:"q-uploader__subtitle"},tt=e.defineComponent({__name:"AttachmentHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,r=t.formApi.form.formStyle,o=e.ref();function l(){let c=t.modelValue;c.add=[],c.delete=[],t.modelValueOnUpdate(c)}function u(){var D;let c=t.modelValue;c.add=[],c.delete=((D=t.field.attachmentData)==null?void 0:D.map(w=>w.id))??[],t.modelValueOnUpdate(c)}function i(){return!!o.value}function s(){return!!o.value}function f(){o.value}function p(c){const D=c;if(!D)return;let w=t.modelValue;D.forEach(S=>{w.add.push(S)}),t.modelValueOnUpdate(w)}function _(c){const D=c;let w=t.modelValue;w.add=w.add.filter(S=>!D.map(T=>T.key).includes(S.key)),t.modelValueOnUpdate(w)}function B(c){let D=t.modelValue;D.delete.push(c.id),t.modelValueOnUpdate(D)}return e.onMounted(()=>{t.registerBehaviourCallbacks(i,s,f,l,u)}),(c,D)=>{const w=e.resolveComponent("q-spinner"),S=e.resolveComponent("q-uploader-add-trigger"),T=e.resolveComponent("q-btn"),z=e.resolveComponent("q-item-label"),k=e.resolveComponent("q-item-section"),g=e.resolveComponent("q-item"),h=e.resolveComponent("q-separator"),x=e.resolveComponent("q-list");return e.openBlock(),e.createBlock(e.unref(d.QUploader),{ref_key:"fieldRef",ref:o,"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(r).fieldBorderless!==!0,square:e.unref(r).fieldSquare,color:e.unref(r).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:p,onRemoved:_},{header:e.withCtx(V=>[e.createElementVNode("div",Xe,[V.isUploading?(e.openBlock(),e.createBlock(w,{key:0,class:"q-uploader__spinner"})):e.createCommentVNode("",!0),e.createElementVNode("div",Ze,[e.createElementVNode("div",ve,e.toDisplayString(t.field.label),1),e.createElementVNode("div",et,"Total : "+e.toDisplayString(V.uploadSizeLabel),1)]),V.canAddFiles?(e.openBlock(),e.createBlock(T,{key:1,type:"a",icon:"add_box",onClick:V.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(S)]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(V=>[e.createVNode(x,{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],O=>(e.openBlock(),e.createBlock(g,{key:O.id},{default:e.withCtx(()=>[e.createVNode(k,null,{default:e.withCtx(()=>[e.createVNode(z,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.filename),1)]),_:2},1024),e.createVNode(z,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(H)(O.size)),1)]),_:2},1024)]),_:2},1024),e.createVNode(k,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>B(O)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e.createVNode(h),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(V.files,O=>(e.openBlock(),e.createBlock(g,{key:O.__key},{default:e.withCtx(()=>[e.createVNode(k,null,{default:e.withCtx(()=>[e.createVNode(z,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.name),1)]),_:2},1024),e.createVNode(z,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(O.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(k,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>V.removeFile(O)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["label","bordered","square","color","class","readonly"])}}});class G{constructor(t,n,r,o,l,u,i,s,f){E(this,"resourceName");E(this,"resourceId");E(this,"formMetadataAndData");E(this,"context");E(this,"formSettings");E(this,"formStyle");E(this,"actionComponent");E(this,"orphanErrorsComponent");E(this,"sectionComponent");E(this,"wrapperResetComponent");E(this,"associationDisplayComponent");E(this,"dynamicComponentRecord");E(this,"formApi");E(this,"registerEventCallback");this.dynamicComponentRecord=r.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=i,this.resourceName=t,this.formApi=s,this.formSettings={...l,...U.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...u,...U.getGlobalFormStyle()},this.actionComponent=r.actionComponent??U.getGlobalActionComponent(),this.orphanErrorsComponent=r.orphanErrorsComponent??U.getGlobalOrphanErrorComponent(),this.sectionComponent=r.sectionComponent??U.getGlobalSectionComponent(),this.wrapperResetComponent=r.wrapperResetComponent??U.getGlobalWrapperResetComponent(),this.associationDisplayComponent=r.associationDisplayComponent??U.getGlobalAssociationDisplayComponent(),this.registerEventCallback=f??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...U.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:U.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(U.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(U.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(U.getGlobalWrapperResetComponent()),dynamicComponentRecord:{},allowBulk:!1}}static getForm(t,n,r,o,l,u,i,s,f){return new G(t,n,r,o,l,u,i,s,f).generateFormDef()}generateFormDef(){const t=ee.create(this.formApi);this.registerEventCallback(t);const n=new Set,r=ee.getEventsObjectFromInstance(t),o=[];this.formMetadataAndData.form.sections.forEach((u,i)=>{const s=[];u.fields.forEach(c=>{const D=this.dynamicComponentRecord[`field-${c.field_name}-before`],w=G.getFieldComponentByFormFieldType(c),S=this.dynamicComponentRecord[`field-${c.field_name}-after`],T={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:G.getRegularFieldTypeByFieldType(c.field_type)};let z=c.label;this.formSettings.requiredFieldsHasAsterisk&&c.rules.find(g=>g.type==="required")&&(z=z.concat("*"));const k={type:c.field_type,extraType:c.field_extra_type,metadata:Object.freeze(c),label:z,hint:c.hint??void 0,prefix:c.prefix??void 0,suffix:c.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??u.readonly??c.readonly??void 0,cssClass:c.css_class??void 0,staticSelectOptions:c.static_select_options,associationData:c.field_association_data,attachmentData:c.field_attachment_data,rules:c.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:D?e.markRaw(D):void 0,mainComponent:e.markRaw(w),afterComponent:S?e.markRaw(S):void 0,events:r.fields[c.field_name]??{},componentOptions:T};s.push(k),n.add(c.field_name)});const f=this.dynamicComponentRecord[`section-${u.name??i}-before`],p=this.sectionComponent,_=this.dynamicComponentRecord[`section-${u.name??i}-after`],B={label:u.label??void 0,icon:u.icon??void 0,cssClass:u.css_class??void 0,hidden:!1,name:u.name??i.toString(),readonly:this.formMetadataAndData.form.readonly??u.readonly??void 0,events:r.sections[u.name??i.toString()]??{},beforeComponent:f?e.markRaw(f):void 0,mainComponent:e.markRaw(p),fieldsComponent:void 0,afterComponent:_?e.markRaw(_):void 0,fields:s};o.push(B)});const l={sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,allowBulk:this.formMetadataAndData.form.allow_bulk??!1,events:r.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context};return n.size<this.formMetadataAndData.form.sections.reduce((u,i)=>u+i.fields.length,0)&&console.warn("Submit64 -> Found fields with the same name"),l}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){switch(t.field_type){case"string":switch(t.field_extra_type){case"color":return Le;case"wysiwyg":return Pe;default:return le}case"text":return le;case"number":return Ue;case"date":return we;case"datetime":return Ee;case"select":return $e;case"selectBelongsTo":return ce;case"selectHasMany":return fe;case"selectHasAndBelongsToMany":return fe;case"selectHasOne":return ce;case"checkbox":return Ie;case"object":return Qe;case"attachmentHasOne":return Ke;case"attachmentHasMany":return tt;default:return le}}}const nt={class:"flex column"},ot=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=null,o=null,l=null;const u=e.useSlots(),i={softReset:p,reset:_,clear:B,validate:w,isValid:S,isInvalid:T,hide:c,unhide:D,resetValidation:z,getFields:k,setReadonlyState:g,setCssClass:h,setIcon:x,setLabel:V,section:n.section},s=e.ref(new Map);function f(){n.section.fields.forEach(y=>{const F=y.metadata.field_name,I=n.formApi.getFieldByName(F);I&&s.value.set(F,I)})}function p(){s.value.forEach(y=>{y.softReset()})}function _(){s.value.forEach(y=>{y.reset()}),A(n.section.events.onReset)}function B(){s.value.forEach(y=>{y.clear()}),A(n.section.events.onClear)}function c(){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(s.value.forEach(F=>{F.hide()}),y.hidden=!0,A(n.section.events.onHide))}function D(){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(s.value.forEach(F=>{F.unhide()}),y.hidden=!1,A(n.section.events.onUnhide))}function w(){let y=!0;return s.value.forEach(F=>{if(!F.validate()){y=!1;return}}),A(n.section.events.onValidated),y}function S(){let y=!0;return s.value.forEach(F=>{if(!F.isValid()){y=!1;return}}),y}function T(){return!S()}function z(){s.value.forEach(y=>{y.resetValidation()})}function k(){return s.value}function g(y){const F=n.privateFormApi.getSectionRef(n.section.name);F&&(F.readonly=y)}function h(y){const F=n.privateFormApi.getSectionRef(n.section.name);F&&(F.cssClass=y)}function x(y){const F=n.privateFormApi.getSectionRef(n.section.name);F&&(F.icon=y)}function V(y){const F=n.privateFormApi.getSectionRef(n.section.name);F&&(F.label=y)}function O(){const y={};for(const[F,I]of s.value)y[F]=I.getValueSerialized();return y}function P(){const y=u.default;if(!y){console.error("Submit64 : did not found fields slot for section "+n.section.name);return}const F=e.defineComponent({inheritAttrs:!1,setup(I,{attrs:Z,slots:te}){return()=>y({...I,...Z},te)}});n.privateFormApi.setSectionFieldComponent(n.section,e.markRaw(F))}t(i);const Q=e.computed(()=>S()),J=e.computed(()=>T()),M=e.computed(()=>O());return e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onIsValid},y=>{r==null||r(),r=null,y&&(r=e.watch(Q,F=>{F&&A(n.section.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onIsInvalid},y=>{o==null||o(),o=null,y&&(o=e.watch(J,F=>{var I;F&&A((I=n.section)==null?void 0:I.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onUpdate},y=>{l==null||l(),l=null,y&&(l=e.watch(M,()=>{var F;A((F=n.section)==null?void 0:F.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(()=>{var F;P();const y=(F=e.getCurrentInstance())==null?void 0:F.exposed;y&&n.privateFormApi.registerSectionWrapperRef(n.section.name,y),e.nextTick(()=>{var I;f(),A((I=n.section)==null?void 0:I.events.onReady)})}),(y,F)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",nt,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:i},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:i,formApi:n.formApi},null,8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:i},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}});function at(a,t){const n=a.rules??[],r=a.type,o=t.form,l=(f,p,_)=>f[p]?_?()=>u(f[p]):()=>f[p]:f.compare_to?()=>{var B;return((B=t.getFieldByName(f.compare_to))==null?void 0:B.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",u=f=>String(d.date.formatDate(d.date.extractDate(f,o.formSettings.backendDateFormat),o.formSettings.dateFormat)),i=[],s=[];switch(r){case"date":i.push(ie(o.formSettings.dateFormat));break;case"datetime":i.push(ie(o.formSettings.datetimeFormat));break}return n.forEach(f=>{const p=f;switch(p.type){case"required":i.push(rt());break;case"absence":i.push(it());break;case"acceptance":i.push(st());break;case"inclusion":i.push(ue(p.including));break;case"exclusion":i.push(lt(p.excluding));break;case"backend":break;case"allowNull":s.push("allowNull");break;case"allowBlank":s.push("allowBlank");break;case"positiveNumber":i.push(ft());break;case"lessThanOrEqualNumber":i.push(ut(l(p,"less_than")));break;case"lessThanNumber":i.push(mt(l(p,"less_than")));break;case"greaterThanOrEqualNumber":i.push(pt(l(p,"greater_than")));break;case"greaterThanNumber":i.push(ht(l(p,"greater_than")));break;case"equalToNumber":i.push(gt(l(p,"equal_to")));break;case"otherThanNumber":i.push(yt(l(p,"other_than")));break;case"numberIntegerOnly":i.push(Ct());break;case"numberNumericOnly":i.push(bt());break;case"numberEvenOnly":i.push(_t());break;case"numberOddOnly":i.push(kt());break;case"lessThanOrEqualStringLength":i.push(Vt(l(p,"less_than")));break;case"lessThanStringLength":i.push(St(l(p,"less_than")));break;case"greaterThanOrEqualStringLength":i.push(Ft(l(p,"greater_than")));break;case"greaterThanStringLength":i.push(xt(l(p,"greater_than")));break;case"equalToStringLength":i.push(Dt(l(p,"equal_to")));break;case"equalToString":i.push(Nt(l(p,"equal_to")));break;case"betweenStringLength":i.push(Bt(()=>p.min,()=>p.max));break;case"otherThanString":i.push(wt(l(p,"other_than")));break;case"validDate":i.push(ie(o.formSettings.dateFormat));break;case"lessThanOrEqualDate":i.push(Rt(l(p,"less_than",!0),o.formSettings.dateFormat));break;case"lessThanDate":i.push(At(l(p,"less_than",!0),o.formSettings.dateFormat));break;case"greaterThanOrEqualDate":i.push(Et(l(p,"greater_than",!0),o.formSettings.dateFormat));break;case"greaterThanDate":i.push(Tt(l(p,"greater_than",!0),o.formSettings.dateFormat));break;case"equalToDate":i.push(zt(l(p,"equal_to",!0),o.formSettings.dateFormat));break;case"otherThanDate":i.push(Ot(l(p,"other_than",!0),o.formSettings.dateFormat));break;case"requiredUploadFile":i.push($t());break;case"allowFileContentType":i.push(Ut(l(p,"including")));break;case"equalToFileLength":i.push(Lt(l(p,"equal_to")));break;case"lessThanOrEqualFileLength":i.push(Qt(l(p,"less_than")));break;case"greaterThanOrEqualFileLength":i.push(Pt(l(p,"greater_than")));break;case"lessThanOrEqualFileCount":i.push(qt(l(p,"less_than"),()=>a.attachmentData));break;case"greaterThanOrEqualFileCount":i.push(Mt(l(p,"greater_than"),()=>a.attachmentData));break;case"lessThanOrEqualTotalFileSize":i.push(Ht(l(p,"less_than")));case"greaterThanOrEqualTotalFileSize":i.push(Gt(l(p,"greater_than")));break;case"equalToTotalFileSize":i.push(jt(l(p,"equal_to")));break}}),s.length>0?s.map(f=>{switch(f){case"allowBlank":return dt(i);case"allowNull":return ct(i)}}):i}function rt(){return a=>!!a||"Ce champ est requis"}function ue(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function lt(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${ue.toString()}`)}function it(){return a=>!a||"Ce champ doit être vide"}function st(){return a=>!!a||"Doit être accepté"}function ct(a){return t=>(t===null||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function dt(a){return t=>(t===""||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function ft(){return a=>Number(a)>0||"Val. positive uniquement"}function ut(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function mt(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function pt(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function ht(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function gt(a,t){return n=>{const r=a();return Number(n)===r||`Égale à ${r}`}}function yt(a,t){return n=>{const r=a();return Number(n)!==r||`Doit être différent de ${a}`}}function Ct(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function bt(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function _t(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function kt(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function Vt(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function St(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function Ft(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function xt(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function Bt(a,t){return n=>{const r=a(),o=t();return String(n).length>=r&&String(n).length<=o||`Entre ${r} et ${o}`}}function Nt(a,t){return n=>{const r=a();return String(n)===r||`Égale à ${r}`}}function Dt(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function wt(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function Rt(a,t){return n=>{const r=a(),o=d.date.extractDate(String(n),t),l=d.date.extractDate(r,t);return o<=l||`Inf. ou égal à ${r}`}}function At(a,t){return n=>{const r=a(),o=d.date.extractDate(String(n),t),l=d.date.extractDate(r,t);return o<l||`Inf. à ${r}`}}function Et(a,t){return n=>{const r=a(),o=d.date.extractDate(String(n),t),l=d.date.extractDate(r,t);return o>=l||`Sup. ou égal à ${r}`}}function Tt(a,t){return n=>{const r=a(),o=d.date.extractDate(String(n),t),l=d.date.extractDate(r,t);return o>l||`Sup. à ${r}`}}function zt(a,t){return n=>{const r=a(),o=d.date.extractDate(String(n),t),l=d.date.extractDate(r,t);return o===l||`Égale à ${o}`}}function Ot(a,t){return n=>{const r=a();return d.date.extractDate(String(n),t)!==d.date.extractDate(r,t)||`Doit être différent de ${r}`}}function ie(a){return t=>t==null||t===""?!0:It(t,a)||`Date invalide. Format : ${a}`}function It(a,t){if(typeof a!="string"||!a.trim())return!1;const n=d.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:d.date.formatDate(n,t)===a}function $t(){return a=>a.add.length>0||"Ce champ est requis"}function Ut(a){return t=>{const n=t,r=a();let o=!0;n.add.forEach(u=>{o&&(r.includes(u.contentType)||(o=!1))});const l=a.length>1;return o||`Type${l?"s":""} autorisé${l?"s":""} : ${r.join(",")}`}}function Lt(a){return t=>{const n=t,r=a();let o=!0;return n.add.forEach(l=>{o&&r!==l.size&&(o=!1)}),o||`Taille par fichier ${H(r)}`}}function Pt(a){return t=>{const n=t,r=a();let o=!0;return n.add.forEach(l=>{o&&l.size<r&&(o=!1)}),o||`Taille par fichier min. ${H(r)}`}}function Qt(a){return t=>{const n=t,r=a();let o=!0;return n.add.forEach(l=>{o&&l.size>r&&(o=!1)}),o||`Taille par fichier max. ${H(r)}`}}function qt(a,t){return n=>{const r=n,o=a(),l=t();return r.add.length+((l==null?void 0:l.length)??0)-r.delete.length<=o||`${o} fichier${o>1?"s":""} max.`}}function Mt(a,t){return n=>{const r=n,o=a(),l=t();return r.add.length+((l==null?void 0:l.length)??0)-r.delete.length>=o||`${o} fichier${o>1?"s":""} min.`}}function Ht(a){return t=>{const n=t,r=a();return n.add.reduce((l,u)=>(l+=u.size,l),0)<=r||`${H(r)} max.`}}function Gt(a){return t=>{const n=t,r=a();return n.add.reduce((l,u)=>(l+=u.size,l),0)>=r||`${H(r)} min.`}}function jt(a){return t=>{const n=t,r=a();return n.add.reduce((l,u)=>(l+=u.size,l),0)===r||`Taille totale ${H(r)}`}}const Yt={computeServerRules:at},Wt={key:2,class:"q-field__bottom text-negative q-pt-none"},Jt=["index"],Kt=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=()=>!0,o=()=>!0,l=()=>{},u=()=>{},i=()=>{};const s=S(),f=e.ref(),p=e.ref([]);function _(){f.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),f.value=c(f.value)}function B(){f.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),f.value=c(f.value),A(n.field.events.onReset),u(),e.nextTick(()=>{Z()})}function c(C){const R=n.formApi.form;switch(n.field.type){case"checkbox":return C==null||C===""?!1:C;case"date":return C==null||C===""?null:d.date.formatDate(d.date.extractDate(String(C),R.formSettings.backendDateFormat),R.formSettings.dateFormat);case"datetime":return C==null||C===""?null:d.date.formatDate(d.date.extractDate(String(C),R.formSettings.backendDatetimeFormat),R.formSettings.datetimeFormat);case"attachmentHasOne":case"attachmentHasMany":return{add:[],delete:[]}}return C}function D(C){const R=n.formApi.form;switch(n.field.type){case"date":return C==null||C===""?null:d.date.formatDate(d.date.extractDate(String(C),R.formSettings.dateFormat),R.formSettings.backendDateFormat);case"datetime":return C==null||C===""?null:d.date.formatDate(d.date.extractDate(String(C),R.formSettings.datetimeFormat),R.formSettings.backendDatetimeFormat)}return C}function w(){switch(n.field.type){case"string":f.value="";break;case"checkbox":f.value=!1;break;case"date":f.value=null;break;case"datetime":f.value=null;break;case"number":f.value=null;break;case"select":f.value=void 0;break;case"text":f.value="";break;case"object":f.value={};break;case"selectBelongsTo":f.value=void 0;break;case"selectHasMany":f.value=void 0;break;case"selectHasAndBelongsToMany":f.value=void 0;break;case"selectHasOne":f.value=void 0;break;case"attachmentHasOne":case"attachmentHasMany":f.value={add:[],delete:[]};break}i(),A(n.field.events.onClear)}function S(){return Yt.computeServerRules(n.field,n.formApi)}function T(C){f.value=C}function z(){return e.unref(f)}function k(){return D(e.unref(f))}function g(C){p.value=C}function h(){const C=n.privateFormApi.getFieldRef(n.field.metadata.field_name);C&&(C.hidden=!0,A(n.field.events.onHide))}function x(){const C=n.privateFormApi.getFieldRef(n.field.metadata.field_name);C&&(C.hidden=!1,A(n.field.events.onUnhide))}function V(C){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.readonly=C)}function O(C){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.hint=C)}function P(C){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.cssClass=C)}function Q(C){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.suffix=C)}function J(C){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.prefix=C)}function M(C){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.label=C)}function y(){const C=r();return A(n.field.events.onValidated),C}function F(){return o()}function I(){return!F()}function Z(){return l()}function te(C,R,j,v,ae){r=C,o=R,l=j,v&&(u=v),ae&&(i=ae)}const ne={softReset:_,reset:B,clear:w,validate:y,isValid:F,isInvalid:I,hide:h,unhide:x,resetValidation:Z,getValueDeserialized:k,getValueSerialized:z,setupBackendErrors:g,setReadonlyState:V,setHint:O,setCssClass:P,setSuffix:Q,setPrefix:J,setLabel:M,setValue:T,field:n.field};return t(ne),e.watch(()=>n.field.events.onUpdate?f.value:null,()=>{A(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid||n.field.events.onIsInvalid?f.value:null,C=>{A(C?n.field.events.onIsValid:n.field.events.onIsInvalid)}),e.onMounted(()=>{var R,j;_();const C=(R=e.getCurrentInstance())==null?void 0:R.exposed;C&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,C),A((j=n.field)==null?void 0:j.events.onReady)}),(C,R)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:ne},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:f.value,field:n.field,formApi:n.formApi,rules:e.unref(s),reset:B,clear:w,getValueDeserialized:k,getValueSerialized:z,validate:y,modelValueOnUpdate:T,registerBehaviourCallbacks:te},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:ne},null,8,["formApi"])):e.createCommentVNode("",!0),p.value.length>0?(e.openBlock(),e.createElementBlock("div",Wt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value,(j,v)=>(e.openBlock(),e.createElementBlock("div",{index:v,class:"flex column"},e.toDisplayString(j),9,Jt))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),Xt={class:"flex column"},Zt=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let r=null,o="",l=0,u=0,i=null,s=null,f=null,p=null,_=null;const B=e.useSlots(),c=e.ref(G.getEmptyFormBeforeInit()),D=e.ref(!1),w=e.ref(!1),S=e.ref(!1),T=e.ref(!1),z=e.ref("create"),k=e.ref({}),g=e.ref(new Map),h=e.ref(new Map);async function x(){r=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),c.value=G.getForm(n.resourceName,n.resourceId,P(),r,n.formSettings,n.formStyle,n.context,Y,n.eventManager),l=c.value.sections.length,u=c.value.sections.map(m=>m.fields).flat().length,n.resourceId&&(z.value="edit")}async function V(){var N,L,K;if(!M())return;A((N=c.value)==null?void 0:N.events.onSubmit),T.value=!0,C();const m=Q(),b=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:m,context:n.context});if(p=b.resource_data,b.success)k.value={},z.value==="create"&&(z.value="edit"),r&&b.resource_data&&(r.resource_data=b.resource_data),c.value=G.getForm(n.resourceName,n.resourceId,P(),{form:b.form,resource_data:b.resource_data},n.formSettings,n.formStyle,n.context,Y,n.eventManager),I(),o=JSON.stringify(Q()),A((K=c.value)==null?void 0:K.events.onSubmitSuccess);else{k.value={};const X=[];for(const[q,W]of h.value){const re=b.errors[q];re&&(W.setupBackendErrors(re),X.push(q))}Object.entries(b.errors).forEach(q=>{X.includes(q[0])||(k.value[q[0]]=q[1])}),A((L=c.value)==null?void 0:L.events.onSubmitUnsuccess)}T.value=!1}async function O(m){var L,K,X;if(!c.value.allowBulk||z.value==="edit"){console.warn("Submit64 : you are not allowed to submitBulk");return}if(!M())return;A((L=c.value)==null?void 0:L.events.onSubmit),T.value=!0,C();const b=Q(),N=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:b,bulkCount:m,context:n.context});if(_=N.bulk_data,N.success)k.value={},z.value==="create"&&(z.value="edit"),r&&N.resource_data&&(r.resource_data=N.resource_data),c.value=G.getForm(n.resourceName,n.resourceId,P(),{form:N.form,resource_data:N.resource_data},n.formSettings,n.formStyle,n.context,Y,n.eventManager),I(),o=JSON.stringify(Q()),A((X=c.value)==null?void 0:X.events.onSubmitSuccess);else{k.value={};const q=[];for(const[W,re]of h.value){const pe=N.errors[W];pe&&(re.setupBackendErrors(pe),q.push(W))}Object.entries(N.errors).forEach(W=>{q.includes(W[0])||(k.value[W[0]]=W[1])}),A((K=c.value)==null?void 0:K.events.onSubmitUnsuccess)}T.value=!1}function P(){const m={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const b in B){const N=B[b];if(N){const L=e.defineComponent({inheritAttrs:!1,setup(K,{attrs:X,slots:q}){return()=>N({...K,...X,innerSlots:q})}});switch(b){case"sections":m.sectionComponent=L;break;case"actions":m.actionComponent=L;break;case"orphan-errors":m.orphanErrorsComponent=L;break;case"association-display":m.associationDisplayComponent=L;break;default:m.dynamicComponentRecord[b]=L;break}}}return m}function Q(){const m={};for(const[b,N]of h.value)m[b]=N.getValueDeserialized();return m}function J(){const m={};for(const[b,N]of h.value)m[b]=N.getValueSerialized();return m}function M(){var b;let m=!0;return h.value.forEach(N=>{if(!N.validate()){m=!1;return}}),A((b=c.value)==null?void 0:b.events.onValidated),m}function y(){let m=!0;return h.value.forEach(b=>{if(!b.isValid()){m=!1;return}}),m}function F(){return!y()}function I(){g.value.forEach(m=>{m.softReset()})}function Z(){var m;h.value.forEach(b=>{b.reset()}),A((m=c.value)==null?void 0:m.events.onReset)}function te(){var m;h.value.forEach(b=>{b.clear()}),A((m=c.value)==null?void 0:m.events.onClear)}function ne(){h.value.forEach(m=>{m.resetValidation()})}function C(){h.value.forEach(m=>{m.setupBackendErrors([])})}function R(m){if(r)return r.resource_data[m]}function j(m){return g.value.get(m)}function v(m){return[...g.value.values()].at(m)}function ae(){return g.value}function vt(m){return h.value.get(m)}function en(){return h.value}function tn(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function nn(){["getMetadataAndData","resourceName"].forEach(b=>{(n[b]===null||n[b]===void 0)&&console.warn(`Missing props for <Submit64> -> ${b}`)})}function on(){return e.unref(z)}function an(){return o!==JSON.stringify(Q())}function rn(m){c.value&&(c.value.context=m)}function ln(m){c.value&&(c.value.cssClass=m)}function sn(m){c.value&&(c.value.readonly=m)}function cn(){return S.value}function dn(){return p}function fn(){return _}function un(){return c}function mn(m){var b;return(b=c.value)==null?void 0:b.sections.find(N=>N.name===m)}function pn(m){var b;return(b=c.value)==null?void 0:b.sections.map(N=>N.fields).flat().find(N=>N.metadata.field_name===m)}function hn(m,b){g.value.set(m,b),l===g.value.size&&(D.value=!0)}function gn(m,b){h.value.set(m,b),u===h.value.size&&(w.value=!0)}function yn(m,b){m.fieldsComponent=b}const me={getFormRef:un,getSectionRef:mn,getFieldRef:pn,registerSectionWrapperRef:hn,registerFieldWrapperRef:gn,setSectionFieldComponent:yn},Cn=new Proxy({},{get(m,b){var N;return(N=c.value)==null?void 0:N[b]}}),Y={getMode:on,getSectionByName:j,getSectionByIndex:v,getSections:ae,getFieldByName:vt,getFields:en,validate:M,isValid:y,isInvalid:F,softReset:I,reset:Z,clear:te,resetValidation:ne,submit:V,submitBulk:O,valuesHasChanged:an,getInitialValueByFieldName:R,getAssociationDataCallback:tn,setContext:rn,setCssClass:ln,setReadonlyState:sn,isReady:cn,getSubmitData:dn,getBulkSubmitData:fn,form:Cn};t(Y);const bn=e.computed(()=>y()),_n=e.computed(()=>F()),kn=e.computed(()=>J());return e.watch(()=>D.value&&w.value,m=>{var b;m&&!S.value&&(A((b=c.value)==null?void 0:b.events.onReady),S.value=!0)}),e.watch(()=>{var m;return(m=c.value)==null?void 0:m.events.onIsValid},m=>{i==null||i(),i=null,m&&(i=e.watch(bn,b=>{var N;b&&A((N=c.value)==null?void 0:N.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var m;return(m=c.value)==null?void 0:m.events.onIsInvalid},m=>{s==null||s(),s=null,m&&(s=e.watch(_n,b=>{var N;b&&A((N=c.value)==null?void 0:N.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var m;return(m=c.value)==null?void 0:m.events.onUpdate},m=>{f==null||f(),f=null,m&&(f=e.watch(kn,()=>{var b;A((b=c.value)==null?void 0:b.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(async()=>{nn(),await x(),e.nextTick(()=>{o=JSON.stringify(Q())})}),(m,b)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",Xt,[e.createElementVNode("div",{class:e.normalizeClass(c.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.value.sections,N=>(e.openBlock(),e.createBlock(ot,{key:N.name,section:N,formApi:Y,privateFormApi:me},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.fields,L=>(e.openBlock(),e.createBlock(Kt,{key:L.metadata.field_name,field:L,formApi:Y,privateFormApi:me},null,8,["field"]))),128))]),_:2},1032,["section"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(c.value.orphanErrorsComponent),{orphanErrors:k.value,formApi:Y},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(c.value.actionComponent),{isLoadingSubmit:T.value,formApi:Y},null,8,["isLoadingSubmit"]))],512)),[[e.vShow,S.value]])}});$.DynamicLogicBuilder=ee,$.Submit64=U,$.Submit64Form=Zt,Object.defineProperty($,Symbol.toStringTag,{value:"Module"})});
