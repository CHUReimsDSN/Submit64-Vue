(function($,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):($=typeof globalThis<"u"?globalThis:$||self,e($["submit64-vue"]={},$.Vue,$.Quasar))})(this,function($,e,u){"use strict";var _n=Object.defineProperty;var kn=($,e,u)=>e in $?_n($,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):$[e]=u;var A=($,e,u)=>kn($,typeof e!="symbol"?e+"":e,u);const ye={class:"flex column"},Ce={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},be=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(r){const t=r;function n(){const a=t.formApi.form.formStyle;return{outline:a.fieldOutlined,rounded:a.fieldRounded,square:a.fieldSquare,dense:a.fieldDense,color:a.fieldColor,noCaps:!0}}return(a,o)=>(e.openBlock(),e.createElementBlock("div",ye,[e.createElementVNode("div",Ce,[e.createVNode(e.unref(u.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.formApi.submit}),null,16,["loading","onClick"]),t.formApi.reset?(e.openBlock(),e.createBlock(e.unref(u.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.formApi.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.formApi.clear?(e.openBlock(),e.createBlock(e.unref(u.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Effacer",onClick:t.formApi.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),_e={class:"flex row items-center"},ke={class:"text-body1 text-weight-medium"},Ve={class:"flex column q-gutter-md"},Se=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",_e,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(u.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",ke,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",Ve,[e.renderSlot(n.$slots,"default")])]))}}),Fe=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(r){const t=r;return(n,a)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:a[0]||(a[0]=c=>t.reset())})}}}),xe=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createBlock(e.unref(u.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),Be={class:"flex column"},Ne=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(r){const t=r;return(n,a)=>(e.openBlock(),e.createElementBlock("div",Be,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(c)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),te=class te{constructor(){A(this,"_formSettings");A(this,"_formStyle");A(this,"_actionComponent");A(this,"_orphanErrorsComponent");A(this,"_sectionComponent");A(this,"_wrapperResetComponent");A(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0,associationEmptyMessage:"Empty",requiredFieldsHasAsterisk:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:""},this._actionComponent=be,this._orphanErrorsComponent=Ne,this._sectionComponent=Se,this._wrapperResetComponent=Fe,this._associationDisplayComponent=xe}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};A(te,"_instance",new te);let U=te;class X{constructor(t){A(this,"formApi");A(this,"events",[]);this.formApi=t}when(t,n){const a=t,o=n,c=new De(a,o,this.formApi);return this.events.push(c),new we(c)}static create(t){return new X(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(a=>{const o=a.getTarget();switch(o.target){case"field":n.fields[o.targetName]||(n.fields[o.targetName]={}),n.fields[o.targetName][o.key]||(n.fields[o.targetName][o.key]=[]),n.fields[o.targetName][o.key].push(a.getActionCallback());break;case"section":n.sections[o.targetName]||(n.sections[o.targetName]={}),n.sections[o.targetName][o.key]||(n.sections[o.targetName][o.key]=[]),n.sections[o.targetName][o.key].push(a.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(a.getActionCallback());break}}),n}}class De{constructor(t,n,a){A(this,"type");A(this,"data");A(this,"formApi");A(this,"action",()=>{});A(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=a}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is invalid":return{target:"field",targetName:this.data.fieldName,key:"onIsInvalid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Field is ready":return{target:"field",targetName:this.data.fieldName,key:"onReady"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onIsValid"};case"Section is invalid":return{target:"section",targetName:this.data.sectionName,key:"onIsInvalid"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Section is updated":return{target:"section",targetName:this.data.sectionName,key:"onUpdate"};case"Section is ready":return{target:"section",targetName:this.data.sectionName,key:"onReady"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is invalid":return{target:"form",key:"onIsInvalid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class we{constructor(t){A(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const Re={class:"row items-center justify-end"},Ee=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,c=a.rulesBehaviour==="lazy",l=e.ref(),f=e.ref();function s(){l.value&&l.value.hide()}function i(){return f.value?f.value.validate():!1}function F(){return f.value?!f.value.hasError:!1}function b(){f.value&&f.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(i,F,b),c||e.nextTick(()=>{var w;(w=f.value)==null||w.resetValidation()})}),(w,d)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":d[1]||(d[1]=D=>t.modelValueOnUpdate(D)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(u.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{ref_key:"popupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":d[0]||(d[0]=D=>t.modelValueOnUpdate(D)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Re,[e.createVNode(e.unref(u.QBtn),{onClick:s,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ae={class:"row items-center justify-end"},Te={class:"row items-center justify-end"},Oe=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,c=a.rulesBehaviour==="lazy",l=e.ref(),f=e.ref(),s=e.ref();function i(){l.value&&l.value.hide()}function F(){f.value&&f.value.hide()}function b(){return s.value?s.value.validate():!1}function w(){return s.value?!s.value.hasError:!1}function d(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(b,w,d),c||e.nextTick(()=>{var D;(D=s.value)==null||D.resetValidation()})}),(D,B)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":B[2]||(B[2]=S=>t.modelValueOnUpdate(S)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(u.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{ref_key:"datePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=S=>t.modelValueOnUpdate(S)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Ae,[e.createVNode(e.unref(u.QBtn),{onClick:i,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(u.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{ref_key:"timePopupProxyRef",ref:f,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":B[1]||(B[1]=S=>t.modelValueOnUpdate(S)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Te,[e.createVNode(e.unref(u.QBtn),{onClick:F,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),ze={class:"flex column"},Ie={key:0,class:"q-field__bottom"},$e={key:1,class:"q-field--error q-field__bottom text-negative"},Ue=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=e.ref(!0),o=t.formApi.form.formStyle;function c(){return n.value===!0}function l(){return n.value===!0}function f(){n.value=!0}return e.watch(()=>t.modelValue,s=>{for(const i of t.rules)if(n.value=i(s),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(c,l,f)}),(s,i)=>(e.openBlock(),e.createElementBlock("div",ze,[e.createVNode(e.unref(u.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":i[0]||(i[0]=F=>t.modelValueOnUpdate(F)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",Ie,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",$e,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Le=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=e.ref([]),a=e.ref([]),o=e.ref(),c=t.formApi.form,l=c.formSettings,f=c.formStyle,s=l.rulesBehaviour==="lazy";function i(B,S){if(B===""){S(()=>{a.value=[...n.value]});return}S(()=>{const T=B.toLowerCase();a.value=n.value.filter(O=>O.label.toLowerCase().includes(T))})}function F(){n.value=Object.freeze(t.field.staticSelectOptions??[]),a.value=t.field.staticSelectOptions??[]}function b(){return o.value?o.value.validate():!1}function w(){return o.value?!o.value.hasError:!1}function d(){o.value&&o.value.resetValidation()}function D(){a.value=[]}return e.onMounted(()=>{F(),t.registerBehaviourCallbacks(b,w,d,void 0,D)}),(B,S)=>(e.openBlock(),e.createBlock(e.unref(u.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":S[0]||(S[0]=T=>t.modelValueOnUpdate(T)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(f).fieldOutlined,filled:e.unref(f).fieldFilled,standout:e.unref(f).fieldStandout,borderless:e.unref(f).fieldBorderless,rounded:e.unref(f).fieldRounded,square:e.unref(f).fieldSquare,dense:e.unref(f).fieldDense,hideBottomSpace:e.unref(f).fieldHideBottomSpace,color:e.unref(f).fieldColor,bgColor:e.unref(f).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":s,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:a.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:i},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(u.QItem),{dense:e.unref(f).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),se="__init",ce=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.field.componentOptions.associationDisplayComponent,a=t.formApi.form,o=a.formSettings,c=a.formStyle,l=o.rulesBehaviour==="lazy",f=e.ref([]),s=e.ref(b()),i=e.ref(),F=e.ref(se);function b(){return{limit:30,nextPage:1,lastPage:2,isLoading:!1}}function w(_,h){if(_===F.value){h(()=>{});return}const p=t.formApi.getAssociationDataCallback();s.value=b(),F.value=_;const x=t.formApi.form;s.value.isLoading=!0,p({resourceName:x.resourceName,resourceId:x.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:_,context:x.context}).then(k=>{h(()=>{f.value=k.rows,s.value.nextPage=2,s.value.lastPage=Math.ceil(k.row_count/s.value.limit),s.value.isLoading=!1})}).catch(()=>{f.value=[],s.value=b()})}function d(){var h,p;const _=t.getValueSerialized();!_||!t.field.associationData||(f.value=[{label:((h=t.field.associationData[0])==null?void 0:h.label)??"???",value:_,data:(p=t.field.associationData[0])==null?void 0:p.data}])}function D(){return i.value?i.value.validate():!1}function B(){return i.value?!i.value.hasError:!1}function S(){i.value&&i.value.resetValidation()}function T(){s.value=b(),f.value=[],F.value=se}function O(_){const h=f.value.length-1;if(s.value.isLoading!==!0&&s.value.nextPage<s.value.lastPage&&_.to===h&&h!==-1){const p=t.formApi.form,x=t.formApi.getAssociationDataCallback();s.value.isLoading=!0,x({resourceName:p.resourceName,resourceId:p.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:F.value,context:p.context}).then(k=>{f.value=f.value.concat(k.rows),s.value.lastPage=Math.ceil(k.row_count/s.value.limit),k.row_count>=s.value.limit&&s.value.nextPage++,s.value.isLoading=!1,_.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(D,B,S,d,T),e.nextTick(()=>{d()})}),(_,h)=>(e.openBlock(),e.createBlock(e.unref(u.QSelect),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":h[0]||(h[0]=p=>t.modelValueOnUpdate(p)),label:t.field.label,outlined:e.unref(c).fieldOutlined,filled:e.unref(c).fieldFilled,standout:e.unref(c).fieldStandout,borderless:e.unref(c).fieldBorderless,rounded:e.unref(c).fieldRounded,square:e.unref(c).fieldSquare,dense:e.unref(c).fieldDense,hideBottomSpace:e.unref(c).fieldHideBottomSpace,color:e.unref(c).fieldColor,bgColor:e.unref(c).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:f.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:t.clear,onFilter:w,onVirtualScroll:O},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(u.QItem),{dense:e.unref(c).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(p=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:p.opt,itemProps:p.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),de="__init",fe=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.field.componentOptions.associationDisplayComponent,a=t.formApi.form,o=a.formSettings,c=a.formStyle,l=o.rulesBehaviour==="lazy",f=e.ref([]),s=e.ref(b()),i=e.ref(),F=e.ref(de);function b(){return{limit:30,nextPage:1,lastPage:100,isLoading:!1}}function w(_,h){if(_===F.value){h(()=>{});return}const p=t.formApi.getAssociationDataCallback();s.value=b(),F.value=_;const x=t.formApi.form;s.value.isLoading=!0,p({resourceName:x.resourceName,resourceId:x.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:_,context:x.context}).then(k=>{h(()=>{f.value=k.rows,s.value.nextPage=2,s.value.lastPage=Math.ceil(k.row_count/s.value.limit),s.value.isLoading=!1})}).catch(()=>{f.value=[],s.value=b()})}function d(){const _=t.getValueSerialized();!_||!t.field.associationData||(f.value=_.map((h,p)=>({label:t.field.associationData[p].label??"???",value:h,data:t.field.associationData[p].data})))}function D(){return i.value?i.value.validate():!1}function B(){return i.value?!i.value.hasError:!1}function S(){i.value&&i.value.resetValidation()}function T(){s.value=b(),f.value=[],F.value=de}function O(_){const h=f.value.length-1;if(s.value.isLoading!==!0&&s.value.nextPage<s.value.lastPage&&_.to===h&&h!==-1){const p=t.formApi.form,x=t.formApi.getAssociationDataCallback();s.value.isLoading=!0,x({resourceName:p.resourceName,resourceId:p.resourceId,associationName:t.field.metadata.field_association_name,limit:s.value.limit,offset:(s.value.nextPage-1)*s.value.limit,labelFilter:F.value,context:p.context}).then(k=>{f.value=f.value.concat(k.rows),s.value.lastPage=Math.ceil(k.row_count/s.value.limit),k.row_count>=s.value.limit&&s.value.nextPage++,s.value.isLoading=!1,_.ref.refresh()})}}return e.onMounted(()=>{t.registerBehaviourCallbacks(D,B,S,d,T),e.nextTick(()=>{d()})}),(_,h)=>(e.openBlock(),e.createBlock(e.unref(u.QSelect),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":h[0]||(h[0]=p=>t.modelValueOnUpdate(p)),label:t.field.label,hint:t.field.hint,outlined:e.unref(c).fieldOutlined,filled:e.unref(c).fieldFilled,standout:e.unref(c).fieldStandout,borderless:e.unref(c).fieldBorderless,rounded:e.unref(c).fieldRounded,square:e.unref(c).fieldSquare,dense:e.unref(c).fieldDense,hideBottomSpace:e.unref(c).fieldHideBottomSpace,color:e.unref(c).fieldColor,bgColor:e.unref(c).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:f.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:t.clear,onFilter:w,onVirtualScroll:O},{"no-option":e.withCtx(()=>[e.createVNode(e.unref(u.QItem),{dense:e.unref(c).fieldDense},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.formApi.form.formSettings.associationEmptyMessage),1)]),_:1})]),_:1})]),_:1},8,["dense"])]),option:e.withCtx(p=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:p.opt,itemProps:p.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options","onClear"]))}}),re=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,c=a.rulesBehaviour==="lazy",l=e.ref();function f(){return l.value?l.value.validate():!1}function s(){return l.value?!l.value.hasError:!1}function i(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(f,s,i)}),(F,b)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":b[0]||(b[0]=w=>t.modelValueOnUpdate(w)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Pe=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,c=a.rulesBehaviour==="lazy",l=e.ref();function f(){return l.value?l.value.validate():!1}function s(){return l.value?!l.value.hasError:!1}function i(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(f,s,i)}),(F,b)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":b[0]||(b[0]=w=>t.modelValueOnUpdate(w)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}}),Qe=e.defineComponent({__name:"ColorField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=t.formApi.form,a=n.formSettings,o=n.formStyle,c=a.rulesBehaviour==="lazy",l=e.ref();function f(){return l.value?l.value.validate():!1}function s(){return l.value?!l.value.hasError:!1}function i(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(f,s,i)}),(F,b)=>(e.openBlock(),e.createBlock(e.unref(u.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":b[1]||(b[1]=w=>t.modelValueOnUpdate(w)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(u.QIcon),{name:"colorize",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QPopupProxy),{cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QColor),{"model-value":t.modelValue,"onUpdate:modelValue":b[0]||(b[0]=w=>t.modelValueOnUpdate(w))},null,8,["model-value"])]),_:1})]),_:1})]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),qe=e.defineComponent({__name:"WysiwygField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,n=u.useQuasar(),o=t.formApi.form.formStyle,c=[[{label:n.lang.editor.align,icon:n.iconSet.editor.align,fixedLabel:!0,list:"only-icons",options:["left","center","right","justify"]}],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],["print","fullscreen"],[{label:n.lang.editor.formatting,icon:n.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:n.lang.editor.fontSize,icon:n.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:n.lang.editor.defaultFont,icon:n.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["viewsource"]],l={arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"},f=e.ref();function s(){return!!f.value}function i(){return!!f.value}function F(){}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,i,F)}),(b,w)=>t.modelValue?(e.openBlock(),e.createBlock(e.unref(u.QEditor),{key:0,ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":w[0]||(w[0]=d=>t.modelValueOnUpdate(d)),toolbar:c,fonts:l,placeholder:t.field.label,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly},null,8,["model-value","placeholder","square","dense","class","readonly"])):e.createCommentVNode("",!0)}}),Me=e.defineComponent({__name:"JsonField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const n=r.formApi.form,a=n.formSettings;return n.formStyle,a.rulesBehaviour,(o,c)=>" TODO json edit ? "}});function E(r){r==null||r.forEach(t=>{t()})}function M(r){const t=["B","KB","MB","GB","TB","PB"];let n=0;for(;parseInt(r.toString(),10)>=1024&&n<t.length-1;)r/=1024,++n;return`${r.toFixed(1)}${t[n]}`}const He={class:"flex column"},Ge={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},je={class:"col"},Ye={class:"q-uploader__title"},We={key:0,class:"caption"},Je={key:0,class:"flex column"},Ke={key:2,class:"flex column"},Xe={key:0,class:"q-field--error q-field__bottom text-negative"},Ze=e.defineComponent({__name:"AttachmentHasOneField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,a=t.formApi.form.formStyle,o=e.ref(null);function c(){let h=t.modelValue;h.add=[],h.delete=[],t.modelValueOnUpdate(h),S()}function l(){var p;let h=t.modelValue;h.add=[],h.delete=((p=t.field.attachmentData)==null?void 0:p.map(x=>x.id))??[],t.modelValueOnUpdate(h),S()}function f(){return S(),s()}function s(){return o.value===null}function i(){o.value=null}async function F(h){return new Promise(p=>{const x=new Blob([h]),k=new FileReader;k.onload=z=>{var V;const P=((V=z.target)==null?void 0:V.result)??"",[Q,y]=P.split(",");p(y)},k.readAsDataURL(x)})}async function b(h){return{key:`${h.lastModified}${h.name}`,size:h.size,filename:h.name,contentType:h.type,base64:await F(await h.arrayBuffer())}}async function w(h){if(!h[0])return;const p=await b(h[0]);let x=t.modelValue;x.add.push(p),t.modelValueOnUpdate(x),S()}async function d(h){if(!h[0])return;const p=await b(h[0]);let x=t.modelValue;x.add=x.add.filter(k=>k.key!==p.key),t.modelValueOnUpdate(x),S()}function D(h){let p=t.modelValue;p.delete.push(h.id),t.modelValueOnUpdate(p),S()}function B(h){let p=t.modelValue;p.delete=p.delete.filter(x=>x!==h.id),t.modelValueOnUpdate(p),S()}function S(){o.value=null;for(const h of t.rules){const p=h(t.modelValue);if(typeof p=="string"){o.value=p;break}}}const T=e.computed(()=>(t.field.attachmentData??[]).length===0),O=e.computed(()=>t.modelValue?t.modelValue.delete:[]),_=e.computed(()=>{var h,p;return t.modelValue?(((h=t.field.attachmentData)==null?void 0:h.length)??0)===0||(((p=t.field.attachmentData)==null?void 0:p.length)??!0)&&t.modelValue.delete.length===1:!0});return e.onMounted(()=>{t.registerBehaviourCallbacks(f,s,i,c,l)}),(h,p)=>(e.openBlock(),e.createElementBlock("div",He,[e.createVNode(e.unref(u.QUploader),{"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(a).fieldBorderless!==!0,square:e.unref(a).fieldSquare,color:e.unref(a).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:w,onRemoved:d,style:{width:"inherit"}},{header:e.withCtx(x=>[e.createElementVNode("div",Ge,[e.createElementVNode("div",je,[e.createElementVNode("div",Ye,e.toDisplayString(t.field.label),1),t.field.hint?(e.openBlock(),e.createElementBlock("div",We,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0)]),x.canAddFiles&&_.value?(e.openBlock(),e.createBlock(e.unref(u.QBtn),{key:0,type:"a",icon:"add_box",onClick:x.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QUploaderAddTrigger))]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(x=>[T.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",Je,[p[0]||(p[0]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier en ligne",-1)),e.createVNode(e.unref(u.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],k=>(e.openBlock(),e.createBlock(e.unref(u.QItem),{key:k.id},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.filename),1)]),_:2},1024),e.createVNode(e.unref(u.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(M)(k.size)),1)]),_:2},1024)]),_:2},1024),t.modelValue?(e.openBlock(),e.createBlock(e.unref(u.QItemSection),{key:0,top:"",side:""},{default:e.withCtx(()=>[O.value.includes(k.id)?(e.openBlock(),e.createBlock(e.unref(u.QBtn),{key:1,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"refresh",onClick:z=>B(k)},null,8,["disable","onClick"])):(e.openBlock(),e.createBlock(e.unref(u.QBtn),{key:0,class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:z=>D(k)},null,8,["disable","onClick"]))]),_:2},1024)):e.createCommentVNode("",!0)]),_:2},1024))),128))]),_:1})])),!T.value&&x.files.length>0?(e.openBlock(),e.createBlock(e.unref(u.QSeparator),{key:1})):e.createCommentVNode("",!0),x.files.length>0?(e.openBlock(),e.createElementBlock("div",Ke,[p[1]||(p[1]=e.createElementVNode("div",{class:"text-weight-medium text-body2"},"Fichier à télécharger",-1)),e.createVNode(e.unref(u.QList),{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(x.files,k=>(e.openBlock(),e.createBlock(e.unref(u.QItem),{key:k.__key},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(u.QItemLabel),{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.name),1)]),_:2},1024),e.createVNode(e.unref(u.QItemLabel),{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(k.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(e.unref(u.QItemSection),{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(e.unref(u.QBtn),{class:"gt-xs",size:"12px",disable:t.field.readonly,flat:"",dense:"",round:"",icon:"delete",onClick:z=>x.removeFile(k)},null,8,["disable","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):e.createCommentVNode("",!0)]),_:1},8,["label","bordered","square","color","class","readonly"]),o.value!==null?(e.openBlock(),e.createElementBlock("div",Xe,e.toDisplayString(o.value),1)):e.createCommentVNode("",!0)]))}}),ve={class:"row no-wrap items-center q-pa-sm q-gutter-xs"},et={class:"col"},tt={class:"q-uploader__title"},nt={class:"q-uploader__subtitle"},ot=e.defineComponent({__name:"AttachmentHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(r){const t=r,a=t.formApi.form.formStyle,o=e.ref();function c(){let d=t.modelValue;d.add=[],d.delete=[],t.modelValueOnUpdate(d)}function l(){var D;let d=t.modelValue;d.add=[],d.delete=((D=t.field.attachmentData)==null?void 0:D.map(B=>B.id))??[],t.modelValueOnUpdate(d)}function f(){return!!o.value}function s(){return!!o.value}function i(){o.value}function F(d){const D=d;if(!D)return;let B=t.modelValue;D.forEach(S=>{B.add.push(S)}),t.modelValueOnUpdate(B)}function b(d){const D=d;let B=t.modelValue;B.add=B.add.filter(S=>!D.map(T=>T.key).includes(S.key)),t.modelValueOnUpdate(B)}function w(d){let D=t.modelValue;D.delete.push(d.id),t.modelValueOnUpdate(D)}return e.onMounted(()=>{t.registerBehaviourCallbacks(f,s,i,c,l)}),(d,D)=>{const B=e.resolveComponent("q-spinner"),S=e.resolveComponent("q-uploader-add-trigger"),T=e.resolveComponent("q-btn"),O=e.resolveComponent("q-item-label"),_=e.resolveComponent("q-item-section"),h=e.resolveComponent("q-item"),p=e.resolveComponent("q-separator"),x=e.resolveComponent("q-list");return e.openBlock(),e.createBlock(e.unref(u.QUploader),{ref_key:"fieldRef",ref:o,"hide-upload-btn":"",multiple:!1,label:t.field.label,bordered:e.unref(a).fieldBorderless!==!0,square:e.unref(a).fieldSquare,color:e.unref(a).fieldColor,class:e.normalizeClass(t.field.cssClass),readonly:t.field.readonly,onAdded:F,onRemoved:b},{header:e.withCtx(k=>[e.createElementVNode("div",ve,[k.isUploading?(e.openBlock(),e.createBlock(B,{key:0,class:"q-uploader__spinner"})):e.createCommentVNode("",!0),e.createElementVNode("div",et,[e.createElementVNode("div",tt,e.toDisplayString(t.field.label),1),e.createElementVNode("div",nt,"Total : "+e.toDisplayString(k.uploadSizeLabel),1)]),k.canAddFiles?(e.openBlock(),e.createBlock(T,{key:1,type:"a",icon:"add_box",onClick:k.pickFiles,round:"",dense:"",flat:""},{default:e.withCtx(()=>[e.createVNode(S)]),_:1},8,["onClick"])):e.createCommentVNode("",!0)])]),list:e.withCtx(k=>[e.createVNode(x,{separator:""},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.field.attachmentData??[],z=>(e.openBlock(),e.createBlock(h,{key:z.id},{default:e.withCtx(()=>[e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(O,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(z.filename),1)]),_:2},1024),e.createVNode(O,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(M)(z.size)),1)]),_:2},1024)]),_:2},1024),e.createVNode(_,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>w(z)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e.createVNode(p),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(k.files,z=>(e.openBlock(),e.createBlock(h,{key:z.__key},{default:e.withCtx(()=>[e.createVNode(_,null,{default:e.withCtx(()=>[e.createVNode(O,{class:"full-width ellipsis"},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(z.name),1)]),_:2},1024),e.createVNode(O,{caption:""},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(z.__sizeLabel),1)]),_:2},1024)]),_:2},1024),e.createVNode(_,{top:"",side:""},{default:e.withCtx(()=>[e.createVNode(T,{class:"gt-xs",size:"12px",flat:"",dense:"",round:"",icon:"delete",onClick:P=>k.removeFile(z)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["label","bordered","square","color","class","readonly"])}}});class H{constructor(t,n,a,o,c,l,f,s,i){A(this,"resourceName");A(this,"resourceId");A(this,"formMetadataAndData");A(this,"context");A(this,"formSettings");A(this,"formStyle");A(this,"actionComponent");A(this,"orphanErrorsComponent");A(this,"sectionComponent");A(this,"wrapperResetComponent");A(this,"associationDisplayComponent");A(this,"dynamicComponentRecord");A(this,"formApi");A(this,"registerEventCallback");this.dynamicComponentRecord=a.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=f,this.resourceName=t,this.formApi=s,this.formSettings={...c,...U.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...l,...U.getGlobalFormStyle()},this.actionComponent=a.actionComponent??U.getGlobalActionComponent(),this.orphanErrorsComponent=a.orphanErrorsComponent??U.getGlobalOrphanErrorComponent(),this.sectionComponent=a.sectionComponent??U.getGlobalSectionComponent(),this.wrapperResetComponent=a.wrapperResetComponent??U.getGlobalWrapperResetComponent(),this.associationDisplayComponent=a.associationDisplayComponent??U.getGlobalAssociationDisplayComponent(),this.registerEventCallback=i??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...U.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:U.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(U.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(U.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(U.getGlobalWrapperResetComponent()),dynamicComponentRecord:{},allowBulk:!1}}static getForm(t,n,a,o,c,l,f,s,i){return new H(t,n,a,o,c,l,f,s,i).generateFormDef()}generateFormDef(){const t=X.create(this.formApi);this.registerEventCallback(t);const n=new Set,a=X.getEventsObjectFromInstance(t),o=[];this.formMetadataAndData.form.sections.forEach((l,f)=>{const s=[];l.fields.forEach(d=>{const D=this.dynamicComponentRecord[`field-${d.field_name}-before`],B=H.getFieldComponentByFormFieldType(d),S=this.dynamicComponentRecord[`field-${d.field_name}-after`],T={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:H.getRegularFieldTypeByFieldType(d.field_type)};let O=d.label;this.formSettings.requiredFieldsHasAsterisk&&d.rules.find(h=>h.type==="required")&&(O=O.concat("*"));const _={type:d.field_type,extraType:d.field_extra_type,metadata:Object.freeze(d),label:O,hint:d.hint??void 0,prefix:d.prefix??void 0,suffix:d.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??l.readonly??d.readonly??void 0,cssClass:d.css_class??void 0,staticSelectOptions:d.static_select_options,associationData:d.field_association_data,attachmentData:d.field_attachment_data,rules:d.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:D?e.markRaw(D):void 0,mainComponent:e.markRaw(B),afterComponent:S?e.markRaw(S):void 0,events:a.fields[d.field_name]??{},componentOptions:T};s.push(_),n.add(d.field_name)});const i=this.dynamicComponentRecord[`section-${l.name??f}-before`],F=this.sectionComponent,b=this.dynamicComponentRecord[`section-${l.name??f}-after`],w={label:l.label??void 0,icon:l.icon??void 0,cssClass:l.css_class??void 0,hidden:!1,name:l.name??f.toString(),readonly:this.formMetadataAndData.form.readonly??l.readonly??void 0,events:a.sections[l.name??f.toString()]??{},beforeComponent:i?e.markRaw(i):void 0,mainComponent:e.markRaw(F),afterComponent:b?e.markRaw(b):void 0,fields:s};o.push(w)});const c={sections:o,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,allowBulk:this.formMetadataAndData.form.allow_bulk??!1,events:a.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context};return n.size<this.formMetadataAndData.form.sections.reduce((l,f)=>l+f.fields.length,0)&&console.warn("Submit64 -> Found fields with the same name"),c}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){switch(t.field_type){case"string":switch(t.field_extra_type){case"color":return Qe;case"wysiwyg":return qe;default:return re}case"text":return re;case"number":return Pe;case"date":return Ee;case"datetime":return Oe;case"select":return Le;case"selectBelongsTo":return ce;case"selectHasMany":return fe;case"selectHasAndBelongsToMany":return fe;case"selectHasOne":return ce;case"checkbox":return Ue;case"object":return Me;case"attachmentHasOne":return Ze;case"attachmentHasMany":return ot;default:return re}}}function at(r,t,n){const a=n.form,o=(s,i,F)=>s[i]?F?()=>c(s[i]):()=>s[i]:s.compare_to?()=>{var b;return((b=n.getFieldByName(s.compare_to))==null?void 0:b.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",c=s=>String(u.date.formatDate(u.date.extractDate(s,a.formSettings.backendDateFormat),a.formSettings.dateFormat)),l=[],f=[];switch(t){case"date":l.push(le(a.formSettings.dateFormat));break;case"datetime":l.push(le(a.formSettings.datetimeFormat));break}return r.forEach(s=>{const i=s;switch(i.type){case"required":l.push(rt());break;case"absence":l.push(it());break;case"acceptance":l.push(st());break;case"inclusion":l.push(ue(i.including));break;case"exclusion":l.push(lt(i.excluding));break;case"backend":break;case"allowNull":f.push("allowNull");break;case"allowBlank":f.push("allowBlank");break;case"positiveNumber":l.push(ft());break;case"lessThanOrEqualNumber":l.push(ut(o(i,"less_than")));break;case"lessThanNumber":l.push(mt(o(i,"less_than")));break;case"greaterThanOrEqualNumber":l.push(pt(o(i,"greater_than")));break;case"greaterThanNumber":l.push(ht(o(i,"greater_than")));break;case"equalToNumber":l.push(gt(o(i,"equal_to")));break;case"otherThanNumber":l.push(yt(o(i,"other_than")));break;case"numberIntegerOnly":l.push(Ct());break;case"numberNumericOnly":l.push(bt());break;case"numberEvenOnly":l.push(_t());break;case"numberOddOnly":l.push(kt());break;case"lessThanOrEqualStringLength":l.push(Vt(o(i,"less_than")));break;case"lessThanStringLength":l.push(St(o(i,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(Ft(o(i,"greater_than")));break;case"greaterThanStringLength":l.push(xt(o(i,"greater_than")));break;case"equalToStringLength":l.push(Dt(o(i,"equal_to")));break;case"equalToString":l.push(Nt(o(i,"equal_to")));break;case"betweenStringLength":l.push(Bt(()=>i.min,()=>i.max));break;case"otherThanString":l.push(wt(o(i,"other_than")));break;case"validDate":l.push(le(a.formSettings.dateFormat));break;case"lessThanOrEqualDate":l.push(Rt(o(i,"less_than",!0),a.formSettings.dateFormat));break;case"lessThanDate":l.push(Et(o(i,"less_than",!0),a.formSettings.dateFormat));break;case"greaterThanOrEqualDate":l.push(At(o(i,"greater_than",!0),a.formSettings.dateFormat));break;case"greaterThanDate":l.push(Tt(o(i,"greater_than",!0),a.formSettings.dateFormat));break;case"equalToDate":l.push(Ot(o(i,"equal_to",!0),a.formSettings.dateFormat));break;case"otherThanDate":l.push(zt(o(i,"other_than",!0),a.formSettings.dateFormat));break;case"allowFileContentType":l.push($t(o(i,"including")));break;case"equalToFileLength":l.push(Ut(o(i,"equal_to")));break;case"lessThanOrEqualFileLength":l.push(Pt(o(i,"less_than")));break;case"greaterThanOrEqualFileLength":l.push(Lt(o(i,"greater_than")));break;case"lessThanOrEqualFileCount":l.push(Qt(o(i,"less_than")));break;case"greaterThanOrEqualFileCount":l.push(qt(o(i,"greater_than")));break;case"lessThanOrEqualTotalFileSize":l.push(Mt(o(i,"less_than")));case"greaterThanOrEqualTotalFileSize":l.push(Ht(o(i,"greater_than")));break;case"equalToTotalFileSize":l.push(Gt(o(i,"equal_to")));break}}),f.length>0?f.map(s=>{switch(s){case"allowBlank":return dt(l);case"allowNull":return ct(l)}}):l}function rt(){return r=>!!r||"Ce champ est requis"}function ue(r){return t=>r.includes(String(t))||`Doit être contenu dans ${r.toString()}`}function lt(r){return t=>!r.includes(String(t)||`Ne doit pas être contenu dans ${ue.toString()}`)}function it(){return r=>!r||"Ce champ doit être vide"}function st(){return r=>!!r||"Doit être accepté"}function ct(r){return t=>(t===null||r.forEach(n=>{const a=n(t);if(a!==!0)return a}),!0)}function dt(r){return t=>(t===""||r.forEach(n=>{const a=n(t);if(a!==!0)return a}),!0)}function ft(){return r=>Number(r)>0||"Val. positive uniquement"}function ut(r){return t=>{const n=r();return Number(t)<=n||`Inf. ou égal à ${n}`}}function mt(r){return t=>{const n=r();return Number(t)<n||`Inf. ${n}`}}function pt(r){return t=>{const n=r();return Number(t)>=n||`Sup. ou égal à ${n}`}}function ht(r){return t=>{const n=r();return Number(t)>n||`Sup. à ${n}`}}function gt(r,t){return n=>{const a=r();return Number(n)===a||`Égale à ${a}`}}function yt(r,t){return n=>{const a=r();return Number(n)!==a||`Doit être différent de ${r}`}}function Ct(){return r=>/^-?\d+$/.test(String(r).trim())||"Nombre entier uniquement"}function bt(){return r=>/^-?\d+(\.\d+)?$/.test(String(r).trim())||"Caractère numérique uniquement"}function _t(){return r=>Number.isInteger(Number(r))&&Number(r)%2===0||"Nombre pair uniquement"}function kt(){return r=>Number.isInteger(Number(r))&&Number(r)%2===1||"Nombre impair uniquement"}function Vt(r){return t=>{const n=r();return String(t).length<=n||`Inf. ou égal à ${n}`}}function St(r){return t=>{const n=r();return String(t).length<n||`Inf. à ${n}`}}function Ft(r){return t=>{const n=r();return String(t).length>=n||`Sup. ou égal à ${n}`}}function xt(r){return t=>{const n=r();return String(t).length>n||`Sup. à ${n}`}}function Bt(r,t){return n=>{const a=r(),o=t();return String(n).length>=a&&String(n).length<=o||`Entre ${a} et ${o}`}}function Nt(r,t){return n=>{const a=r();return String(n)===a||`Égale à ${a}`}}function Dt(r){return t=>{const n=r();return String(t).length===n||`Doit contenir ${n} caractères`}}function wt(r){return t=>{const n=r();return String(t)!==n||`Doit être différent de ${n}`}}function Rt(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),c=u.date.extractDate(a,t);return o<=c||`Inf. ou égal à ${a}`}}function Et(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),c=u.date.extractDate(a,t);return o<c||`Inf. à ${a}`}}function At(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),c=u.date.extractDate(a,t);return o>=c||`Sup. ou égal à ${a}`}}function Tt(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),c=u.date.extractDate(a,t);return o>c||`Sup. à ${a}`}}function Ot(r,t){return n=>{const a=r(),o=u.date.extractDate(String(n),t),c=u.date.extractDate(a,t);return o===c||`Égale à ${o}`}}function zt(r,t){return n=>{const a=r();return u.date.extractDate(String(n),t)!==u.date.extractDate(a,t)||`Doit être différent de ${a}`}}function le(r){return t=>t==null||t===""?!0:It(t,r)||`Date invalide. Format : ${r}`}function It(r,t){if(typeof r!="string"||!r.trim())return!1;const n=u.date.extractDate(r,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:u.date.formatDate(n,t)===r}function $t(r){return t=>{const n=t,a=r();let o=!0;n.add.forEach(l=>{o&&(a.includes(l.contentType)||(o=!1))});const c=r.length>1;return o||`Type${c?"s":""} autorisé${c?"s":""} : ${a.join(",")}`}}function Ut(r){return t=>{const n=t,a=r();let o=!0;return n.add.forEach(c=>{o&&a!==c.size&&(o=!1)}),o||`Taille par fichier ${M(a)}`}}function Lt(r){return t=>{const n=t,a=r();let o=!0;return n.add.forEach(c=>{o&&c.size<a&&(o=!1)}),o||`Taille par fichier min. ${M(a)}`}}function Pt(r){return t=>{const n=t,a=r();let o=!0;return n.add.forEach(c=>{o&&c.size>a&&(o=!1)}),o||`Taille par fichier max. ${M(a)}`}}function Qt(r){return t=>{const n=t,a=r();return n.add.length<=a||`${a} fichier${a>1?"s":""} max.`}}function qt(r){return t=>{const n=t,a=r();return n.add.length>=a||`${a} fichier${a>1?"s":""} min.`}}function Mt(r){return t=>{const n=t,a=r();return n.add.reduce((c,l)=>(c+=l.size,c),0)<=a||`${M(a)} max.`}}function Ht(r){return t=>{const n=t,a=r();return n.add.reduce((c,l)=>(c+=l.size,c),0)>=a||`${M(a)} min.`}}function Gt(r){return t=>{const n=t,a=r();return n.add.reduce((c,l)=>(c+=l.size,c),0)===a||`Taille totale ${M(a)}`}}const jt={computeServerRules:at},Yt={key:2,class:"q-field__bottom text-negative q-pt-none"},Wt=["index"],Jt=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(r,{expose:t}){const n=r;let a=()=>!0,o=()=>!0,c=()=>{},l=()=>{},f=()=>{};const s=S(),i=e.ref(),F=e.ref([]);function b(){i.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),i.value=d(i.value)}function w(){i.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),i.value=d(i.value),E(n.field.events.onReset),l(),e.nextTick(()=>{ne()})}function d(g){const R=n.formApi.form;switch(n.field.type){case"checkbox":return g==null||g===""?!1:g;case"date":return g==null||g===""?null:u.date.formatDate(u.date.extractDate(String(g),R.formSettings.backendDateFormat),R.formSettings.dateFormat);case"datetime":return g==null||g===""?null:u.date.formatDate(u.date.extractDate(String(g),R.formSettings.backendDatetimeFormat),R.formSettings.datetimeFormat);case"attachmentHasOne":case"attachmentHasMany":return{add:[],delete:[]}}return g}function D(g){const R=n.formApi.form;switch(n.field.type){case"date":return g==null||g===""?null:u.date.formatDate(u.date.extractDate(String(g),R.formSettings.dateFormat),R.formSettings.backendDateFormat);case"datetime":return g==null||g===""?null:u.date.formatDate(u.date.extractDate(String(g),R.formSettings.datetimeFormat),R.formSettings.backendDatetimeFormat)}return g}function B(){switch(n.field.type){case"string":i.value="";break;case"checkbox":i.value=!1;break;case"date":i.value=null;break;case"datetime":i.value=null;break;case"number":i.value=null;break;case"select":i.value=void 0;break;case"text":i.value="";break;case"object":i.value={};break;case"selectBelongsTo":i.value=void 0;break;case"selectHasMany":i.value=void 0;break;case"selectHasAndBelongsToMany":i.value=void 0;break;case"selectHasOne":i.value=void 0;break;case"attachmentHasOne":case"attachmentHasMany":i.value={add:[],delete:[]};break}f(),E(n.field.events.onClear)}function S(){return jt.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function T(g){i.value=g}function O(){return e.unref(i)}function _(){return D(e.unref(i))}function h(g){F.value=g}function p(){const g=n.privateFormApi.getFieldRef(n.field.metadata.field_name);g&&(g.hidden=!0,E(n.field.events.onHide))}function x(){const g=n.privateFormApi.getFieldRef(n.field.metadata.field_name);g&&(g.hidden=!1,E(n.field.events.onUnhide))}function k(g){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.readonly=g)}function z(g){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.hint=g)}function P(g){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.cssClass=g)}function Q(g){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.suffix=g)}function y(g){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.prefix=g)}function V(g){const R=n.privateFormApi.getFieldRef(n.field.metadata.field_name);R&&(R.label=g)}function I(){const g=a();return E(n.field.events.onValidated),g}function Z(){return o()}function v(){return!Z()}function ne(){return c()}function ie(g,R,G,K,oe){a=g,o=R,c=G,K&&(l=K),oe&&(f=oe)}const ee={softReset:b,reset:w,clear:B,validate:I,isValid:Z,isInvalid:v,hide:p,unhide:x,resetValidation:ne,getValueDeserialized:_,getValueSerialized:O,setupBackendErrors:h,setReadonlyState:k,setHint:z,setCssClass:P,setSuffix:Q,setPrefix:y,setLabel:V,setValue:T,field:n.field};return t(ee),e.watch(()=>n.field.events.onUpdate?i.value:null,()=>{E(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid||n.field.events.onIsInvalid?i.value:null,g=>{E(g?n.field.events.onIsValid:n.field.events.onIsInvalid)}),e.onMounted(()=>{var R,G;b();const g=(R=e.getCurrentInstance())==null?void 0:R.exposed;g&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,g),E((G=n.field)==null?void 0:G.events.onReady)}),(g,R)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:ee},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:i.value,field:n.field,formApi:n.formApi,rules:e.unref(s),reset:w,clear:B,getValueDeserialized:_,getValueSerialized:O,validate:I,modelValueOnUpdate:T,registerBehaviourCallbacks:ie},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:ee},null,8,["formApi"])):e.createCommentVNode("",!0),F.value.length>0?(e.openBlock(),e.createElementBlock("div",Yt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(F.value,(G,K)=>(e.openBlock(),e.createElementBlock("div",{index:K,class:"flex column"},e.toDisplayString(G),9,Wt))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),Kt={class:"flex column"},Xt=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(r,{expose:t}){const n=r;let a=null,o=null,c=null;const l={softReset:i,reset:F,clear:b,validate:D,isValid:B,isInvalid:S,hide:w,unhide:d,resetValidation:T,getFields:O,setReadonlyState:_,setCssClass:h,setIcon:p,setLabel:x,section:n.section},f=e.ref(new Map);function s(){n.section.fields.forEach(y=>{const V=y.metadata.field_name,I=n.formApi.getFieldByName(V);I&&f.value.set(V,I)})}function i(){f.value.forEach(y=>{y.softReset()})}function F(){f.value.forEach(y=>{y.reset()}),E(n.section.events.onReset)}function b(){f.value.forEach(y=>{y.clear()}),E(n.section.events.onClear)}function w(){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(f.value.forEach(V=>{V.hide()}),y.hidden=!0,E(n.section.events.onHide))}function d(){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(f.value.forEach(V=>{V.unhide()}),y.hidden=!1,E(n.section.events.onUnhide))}function D(){let y=!0;return f.value.forEach(V=>{if(!V.validate()){y=!1;return}}),E(n.section.events.onValidated),y}function B(){let y=!0;return f.value.forEach(V=>{if(!V.isValid()){y=!1;return}}),y}function S(){return!B()}function T(){f.value.forEach(y=>{y.resetValidation()})}function O(){return f.value}function _(y){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.readonly=y)}function h(y){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.cssClass=y)}function p(y){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.icon=y)}function x(y){const V=n.privateFormApi.getSectionRef(n.section.name);V&&(V.label=y)}function k(){const y={};for(const[V,I]of f.value)y[V]=I.getValueSerialized();return y}t(l);const z=e.computed(()=>B()),P=e.computed(()=>S()),Q=e.computed(()=>k());return e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onIsValid},y=>{a==null||a(),a=null,y&&(a=e.watch(z,V=>{V&&E(n.section.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onIsInvalid},y=>{o==null||o(),o=null,y&&(o=e.watch(P,V=>{var I;V&&E((I=n.section)==null?void 0:I.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var y;return(y=n.section)==null?void 0:y.events.onUpdate},y=>{c==null||c(),c=null,y&&(c=e.watch(Q,()=>{var V;E((V=n.section)==null?void 0:V.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(()=>{var V;const y=(V=e.getCurrentInstance())==null?void 0:V.exposed;y&&n.privateFormApi.registerSectionWrapperRef(n.section.name,y),e.nextTick(()=>{var I;s(),E((I=n.section)==null?void 0:I.events.onReady)})}),(y,V)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",Kt,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:l,formApi:n.formApi},{default:e.withCtx(()=>[e.renderSlot(y.$slots,"default")]),_:3},8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:l},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}}),Zt={class:"flex column"},vt=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(r,{expose:t}){const n=r;let a=null,o="",c=0,l=0,f=null,s=null,i=null,F=null,b=null;const w=e.useSlots(),d=e.ref(H.getEmptyFormBeforeInit()),D=e.ref(!1),B=e.ref(!1),S=e.ref(!1),T=e.ref(!1),O=e.ref("create"),_=e.ref({}),h=e.ref(new Map),p=e.ref(new Map);async function x(){a=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),d.value=H.getForm(n.resourceName,n.resourceId,P(),a,n.formSettings,n.formStyle,n.context,j,n.eventManager),c=d.value.sections.length,l=d.value.sections.map(m=>m.fields).flat().length,n.resourceId&&(O.value="edit")}async function k(){var N,L,W;if(!V())return;E((N=d.value)==null?void 0:N.events.onSubmit),T.value=!0,g();const m=Q(),C=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:m,context:n.context});if(F=C.resource_data,C.success)_.value={},O.value==="create"&&(O.value="edit"),a&&C.resource_data&&(a.resource_data=C.resource_data),d.value=H.getForm(n.resourceName,n.resourceId,P(),{form:C.form,resource_data:C.resource_data},n.formSettings,n.formStyle,n.context,j,n.eventManager),v(),o=JSON.stringify(Q()),E((W=d.value)==null?void 0:W.events.onSubmitSuccess);else{_.value={};const J=[];for(const[q,Y]of p.value){const ae=C.errors[q];ae&&(Y.setupBackendErrors(ae),J.push(q))}Object.entries(C.errors).forEach(q=>{J.includes(q[0])||(_.value[q[0]]=q[1])}),E((L=d.value)==null?void 0:L.events.onSubmitUnsuccess)}T.value=!1}async function z(m){var L,W,J;if(!d.value.allowBulk||O.value==="edit"){console.warn("Submit64 : you are not allowed to submitBulk");return}if(!V())return;E((L=d.value)==null?void 0:L.events.onSubmit),T.value=!0,g();const C=Q(),N=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:C,bulkCount:m,context:n.context});if(b=N.bulk_data,N.success)_.value={},O.value==="create"&&(O.value="edit"),a&&N.resource_data&&(a.resource_data=N.resource_data),d.value=H.getForm(n.resourceName,n.resourceId,P(),{form:N.form,resource_data:N.resource_data},n.formSettings,n.formStyle,n.context,j,n.eventManager),v(),o=JSON.stringify(Q()),E((J=d.value)==null?void 0:J.events.onSubmitSuccess);else{_.value={};const q=[];for(const[Y,ae]of p.value){const ge=N.errors[Y];ge&&(ae.setupBackendErrors(ge),q.push(Y))}Object.entries(N.errors).forEach(Y=>{q.includes(Y[0])||(_.value[Y[0]]=Y[1])}),E((W=d.value)==null?void 0:W.events.onSubmitUnsuccess)}T.value=!1}function P(){const m={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const C in w){const N=w[C];if(N){const L=e.defineComponent({inheritAttrs:!1,setup(W,{attrs:J,slots:q}){return()=>N({...W,...J,slots:q})}});switch(C){case"sections":m.sectionComponent=L;break;case"actions":m.actionComponent=L;break;case"orphan-errors":m.orphanErrorsComponent=L;break;case"association-display":m.associationDisplayComponent=L;break;default:m.dynamicComponentRecord[C]=L;break}}}return m}function Q(){const m={};for(const[C,N]of p.value)m[C]=N.getValueDeserialized();return m}function y(){const m={};for(const[C,N]of p.value)m[C]=N.getValueSerialized();return m}function V(){var C;let m=!0;return p.value.forEach(N=>{if(!N.validate()){m=!1;return}}),E((C=d.value)==null?void 0:C.events.onValidated),m}function I(){let m=!0;return p.value.forEach(C=>{if(!C.isValid()){m=!1;return}}),m}function Z(){return!I()}function v(){h.value.forEach(m=>{m.softReset()})}function ne(){var m;p.value.forEach(C=>{C.reset()}),E((m=d.value)==null?void 0:m.events.onReset)}function ie(){var m;p.value.forEach(C=>{C.clear()}),E((m=d.value)==null?void 0:m.events.onClear)}function ee(){p.value.forEach(m=>{m.resetValidation()})}function g(){p.value.forEach(m=>{m.setupBackendErrors([])})}function R(m){if(a)return a.resource_data[m]}function G(m){return h.value.get(m)}function K(m){return[...h.value.values()].at(m)}function oe(){return h.value}function en(m){return p.value.get(m)}function tn(){return p.value}function nn(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function on(){["getMetadataAndData","resourceName"].forEach(C=>{(n[C]===null||n[C]===void 0)&&console.warn(`Missing props for <Submit64> -> ${C}`)})}function an(){return e.unref(O)}function rn(){return o!==JSON.stringify(Q())}function ln(m){d.value&&(d.value.context=m)}function sn(m){d.value&&(d.value.cssClass=m)}function cn(m){d.value&&(d.value.readonly=m)}function dn(){return S.value}function fn(){return F}function un(){return b}function mn(){return d}function pn(m){var C;return(C=d.value)==null?void 0:C.sections.find(N=>N.name===m)}function hn(m){var C;return(C=d.value)==null?void 0:C.sections.map(N=>N.fields).flat().find(N=>N.metadata.field_name===m)}function me(m,C){h.value.set(m,C),c===h.value.size&&(D.value=!0)}function pe(m,C){p.value.set(m,C),l===p.value.size&&(B.value=!0)}const he={getFormRef:mn,getSectionRef:pn,getFieldRef:hn,registerSectionWrapperRef:me,registerFieldWrapperRef:pe},gn=new Proxy({},{get(m,C){var N;return(N=d.value)==null?void 0:N[C]}}),j={getMode:an,getSectionByName:G,getSectionByIndex:K,getSections:oe,getFieldByName:en,getFields:tn,validate:V,isValid:I,isInvalid:Z,softReset:v,reset:ne,clear:ie,resetValidation:ee,submit:k,submitBulk:z,valuesHasChanged:rn,getInitialValueByFieldName:R,getAssociationDataCallback:nn,setContext:ln,setCssClass:sn,setReadonlyState:cn,isReady:dn,getSubmitData:fn,getBulkSubmitData:un,form:gn};t(j);const yn=e.computed(()=>I()),Cn=e.computed(()=>Z()),bn=e.computed(()=>y());return e.watch(()=>D.value&&B.value,m=>{var C;m&&!S.value&&(E((C=d.value)==null?void 0:C.events.onReady),S.value=!0)}),e.watch(()=>{var m;return(m=d.value)==null?void 0:m.events.onIsValid},m=>{f==null||f(),f=null,m&&(f=e.watch(yn,C=>{var N;C&&E((N=d.value)==null?void 0:N.events.onIsValid)}))},{immediate:!0}),e.watch(()=>{var m;return(m=d.value)==null?void 0:m.events.onIsInvalid},m=>{s==null||s(),s=null,m&&(s=e.watch(Cn,C=>{var N;C&&E((N=d.value)==null?void 0:N.events.onIsInvalid)}))},{immediate:!0}),e.watch(()=>{var m;return(m=d.value)==null?void 0:m.events.onUpdate},m=>{i==null||i(),i=null,m&&(i=e.watch(bn,()=>{var C;E((C=d.value)==null?void 0:C.events.onUpdate)},{immediate:!0}))},{immediate:!0}),e.onMounted(async()=>{on(),await x(),e.nextTick(()=>{o=JSON.stringify(Q())})}),(m,C)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",Zt,[e.createElementVNode("div",{class:e.normalizeClass(d.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(d.value.sections,N=>(e.openBlock(),e.createBlock(Xt,{key:N.name,section:N,context:n.context,formApi:j,privateFormApi:he,registerRef:me},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(N.fields,L=>(e.openBlock(),e.createBlock(Jt,{key:L.metadata.field_name,field:L,context:n.context,formApi:j,privateFormApi:he,registerRef:pe},null,8,["field","context"]))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(d.value.orphanErrorsComponent),{orphanErrors:_.value,formApi:j},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(d.value.actionComponent),{isLoadingSubmit:T.value,formApi:j},null,8,["isLoadingSubmit"]))],512)),[[e.vShow,S.value]])}});$.DynamicLogicBuilder=X,$.Submit64=U,$.Submit64Form=vt,Object.defineProperty($,Symbol.toStringTag,{value:"Module"})});
