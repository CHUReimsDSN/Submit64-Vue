(function(A,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(A=typeof globalThis<"u"?globalThis:A||self,e(A["submit64-vue"]={},A.Vue,A.Quasar))})(this,function(A,e,m){"use strict";var Nt=Object.defineProperty;var At=(A,e,m)=>e in A?Nt(A,e,{enumerable:!0,configurable:!0,writable:!0,value:m}):A[e]=m;var S=(A,e,m)=>At(A,typeof e!="symbol"?e+"":e,m);const le={class:"flex column"},se={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},ce=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{}},setup(a){const t=a;function n(){const r=t.formApi.form.formStyle;return{outline:r.fieldOutlined,rounded:r.fieldRounded,square:r.fieldSquare,dense:r.fieldDense,color:r.fieldColor,noCaps:!0}}return(r,o)=>(e.openBlock(),e.createElementBlock("div",le,[e.createElementVNode("div",se,[e.createVNode(e.unref(m.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.submit}),null,16,["loading","onClick"]),t.reset?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(m.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Vider",onClick:t.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),de={class:"flex row items-center"},fe={class:"text-body1 text-weight-medium"},ue={class:"flex column q-gutter-md"},me=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",de,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(m.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",fe,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",ue,[e.renderSlot(n.$slots,"default")])]))}}),pe=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,r)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:r[0]||(r[0]=c=>t.reset())})}}}),ge=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createBlock(e.unref(m.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(m.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),he={class:"flex column"},ye=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",he,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,c)=>(e.openBlock(),e.createElementBlock("div",{key:c,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(c)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),Q=class Q{constructor(){S(this,"_formSettings");S(this,"_formStyle");S(this,"_actionComponent");S(this,"_orphanErrorsComponent");S(this,"_sectionComponent");S(this,"_wrapperResetComponent");S(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=ce,this._orphanErrorsComponent=ye,this._sectionComponent=me,this._wrapperResetComponent=pe,this._associationDisplayComponent=ge}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};S(Q,"_instance",new Q);let E=Q;class U{constructor(t){S(this,"formApi");S(this,"events",[]);this.formApi=t}when(t,n){const r=t,o=n,c=new Ce(r,o,this.formApi);return this.events.push(c),new be(c)}static create(t){return new U(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(r=>{const o=r.getTarget();switch(o.target){case"field":n.fields[o.target]||(n.fields[o.target]={}),n.fields[o.target][o.key]||(n.fields[o.target][o.key]=[]),n.fields[o.target][o.key].push(r.getActionCallback());break;case"section":n.sections[o.target]||(n.sections[o.target]={}),n.sections[o.target][o.key]||(n.sections[o.target][o.key]=[]),n.sections[o.target][o.key].push(r.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(r.getActionCallback());break}}),n}}class Ce{constructor(t,n,r){S(this,"type");S(this,"data");S(this,"formApi");S(this,"action",()=>{});S(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=r}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class be{constructor(t){S(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const ke={class:"row items-center justify-end"},Se=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,c=r.rulesBehaviour==="lazy",l=e.ref(),s=e.ref();function i(){l.value&&l.value.hide()}function d(){return s.value?s.value.validate():!1}function p(){return s.value?s.value.hasError:!1}function k(){s.value&&s.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(d,p,k)}),(C,x)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":x[1]||(x[1]=B=>t.modelValueOnUpdate(B)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"popupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":x[0]||(x[0]=B=>t.modelValueOnUpdate(B)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",ke,[e.createVNode(e.unref(m.QBtn),{onClick:i,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),_e={class:"row items-center justify-end"},Fe={class:"row items-center justify-end"},Ve=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,c=r.rulesBehaviour==="lazy",l=e.ref(),s=e.ref(),i=e.ref();function d(){l.value&&l.value.hide()}function p(){s.value&&s.value.hide()}function k(){return i.value?i.value.validate():!1}function C(){return i.value?i.value.hasError:!1}function x(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(k,C,x)}),(B,F)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":F[2]||(F[2]=V=>t.modelValueOnUpdate(V)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"datePopupProxyRef",ref:l,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=V=>t.modelValueOnUpdate(V)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",_e,[e.createVNode(e.unref(m.QBtn),{onClick:d,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(m.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QPopupProxy),{ref_key:"timePopupProxyRef",ref:s,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(m.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":F[1]||(F[1]=V=>t.modelValueOnUpdate(V)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Fe,[e.createVNode(e.unref(m.QBtn),{onClick:p,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),xe={class:"flex column"},Be={key:0,class:"q-field__bottom"},De={key:1,class:"q-field--error q-field__bottom text-negative"},Re=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),o=t.formApi.form.formStyle;function c(){return n.value===!0}function l(){return n.value===!0}function s(){n.value=!0}return e.watch(()=>t.modelValue,i=>{for(const d of t.rules)if(n.value=d(i),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(c,l,s)}),(i,d)=>(e.openBlock(),e.createElementBlock("div",xe,[e.createVNode(e.unref(m.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":d[0]||(d[0]=p=>t.modelValueOnUpdate(p)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",Be,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",De,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Ne=e.defineComponent({__name:"ObjectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.form,r=n.formSettings;return n.formStyle,r.rulesBehaviour,(o,c)=>" TODO json edit ? "}}),Ae=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),r=e.ref([]),o=e.ref(),c=t.formApi.form,l=c.formSettings,s=c.formStyle,i=l.rulesBehaviour==="lazy";function d(F,V){if(F===""){V(()=>{r.value=[...n.value]});return}V(()=>{const w=F.toLowerCase();r.value=n.value.filter(g=>g.label.toLowerCase().includes(w))})}function p(){n.value=Object.freeze(t.field.staticSelectOptions??[]),r.value=t.field.staticSelectOptions??[]}function k(){return o.value?o.value.validate():!1}function C(){return o.value?o.value.hasError:!1}function x(){o.value&&o.value.resetValidation()}function B(){t.clear(),r.value=[]}return e.onMounted(()=>{p(),t.registerBehaviourCallbacks(k,C,x)}),(F,V)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":V[0]||(V[0]=w=>t.modelValueOnUpdate(w)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(s).fieldOutlined,filled:e.unref(s).fieldFilled,standout:e.unref(s).fieldStandout,borderless:e.unref(s).fieldBorderless,rounded:e.unref(s).fieldRounded,square:e.unref(s).fieldSquare,dense:e.unref(s).fieldDense,hideBottomSpace:e.unref(s).fieldHideBottomSpace,color:e.unref(s).fieldColor,bgColor:e.unref(s).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:r.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:B,onFilter:d},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),X=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,c=r.formStyle,l=o.rulesBehaviour==="lazy",s=e.ref([]),i=e.ref(k()),d=e.ref(),p=e.ref("__init");function k(){return{limit:30,nextPage:2,lastPage:2,isLoading:!1}}function C(h,_){if(h===p.value)return;const N=t.formApi.getAssociationDataCallback();i.value=k(),p.value=h;const T=t.formApi.form;i.value.isLoading=!0,N({resourceName:T.resourceName,resourceId:T.resourceId,associationName:t.field.metadata.field_association_name,limit:i.value.limit,offset:(i.value.nextPage-1)*i.value.limit,labelFilter:h,context:T.context}).then(z=>{_(()=>{s.value=z.rows,i.value.lastPage=Math.ceil(z.row_count/i.value.limit),i.value.isLoading=!1})}).catch(()=>{s.value=[],i.value=k()})}function x(){e.nextTick(()=>{const h=t.getValueSerialized();!h||!t.field.associationData||(s.value=[{label:t.field.associationData.label[0]??"???",value:h,data:t.field.associationData.data[0]}])})}function B(){return d.value?d.value.validate():!1}function F(){return d.value?d.value.hasError:!1}function V(){d.value&&d.value.resetValidation()}function w(){t.clear(),s.value=[]}function g(h){const _=s.value.length-1;if(i.value.isLoading!==!0&&i.value.nextPage<i.value.lastPage&&h.to===_&&_>i.value.limit-1){const N=t.formApi.form,T=t.formApi.getAssociationDataCallback();i.value.isLoading=!0,T({resourceName:N.resourceName,resourceId:N.resourceId,associationName:t.field.metadata.field_association_name,limit:i.value.limit,offset:(i.value.nextPage-1)*i.value.limit,labelFilter:p.value,context:N.context}).then(z=>{s.value=s.value.concat(z.rows),i.value.lastPage=Math.ceil(z.row_count/i.value.limit),i.value.nextPage++,i.value.isLoading=!1,h.ref.refresh()})}}return e.onMounted(()=>{x(),t.registerBehaviourCallbacks(B,F,V)}),(h,_)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=N=>t.modelValueOnUpdate(N)),label:t.field.label,outlined:e.unref(c).fieldOutlined,filled:e.unref(c).fieldFilled,standout:e.unref(c).fieldStandout,borderless:e.unref(c).fieldBorderless,rounded:e.unref(c).fieldRounded,square:e.unref(c).fieldSquare,dense:e.unref(c).fieldDense,hideBottomSpace:e.unref(c).fieldHideBottomSpace,color:e.unref(c).fieldColor,bgColor:e.unref(c).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:s.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:w,onFilter:C,onVirtualScroll:g},{option:e.withCtx(N=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:N.opt,itemProps:N.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),Z=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,c=r.formStyle,l=o.rulesBehaviour==="lazy",s=e.ref([]),i=e.ref(k()),d=e.ref(),p=e.ref("__init");function k(){return{limit:30,nextPage:2,lastPage:2,isLoading:!1}}function C(g,h){if(g===p.value)return;const _=t.formApi.getAssociationDataCallback();i.value=k(),p.value=g;const N=t.formApi.form;i.value.isLoading=!0,_({resourceName:N.resourceName,resourceId:N.resourceId,associationName:t.field.metadata.field_association_name,limit:i.value.limit,offset:(i.value.nextPage-1)*i.value.limit,labelFilter:g,context:N.context}).then(T=>{h(()=>{s.value=T.rows,i.value.lastPage=Math.ceil(T.row_count/i.value.limit),i.value.isLoading=!1})}).catch(()=>{s.value=[],i.value=k()})}function x(){e.nextTick(()=>{const g=t.getValueSerialized();!g||!t.field.associationData||(s.value=g.map((h,_)=>({label:t.field.associationData.label[_]??"???",value:h,data:t.field.associationData.data[_]})))})}function B(){return d.value?d.value.validate():!1}function F(){return d.value?d.value.hasError:!1}function V(){d.value&&d.value.resetValidation()}function w(){t.clear(),s.value=[]}return e.onMounted(()=>{x(),t.registerBehaviourCallbacks(B,F,V)}),(g,h)=>(e.openBlock(),e.createBlock(e.unref(m.QSelect),{ref_key:"fieldRef",ref:d,"model-value":t.modelValue,"onUpdate:modelValue":h[0]||(h[0]=_=>t.modelValueOnUpdate(_)),label:t.field.label,hint:t.field.hint,outlined:e.unref(c).fieldOutlined,filled:e.unref(c).fieldFilled,standout:e.unref(c).fieldStandout,borderless:e.unref(c).fieldBorderless,rounded:e.unref(c).fieldRounded,square:e.unref(c).fieldSquare,dense:e.unref(c).fieldDense,hideBottomSpace:e.unref(c).fieldHideBottomSpace,color:e.unref(c).fieldColor,bgColor:e.unref(c).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:s.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:w,onFilter:C},{option:e.withCtx(_=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:_.opt,itemProps:_.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),ee=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,c=r.rulesBehaviour==="lazy",l=e.ref();function s(){return l.value?l.value.validate():!1}function i(){return l.value?l.value.hasError:!1}function d(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,i,d)}),(p,k)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":k[0]||(k[0]=C=>t.modelValueOnUpdate(C)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Ee=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,c=r.rulesBehaviour==="lazy",l=e.ref();function s(){return l.value?l.value.validate():!1}function i(){return l.value?l.value.hasError:!1}function d(){l.value&&l.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,i,d)}),(p,k)=>(e.openBlock(),e.createBlock(e.unref(m.QInput),{ref_key:"fieldRef",ref:l,"model-value":t.modelValue,"onUpdate:modelValue":k[0]||(k[0]=C=>t.modelValueOnUpdate(C)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":c,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}});class ${constructor(t,n,r,o,c,l,s,i,d){S(this,"resourceName");S(this,"resourceId");S(this,"formMetadataAndData");S(this,"context");S(this,"formSettings");S(this,"formStyle");S(this,"actionComponent");S(this,"orphanErrorsComponent");S(this,"sectionComponent");S(this,"wrapperResetComponent");S(this,"associationDisplayComponent");S(this,"dynamicComponentRecord");S(this,"formApi");S(this,"registerEventCallback");this.dynamicComponentRecord=r.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=s,this.resourceName=t,this.formApi=i,this.formSettings={...c,...E.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...l,...E.getGlobalFormStyle()},this.actionComponent=r.actionComponent??E.getGlobalActionComponent(),this.orphanErrorsComponent=r.orphanErrorsComponent??E.getGlobalOrphanErrorComponent(),this.sectionComponent=r.sectionComponent??E.getGlobalSectionComponent(),this.wrapperResetComponent=r.wrapperResetComponent??E.getGlobalWrapperResetComponent(),this.associationDisplayComponent=r.associationDisplayComponent??E.getGlobalAssociationDisplayComponent(),this.registerEventCallback=d??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...E.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:E.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(E.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(E.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(E.getGlobalWrapperResetComponent()),dynamicComponentRecord:{}}}static getForm(t,n,r,o,c,l,s,i,d){return new $(t,n,r,o,c,l,s,i,d).generateFormDef()}generateFormDef(){const t=U.create(this.formApi);this.registerEventCallback(t);const n=U.getEventsObjectFromInstance(t),r=[];return this.formMetadataAndData.form.sections.forEach((c,l)=>{const s=[];c.fields.forEach(C=>{const x=this.dynamicComponentRecord[`field-${C.field_name}-before`],B=$.getFieldComponentByFormFieldType(C.field_type),F=this.dynamicComponentRecord[`field-${C.field_name}-after`],V={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:$.getRegularFieldTypeByFieldType(C.field_type)},w={type:C.field_type,metadata:Object.freeze(C),label:C.label,hint:C.hint??void 0,prefix:C.prefix??void 0,suffix:C.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??c.readonly??C.readonly??void 0,cssClass:C.css_class??void 0,staticSelectOptions:C.static_select_options,associationData:C.field_association_data,rules:C.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:x?e.markRaw(x):void 0,mainComponent:e.markRaw(B),afterComponent:F?e.markRaw(F):void 0,events:n.fields[C.field_name]??{},componentOptions:V};s.push(w)});const i=this.dynamicComponentRecord[`section-${c.name??l}-before`],d=this.sectionComponent,p=this.dynamicComponentRecord[`section-${c.name??l}-after`],k={label:c.label??void 0,icon:c.icon??void 0,cssClass:c.css_class??void 0,hidden:!1,name:c.name??l.toString(),readonly:this.formMetadataAndData.form.readonly??c.readonly??void 0,events:n.sections[c.name??l.toString()]??{},beforeComponent:i?e.markRaw(i):void 0,mainComponent:e.markRaw(d),afterComponent:p?e.markRaw(p):void 0,fields:s};r.push(k)}),{sections:r,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,events:n.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context}}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){return{string:ee,text:ee,number:Ee,date:Se,datetime:Ve,selectString:Ae,selectBelongsTo:X,selectHasMany:Z,selectHasAndBelongsToMany:Z,selectHasOne:X,checkbox:Re,object:Ne}[t]}}function D(a){a==null||a.forEach(t=>{t()})}function we(a,t,n){const r=n.form,o=(i,d,p)=>i[d]?p?()=>c(i[d]):()=>i[d]:i.compare_to?()=>{var k;return((k=n.getFieldByName(i.compare_to))==null?void 0:k.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",c=i=>String(m.date.formatDate(m.date.extractDate(i,r.formSettings.backendDateFormat),r.formSettings.dateFormat)),l=[],s=[];switch(t){case"date":l.push(ne(r.formSettings.dateFormat));break;case"datetime":l.push(ne(r.formSettings.datetimeFormat));break}return a.forEach(i=>{const d=i;switch(d.type){case"required":l.push(Te());break;case"absence":l.push(ze());break;case"acceptance":l.push(Ie());break;case"inclusion":l.push(te(d.including));break;case"exclusion":l.push(Oe(d.excluding));break;case"backend":break;case"allowNull":s.push("allowNull");break;case"allowBlank":s.push("allowBlank");break;case"positiveNumber":l.push(Ue());break;case"lessThanOrEqualNumber":l.push(Le(o(d,"less_than")));break;case"lessThanNumber":l.push(qe(o(d,"less_than")));break;case"greaterThanOrEqualNumber":l.push(Qe(o(d,"greater_than")));break;case"greaterThanNumber":l.push(Ge(o(d,"greater_than")));break;case"equalToNumber":l.push(Me(o(d,"equal_to")));break;case"otherThanNumber":l.push(He(o(d,"other_than")));break;case"numberIntegerOnly":l.push(je());break;case"numberNumericOnly":l.push(Ye());break;case"numberEvenOnly":l.push(We());break;case"numberOddOnly":l.push(ve());break;case"lessThanOrEqualStringLength":l.push(Je(o(d,"less_than")));break;case"lessThanStringLength":l.push(Ke(o(d,"less_than")));break;case"greaterThanOrEqualStringLength":l.push(Xe(o(d,"greater_than")));break;case"greaterThanStringLength":l.push(Ze(o(d,"greater_than")));break;case"equalToStringLength":l.push(nt(o(d,"equal_to")));break;case"equalToString":l.push(tt(o(d,"equal_to")));break;case"betweenStringLength":l.push(et(()=>d.min,()=>d.max));break;case"otherThanString":l.push(ot(o(d,"other_than")));break;case"lessThanOrEqualDate":l.push(rt(o(d,"less_than",!0),r.formSettings.dateFormat));break;case"lessThanDate":l.push(at(o(d,"less_than",!0),r.formSettings.dateFormat));break;case"greaterThanOrEqualDate":l.push(it(o(d,"greater_than",!0),r.formSettings.dateFormat));break;case"greaterThanDate":l.push(lt(o(d,"greater_than",!0),r.formSettings.dateFormat));break;case"equalToDate":l.push(st(o(d,"equal_to",!0),r.formSettings.dateFormat));break;case"otherThanDate":l.push(ct(o(d,"other_than",!0),r.formSettings.dateFormat));break}}),s.length>0?s.map(i=>{switch(i){case"allowBlank":return Pe(l);case"allowNull":return $e(l)}}):l}function Te(){return a=>!!a||"Ce champ est requis"}function te(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function Oe(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${te.toString()}`)}function ze(){return a=>!a||"Ce champ doit être vide"}function Ie(){return a=>!!a||"Doit être accepté"}function $e(a){return t=>(t===null||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function Pe(a){return t=>(t===""||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function Ue(){return a=>Number(a)>0||"Val. positive uniquement"}function Le(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function qe(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function Qe(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function Ge(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function Me(a,t){return n=>{const r=a();return Number(n)===r||`Égale à ${r}`}}function He(a,t){return n=>{const r=a();return Number(n)!==r||`Doit être différent de ${a}`}}function je(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function Ye(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function We(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function ve(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function Je(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function Ke(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function Xe(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function Ze(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function et(a,t){return n=>{const r=a(),o=t();return String(n).length>=r&&String(n).length<=o||`Entre ${r} et ${o}`}}function tt(a,t){return n=>{const r=a();return String(n)===r||`Égale à ${r}`}}function nt(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function ot(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function rt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),c=m.date.extractDate(r,t);return o<=c||`Inf. ou égal à ${r}`}}function at(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),c=m.date.extractDate(r,t);return o<c||`Inf. à ${r}`}}function it(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),c=m.date.extractDate(r,t);return o>=c||`Sup. ou égal à ${r}`}}function lt(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),c=m.date.extractDate(r,t);return o>c||`Sup. à ${r}`}}function st(a,t){return n=>{const r=a(),o=m.date.extractDate(String(n),t),c=m.date.extractDate(r,t);return o===c||`Égale à ${o}`}}function ct(a,t){return n=>{const r=a();return m.date.extractDate(String(n),t)!==m.date.extractDate(r,t)||`Doit être différent de ${r}`}}function ne(a){return t=>t==null||t===""?!0:dt(t,a)||`Date invalide. Format : ${a}`}function dt(a,t){if(typeof a!="string"||!a.trim())return!1;const n=m.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:m.date.formatDate(n,t)===a}const ft={computeServerRules:we},ut={key:2,class:"q-field__bottom text-negative q-pt-none"},mt=["index"],pt=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=()=>!0,o=()=>!0,c=()=>{};const l=x(),s=e.ref(),i=e.ref([]);function d(){s.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),s.value=p(s.value),D(n.field.events.onReset),e.nextTick(()=>{H()})}function p(u){const b=n.formApi.form;switch(n.field.type){case"checkbox":return u==null||u===""?!1:u;case"date":return u==null||u===""?null:m.date.formatDate(m.date.extractDate(String(u),b.formSettings.backendDateFormat),b.formSettings.dateFormat);case"datetime":return u==null||u===""?null:m.date.formatDate(m.date.extractDate(String(u),b.formSettings.backendDatetimeFormat),b.formSettings.datetimeFormat)}return u}function k(u){const b=n.formApi.form;switch(n.field.type){case"date":return u==null||u===""?null:m.date.formatDate(m.date.extractDate(String(u),b.formSettings.dateFormat),b.formSettings.backendDateFormat);case"datetime":return u==null||u===""?null:m.date.formatDate(m.date.extractDate(String(u),b.formSettings.datetimeFormat),b.formSettings.backendDatetimeFormat)}return u}function C(){switch(n.field.type){case"string":s.value="";break;case"checkbox":s.value=!1;break;case"date":s.value=null;break;case"datetime":s.value=null;break;case"number":s.value=null;break;case"selectString":s.value=void 0;break;case"text":s.value="";break;case"object":s.value={};break;case"selectBelongsTo":s.value=void 0;break;case"selectHasMany":s.value=void 0;break}D(n.field.events.onClear)}function x(){return ft.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function B(u){s.value=u}function F(){return e.unref(s)}function V(){return k(e.unref(s))}function w(u){i.value=u}function g(){const u=n.privateFormApi.getFieldRef(n.field.metadata.field_name);u&&(u.hidden=!0)}function h(){const u=n.privateFormApi.getFieldRef(n.field.metadata.field_name);u&&(u.hidden=!1)}function _(u){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.readonly=u)}function N(u){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.hint=u)}function T(u){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.cssClass=u)}function z(u){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.suffix=u)}function W(u){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.prefix=u)}function v(u){const b=n.privateFormApi.getFieldRef(n.field.metadata.field_name);b&&(b.label=u)}function G(){const u=r();return D(n.field.events.onValidated),u}function M(){return o()}function H(){return c()}function J(u,b,q){r=u,o=b,c=q}const L={reset:d,clear:C,validate:G,isValid:M,hide:g,unhide:h,resetValidation:H,getValueDeserialized:V,getValueSerialized:F,setupBackendErrors:w,setReadonlyState:_,setHint:N,setCssClass:T,setSuffix:z,setPrefix:W,setLabel:v,setValue:B,field:n.field};return t(L),e.watch(()=>n.field.events.onUpdate?s.value:null,()=>{D(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid?M():null,u=>{u&&D(n.field.events.onIsValid)}),e.onMounted(()=>{var b;d();const u=(b=e.getCurrentInstance())==null?void 0:b.exposed;u&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,u)}),(u,b)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,formApi:n.formApi,fieldApi:L},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:s.value,field:n.field,formApi:n.formApi,rules:e.unref(l),reset:d,clear:C,getValueDeserialized:V,getValueSerialized:F,validate:G,modelValueOnUpdate:B,registerBehaviourCallbacks:J},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,formApi:n.formApi,fieldApi:L},null,8,["formApi"])):e.createCommentVNode("",!0),i.value.length>0?(e.openBlock(),e.createElementBlock("div",ut,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,(q,K)=>(e.openBlock(),e.createElementBlock("div",{index:K,class:"flex column"},e.toDisplayString(q),9,mt))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),gt={class:"flex column"},ht=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a,r=new Map,o={reset:l,clear:s,validate:p,isValid:k,hide:i,unhide:d,resetValidation:C,getFields:x,setReadonlyState:B,setCssClass:F,setIcon:V,setLabel:w,section:n.section};function c(){n.section.fields.forEach(g=>{const h=g.metadata.field_name,_=n.formApi.getFieldByName(h);_&&r.set(h,_)})}function l(){r.forEach(g=>{g.reset()}),D(n.section.events.onReset)}function s(){r.forEach(g=>{g.clear()}),D(n.section.events.onClear)}function i(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(r.forEach(h=>{h.hide()}),g.hidden=!0,D(n.section.events.onHide))}function d(){const g=n.privateFormApi.getSectionRef(n.section.name);g&&(r.forEach(h=>{h.unhide()}),g.hidden=!1,D(n.section.events.onUnhide))}function p(){let g=!0;return r.forEach(h=>{if(!h.validate()){g=!1;return}}),D(n.section.events.onValidated),g}function k(){let g=!0;return r.forEach(h=>{if(!h.isValid()){g=!1;return}}),g}function C(){r.forEach(g=>{g.resetValidation()})}function x(){return r}function B(g){const h=n.privateFormApi.getSectionRef(n.section.name);h&&(h.readonly=g)}function F(g){const h=n.privateFormApi.getSectionRef(n.section.name);h&&(h.cssClass=g)}function V(g){const h=n.privateFormApi.getSectionRef(n.section.name);h&&(h.icon=g)}function w(g){const h=n.privateFormApi.getSectionRef(n.section.name);h&&(h.label=g)}return t(o),e.watch(()=>n.section.events.onIsValid?k():null,g=>{g&&D(n.section.events.onIsValid)}),e.onMounted(()=>{var h;const g=(h=e.getCurrentInstance())==null?void 0:h.exposed;g&&n.privateFormApi.registerSectionWrapperRef(n.section.name,g),e.nextTick(()=>{c()})}),(g,h)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",gt,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:o},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:o,formApi:n.formApi},{default:e.withCtx(()=>[e.renderSlot(g.$slots,"default")]),_:3},8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:o},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}}),yt={class:"flex column"},Ct=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let r=null,o="",c=0,l=0;const s=e.useSlots(),i=new Map,d=new Map,p=e.ref($.getEmptyFormBeforeInit()),k=e.ref(!1),C=e.ref(!1),x=e.ref(!1),B=e.ref(!1),F=e.ref("create"),V=e.ref({});async function w(){r=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),p.value=$.getForm(n.resourceName,n.resourceId,h(),r,n.formSettings,n.formStyle,n.context,P,n.eventManager),c=p.value.sections.length,l=p.value.sections.map(f=>f.fields).flat().length,n.resourceId&&(F.value="edit")}async function g(){var R,O,j;if(!N())return;B.value=!0,G();const f=_(),y=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:f,context:n.context});if(y.success)V.value={},F.value==="create"&&(F.value="edit"),r&&y.resource_data&&(r.resource_data=y.resource_data),o=JSON.stringify(_()),p.value=$.getForm(n.resourceName,n.resourceId,h(),{form:y.form,resource_data:y.resource_data},n.formSettings,n.formStyle,n.context,P,n.eventManager),D((O=p.value)==null?void 0:O.events.onSubmitSuccess);else{V.value={};const Y=[];[...i].forEach(I=>{const ie=y.errors[I[0]];ie&&(I[1].setupBackendErrors(ie),Y.push(I[0]))}),Object.entries(y.errors).forEach(I=>{Y.includes(I[0])||(V.value[I[0]]=I[1])}),D((R=p.value)==null?void 0:R.events.onSubmitUnsuccess)}D((j=p.value)==null?void 0:j.events.onSubmit),B.value=!1}function h(){const f={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const y in s){const R=s[y];if(R){const O=e.defineComponent({inheritAttrs:!1,setup(j,{attrs:Y,slots:I}){return()=>R({...j,...Y,slots:I})}});switch(y){case"sections":f.sectionComponent=O;break;case"actions":f.actionComponent=O;break;case"orphan-errors":f.orphanErrorsComponent=O;break;case"association-display":f.associationDisplayComponent=O;break;default:f.dynamicComponentRecord[y]=O;break}}}return f}function _(){const f={};return[...i].forEach(y=>{f[y[0]]=y[1].getValueDeserialized()}),f}function N(){var y;let f=!0;return i.forEach(R=>{if(!R.validate()){f=!1;return}}),D((y=p.value)==null?void 0:y.events.onValidated),f}function T(){let f=!0;return i.forEach(y=>{if(!y.isValid()){f=!1;return}}),f}function z(){var f;i.forEach(y=>{y.reset()}),D((f=p.value)==null?void 0:f.events.onReset)}function W(){var f;i.forEach(y=>{y.clear()}),D((f=p.value)==null?void 0:f.events.onClear)}function v(){i.forEach(f=>{f.resetValidation()})}function G(){i.forEach(f=>{f.setupBackendErrors([])})}function M(f){if(r)return r.resource_data[f]}function H(f){return d.get(f)}function J(f){return[...d.values()].at(f)}function L(){return d}function u(f){return i.get(f)}function b(){return i}function q(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function K(){["getMetadataAndData","resourceName"].forEach(y=>{(n[y]===null||n[y]===void 0)&&console.warn(`Missing props for <Submit64> -> ${y}`)})}function bt(){return e.unref(F)}function kt(){return o!==JSON.stringify(_())}function St(f){p.value&&(p.value.context=f)}function _t(f){p.value&&(p.value.cssClass=f)}function Ft(f){p.value&&(p.value.readonly=f)}function Vt(){return x.value}function xt(){return p}function Bt(f){var y;return(y=p.value)==null?void 0:y.sections.find(R=>R.name===f)}function Dt(f){var y;return(y=p.value)==null?void 0:y.sections.map(R=>R.fields).flat().find(R=>R.metadata.field_name===f)}function oe(f,y){d.set(f,y),c===d.size&&(k.value=!0)}function re(f,y){i.set(f,y),l===i.size&&(C.value=!0)}const ae={getFormRef:xt,getSectionRef:Bt,getFieldRef:Dt,registerSectionWrapperRef:oe,registerFieldWrapperRef:re},Rt=new Proxy({},{get(f,y){var R;return(R=p.value)==null?void 0:R[y]}}),P={getMode:bt,getSectionByName:H,getSectionByIndex:J,getSections:L,getFieldByName:u,getFields:b,validate:N,isFormValid:T,reset:z,clear:W,resetValidation:v,submit:g,valuesHasChanged:kt,getInitialValueByFieldName:M,getAssociationDataCallback:q,setContext:St,setCssClass:_t,setReadonlyState:Ft,isReady:Vt,form:Rt};return t(P),e.watch(()=>k.value&&C.value,f=>{var y;f&&!x.value&&(D((y=p.value)==null?void 0:y.events.onReady),x.value=!0)}),e.watch(()=>{var f;return(f=p.value)!=null&&f.events.onIsValid?T():null},()=>{var f;D((f=p.value)==null?void 0:f.events.onIsValid)}),e.watch(()=>{var f;return(f=p.value)!=null&&f.events.onUpdate?_():null},()=>{var f;D((f=p.value)==null?void 0:f.events.onUpdate)}),e.onMounted(async()=>{K(),await w(),e.nextTick(()=>{o=JSON.stringify(_())})}),(f,y)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",yt,[e.createElementVNode("div",{class:e.normalizeClass(p.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(p.value.sections,R=>(e.openBlock(),e.createBlock(ht,{key:R.name,section:R,context:n.context,formApi:P,privateFormApi:ae,registerRef:oe},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(R.fields,O=>(e.openBlock(),e.createBlock(pt,{key:O.metadata.field_name,field:O,context:n.context,formApi:P,privateFormApi:ae,registerRef:re},null,8,["field","context"]))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(p.value.orphanErrorsComponent),{orphanErrors:V.value,formApi:P},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(p.value.actionComponent),{isLoadingSubmit:B.value,formApi:P},null,8,["isLoadingSubmit"]))],512)),[[e.vShow,x.value]])}});A.DynamicLogicBuilder=U,A.Submit64=E,A.Submit64Form=Ct,Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});
