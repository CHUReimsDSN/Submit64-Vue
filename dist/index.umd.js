(function(N,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("quasar")):typeof define=="function"&&define.amd?define(["exports","vue","quasar"],e):(N=typeof globalThis<"u"?globalThis:N||self,e(N["submit64-vue"]={},N.Vue,N.Quasar))})(this,function(N,e,p){"use strict";var At=Object.defineProperty;var Et=(N,e,p)=>e in N?At(N,e,{enumerable:!0,configurable:!0,writable:!0,value:p}):N[e]=p;var S=(N,e,p)=>Et(N,typeof e!="symbol"?e+"":e,p);const se={class:"flex column"},ce={class:"flex row items-center no-wrap q-pt-sm q-gutter-x-sm"},de=e.defineComponent({__name:"DefaultActionComponent",props:{isLoadingSubmit:{type:Boolean},formApi:{},submit:{type:Function},reset:{type:Function},clear:{type:Function}},setup(a){const t=a;function n(){const r=t.formApi.form.formStyle;return{outline:r.fieldOutlined,rounded:r.fieldRounded,square:r.fieldSquare,dense:r.fieldDense,color:r.fieldColor,noCaps:!0}}return(r,o)=>(e.openBlock(),e.createElementBlock("div",se,[e.createElementVNode("div",ce,[e.createVNode(e.unref(p.QBtn),e.mergeProps(n(),{label:"Enregistrer",loading:t.isLoadingSubmit,onClick:t.submit}),null,16,["loading","onClick"]),t.reset?(e.openBlock(),e.createBlock(e.unref(p.QBtn),e.mergeProps({key:0},n(),{loading:t.isLoadingSubmit,label:"Réinitialiser",onClick:t.reset}),null,16,["loading","onClick"])):e.createCommentVNode("",!0),t.clear?(e.openBlock(),e.createBlock(e.unref(p.QBtn),e.mergeProps({key:1},n(),{loading:t.isLoadingSubmit,label:"Vider",onClick:t.clear}),null,16,["loading","onClick"])):e.createCommentVNode("",!0)])]))}}),fe={class:"flex row items-center"},ue={class:"text-body1 text-weight-medium"},me={class:"flex column q-gutter-md"},pe=e.defineComponent({__name:"DefaultSectionComponent",props:{formApi:{},sectionApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",fe,[t.sectionApi.section.icon?(e.openBlock(),e.createBlock(e.unref(p.QIcon),{key:0,name:t.sectionApi.section.icon,size:"sm",color:t.formApi.form.formStyle.fieldColor},null,8,["name","color"])):e.createCommentVNode("",!0),e.createElementVNode("div",ue,e.toDisplayString(t.sectionApi.section.label),1)]),e.createElementVNode("div",me,[e.renderSlot(n.$slots,"default")])]))}}),he=e.defineComponent({__name:"DefaultWrapperResetComponent",props:{reset:{type:Function}},setup(a){const t=a;return(n,r)=>{const o=e.resolveComponent("q-icon");return e.openBlock(),e.createBlock(o,{name:"reset",class:"cursor-pointer",onClick:r[0]||(r[0]=l=>t.reset())})}}}),ge=e.defineComponent({__name:"DefaultAssociationDisplayComponent",props:{associationName:{},entry:{},itemProps:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createBlock(e.unref(p.QItem),e.normalizeProps(e.guardReactiveProps(t.itemProps)),{default:e.withCtx(()=>[e.createVNode(e.unref(p.QItemSection),null,{default:e.withCtx(()=>[e.createVNode(e.unref(p.QItemLabel),null,{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t.entry.label),1)]),_:1})]),_:1})]),_:1},16))}}),ye={class:"flex column"},Ce=e.defineComponent({__name:"DefaultOrphanErrorsComponent",props:{orphanErrors:{},formApi:{}},setup(a){const t=a;return(n,r)=>(e.openBlock(),e.createElementBlock("div",ye,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.orphanErrors,(o,l)=>(e.openBlock(),e.createElementBlock("div",{key:l,class:"q-field--error q-field__bottom text-negative"},e.toDisplayString(l)+" : "+e.toDisplayString(o.join(",")),1))),128))]))}}),P=class P{constructor(){S(this,"_formSettings");S(this,"_formStyle");S(this,"_actionComponent");S(this,"_orphanErrorsComponent");S(this,"_sectionComponent");S(this,"_wrapperResetComponent");S(this,"_associationDisplayComponent");this._formSettings={rulesBehaviour:"ondemand",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY HH:mm",renderBackendHint:!0},this._formStyle={fieldOutlined:!1,fieldDense:!0,fieldHideBottomSpace:!0,fieldFilled:!1,fieldStandout:!1,fieldBorderless:!1,fieldRounded:!1,fieldSquare:!1,fieldClass:"",fieldColor:"primary",fieldBgColor:"white"},this._actionComponent=de,this._orphanErrorsComponent=Ce,this._sectionComponent=pe,this._wrapperResetComponent=he,this._associationDisplayComponent=ge}static registerGlobalFormSetting(t){this._instance._formSettings={...this._instance._formSettings,...t}}static registerGlobalFormStyle(t){this._instance._formStyle={...this._instance._formStyle,...t}}static registerGlobalActionComponent(t){this._instance._actionComponent=t}static registerGlobalOrphanErrorsComponent(t){this._instance._orphanErrorsComponent=t}static registerGlobalSectionComponent(t){this._instance._sectionComponent=t}static registerGlobalWrapperResetComponent(t){this._instance._wrapperResetComponent=t}static registerGlobalAssociationDisplayComponent(t){this._instance._associationDisplayComponent=t}static getGlobalFormSetting(){return this._instance._formSettings}static getGlobalFormStyle(){return this._instance._formStyle}static getGlobalActionComponent(){return this._instance._actionComponent}static getGlobalOrphanErrorComponent(){return this._instance._orphanErrorsComponent}static getGlobalSectionComponent(){return this._instance._sectionComponent}static getGlobalWrapperResetComponent(){return this._instance._wrapperResetComponent}static getGlobalAssociationDisplayComponent(){return this._instance._associationDisplayComponent}};S(P,"_instance",new P);let A=P;class ${constructor(t){S(this,"formApi");S(this,"events",[]);this.formApi=t}when(t,n){const r=t,o=n,l=new be(r,o,this.formApi);return this.events.push(l),new ke(l)}static create(t){return new $(t)}static getEventsObjectFromInstance(t){const n={fields:{},sections:{},form:{}};return t.events.forEach(r=>{const o=r.getTarget();switch(o.target){case"field":n.fields[o.target]||(n.fields[o.target]={}),n.fields[o.target][o.key]||(n.fields[o.target][o.key]=[]),n.fields[o.target][o.key].push(r.getActionCallback());break;case"section":n.sections[o.target]||(n.sections[o.target]={}),n.sections[o.target][o.key]||(n.sections[o.target][o.key]=[]),n.sections[o.target][o.key].push(r.getActionCallback());break;case"form":n.form[o.key]||(n.form[o.key]=[]),n.form[o.key].push(r.getActionCallback());break}}),n}}class be{constructor(t,n,r){S(this,"type");S(this,"data");S(this,"formApi");S(this,"action",()=>{});S(this,"cyclicActionCallSet",new Set);this.type=t,this.data=n,this.formApi=r}getTarget(){switch(this.type){case"Field is updated":return{target:"field",targetName:this.data.fieldName,key:"onUpdate"};case"Field is valid":return{target:"field",targetName:this.data.fieldName,key:"onIsValid"};case"Field is validated":return{target:"field",targetName:this.data.fieldName,key:"onValidated"};case"Field is cleared":return{target:"field",targetName:this.data.fieldName,key:"onClear"};case"Field is reseted":return{target:"field",targetName:this.data.fieldName,key:"onReset"};case"Field is hidden":return{target:"field",targetName:this.data.fieldName,key:"onHide"};case"Field is unhidden":return{target:"field",targetName:this.data.fieldName,key:"onUnhide"};case"Section is valid":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is hidden":return{target:"section",targetName:this.data.sectionName,key:"onHide"};case"Section is unhidden":return{target:"section",targetName:this.data.sectionName,key:"onUnhide"};case"Section is cleared":return{target:"section",targetName:this.data.sectionName,key:"onClear"};case"Section is reseted":return{target:"section",targetName:this.data.sectionName,key:"onReset"};case"Section is validated":return{target:"section",targetName:this.data.sectionName,key:"onValidated"};case"Form is ready":return{target:"form",key:"onReady"};case"Form is submited":return{target:"form",key:"onSubmit"};case"Form submit is successful":return{target:"form",key:"onSubmitSuccess"};case"Form submit is unsuccessful":return{target:"form",key:"onSubmitUnsuccess"};case"Form is updated":return{target:"form",key:"onUpdate"};case"Form is cleared":return{target:"form",key:"onClear"};case"Form is reseted":return{target:"form",key:"onReset"};case"Form is valid":return{target:"form",key:"onIsValid"};case"Form is validated":return{target:"form",key:"onValidated"};default:return console.warn(`Submit64 -> unhandled event target : ${this.type}`),{target:null}}}getActionCallback(){return()=>{this.cyclicActionCallSet.has(this.type)||(this.cyclicActionCallSet.add(this.type),this.action(this.formApi),this.cyclicActionCallSet.clear())}}}class ke{constructor(t){S(this,"formEvent");this.formEvent=t}then(t){return this.formEvent.action=t,this}}const Se={class:"row items-center justify-end"},_e=e.defineComponent({__name:"DateField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",i=e.ref(),c=e.ref();function f(){i.value&&i.value.hide()}function s(){return c.value?c.value.validate():!1}function h(){return c.value?c.value.hasError:!1}function _(){c.value&&c.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(s,h,_)}),(C,V)=>(e.openBlock(),e.createBlock(e.unref(p.QInput),{ref_key:"fieldRef",ref:c,"model-value":t.modelValue,"onUpdate:modelValue":V[1]||(V[1]=x=>t.modelValueOnUpdate(x)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(p.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(p.QPopupProxy),{ref_key:"popupProxyRef",ref:i,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(p.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":V[0]||(V[0]=x=>t.modelValueOnUpdate(x)),mask:e.unref(n).formSettings.dateFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Se,[e.createVNode(e.unref(p.QBtn),{onClick:f,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),Fe={class:"row items-center justify-end"},Ve={class:"row items-center justify-end"},Be=e.defineComponent({__name:"DateTimeField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",i=e.ref(),c=e.ref(),f=e.ref();function s(){i.value&&i.value.hide()}function h(){c.value&&c.value.hide()}function _(){return f.value?f.value.validate():!1}function C(){return f.value?f.value.hasError:!1}function V(){f.value&&f.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(_,C,V)}),(x,F)=>(e.openBlock(),e.createBlock(e.unref(p.QInput),{ref_key:"fieldRef",ref:f,"model-value":t.modelValue,"onUpdate:modelValue":F[2]||(F[2]=b=>t.modelValueOnUpdate(b)),label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,rules:t.rules,onClear:t.clear},{append:e.withCtx(()=>[e.createVNode(e.unref(p.QIcon),{size:"sm",color:"primary",name:"event",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(p.QPopupProxy),{ref_key:"datePopupProxyRef",ref:i,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(p.QDate),{"model-value":t.modelValue,"onUpdate:modelValue":F[0]||(F[0]=b=>t.modelValueOnUpdate(b)),mask:e.unref(n).formSettings.datetimeFormat},{default:e.withCtx(()=>[e.createElementVNode("div",Fe,[e.createVNode(e.unref(p.QBtn),{onClick:s,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1}),e.createVNode(e.unref(p.QIcon),{size:"sm",color:"primary",name:"access_time",class:"cursor-pointer"},{default:e.withCtx(()=>[e.createVNode(e.unref(p.QPopupProxy),{ref_key:"timePopupProxyRef",ref:c,cover:"","transition-show":"scale","transition-hide":"scale"},{default:e.withCtx(()=>[e.createVNode(e.unref(p.QTime),{"model-value":t.modelValue,"onUpdate:modelValue":F[1]||(F[1]=b=>t.modelValueOnUpdate(b)),mask:e.unref(n).formSettings.datetimeFormat,format24h:""},{default:e.withCtx(()=>[e.createElementVNode("div",Ve,[e.createVNode(e.unref(p.QBtn),{onClick:h,label:"Fermer",color:"secondary",flat:"","no-caps":""})])]),_:1},8,["model-value","mask"])]),_:1},512)]),_:1})]),_:1},8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),xe={class:"flex column"},De={key:0,class:"q-field__bottom"},Re={key:1,class:"q-field--error q-field__bottom text-negative"},Ne=e.defineComponent({__name:"CheckboxField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref(!0),o=t.formApi.form.formStyle;function l(){return n.value===!0}function i(){return n.value===!0}function c(){n.value=!0}return e.watch(()=>t.modelValue,f=>{for(const s of t.rules)if(n.value=s(f),n.value!==!0)break}),e.onMounted(()=>{t.registerBehaviourCallbacks(l,i,c)}),(f,s)=>(e.openBlock(),e.createElementBlock("div",xe,[e.createVNode(e.unref(p.QCheckbox),{"model-value":t.modelValue,"onUpdate:modelValue":s[0]||(s[0]=h=>t.modelValueOnUpdate(h)),label:t.field.label,dense:e.unref(o).fieldDense,color:e.unref(o).fieldColor,"aria-readonly":t.field.readonly,class:e.normalizeClass([t.field.cssClass,"q-pb-md"])},null,8,["model-value","label","dense","color","aria-readonly","class"]),t.field.hint?(e.openBlock(),e.createElementBlock("div",De,e.toDisplayString(t.field.hint),1)):e.createCommentVNode("",!0),n.value!==!0?(e.openBlock(),e.createElementBlock("div",Re,e.toDisplayString(n.value),1)):e.createCommentVNode("",!0)]))}}),Ae=e.defineComponent({__name:"ObjectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const n=a.formApi.form,r=n.formSettings;return n.formStyle,r.rulesBehaviour,(o,l)=>" TODO json edit ? "}}),Ee=e.defineComponent({__name:"SelectField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=e.ref([]),r=e.ref([]),o=e.ref(),l=t.formApi.form,i=l.formSettings,c=l.formStyle,f=i.rulesBehaviour==="lazy";function s(F,b){if(F===""){b(()=>{r.value=[...n.value]});return}b(()=>{const B=F.toLowerCase();r.value=n.value.filter(u=>u.label.toLowerCase().includes(B))})}function h(){n.value=Object.freeze(t.field.staticSelectOptions??[]),r.value=t.field.staticSelectOptions??[]}function _(){return o.value?o.value.validate():!1}function C(){return o.value?o.value.hasError:!1}function V(){o.value&&o.value.resetValidation()}function x(){t.clear(),r.value=[]}return e.onMounted(()=>{h(),t.registerBehaviourCallbacks(_,C,V)}),(F,b)=>(e.openBlock(),e.createBlock(e.unref(p.QSelect),{ref_key:"fieldRef",ref:o,"model-value":t.modelValue,"onUpdate:modelValue":b[0]||(b[0]=B=>t.modelValueOnUpdate(B)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(c).fieldOutlined,filled:e.unref(c).fieldFilled,standout:e.unref(c).fieldStandout,borderless:e.unref(c).fieldBorderless,rounded:e.unref(c).fieldRounded,square:e.unref(c).fieldSquare,dense:e.unref(c).fieldDense,hideBottomSpace:e.unref(c).fieldHideBottomSpace,color:e.unref(c).fieldColor,bgColor:e.unref(c).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":f,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:r.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:x,onFilter:s},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}});function U(){return 20}function D(a){a==null||a.forEach(t=>{t()})}const v=e.defineComponent({__name:"SelectBelongsToField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,l=r.formStyle,i=o.rulesBehaviour==="lazy",c=e.ref([]),f=e.ref({limit:U(),offset:0}),s=e.ref();function h(b,B){const u=t.formApi.getAssociationDataCallback();b===""&&(f.value={limit:U(),offset:0}),B(()=>{const y=t.formApi.form;u({resourceName:y.resourceName,resourceId:y.resourceId,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:b,context:y.context}).then(E=>{c.value=E.rows}).catch(()=>{c.value=[]})})}function _(){e.nextTick(()=>{const b=t.getValueSerialized();!b||!t.field.associationData||(c.value=[{label:t.field.associationData.label[0]??"???",value:b,data:t.field.associationData.data[0]}])})}function C(){return s.value?s.value.validate():!1}function V(){return s.value?s.value.hasError:!1}function x(){s.value&&s.value.resetValidation()}function F(){t.clear(),c.value=[]}return e.onMounted(()=>{_(),t.registerBehaviourCallbacks(C,V,x)}),(b,B)=>(e.openBlock(),e.createBlock(e.unref(p.QSelect),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=u=>t.modelValueOnUpdate(u)),type:t.field.componentOptions.regularFieldType,label:t.field.label,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:c.value,mapOptions:!0,emitValue:!0,useInput:!0,onClear:F,onFilter:h},{option:e.withCtx(u=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:u.opt,itemProps:u.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","type","label","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),ee=e.defineComponent({__name:"SelectHasManyField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.field.componentOptions.associationDisplayComponent,r=t.formApi.form,o=r.formSettings,l=r.formStyle,i=o.rulesBehaviour==="lazy",c=e.ref([]),f=e.ref({limit:U(),offset:0}),s=e.ref();function h(b,B){const u=t.formApi.getAssociationDataCallback();b===""&&(f.value={limit:U(),offset:0}),B(()=>{const y=t.formApi.form;u({resourceName:y.resourceName,resourceId:y.resourceId,associationName:t.field.metadata.field_association_name,limit:f.value.limit,offset:f.value.offset,labelFilter:b,context:y.context}).then(E=>{c.value=E.rows}).catch(()=>{c.value=[]})})}function _(){e.nextTick(()=>{const b=t.getValueSerialized();!b||!t.field.associationData||(c.value=b.map((B,u)=>({label:t.field.associationData.label[u]??"???",value:B,data:t.field.associationData.data[u]})))})}function C(){return s.value?s.value.validate():!1}function V(){return s.value?s.value.hasError:!1}function x(){s.value&&s.value.resetValidation()}function F(){t.clear(),c.value=[]}return e.onMounted(()=>{_(),t.registerBehaviourCallbacks(C,V,x)}),(b,B)=>(e.openBlock(),e.createBlock(e.unref(p.QSelect),{ref_key:"fieldRef",ref:s,"model-value":t.modelValue,"onUpdate:modelValue":B[0]||(B[0]=u=>t.modelValueOnUpdate(u)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(l).fieldOutlined,filled:e.unref(l).fieldFilled,standout:e.unref(l).fieldStandout,borderless:e.unref(l).fieldBorderless,rounded:e.unref(l).fieldRounded,square:e.unref(l).fieldSquare,dense:e.unref(l).fieldDense,hideBottomSpace:e.unref(l).fieldHideBottomSpace,color:e.unref(l).fieldColor,bgColor:e.unref(l).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":i,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,options:c.value,mapOptions:!0,emitValue:!0,useInput:!0,multiple:!0,"use-chips":!0,onClear:F,onFilter:h},{option:e.withCtx(u=>[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(n)),{associationName:t.field.metadata.field_association_name,entry:u.opt,itemProps:u.itemProps},null,8,["associationName","entry","itemProps"]))]),_:1},8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","options"]))}}),te=e.defineComponent({__name:"StringField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",i=e.ref();function c(){return i.value?i.value.validate():!1}function f(){return i.value?i.value.hasError:!1}function s(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,f,s)}),(h,_)=>(e.openBlock(),e.createBlock(e.unref(p.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=C=>t.modelValueOnUpdate(C)),type:t.field.componentOptions.regularFieldType,label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,clearable:t.field.clearable,autogrow:!0,rules:t.rules,onClear:t.clear},null,8,["model-value","type","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","prefix","suffix","readonly","clearable","rules","onClear"]))}}),we=e.defineComponent({__name:"NumberField",props:{modelValue:{},field:{},formApi:{},rules:{},modelValueOnUpdate:{type:Function},reset:{type:Function},clear:{type:Function},getValueSerialized:{type:Function},getValueDeserialized:{type:Function},registerBehaviourCallbacks:{type:Function}},setup(a){const t=a,n=t.formApi.form,r=n.formSettings,o=n.formStyle,l=r.rulesBehaviour==="lazy",i=e.ref();function c(){return i.value?i.value.validate():!1}function f(){return i.value?i.value.hasError:!1}function s(){i.value&&i.value.resetValidation()}return e.onMounted(()=>{t.registerBehaviourCallbacks(c,f,s)}),(h,_)=>(e.openBlock(),e.createBlock(e.unref(p.QInput),{ref_key:"fieldRef",ref:i,"model-value":t.modelValue,"onUpdate:modelValue":_[0]||(_[0]=C=>t.modelValueOnUpdate(C)),type:"number",label:t.field.label,hint:t.field.hint,outlined:e.unref(o).fieldOutlined,filled:e.unref(o).fieldFilled,standout:e.unref(o).fieldStandout,borderless:e.unref(o).fieldBorderless,rounded:e.unref(o).fieldRounded,square:e.unref(o).fieldSquare,dense:e.unref(o).fieldDense,hideBottomSpace:e.unref(o).fieldHideBottomSpace,color:e.unref(o).fieldColor,bgColor:e.unref(o).fieldBgColor,class:e.normalizeClass(t.field.cssClass),"lazy-rules":l,clearable:t.field.clearable,prefix:t.field.prefix,suffix:t.field.suffix,readonly:t.field.readonly,rules:t.rules,onClear:t.clear},null,8,["model-value","label","hint","outlined","filled","standout","borderless","rounded","square","dense","hideBottomSpace","color","bgColor","class","clearable","prefix","suffix","readonly","rules","onClear"]))}});class O{constructor(t,n,r,o,l,i,c,f,s){S(this,"resourceName");S(this,"resourceId");S(this,"formMetadataAndData");S(this,"context");S(this,"formSettings");S(this,"formStyle");S(this,"actionComponent");S(this,"orphanErrorsComponent");S(this,"sectionComponent");S(this,"wrapperResetComponent");S(this,"associationDisplayComponent");S(this,"dynamicComponentRecord");S(this,"formApi");S(this,"registerEventCallback");this.dynamicComponentRecord=r.dynamicComponentRecord??{},this.formMetadataAndData=o,this.resourceId=n,this.context=c,this.resourceName=t,this.formApi=f,this.formSettings={...l,...A.getGlobalFormSetting(),backendDateFormat:o.form.backend_date_format,backendDatetimeFormat:o.form.backend_datetime_format},this.formStyle={...i,...A.getGlobalFormStyle()},this.actionComponent=r.actionComponent??A.getGlobalActionComponent(),this.orphanErrorsComponent=r.orphanErrorsComponent??A.getGlobalOrphanErrorComponent(),this.sectionComponent=r.sectionComponent??A.getGlobalSectionComponent(),this.wrapperResetComponent=r.wrapperResetComponent??A.getGlobalWrapperResetComponent(),this.associationDisplayComponent=r.associationDisplayComponent??A.getGlobalAssociationDisplayComponent(),this.registerEventCallback=s??(()=>{})}static getEmptyFormBeforeInit(){return{resourceName:"",sections:[],formSettings:{...A.getGlobalFormSetting(),backendDateFormat:"YYYY/MM/DD",backendDatetimeFormat:"YYYY/MM/DD HH:mm"},formStyle:A.getGlobalFormStyle(),events:{},actionComponent:e.markRaw(A.getGlobalActionComponent()),orphanErrorsComponent:e.markRaw(A.getGlobalOrphanErrorComponent()),wrapperResetComponent:e.markRaw(A.getGlobalWrapperResetComponent()),dynamicComponentRecord:{}}}static getForm(t,n,r,o,l,i,c,f,s){return new O(t,n,r,o,l,i,c,f,s).generateFormDef()}generateFormDef(){const t=$.create(this.formApi);this.registerEventCallback(t);const n=$.getEventsObjectFromInstance(t),r=[];return this.formMetadataAndData.form.sections.forEach((l,i)=>{const c=[];l.fields.forEach(C=>{const V=this.dynamicComponentRecord[`field-${C.field_name}-before`],x=O.getFieldComponentByFormFieldType(C.field_type),F=this.dynamicComponentRecord[`field-${C.field_name}-after`],b={associationDisplayComponent:e.markRaw(this.associationDisplayComponent),regularFieldType:O.getRegularFieldTypeByFieldType(C.field_type)},B={type:C.field_type,metadata:Object.freeze(C),label:C.label,hint:C.hint??void 0,prefix:C.prefix??void 0,suffix:C.suffix??void 0,readonly:this.formMetadataAndData.form.readonly??l.readonly??C.readonly??void 0,cssClass:C.css_class??void 0,staticSelectOptions:C.static_select_options,associationData:C.field_association_data,rules:C.rules,clearable:this.formMetadataAndData.form.clearable??void 0,hidden:!1,beforeComponent:V?e.markRaw(V):void 0,mainComponent:e.markRaw(x),afterComponent:F?e.markRaw(F):void 0,events:n.fields[C.field_name]??{},componentOptions:b};c.push(B)});const f=this.dynamicComponentRecord[`section-${l.name??i}-before`],s=this.sectionComponent,h=this.dynamicComponentRecord[`section-${l.name??i}-after`],_={label:l.label??void 0,icon:l.icon??void 0,cssClass:l.css_class??void 0,hidden:!1,name:l.name??i.toString(),readonly:this.formMetadataAndData.form.readonly??l.readonly??void 0,events:n.sections[l.name??i.toString()]??{},beforeComponent:f?e.markRaw(f):void 0,mainComponent:e.markRaw(s),afterComponent:h?e.markRaw(h):void 0,fields:c};r.push(_)}),{sections:r,resourceName:this.formMetadataAndData.form.resource_name,resourceId:this.resourceId,formSettings:this.formSettings,formStyle:this.formStyle,cssClass:this.formMetadataAndData.form.css_class??void 0,resetable:this.formMetadataAndData.form.resetable??void 0,clearable:this.formMetadataAndData.form.clearable??void 0,readonly:this.formMetadataAndData.form.readonly??void 0,events:n.form,actionComponent:e.markRaw(this.actionComponent),orphanErrorsComponent:e.markRaw(this.orphanErrorsComponent),wrapperResetComponent:e.markRaw(this.wrapperResetComponent),dynamicComponentRecord:this.dynamicComponentRecord,context:this.context}}static getRegularFieldTypeByFieldType(t){return{text:"textarea"}[t]||void 0}static getFieldComponentByFormFieldType(t){return{string:te,text:te,number:we,date:_e,datetime:Be,selectString:Ee,selectBelongsTo:v,selectHasMany:ee,selectHasAndBelongsToMany:ee,selectHasOne:v,checkbox:Ne,object:Ae}[t]}}function Te(a,t,n){const r=n.form,o=(f,s,h)=>f[s]?h?()=>l(f[s]):()=>f[s]:f.compare_to?()=>{var _;return((_=n.getFieldByName(f.compare_to))==null?void 0:_.getValueSerialized())??"Submit64 error : missing comparator definition"}:()=>"",l=f=>String(p.date.formatDate(p.date.extractDate(f,r.formSettings.backendDateFormat),r.formSettings.dateFormat)),i=[],c=[];switch(t){case"date":i.push(oe(r.formSettings.dateFormat));break;case"datetime":i.push(oe(r.formSettings.datetimeFormat));break}return a.forEach(f=>{const s=f;switch(s.type){case"required":i.push(Oe());break;case"absence":i.push($e());break;case"acceptance":i.push(Ie());break;case"inclusion":i.push(ne(s.including));break;case"exclusion":i.push(ze(s.excluding));break;case"backend":break;case"allowNull":c.push("allowNull");break;case"allowBlank":c.push("allowBlank");break;case"positiveNumber":i.push(qe());break;case"lessThanOrEqualNumber":i.push(Le(o(s,"less_than")));break;case"lessThanNumber":i.push(Qe(o(s,"less_than")));break;case"greaterThanOrEqualNumber":i.push(Ge(o(s,"greater_than")));break;case"greaterThanNumber":i.push(He(o(s,"greater_than")));break;case"equalToNumber":i.push(Me(o(s,"equal_to")));break;case"otherThanNumber":i.push(je(o(s,"other_than")));break;case"numberIntegerOnly":i.push(Ye());break;case"numberNumericOnly":i.push(We());break;case"numberEvenOnly":i.push(Je());break;case"numberOddOnly":i.push(Ke());break;case"lessThanOrEqualStringLength":i.push(Xe(o(s,"less_than")));break;case"lessThanStringLength":i.push(Ze(o(s,"less_than")));break;case"greaterThanOrEqualStringLength":i.push(ve(o(s,"greater_than")));break;case"greaterThanStringLength":i.push(et(o(s,"greater_than")));break;case"equalToStringLength":i.push(ot(o(s,"equal_to")));break;case"equalToString":i.push(nt(o(s,"equal_to")));break;case"betweenStringLength":i.push(tt(()=>s.min,()=>s.max));break;case"otherThanString":i.push(rt(o(s,"other_than")));break;case"lessThanOrEqualDate":i.push(at(o(s,"less_than",!0),r.formSettings.dateFormat));break;case"lessThanDate":i.push(it(o(s,"less_than",!0),r.formSettings.dateFormat));break;case"greaterThanOrEqualDate":i.push(lt(o(s,"greater_than",!0),r.formSettings.dateFormat));break;case"greaterThanDate":i.push(st(o(s,"greater_than",!0),r.formSettings.dateFormat));break;case"equalToDate":i.push(ct(o(s,"equal_to",!0),r.formSettings.dateFormat));break;case"otherThanDate":i.push(dt(o(s,"other_than",!0),r.formSettings.dateFormat));break}}),c.length>0?c.map(f=>{switch(f){case"allowBlank":return Pe(i);case"allowNull":return Ue(i)}}):i}function Oe(){return a=>!!a||"Ce champ est requis"}function ne(a){return t=>a.includes(String(t))||`Doit être contenu dans ${a.toString()}`}function ze(a){return t=>!a.includes(String(t)||`Ne doit pas être contenu dans ${ne.toString()}`)}function $e(){return a=>!a||"Ce champ doit être vide"}function Ie(){return a=>!!a||"Doit être accepté"}function Ue(a){return t=>(t===null||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function Pe(a){return t=>(t===""||a.forEach(n=>{const r=n(t);if(r!==!0)return r}),!0)}function qe(){return a=>Number(a)>0||"Val. positive uniquement"}function Le(a){return t=>{const n=a();return Number(t)<=n||`Inf. ou égal à ${n}`}}function Qe(a){return t=>{const n=a();return Number(t)<n||`Inf. ${n}`}}function Ge(a){return t=>{const n=a();return Number(t)>=n||`Sup. ou égal à ${n}`}}function He(a){return t=>{const n=a();return Number(t)>n||`Sup. à ${n}`}}function Me(a,t){return n=>{const r=a();return Number(n)===r||`Égale à ${r}`}}function je(a,t){return n=>{const r=a();return Number(n)!==r||`Doit être différent de ${a}`}}function Ye(){return a=>/^-?\d+$/.test(String(a).trim())||"Nombre entier uniquement"}function We(){return a=>/^-?\d+(\.\d+)?$/.test(String(a).trim())||"Caractère numérique uniquement"}function Je(){return a=>Number.isInteger(Number(a))&&Number(a)%2===0||"Nombre pair uniquement"}function Ke(){return a=>Number.isInteger(Number(a))&&Number(a)%2===1||"Nombre impair uniquement"}function Xe(a){return t=>{const n=a();return String(t).length<=n||`Inf. ou égal à ${n}`}}function Ze(a){return t=>{const n=a();return String(t).length<n||`Inf. à ${n}`}}function ve(a){return t=>{const n=a();return String(t).length>=n||`Sup. ou égal à ${n}`}}function et(a){return t=>{const n=a();return String(t).length>n||`Sup. à ${n}`}}function tt(a,t){return n=>{const r=a(),o=t();return String(n).length>=r&&String(n).length<=o||`Entre ${r} et ${o}`}}function nt(a,t){return n=>{const r=a();return String(n)===r||`Égale à ${r}`}}function ot(a){return t=>{const n=a();return String(t).length===n||`Doit contenir ${n} caractères`}}function rt(a){return t=>{const n=a();return String(t)!==n||`Doit être différent de ${n}`}}function at(a,t){return n=>{const r=a(),o=p.date.extractDate(String(n),t),l=p.date.extractDate(r,t);return o<=l||`Inf. ou égal à ${r}`}}function it(a,t){return n=>{const r=a(),o=p.date.extractDate(String(n),t),l=p.date.extractDate(r,t);return o<l||`Inf. à ${r}`}}function lt(a,t){return n=>{const r=a(),o=p.date.extractDate(String(n),t),l=p.date.extractDate(r,t);return o>=l||`Sup. ou égal à ${r}`}}function st(a,t){return n=>{const r=a(),o=p.date.extractDate(String(n),t),l=p.date.extractDate(r,t);return o>l||`Sup. à ${r}`}}function ct(a,t){return n=>{const r=a(),o=p.date.extractDate(String(n),t),l=p.date.extractDate(r,t);return o===l||`Égale à ${o}`}}function dt(a,t){return n=>{const r=a();return p.date.extractDate(String(n),t)!==p.date.extractDate(r,t)||`Doit être différent de ${r}`}}function oe(a){return t=>t==null||t===""?!0:ft(t,a)||`Date invalide. Format : ${a}`}function ft(a,t){if(typeof a!="string"||!a.trim())return!1;const n=p.date.extractDate(a,t);return!(n instanceof Date)||isNaN(n.getTime())?!1:p.date.formatDate(n,t)===a}const ut={computeServerRules:Te},mt={key:2,class:"q-field__bottom text-negative q-pt-none"},pt=["index"],ht=e.defineComponent({__name:"FieldWrapper",props:{field:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a;let r=()=>!0,o=()=>!0,l=()=>{};const i=V(),c=e.ref(),f=e.ref([]);function s(){c.value=n.formApi.getInitialValueByFieldName(n.field.metadata.field_name),c.value=h(c.value),D(n.field.events.onReset),e.nextTick(()=>{j()})}function h(m){const k=n.formApi.form;switch(n.field.type){case"checkbox":return m==null||m===""?!1:m;case"date":return m==null||m===""?null:p.date.formatDate(p.date.extractDate(String(m),k.formSettings.backendDateFormat),k.formSettings.dateFormat);case"datetime":return m==null||m===""?null:p.date.formatDate(p.date.extractDate(String(m),k.formSettings.backendDatetimeFormat),k.formSettings.datetimeFormat)}return m}function _(m){const k=n.formApi.form;switch(n.field.type){case"date":return m==null||m===""?null:p.date.formatDate(p.date.extractDate(String(m),k.formSettings.dateFormat),k.formSettings.backendDateFormat);case"datetime":return m==null||m===""?null:p.date.formatDate(p.date.extractDate(String(m),k.formSettings.datetimeFormat),k.formSettings.backendDatetimeFormat)}return m}function C(){switch(n.field.type){case"string":c.value="";break;case"checkbox":c.value=!1;break;case"date":c.value=null;break;case"datetime":c.value=null;break;case"number":c.value=null;break;case"selectString":c.value=void 0;break;case"text":c.value="";break;case"object":c.value={};break;case"selectBelongsTo":c.value=void 0;break;case"selectHasMany":c.value=void 0;break}D(n.field.events.onClear)}function V(){return ut.computeServerRules(n.field.rules??[],n.field.type,n.formApi)}function x(m){c.value=m}function F(){return e.unref(c)}function b(){return _(e.unref(c))}function B(m){f.value=m}function u(){const m=n.privateFormApi.getFieldRef(n.field.metadata.field_name);m&&(m.hidden=!0)}function y(){const m=n.privateFormApi.getFieldRef(n.field.metadata.field_name);m&&(m.hidden=!1)}function E(m){const k=n.privateFormApi.getFieldRef(n.field.metadata.field_name);k&&(k.readonly=m)}function q(m){const k=n.privateFormApi.getFieldRef(n.field.metadata.field_name);k&&(k.hint=m)}function L(m){const k=n.privateFormApi.getFieldRef(n.field.metadata.field_name);k&&(k.cssClass=m)}function Q(m){const k=n.privateFormApi.getFieldRef(n.field.metadata.field_name);k&&(k.suffix=m)}function G(m){const k=n.privateFormApi.getFieldRef(n.field.metadata.field_name);k&&(k.prefix=m)}function J(m){const k=n.privateFormApi.getFieldRef(n.field.metadata.field_name);k&&(k.label=m)}function H(){const m=r();return D(n.field.events.onValidated),m}function M(){return o()}function j(){return l()}function K(m,k,I){r=m,o=k,l=I}const X={reset:s,clear:C,validate:H,isValid:M,hide:u,unhide:y,resetValidation:j,getValueDeserialized:b,getValueSerialized:F,setupBackendErrors:B,setReadonlyState:E,setHint:q,setCssClass:L,setSuffix:Q,setPrefix:G,setLabel:J,setValue:x,field:n.field};return t(X),e.watch(()=>n.field.events.onUpdate?c.value:null,()=>{D(n.field.events.onUpdate)}),e.watch(()=>n.field.events.onIsValid?M():null,m=>{m&&D(n.field.events.onIsValid)}),e.onMounted(()=>{var k;s();const m=(k=e.getCurrentInstance())==null?void 0:k.exposed;m&&n.formApi&&n.privateFormApi.registerFieldWrapperRef(n.field.metadata.field_name,m)}),(m,k)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",null,[n.field.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.beforeComponent),{key:0,field:n.field,formApi:n.formApi},null,8,["field","formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.mainComponent),{modelValue:c.value,field:n.field,formApi:n.formApi,rules:e.unref(i),reset:s,clear:C,getValueDeserialized:b,getValueSerialized:F,validate:H,modelValueOnUpdate:x,registerBehaviourCallbacks:K},null,8,["modelValue","field","formApi","rules"])),n.field.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.field.afterComponent),{key:1,field:n.field,formApi:n.formApi},null,8,["field","formApi"])):e.createCommentVNode("",!0),f.value.length>0?(e.openBlock(),e.createElementBlock("div",mt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(f.value,(I,Z)=>(e.openBlock(),e.createElementBlock("div",{index:Z,class:"flex column"},e.toDisplayString(I),9,pt))),256))])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.field.hidden!==!0]])}}),gt={class:"flex column"},yt=e.defineComponent({__name:"SectionWrapper",props:{section:{},formApi:{},privateFormApi:{}},setup(a,{expose:t}){const n=a,r=new Map,o={reset:i,clear:c,validate:h,isValid:_,hide:f,unhide:s,resetValidation:C,getFields:V,setReadonlyState:x,setCssClass:F,setIcon:b,setLabel:B,section:n.section};function l(){n.section.fields.forEach(u=>{const y=u.metadata.field_name,E=n.formApi.getFieldByName(y);E&&r.set(y,E)})}function i(){r.forEach(u=>{u.reset()}),D(n.section.events.onReset)}function c(){r.forEach(u=>{u.clear()}),D(n.section.events.onClear)}function f(){const u=n.privateFormApi.getSectionRef(n.section.name);u&&(r.forEach(y=>{y.hide()}),u.hidden=!0,D(n.section.events.onHide))}function s(){const u=n.privateFormApi.getSectionRef(n.section.name);u&&(r.forEach(y=>{y.unhide()}),u.hidden=!1,D(n.section.events.onUnhide))}function h(){let u=!0;return r.forEach(y=>{if(!y.validate()){u=!1;return}}),D(n.section.events.onValidated),u}function _(){let u=!0;return r.forEach(y=>{if(!y.isValid()){u=!1;return}}),u}function C(){r.forEach(u=>{u.resetValidation()})}function V(){return r}function x(u){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(y.readonly=u)}function F(u){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(y.cssClass=u)}function b(u){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(y.icon=u)}function B(u){const y=n.privateFormApi.getSectionRef(n.section.name);y&&(y.label=u)}return t(o),e.watch(()=>n.section.events.onIsValid?_():null,u=>{u&&D(n.section.events.onIsValid)}),e.onMounted(()=>{var y;const u=(y=e.getCurrentInstance())==null?void 0:y.exposed;u&&n.privateFormApi.registerSectionWrapperRef(n.section.name,u),e.nextTick(()=>{l()})}),(u,y)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",gt,[n.section.beforeComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.beforeComponent),{key:0,formApi:n.formApi,sectionApi:o},null,8,["formApi"])):e.createCommentVNode("",!0),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.mainComponent),{sectionApi:o,formApi:n.formApi},{default:e.withCtx(()=>[e.renderSlot(u.$slots,"default")]),_:3},8,["formApi"])),n.section.afterComponent?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.section.afterComponent),{key:1,formApi:n.formApi,sectionApi:o},null,8,["formApi"])):e.createCommentVNode("",!0)],512)),[[e.vShow,n.section.hidden!==!0]])}}),Ct={class:"flex column"},bt=e.defineComponent({__name:"Submit64Form",props:{resourceName:{},getMetadataAndData:{},getSubmitFormData:{},getAssociationData:{},resourceId:{},formSettings:{},formStyle:{},actionComponent:{},orphanErrorsComponent:{},sectionComponent:{},wrapperResetComponent:{},associationDisplayComponent:{},associationDisplayRecord:{},eventManager:{},context:{}},setup(a,{expose:t}){const n=a;let r=null,o="",l=0,i=0;const c=e.useSlots(),f=new Map,s=new Map,h=e.ref(O.getEmptyFormBeforeInit()),_=e.ref(!1),C=e.ref(!1),V=e.ref(!1),x=e.ref(!1),F=e.ref("create"),b=e.ref({});async function B(){r=await n.getMetadataAndData({resourceName:n.resourceName,resourceId:n.resourceId,context:n.context}),h.value=O.getForm(n.resourceName,n.resourceId,y(),r,n.formSettings,n.formStyle,n.context,z,n.eventManager),l=h.value.sections.length,i=h.value.sections.map(d=>d.fields).flat().length,n.resourceId&&(F.value="edit")}async function u(){var R,w,Y;if(!q())return;x.value=!0,H();const d=E(),g=await n.getSubmitFormData({resourceName:n.resourceName,resourceId:n.resourceId,resourceData:d,context:n.context});if(g.success)b.value={},F.value==="create"&&(F.value="edit"),r&&g.resource_data&&(r.resource_data=g.resource_data),o=JSON.stringify(E()),D((w=h.value)==null?void 0:w.events.onSubmitUnsuccess);else{b.value={};const W=[];[...f].forEach(T=>{const le=g.errors[T[0]];le&&(T[1].setupBackendErrors(le),W.push(T[0]))}),Object.entries(g.errors).forEach(T=>{W.includes(T[0])||(b.value[T[0]]=T[1])}),D((R=h.value)==null?void 0:R.events.onSubmitSuccess)}D((Y=h.value)==null?void 0:Y.events.onSubmit),x.value=!1}function y(){const d={sectionComponent:n.sectionComponent,actionComponent:n.actionComponent,orphanErrorsComponent:n.orphanErrorsComponent,associationDisplayComponent:n.associationDisplayComponent,dynamicComponentRecord:{}};for(const g in c){const R=c[g];if(R){const w=e.defineComponent({inheritAttrs:!1,setup(Y,{attrs:W,slots:T}){return()=>R({...Y,...W,slots:T})}});switch(g){case"sections":d.sectionComponent=w;break;case"actions":d.actionComponent=w;break;case"orphan-errors":d.orphanErrorsComponent=w;break;case"association-display":d.associationDisplayComponent=w;break;default:d.dynamicComponentRecord[g]=w;break}}}return d}function E(){const d={};return[...f].forEach(g=>{d[g[0]]=g[1].getValueDeserialized()}),d}function q(){var g;let d=!0;return f.forEach(R=>{if(!R.validate()){d=!1;return}}),D((g=h.value)==null?void 0:g.events.onValidated),d}function L(){let d=!0;return f.forEach(g=>{if(!g.isValid()){d=!1;return}}),d}function Q(){var d;f.forEach(g=>{g.reset()}),D((d=h.value)==null?void 0:d.events.onReset)}function G(){var d;f.forEach(g=>{g.clear()}),D((d=h.value)==null?void 0:d.events.onClear)}function J(){f.forEach(d=>{d.resetValidation()})}function H(){f.forEach(d=>{d.setupBackendErrors([])})}function M(d){if(r)return r.resource_data[d]}function j(d){return s.get(d)}function K(d){return[...s.values()].at(d)}function X(){return s}function m(d){return f.get(d)}function k(){return f}function I(){return n.getAssociationData??(async()=>({rows:[],row_count:0}))}function Z(){["getMetadataAndData","resourceName"].forEach(g=>{(n[g]===null||n[g]===void 0)&&console.warn(`Missing props for <Submit64> -> ${g}`)})}function kt(){return e.unref(F)}function St(){return o!==JSON.stringify(E())}function _t(d){h.value&&(h.value.context=d)}function Ft(d){h.value&&(h.value.cssClass=d)}function Vt(d){h.value&&(h.value.readonly=d)}function Bt(){return V.value}function xt(){return h}function Dt(d){var g;return(g=h.value)==null?void 0:g.sections.find(R=>R.name===d)}function Rt(d){var g;return(g=h.value)==null?void 0:g.sections.map(R=>R.fields).flat().find(R=>R.metadata.field_name===d)}function re(d,g){s.set(d,g),l===s.size&&(_.value=!0)}function ae(d,g){f.set(d,g),i===f.size&&(C.value=!0)}const ie={getFormRef:xt,getSectionRef:Dt,getFieldRef:Rt,registerSectionWrapperRef:re,registerFieldWrapperRef:ae},Nt=new Proxy({},{get(d,g){var R;return(R=h.value)==null?void 0:R[g]}}),z={getMode:kt,getSectionByName:j,getSectionByIndex:K,getSections:X,getFieldByName:m,getFields:k,validate:q,isFormValid:L,reset:Q,clear:G,resetValidation:J,submit:u,valuesHasChanged:St,getInitialValueByFieldName:M,getAssociationDataCallback:I,setContext:_t,setCssClass:Ft,setReadonlyState:Vt,isReady:Bt,form:Nt};return t(z),e.watch(()=>_.value&&C.value,d=>{var g;d&&!V.value&&(D((g=h.value)==null?void 0:g.events.onReady),V.value=!0)}),e.watch(()=>{var d;return(d=h.value)!=null&&d.events.onIsValid?L():null},()=>{var d;D((d=h.value)==null?void 0:d.events.onIsValid)}),e.watch(()=>{var d;return(d=h.value)!=null&&d.events.onUpdate?E():null},()=>{var d;D((d=h.value)==null?void 0:d.events.onUpdate)}),e.onMounted(async()=>{Z(),await B(),e.nextTick(()=>{o=JSON.stringify(E())})}),(d,g)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",Ct,[e.createElementVNode("div",{class:e.normalizeClass(h.value.cssClass??"flex column q-pa-sm q-gutter-sm")},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value.sections,R=>(e.openBlock(),e.createBlock(yt,{key:R.name,section:R,context:n.context,formApi:z,privateFormApi:ie,registerRef:re},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(R.fields,w=>(e.openBlock(),e.createBlock(ht,{key:w.metadata.field_name,field:w,context:n.context,formApi:z,privateFormApi:ie,registerRef:ae},null,8,["field","context"]))),128))]),_:2},1032,["section","context"]))),128))],2),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(h.value.orphanErrorsComponent),{orphanErrors:b.value,formApi:z},null,8,["orphanErrors"])),(e.openBlock(),e.createBlock(e.resolveDynamicComponent(h.value.actionComponent),{isLoadingSubmit:x.value,submit:u,clear:h.value.clearable?G:void 0,reset:h.value.resetable?Q:void 0,formApi:z},null,8,["isLoadingSubmit","clear","reset"]))],512)),[[e.vShow,V.value]])}});N.DynamicLogicBuilder=$,N.Submit64=A,N.Submit64Form=bt,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
